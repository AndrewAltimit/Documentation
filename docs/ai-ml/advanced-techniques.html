<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

<!-- SEO Meta Tags -->
<meta name="description" content="Technology and Physics notes">
<meta name="author" content="Andrew">

<!-- Open Graph -->
<meta property="og:title" content="Advanced Techniques & Workflows">
<meta property="og:description" content="Technology and Physics notes">
<meta property="og:type" content="website">
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/ai-ml/advanced-techniques.html">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Advanced Techniques & Workflows">
<meta name="twitter:description" content="Technology and Physics notes">

<title>Advanced Techniques & Workflows | Andrews Notebook</title>


  <link href="/Documentation/feed.xml" type="application/atom+xml" rel="alternate" title="Andrews Notebook Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Documentation/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<!-- Custom styles -->
<!-- MathJax for LaTeX equation rendering -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
/* MathJax equation styling */
mjx-container {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
}

mjx-container[display="true"] {
  display: block !important;
  margin: 1.5em 0 !important;
  text-align: center;
}

mjx-container[display="true"] svg {
  max-width: 100%;
  height: auto;
}

/* Inline equations */
mjx-container:not([display="true"]) {
  display: inline !important;
  margin: 0 0.1em;
}

/* Equation numbering (if used) */
.MathJax .mjx-mtr {
  margin: 0.25em 0;
}

/* Better scrolling for wide equations on mobile */
@media (max-width: 768px) {
  mjx-container[display="true"] {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}
</style>

<!-- Custom styles for documentation -->
<link rel="stylesheet" href="/Documentation/style.css?v=2.0.1">
<link rel="stylesheet" href="/Documentation/assets/css/condensed.css?v=2.0.1">
<style>
  /* Widescreen optimized layout */
  body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  /* Main container - full width */
  #main {
    display: flex;
    position: relative;
    min-height: 100vh;
    width: 100%;
    max-width: 100%;
  }
  
  /* Sidebar fixed to left edge */
  .sidebar.sticky {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-right: 1px solid #e1e4e8;
    padding: 2rem 1rem;
    z-index: 100;
  }
  
  /* Sidebar navigation styling */
  .nav__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__title {
    margin: 1.5rem 0 0.5rem;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    border-bottom: 1px solid #e1e4e8;
  }
  
  .nav__items {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__items a {
    display: block;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }
  
  .nav__items a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }
  
  .nav__items a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }
  
  /* Content area with left margin for sidebar */
  article.page {
    margin-left: 280px;
    min-height: 100vh;
    background: white;
    width: calc(100% - 280px);
    max-width: none;
  }
  
  /* Content wrapper - use full width */
  .page__inner-wrap {
    max-width: none;
    margin: 0;
    padding: 2rem 3rem;
  }
  
  .page__title {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Let content use available width */
  .page__content {
    max-width: none;
    width: 100%;
  }
  
  /* For optimal reading, constrain just the text paragraphs */
  .page__content > p,
  .page__content > ul,
  .page__content > ol {
    max-width: 65ch;
  }
  
  /* Let code blocks, tables, and special content use full width */
  .page__content pre,
  .page__content table,
  .page__content .noteBoxes,
  .page__content figure,
  .page__content .highlight {
    max-width: 100%;
  }
  
  /* Wide note boxes */
  .noteBoxes {
    width: 90% !important;
    max-width: 800px;
  }
  
  /* Tables use available width */
  table {
    width: 100%;
    max-width: 100%;
  }
  
  /* Code blocks optimization */
  pre {
    max-width: 100%;
    overflow-x: auto;
  }
  
  .highlight {
    max-width: 100%;
    margin: 1rem 0;
  }
  
  /* Responsive adjustments */
  @media (min-width: 2000px) {
    .sidebar.sticky {
      width: 320px;
    }
    
    article.page {
      margin-left: 320px;
      width: calc(100% - 320px);
    }
    
    .page__inner-wrap {
      padding: 2rem 4rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 75ch;
    }
  }
  
  @media (min-width: 1024px) and (max-width: 1439px) {
    .sidebar.sticky {
      width: 250px;
    }
    
    article.page {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    
    .page__inner-wrap {
      padding: 2rem 2rem;
    }
  }
  
  /* Tablet and mobile */
  @media (max-width: 1023px) {
    #main {
      flex-direction: column;
    }
    
    .sidebar.sticky {
      position: relative;
      width: 100%;
      height: auto;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
      padding: 1rem;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
    
    .page__inner-wrap {
      padding: 1rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 100%;
    }
  }
  
  /* Mobile navigation toggle */
  .nav-toggle {
    display: none;
  }
  
  @media (max-width: 1023px) {
    .nav-toggle {
      display: block;
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 200;
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .sidebar.sticky {
      position: fixed;
      left: -100%;
      top: 0;
      transition: left 0.3s ease;
      z-index: 150;
      height: 100vh;
      width: 280px;
    }
    
    .sidebar.sticky.active {
      left: 0;
    }
    
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 140;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
  }
</style>

<!-- Mobile navigation toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  if (window.innerWidth <= 1023) {
    if (!document.querySelector('.nav-toggle')) {
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'nav-toggle';
      toggleBtn.innerHTML = '‚ò∞ Menu';
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
      document.body.appendChild(toggleBtn);
      
      const overlay = document.createElement('div');
      overlay.className = 'sidebar-overlay';
      document.body.appendChild(overlay);
      
      toggleBtn.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });
      
      overlay.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    }
  }
  
  // Handle window resize
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const sidebar = document.querySelector('.sidebar.sticky');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggle = document.querySelector('.nav-toggle');
      
      if (window.innerWidth > 1023) {
        if (sidebar) sidebar.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        if (toggle) toggle.style.display = 'none';
      } else {
        if (toggle) toggle.style.display = 'block';
      }
    }, 250);
  });
});
</script>


  
    <script src="/Documentation/assets/js/custom.js"></script>
  

</head>
<body>
  <div id="main" role="main">
  <aside class="sidebar sticky">
    <nav class="nav__list">
      
        
          <h3 class="nav__title">Navigation</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/topic-map.html"
                     >
                    <span class="nav__sub-title">üó∫Ô∏è Topic Map</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/search.html"
                     >
                    <span class="nav__sub-title">üîç Search</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html"
                     >
                    <span class="nav__sub-title">üìã Reference Index</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Technology</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/technology/index.html"
                     >
                    <span class="nav__sub-title">Technology Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/git-reference.html"
                     >
                    <span class="nav__sub-title">Git Command Reference</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/docker-essentials.html"
                     >
                    <span class="nav__sub-title">Docker Essentials</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/terraform.html"
                     >
                    <span class="nav__sub-title">Terraform</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/docker.html"
                     >
                    <span class="nav__sub-title">Docker</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/aws.html"
                     >
                    <span class="nav__sub-title">AWS</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/kubernetes.html"
                     >
                    <span class="nav__sub-title">Kubernetes</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/database-design.html"
                     >
                    <span class="nav__sub-title">Database Design</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/networking.html"
                     >
                    <span class="nav__sub-title">Networking</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/cybersecurity.html"
                     >
                    <span class="nav__sub-title">Cybersecurity</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/git.html"
                     >
                    <span class="nav__sub-title">Git</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/branching.html"
                     >
                    <span class="nav__sub-title">Branching Strategies</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ci-cd.html"
                     >
                    <span class="nav__sub-title">CI/CD</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/unreal.html"
                     >
                    <span class="nav__sub-title">Unreal Engine</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai.html"
                     >
                    <span class="nav__sub-title">AI Fundamentals</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai-fundamentals-simple.html"
                     >
                    <span class="nav__sub-title">AI Fundamentals (Simple)</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai-lecture-2023.html"
                     >
                    <span class="nav__sub-title">AI Lecture 2023</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/please-build.html"
                     >
                    <span class="nav__sub-title">Please Build</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Specialized Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/distributed-systems/index.html"
                     >
                    <span class="nav__sub-title">Distributed Systems Hub</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/quantum-computing/index.html"
                     >
                    <span class="nav__sub-title">Quantum Computing Hub</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/artificial-intelligence/index.html"
                     >
                    <span class="nav__sub-title">Artificial Intelligence Hub</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/gamedev/index.html"
                     >
                    <span class="nav__sub-title">Game Development</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/graphics/3d-rendering.html"
                     >
                    <span class="nav__sub-title">3D Graphics & Rendering</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/vr-ar/index.html"
                     >
                    <span class="nav__sub-title">VR/AR Development</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/optimization/index.html"
                     >
                    <span class="nav__sub-title">Performance Optimization</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">AI/ML - Generative AI</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/ai-ml/index.html"
                     >
                    <span class="nav__sub-title">AI/ML Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html"
                     >
                    <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/base-models-comparison.html"
                     >
                    <span class="nav__sub-title">Base Models Comparison</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/model-types.html"
                     >
                    <span class="nav__sub-title">Model Types</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/lora-training.html"
                     >
                    <span class="nav__sub-title">LoRA Training</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/controlnet.html"
                     >
                    <span class="nav__sub-title">ControlNet Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/comfyui-guide.html"
                     >
                    <span class="nav__sub-title">ComfyUI Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/output-formats.html"
                     >
                    <span class="nav__sub-title">Output Formats</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/advanced-techniques.html"
                     class="active">
                    <span class="nav__sub-title">Advanced Techniques</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Physics</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/physics/index.html"
                     >
                    <span class="nav__sub-title">Physics Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/classical-mechanics.html"
                     >
                    <span class="nav__sub-title">Classical Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/thermodynamics.html"
                     >
                    <span class="nav__sub-title">Thermodynamics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/statistical-mechanics.html"
                     >
                    <span class="nav__sub-title">Statistical Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/relativity.html"
                     >
                    <span class="nav__sub-title">Relativity</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/quantum-mechanics.html"
                     >
                    <span class="nav__sub-title">Quantum Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/condensed-matter.html"
                     >
                    <span class="nav__sub-title">Condensed Matter Physics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/quantum-field-theory.html"
                     >
                    <span class="nav__sub-title">Quantum Field Theory</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/string-theory.html"
                     >
                    <span class="nav__sub-title">String Theory</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/computational-physics.html"
                     >
                    <span class="nav__sub-title">Computational Physics</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Advanced Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/advanced/index.html"
                     >
                    <span class="nav__sub-title">Research Hub</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/ai-mathematics/"
                     >
                    <span class="nav__sub-title">AI Mathematics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/distributed-systems-theory/"
                     >
                    <span class="nav__sub-title">Distributed Systems Theory</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/quantum-algorithms-research/"
                     >
                    <span class="nav__sub-title">Quantum Algorithms Research</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/monorepo/"
                     >
                    <span class="nav__sub-title">Monorepo Architecture</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Quick Reference</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/reference/index.html"
                     >
                    <span class="nav__sub-title">Reference Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#command-line-references"
                     >
                    <span class="nav__sub-title">Command Cheat Sheets</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#physics-formulas--constants"
                     >
                    <span class="nav__sub-title">Physics Formulas</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#algorithms--data-structures"
                     >
                    <span class="nav__sub-title">Algorithms & Big O</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#api-reference-patterns"
                     >
                    <span class="nav__sub-title">API Patterns</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#troubleshooting-flowcharts"
                     >
                    <span class="nav__sub-title">Troubleshooting</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#best-practices-checklists"
                     >
                    <span class="nav__sub-title">Best Practices</span>
                  </a>
                </li>
              
            </ul>
          
        
      
    </nav>
  </aside>

  <article class="page">
    <div class="page__inner-wrap">
      <header>
        <h1 id="page-title" class="page__title">Advanced Techniques & Workflows</h1>
      </header>
      
      <section class="page__content">
        
<div class="code-example">
  <p>Cutting-edge techniques and complex workflows for pushing the boundaries of AI image generation.</p>
</div>

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#latent-space-techniques" id="markdown-toc-latent-space-techniques">Latent Space Techniques</a>    <ol>
      <li><a href="#latent-space-interpolation" id="markdown-toc-latent-space-interpolation">Latent Space Interpolation</a></li>
      <li><a href="#spherical-linear-interpolation-slerp" id="markdown-toc-spherical-linear-interpolation-slerp">Spherical Linear Interpolation (SLERP)</a></li>
      <li><a href="#latent-space-navigation" id="markdown-toc-latent-space-navigation">Latent Space Navigation</a></li>
      <li><a href="#latent-composition" id="markdown-toc-latent-composition">Latent Composition</a></li>
    </ol>
  </li>
  <li><a href="#regional-prompting" id="markdown-toc-regional-prompting">Regional Prompting</a>    <ol>
      <li><a href="#attention-masking" id="markdown-toc-attention-masking">Attention Masking</a></li>
      <li><a href="#gligen-integration" id="markdown-toc-gligen-integration">GLIGEN Integration</a></li>
      <li><a href="#prompt-weighting-techniques" id="markdown-toc-prompt-weighting-techniques">Prompt Weighting Techniques</a>        <ol>
          <li><a href="#alternating-prompts" id="markdown-toc-alternating-prompts">Alternating Prompts</a></li>
          <li><a href="#composable-diffusion" id="markdown-toc-composable-diffusion">Composable Diffusion</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#advanced-sampling-methods" id="markdown-toc-advanced-sampling-methods">Advanced Sampling Methods</a>    <ol>
      <li><a href="#classifier-free-guidance-rescale" id="markdown-toc-classifier-free-guidance-rescale">Classifier-Free Guidance Rescale</a></li>
      <li><a href="#dynamic-thresholding" id="markdown-toc-dynamic-thresholding">Dynamic Thresholding</a></li>
      <li><a href="#karras-noise-schedule" id="markdown-toc-karras-noise-schedule">Karras Noise Schedule</a></li>
      <li><a href="#edm-sampling" id="markdown-toc-edm-sampling">EDM Sampling</a></li>
      <li><a href="#restart-sampling" id="markdown-toc-restart-sampling">Restart Sampling</a></li>
    </ol>
  </li>
  <li><a href="#multi-stage-workflows" id="markdown-toc-multi-stage-workflows">Multi-Stage Workflows</a>    <ol>
      <li><a href="#progressive-upscaling" id="markdown-toc-progressive-upscaling">Progressive Upscaling</a></li>
      <li><a href="#detail-enhancement-pipeline" id="markdown-toc-detail-enhancement-pipeline">Detail Enhancement Pipeline</a></li>
      <li><a href="#style-mixing-workflow" id="markdown-toc-style-mixing-workflow">Style Mixing Workflow</a></li>
    </ol>
  </li>
  <li><a href="#optimization-techniques" id="markdown-toc-optimization-techniques">Optimization Techniques</a>    <ol>
      <li><a href="#attention-optimization" id="markdown-toc-attention-optimization">Attention Optimization</a>        <ol>
          <li><a href="#flash-attention-2" id="markdown-toc-flash-attention-2">Flash Attention 2</a></li>
          <li><a href="#token-merging-tome" id="markdown-toc-token-merging-tome">Token Merging (ToMe)</a></li>
        </ol>
      </li>
      <li><a href="#memory-optimization" id="markdown-toc-memory-optimization">Memory Optimization</a>        <ol>
          <li><a href="#gradient-checkpointing" id="markdown-toc-gradient-checkpointing">Gradient Checkpointing</a></li>
          <li><a href="#sequential-generation" id="markdown-toc-sequential-generation">Sequential Generation</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#prompt-engineering-advanced" id="markdown-toc-prompt-engineering-advanced">Prompt Engineering Advanced</a>    <ol>
      <li><a href="#semantic-prompt-optimization" id="markdown-toc-semantic-prompt-optimization">Semantic Prompt Optimization</a></li>
      <li><a href="#prompt-expansion" id="markdown-toc-prompt-expansion">Prompt Expansion</a></li>
    </ol>
  </li>
  <li><a href="#custom-sampling-algorithms" id="markdown-toc-custom-sampling-algorithms">Custom Sampling Algorithms</a>    <ol>
      <li><a href="#ancestral-sampling-with-temperature" id="markdown-toc-ancestral-sampling-with-temperature">Ancestral Sampling with Temperature</a></li>
      <li><a href="#importance-sampling" id="markdown-toc-importance-sampling">Importance Sampling</a></li>
    </ol>
  </li>
  <li><a href="#advanced-controlnet-techniques" id="markdown-toc-advanced-controlnet-techniques">Advanced ControlNet Techniques</a>    <ol>
      <li><a href="#multi-scale-control" id="markdown-toc-multi-scale-control">Multi-Scale Control</a></li>
      <li><a href="#temporal-controlnet" id="markdown-toc-temporal-controlnet">Temporal ControlNet</a></li>
    </ol>
  </li>
  <li><a href="#experimental-techniques" id="markdown-toc-experimental-techniques">Experimental Techniques</a>    <ol>
      <li><a href="#consistency-distillation" id="markdown-toc-consistency-distillation">Consistency Distillation</a></li>
      <li><a href="#adversarial-diffusion-distillation-add" id="markdown-toc-adversarial-diffusion-distillation-add">Adversarial Diffusion Distillation (ADD)</a></li>
      <li><a href="#flow-matching" id="markdown-toc-flow-matching">Flow Matching</a></li>
      <li><a href="#neural-codec-integration" id="markdown-toc-neural-codec-integration">Neural Codec Integration</a></li>
    </ol>
  </li>
  <li><a href="#workflow-automation" id="markdown-toc-workflow-automation">Workflow Automation</a>    <ol>
      <li><a href="#batch-processing-pipeline" id="markdown-toc-batch-processing-pipeline">Batch Processing Pipeline</a></li>
      <li><a href="#ab-testing-framework" id="markdown-toc-ab-testing-framework">A/B Testing Framework</a></li>
      <li><a href="#real-time-generation-pipeline" id="markdown-toc-real-time-generation-pipeline">Real-Time Generation Pipeline</a></li>
    </ol>
  </li>
  <li><a href="#performance-monitoring" id="markdown-toc-performance-monitoring">Performance Monitoring</a>    <ol>
      <li><a href="#generation-metrics" id="markdown-toc-generation-metrics">Generation Metrics</a></li>
    </ol>
  </li>
  <li><a href="#cutting-edge-techniques" id="markdown-toc-cutting-edge-techniques">Cutting-Edge Techniques</a>    <ol>
      <li><a href="#differential-diffusion" id="markdown-toc-differential-diffusion">Differential Diffusion</a></li>
      <li><a href="#self-attention-guidance-sag" id="markdown-toc-self-attention-guidance-sag">Self-Attention Guidance (SAG)</a></li>
    </ol>
  </li>
  <li><a href="#best-practices" id="markdown-toc-best-practices">Best Practices</a>    <ol>
      <li><a href="#workflow-design" id="markdown-toc-workflow-design">Workflow Design</a></li>
      <li><a href="#experimentation-guidelines" id="markdown-toc-experimentation-guidelines">Experimentation Guidelines</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
  <li><a href="#see-also" id="markdown-toc-see-also">See Also</a></li>
</ol>

<hr />

<h2 id="overview">Overview</h2>

<p>This guide covers advanced techniques that go beyond basic image generation, including latent space manipulation, regional prompting, advanced sampling methods, and complex multi-stage workflows.</p>

<p>In 2024, the field has advanced with new techniques like consistency distillation, flow matching, and adversarial training methods that enable real-time generation without quality loss. These cutting-edge approaches are reshaping what‚Äôs possible with diffusion models.</p>

<h2 id="latent-space-techniques">Latent Space Techniques</h2>

<h3 id="latent-space-interpolation">Latent Space Interpolation</h3>

<p>Smoothly transition between different concepts or images:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">latent_interpolation</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">latent_b</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">interpolated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">interpolated_latent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_a</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">latent_b</span>
        <span class="n">interpolated</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">interpolated_latent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interpolated</span>
</code></pre></div></div>

<h3 id="spherical-linear-interpolation-slerp">Spherical Linear Interpolation (SLERP)</h3>

<p>Better for maintaining consistency during interpolation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">slerp</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">latent_b</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="c1"># Normalize vectors
</span>    <span class="n">a_norm</span> <span class="o">=</span> <span class="n">latent_a</span> <span class="o">/</span> <span class="n">torch</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b_norm</span> <span class="o">=</span> <span class="n">latent_b</span> <span class="o">/</span> <span class="n">torch</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">latent_b</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Calculate angle
</span>    <span class="n">dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_norm</span> <span class="o">*</span> <span class="n">b_norm</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">acos</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># SLERP formula
</span>    <span class="n">sin_theta</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">wa</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_theta</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_theta</span>
    
    <span class="k">return</span> <span class="n">wa</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_a</span> <span class="o">+</span> <span class="n">wb</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_b</span>
</code></pre></div></div>

<h3 id="latent-space-navigation">Latent Space Navigation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ComfyUI workflow for latent exploration
</span><span class="p">[</span><span class="n">Latent</span> <span class="n">A</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Latent</span> <span class="n">Interpolate</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">KSampler</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Preview</span><span class="p">]</span>
                <span class="err">‚Üë</span>
          <span class="p">[</span><span class="n">Latent</span> <span class="n">B</span><span class="p">]</span>
          
<span class="c1"># Advanced: Multi-dimensional navigation
</span><span class="p">[</span><span class="n">Center</span> <span class="n">Latent</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Add</span> <span class="n">Noise</span> <span class="n">Direction</span> <span class="mi">1</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Blend</span><span class="p">]</span>
                <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Add</span> <span class="n">Noise</span> <span class="n">Direction</span> <span class="mi">2</span><span class="p">]</span> <span class="err">‚Üó</span>
</code></pre></div></div>

<h3 id="latent-composition">Latent Composition</h3>

<p>Combine multiple latents with masks:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">masked_latent_composite</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">masks</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Combine multiple latents using masks</span><span class="sh">"""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">latents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">latent</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">masks</span><span class="p">):</span>
        <span class="c1"># Resize mask to latent dimensions
</span>        <span class="n">mask_resized</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">interpolate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">latent</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">latent</span> <span class="o">*</span> <span class="n">mask_resized</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="regional-prompting">Regional Prompting</h2>

<h3 id="attention-masking">Attention Masking</h3>

<p>Control where specific prompts apply:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Regional prompt structure
</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">detailed robot</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">mask</span><span class="sh">"</span><span class="p">:</span> <span class="n">left_half_mask</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.2</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lush forest</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">mask</span><span class="sh">"</span><span class="p">:</span> <span class="n">right_half_mask</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<h3 id="gligen-integration">GLIGEN Integration</h3>

<p>Grounded Language-to-Image Generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Bounding box control
</span><span class="n">gligen_inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">boxes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]],</span>  <span class="c1"># [x, y, w, h]
</span>    <span class="sh">"</span><span class="s">phrases</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">red car</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">strengths</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="prompt-weighting-techniques">Prompt Weighting Techniques</h3>

<h4 id="alternating-prompts">Alternating Prompts</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Switch prompts during generation
</span><span class="n">prompt_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="sh">"</span><span class="s">a cat sitting</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="sh">"</span><span class="s">[a cat sitting|a dog sitting]</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Alternate
</span>    <span class="mi">20</span><span class="p">:</span> <span class="sh">"</span><span class="s">a dog sitting</span><span class="sh">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="composable-diffusion">Composable Diffusion</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># AND operation
</span><span class="sh">"</span><span class="s">a cat AND a dog</span><span class="sh">"</span>  <span class="c1"># Both must appear
</span>
<span class="c1"># Weight distribution
</span><span class="sh">"</span><span class="s">(cat:1.2) and (dog:0.8)</span><span class="sh">"</span>  <span class="c1"># Cat emphasized
</span></code></pre></div></div>

<h2 id="advanced-sampling-methods">Advanced Sampling Methods</h2>

<h3 id="classifier-free-guidance-rescale">Classifier-Free Guidance Rescale</h3>

<p>Reduce oversaturation at high CFG values:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cfg_rescale</span><span class="p">(</span><span class="n">noise_pred_conditional</span><span class="p">,</span> <span class="n">noise_pred_unconditional</span><span class="p">,</span> 
                <span class="n">guidance_scale</span><span class="p">,</span> <span class="n">rescale_factor</span><span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Rescale CFG to prevent oversaturation</span><span class="sh">"""</span>
    <span class="c1"># Standard CFG
</span>    <span class="n">noise_pred</span> <span class="o">=</span> <span class="n">noise_pred_unconditional</span> <span class="o">+</span> <span class="n">guidance_scale</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="n">noise_pred_conditional</span> <span class="o">-</span> <span class="n">noise_pred_unconditional</span><span class="p">)</span>
    
    <span class="c1"># Rescale
</span>    <span class="n">std_pos</span> <span class="o">=</span> <span class="n">noise_pred_conditional</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
    <span class="n">std_cfg</span> <span class="o">=</span> <span class="n">noise_pred</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
    
    <span class="n">rescale_factor</span> <span class="o">=</span> <span class="n">rescale_factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">std_pos</span> <span class="o">/</span> <span class="n">std_cfg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">noise_pred</span> <span class="o">*</span> <span class="n">rescale_factor</span>
</code></pre></div></div>

<h3 id="dynamic-thresholding">Dynamic Thresholding</h3>

<p>Prevent color artifacts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dynamic_thresholding</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mf">99.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Apply dynamic thresholding to prevent artifacts</span><span class="sh">"""</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">quantile</span><span class="p">(</span>
        <span class="n">x</span><span class="p">.</span><span class="nf">abs</span><span class="p">().</span><span class="nf">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
        <span class="n">percentile</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> 
        <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">torch</span><span class="p">.</span><span class="nf">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">clamp</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">s</span><span class="p">.</span><span class="nf">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="nf">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="karras-noise-schedule">Karras Noise Schedule</h3>

<p>Optimized noise scheduling:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">karras_schedule</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sigma_min</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Generate Karras noise schedule</span><span class="sh">"""</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">min_inv_rho</span> <span class="o">=</span> <span class="n">sigma_min</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">max_inv_rho</span> <span class="o">=</span> <span class="n">sigma_max</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">sigmas</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_inv_rho</span> <span class="o">+</span> <span class="n">ramp</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_inv_rho</span> <span class="o">-</span> <span class="n">max_inv_rho</span><span class="p">))</span> <span class="o">**</span> <span class="n">rho</span>
    <span class="k">return</span> <span class="n">sigmas</span>
</code></pre></div></div>

<h3 id="edm-sampling">EDM Sampling</h3>

<p>Elucidated Diffusion Models approach:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">edm_sampler</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sigmas</span><span class="p">,</span> <span class="n">s_churn</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">s_noise</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">EDM sampling with stochasticity control</span><span class="sh">"""</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigma_next</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="nf">zip</span><span class="p">(</span><span class="n">sigmas</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">sigmas</span><span class="p">[</span><span class="mi">1</span><span class="p">:])):</span>
        <span class="c1"># Add noise for stochasticity
</span>        <span class="k">if</span> <span class="n">s_churn</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">s_churn</span> <span class="o">/</span> <span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">s_noise</span>
            <span class="n">sigma_hat</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">eps</span> <span class="o">*</span> <span class="p">(</span><span class="n">sigma_hat</span> <span class="o">-</span> <span class="n">sigma</span><span class="p">)</span>
        
        <span class="c1"># Denoise
</span>        <span class="n">x</span> <span class="o">=</span> <span class="nf">denoise_step</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">sigma_hat</span><span class="p">,</span> <span class="n">sigma_next</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<h3 id="restart-sampling">Restart Sampling</h3>

<p>Improve quality with strategic restarts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Restart sampling workflow
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">restart_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">35</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">restart_points</span><span class="p">:</span>
        <span class="c1"># Add controlled noise and continue
</span>        <span class="n">latents</span> <span class="o">=</span> <span class="n">latents</span> <span class="o">+</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    
    <span class="n">latents</span> <span class="o">=</span> <span class="nf">sampler_step</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="multi-stage-workflows">Multi-Stage Workflows</h2>

<h3 id="progressive-upscaling">Progressive Upscaling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 4x upscale pipeline
</span><span class="n">stages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>    <span class="c1"># Base generation
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">768</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>    <span class="c1"># First upscale
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>   <span class="c1"># Second upscale
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>   <span class="c1"># Final upscale
</span><span class="p">]</span>

<span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">:</span>
        <span class="n">latent</span> <span class="o">=</span> <span class="nf">upscale_latent</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="n">latent</span> <span class="o">=</span> <span class="nf">generate</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">denoise</span><span class="o">=</span><span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="detail-enhancement-pipeline">Detail Enhancement Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ComfyUI workflow
</span><span class="p">[</span><span class="n">Base</span> <span class="n">Generation</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Face</span> <span class="n">Detector</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Face</span> <span class="n">Enhancement</span><span class="p">]</span>
        <span class="err">‚Üì</span>                                    <span class="err">‚Üì</span>
   <span class="p">[</span><span class="n">Background</span><span class="p">]</span>     <span class="err">‚Üí</span>    <span class="p">[</span><span class="n">Composite</span><span class="p">]</span>    <span class="err">‚Üê</span>  <span class="p">[</span><span class="n">Enhanced</span> <span class="n">Face</span><span class="p">]</span>
        <span class="err">‚Üì</span>
   <span class="p">[</span><span class="n">Final</span> <span class="n">Output</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="style-mixing-workflow">Style Mixing Workflow</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Multi-model style mixing
</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">photorealistic.ckpt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">artistic.ckpt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">anime.ckpt</span><span class="sh">"</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>

<span class="c1"># Generate with each model
</span><span class="n">latents</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">latent</span> <span class="o">=</span> <span class="nf">generate_with_model</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">latents</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span>

<span class="c1"># Weighted combination
</span><span class="n">final_latent</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="optimization-techniques">Optimization Techniques</h2>

<h3 id="attention-optimization">Attention Optimization</h3>

<h4 id="flash-attention-2">Flash Attention 2</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable flash attention 2 for speed
</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">use_flash_attention_2</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">attention_slice_size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">auto</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">attention_processor</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flash_attn</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">enable_math</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>  <span class="c1"># Disable for pure Flash Attention
</span>    <span class="sh">"</span><span class="s">enable_mem_efficient</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
<span class="p">}</span>

<span class="c1"># With torch.compile for additional speedup
</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">"</span><span class="s">reduce-overhead</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="token-merging-tome">Token Merging (ToMe)</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">token_merging</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">merge_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Merge similar tokens to reduce computation</span><span class="sh">"""</span>
    <span class="c1"># Calculate similarity matrix
</span>    <span class="n">similarity</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">matmul</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Find most similar pairs
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">similarity</span><span class="p">.</span><span class="nf">topk</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">*</span> <span class="n">merge_ratio</span><span class="p">))</span>
    
    <span class="c1"># Merge tokens
</span>    <span class="n">merged</span> <span class="o">=</span> <span class="nf">average_similar_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></div>

<h3 id="memory-optimization">Memory Optimization</h3>

<h4 id="gradient-checkpointing">Gradient Checkpointing</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Trade compute for memory
</span><span class="n">model</span><span class="p">.</span><span class="nf">enable_gradient_checkpointing</span><span class="p">()</span>

<span class="c1"># Custom checkpointing
</span><span class="k">def</span> <span class="nf">checkpoint_forward</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">checkpoint</span><span class="p">.</span><span class="nf">checkpoint</span><span class="p">(</span>
        <span class="n">module</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">use_reentrant</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span>
</code></pre></div></div>

<h4 id="sequential-generation">Sequential Generation</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate in tiles for large images
</span><span class="k">def</span> <span class="nf">tiled_generation</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tile_size</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tile_size</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">):</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="nf">generate_tile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">)</span>
            <span class="n">tiles</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tile</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="nf">blend_tiles</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="prompt-engineering-advanced">Prompt Engineering Advanced</h2>

<h3 id="semantic-prompt-optimization">Semantic Prompt Optimization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">optimize_prompt</span><span class="p">(</span><span class="n">base_prompt</span><span class="p">,</span> <span class="n">target_features</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Iteratively optimize prompt for target features</span><span class="sh">"""</span>
    <span class="n">current_prompt</span> <span class="o">=</span> <span class="n">base_prompt</span>
    
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># Generate with current prompt
</span>        <span class="n">features</span> <span class="o">=</span> <span class="nf">extract_features</span><span class="p">(</span><span class="nf">generate</span><span class="p">(</span><span class="n">current_prompt</span><span class="p">))</span>
        
        <span class="c1"># Calculate feature difference
</span>        <span class="n">diff</span> <span class="o">=</span> <span class="n">target_features</span> <span class="o">-</span> <span class="n">features</span>
        
        <span class="c1"># Update prompt based on difference
</span>        <span class="n">current_prompt</span> <span class="o">=</span> <span class="nf">update_prompt</span><span class="p">(</span><span class="n">current_prompt</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nf">convergence_reached</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
            <span class="k">break</span>
    
    <span class="k">return</span> <span class="n">current_prompt</span>
</code></pre></div></div>

<h3 id="prompt-expansion">Prompt Expansion</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">expand_prompt</span><span class="p">(</span><span class="n">simple_prompt</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Expand simple prompt with quality modifiers</span><span class="sh">"""</span>
    <span class="n">quality_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">highly detailed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">4k</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">professional</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">award winning</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">trending on artstation</span><span class="sh">"</span>
    <span class="p">]</span>
    
    <span class="n">style_hints</span> <span class="o">=</span> <span class="nf">analyze_intended_style</span><span class="p">(</span><span class="n">simple_prompt</span><span class="p">)</span>
    
    <span class="n">expanded</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">simple_prompt</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">quality_tags</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
    <span class="k">if</span> <span class="n">style_hints</span><span class="p">:</span>
        <span class="n">expanded</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">, </span><span class="si">{</span><span class="n">style_hints</span><span class="si">}</span><span class="sh">"</span>
    
    <span class="k">return</span> <span class="n">expanded</span>
</code></pre></div></div>

<h2 id="custom-sampling-algorithms">Custom Sampling Algorithms</h2>

<h3 id="ancestral-sampling-with-temperature">Ancestral Sampling with Temperature</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ancestral_sample_with_temp</span><span class="p">(</span><span class="n">noise_pred</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Ancestral sampling with temperature control</span><span class="sh">"""</span>
    <span class="c1"># Add noise with temperature scaling
</span>    <span class="n">noise</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">noise_pred</span><span class="p">)</span> <span class="o">*</span> <span class="n">temperature</span>
    
    <span class="c1"># Ancestral update
</span>    <span class="n">sigma_down</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigma_next</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="n">x_next</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sigma_down</span> <span class="o">*</span> <span class="p">(</span><span class="n">noise_pred</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">x_next</span>
</code></pre></div></div>

<h3 id="importance-sampling">Importance Sampling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">importance_sampling</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Generate multiple samples and select best</span><span class="sh">"""</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nf">generate_sample</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="nf">evaluate_quality</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    
    <span class="c1"># Return best sample
</span>    <span class="n">best_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">tensor</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">samples</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="advanced-controlnet-techniques">Advanced ControlNet Techniques</h2>

<h3 id="multi-scale-control">Multi-Scale Control</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Apply control at different resolutions
</span><span class="n">control_scales</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">control_scales</span><span class="p">:</span>
    <span class="n">control_resized</span> <span class="o">=</span> <span class="nf">resize</span><span class="p">(</span><span class="n">control_image</span><span class="p">,</span> <span class="n">scale</span><span class="p">[</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">apply_control</span><span class="p">(</span><span class="n">control_resized</span><span class="p">,</span> <span class="n">scale</span><span class="p">[</span><span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="temporal-controlnet">Temporal ControlNet</h3>

<p>For video consistency:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">temporal_controlnet</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">control_strength_decay</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Apply control with temporal decay</span><span class="sh">"""</span>
    <span class="n">previous_control</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">controlled_frames</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">previous_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Blend with previous frame's control
</span>            <span class="n">current_control</span> <span class="o">=</span> <span class="nf">blend_controls</span><span class="p">(</span>
                <span class="nf">extract_control</span><span class="p">(</span><span class="n">frame</span><span class="p">),</span>
                <span class="n">previous_control</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">control_strength_decay</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_control</span> <span class="o">=</span> <span class="nf">extract_control</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        
        <span class="n">controlled_frame</span> <span class="o">=</span> <span class="nf">generate_with_control</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="n">current_control</span>
        <span class="p">)</span>
        <span class="n">controlled_frames</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">controlled_frame</span><span class="p">)</span>
        <span class="n">previous_control</span> <span class="o">=</span> <span class="n">current_control</span>
    
    <span class="k">return</span> <span class="n">controlled_frames</span>
</code></pre></div></div>

<h2 id="experimental-techniques">Experimental Techniques</h2>

<h3 id="consistency-distillation">Consistency Distillation</h3>

<p>Latest approach for few-step generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Consistency distillation (LCM/TCD style)
</span><span class="k">def</span> <span class="nf">consistency_distillation</span><span class="p">(</span><span class="n">teacher_model</span><span class="p">,</span> <span class="n">student_model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Train student for consistency</span><span class="sh">"""</span>
    <span class="c1"># Teacher prediction
</span>    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="n">teacher_v</span> <span class="o">=</span> <span class="nf">teacher_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">x_pred</span> <span class="o">=</span> <span class="nf">predict_x0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">teacher_v</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Student should match at adjacent timesteps
</span>    <span class="n">t_next</span> <span class="o">=</span> <span class="nf">get_adjacent_timestep</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">student_v</span> <span class="o">=</span> <span class="nf">student_model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t_next</span><span class="p">)</span>
    
    <span class="c1"># Consistency loss
</span>    <span class="n">loss</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">mse_loss</span><span class="p">(</span><span class="n">student_v</span><span class="p">,</span> <span class="n">teacher_v</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">loss</span>
</code></pre></div></div>

<h3 id="adversarial-diffusion-distillation-add">Adversarial Diffusion Distillation (ADD)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GAN-based acceleration
</span><span class="k">def</span> <span class="nf">add_training</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">discriminator</span><span class="p">,</span> <span class="n">real_images</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Adversarial Diffusion Distillation</span><span class="sh">"""</span>
    <span class="c1"># Generate with few steps
</span>    <span class="n">fake_images</span> <span class="o">=</span> <span class="nf">generator</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># Discriminator loss
</span>    <span class="n">d_real</span> <span class="o">=</span> <span class="nf">discriminator</span><span class="p">(</span><span class="n">real_images</span><span class="p">)</span>
    <span class="n">d_fake</span> <span class="o">=</span> <span class="nf">discriminator</span><span class="p">(</span><span class="n">fake_images</span><span class="p">.</span><span class="nf">detach</span><span class="p">())</span>
    <span class="n">d_loss</span> <span class="o">=</span> <span class="nf">gan_loss</span><span class="p">(</span><span class="n">d_real</span><span class="p">,</span> <span class="n">d_fake</span><span class="p">)</span>
    
    <span class="c1"># Generator loss with perceptual component
</span>    <span class="n">g_adv</span> <span class="o">=</span> <span class="nf">discriminator</span><span class="p">(</span><span class="n">fake_images</span><span class="p">)</span>
    <span class="n">g_loss</span> <span class="o">=</span> <span class="nf">gan_loss</span><span class="p">(</span><span class="n">g_adv</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="o">+</span> \
             <span class="nf">perceptual_loss</span><span class="p">(</span><span class="n">fake_images</span><span class="p">,</span> <span class="n">real_images</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">g_loss</span><span class="p">,</span> <span class="n">d_loss</span>
</code></pre></div></div>

<h3 id="flow-matching">Flow Matching</h3>

<p>Alternative to diffusion used in FLUX/SD3:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">flow_matching_loss</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Rectified flow training</span><span class="sh">"""</span>
    <span class="c1"># Interpolate between noise and data
</span>    <span class="n">xt</span> <span class="o">=</span> <span class="n">t</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">x0</span>
    
    <span class="c1"># Target velocity
</span>    <span class="n">target_v</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span>
    
    <span class="c1"># Model prediction
</span>    <span class="n">pred_v</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Matching loss
</span>    <span class="k">return</span> <span class="n">F</span><span class="p">.</span><span class="nf">mse_loss</span><span class="p">(</span><span class="n">pred_v</span><span class="p">,</span> <span class="n">target_v</span><span class="p">)</span>

<span class="c1"># Sampling with flow
</span><span class="k">def</span> <span class="nf">sample_flow</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ODE sampling for rectified flows</span><span class="sh">"""</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">steps</span>
    <span class="n">xt</span> <span class="o">=</span> <span class="n">x0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">xt</span> <span class="o">+</span> <span class="n">v</span> <span class="o">*</span> <span class="n">dt</span>
    
    <span class="k">return</span> <span class="n">xt</span>
</code></pre></div></div>

<h3 id="neural-codec-integration">Neural Codec Integration</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compress latents with neural codec
</span><span class="n">encoded</span> <span class="o">=</span> <span class="n">neural_codec</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span>  <span class="c1"># Ultra-compressed
</span><span class="n">transmitted</span> <span class="o">=</span> <span class="nf">send_over_network</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">neural_codec</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">transmitted</span><span class="p">)</span>
<span class="n">final_image</span> <span class="o">=</span> <span class="n">vae</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="workflow-automation">Workflow Automation</h2>

<h3 id="batch-processing-pipeline">Batch Processing Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BatchPipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">base_workflow</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">base_workflow</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">variations</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">input_data</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">variation</span> <span class="ow">in</span> <span class="n">variations</span><span class="p">:</span>
                <span class="c1"># Apply variation
</span>                <span class="n">modified_workflow</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply_variation</span><span class="p">(</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">workflow</span><span class="p">,</span> <span class="n">variation</span>
                <span class="p">)</span>
                
                <span class="c1"># Generate
</span>                <span class="n">result</span> <span class="o">=</span> <span class="nf">execute_workflow</span><span class="p">(</span>
                    <span class="n">modified_workflow</span><span class="p">,</span> <span class="n">input_data</span>
                <span class="p">)</span>
                
                <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">:</span> <span class="n">input_data</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">variation</span><span class="sh">"</span><span class="p">:</span> <span class="n">variation</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">:</span> <span class="n">result</span>
                <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">apply_variation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">variation</span><span class="p">):</span>
        <span class="c1"># Modify workflow parameters
</span>        <span class="k">return</span> <span class="n">modified_workflow</span>
</code></pre></div></div>

<h3 id="ab-testing-framework">A/B Testing Framework</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ab_test_parameters</span><span class="p">(</span><span class="n">base_config</span><span class="p">,</span> <span class="n">test_params</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Test different parameter combinations</span><span class="sh">"""</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_values</span> <span class="ow">in</span> <span class="n">test_params</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">param_results</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_values</span><span class="p">:</span>
            <span class="c1"># Update config
</span>            <span class="n">test_config</span> <span class="o">=</span> <span class="n">base_config</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            <span class="n">test_config</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            
            <span class="c1"># Generate samples
</span>            <span class="n">samples</span> <span class="o">=</span> <span class="nf">generate_samples</span><span class="p">(</span><span class="n">test_config</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
            
            <span class="c1"># Evaluate quality
</span>            <span class="n">quality_score</span> <span class="o">=</span> <span class="nf">evaluate_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="n">param_results</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">quality_score</span><span class="p">))</span>
        
        <span class="n">results</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_results</span>
    
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div>

<h3 id="real-time-generation-pipeline">Real-Time Generation Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeGenerator</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Optimized for &lt;100ms generation</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_path</span><span class="p">):</span>
        <span class="c1"># Load optimized model
</span>        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="nf">load_lcm_model</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">model</span><span class="p">)</span>
        
        <span class="c1"># Pre-allocate tensors
</span>        <span class="n">self</span><span class="p">.</span><span class="n">noise</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">).</span><span class="nf">cuda</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">text_cache</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="nd">@torch.inference_mode</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># Cache text encoding
</span>        <span class="k">if</span> <span class="n">prompt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">text_cache</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">text_cache</span><span class="p">[</span><span class="n">prompt</span><span class="p">]</span> <span class="o">=</span> <span class="nf">encode_prompt</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
        
        <span class="c1"># Fast generation
</span>        <span class="k">if</span> <span class="n">seed</span><span class="p">:</span>
            <span class="n">torch</span><span class="p">.</span><span class="nf">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        
        <span class="c1"># 4-step LCM generation
</span>        <span class="n">latents</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">noise</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">999</span><span class="p">,</span> <span class="mi">749</span><span class="p">,</span> <span class="mi">499</span><span class="p">,</span> <span class="mi">249</span><span class="p">]:</span>
            <span class="n">latents</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">model</span><span class="p">(</span>
                <span class="n">latents</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> 
                <span class="n">self</span><span class="p">.</span><span class="n">text_cache</span><span class="p">[</span><span class="n">prompt</span><span class="p">],</span>
                <span class="n">guidance_scale</span><span class="o">=</span><span class="mf">1.5</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="nf">decode_latents</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="performance-monitoring">Performance Monitoring</h2>

<h3 id="generation-metrics">Generation Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GenerationProfiler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">profile_generation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">profiler</span><span class="p">.</span><span class="nf">profile</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="nf">execute_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
        
        <span class="c1"># Extract metrics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">prof</span><span class="p">.</span><span class="n">total_time</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">memory_used</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">max_memory_allocated</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">quality_score</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="nf">assess_quality</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">output</span>
    
    <span class="k">def</span> <span class="nf">get_report</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">metric</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="cutting-edge-techniques">Cutting-Edge Techniques</h2>

<h3 id="differential-diffusion">Differential Diffusion</h3>

<p>Selective region control:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">differential_diffusion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">strength_map</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Apply different denoising strengths by region</span><span class="sh">"""</span>
    <span class="c1"># Decompose into regions
</span>    <span class="n">regions</span> <span class="o">=</span> <span class="nf">segment_by_mask</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>
    
    <span class="c1"># Apply different schedules
</span>    <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">strength</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">regions</span><span class="p">,</span> <span class="n">strength_map</span><span class="p">):</span>
        <span class="n">region_schedule</span> <span class="o">=</span> <span class="nf">modify_schedule</span><span class="p">(</span><span class="n">base_schedule</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
        <span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">denoise_region</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">region_schedule</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">combine_regions</span><span class="p">(</span><span class="n">regions</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="self-attention-guidance-sag">Self-Attention Guidance (SAG)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">self_attention_guidance</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Enhance details using self-attention maps</span><span class="sh">"""</span>
    <span class="c1"># Get attention maps
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">attns</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">return_attention</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Blur attention for guidance
</span>    <span class="n">blurred</span> <span class="o">=</span> <span class="nf">gaussian_blur</span><span class="p">(</span><span class="n">attns</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    
    <span class="c1"># Guided prediction
</span>    <span class="n">pred</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">guided</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">attns</span> <span class="o">-</span> <span class="n">blurred</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">guided</span>
</code></pre></div></div>

<h2 id="best-practices">Best Practices</h2>

<h3 id="workflow-design">Workflow Design</h3>

<ol>
  <li><strong>Modularity</strong>: Build reusable components</li>
  <li><strong>Validation</strong>: Test each stage independently</li>
  <li><strong>Documentation</strong>: Comment complex operations</li>
  <li><strong>Version Control</strong>: Track workflow changes</li>
  <li><strong>Performance</strong>: Profile and optimize bottlenecks</li>
  <li><strong>Future-Proofing</strong>: Design for new model architectures</li>
</ol>

<h3 id="experimentation-guidelines">Experimentation Guidelines</h3>

<ol>
  <li><strong>Controlled Testing</strong>: Change one variable at a time</li>
  <li><strong>Reproducibility</strong>: Fix seeds for comparisons</li>
  <li><strong>Metrics</strong>: Define clear success criteria</li>
  <li><strong>Iteration</strong>: Start simple, add complexity</li>
  <li><strong>Documentation</strong>: Record successful configurations</li>
  <li><strong>Benchmarking</strong>: Compare against established baselines</li>
  <li><strong>Community Sharing</strong>: Contribute findings back</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>Advanced techniques open up new possibilities in AI image generation, from precise control over the generation process to optimization for specific use cases. The landscape in 2024 has shifted toward real-time generation, consistency models, and flow-based approaches that challenge traditional diffusion paradigms.</p>

<p>Key trends shaping the future:</p>
<ul>
  <li><strong>Real-time Generation</strong>: Sub-100ms image creation becoming standard</li>
  <li><strong>Unified Architectures</strong>: Models handling multiple modalities seamlessly</li>
  <li><strong>Adaptive Computation</strong>: Dynamic resource allocation based on complexity</li>
  <li><strong>Neural Compression</strong>: Extreme model compression without quality loss</li>
</ul>

<p>The key to mastering these techniques is understanding the underlying principles and experimenting with different combinations. As the field evolves rapidly, staying updated with the latest research and community developments will help you leverage new techniques as they emerge. Remember that the most impressive results often come from creative combinations of multiple techniques rather than relying on any single advanced method.</p>

<hr />

<h2 id="see-also">See Also</h2>
<ul>
  <li><a href="stable-diffusion-fundamentals.html">Stable Diffusion Fundamentals</a> - Core concepts explained</li>
  <li><a href="comfyui-guide.html">ComfyUI Guide</a> - Visual workflow creation</li>
  <li><a href="model-types.html">Model Types</a> - Understanding LoRAs, VAEs, embeddings</li>
  <li><a href="base-models-comparison.html">Base Models Comparison</a> - SD 1.5, SDXL, FLUX compared</li>
  <li><a href="lora-training.html">LoRA Training</a> - Train custom models</li>
  <li><a href="controlnet.html">ControlNet</a> - Precise control over generation</li>
  <li><a href="output-formats.html">Output Formats</a> - Exporting and using generated content</li>
  <li><a href="../technology/ai.html">AI Fundamentals</a> - Core AI/ML concepts</li>
  <li><a href="index.html">AI/ML Documentation Hub</a> - Complete AI/ML documentation index</li>
</ul>

      </section>
    </div>
  </article>
</div>
</body>
</html>