<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Advanced Techniques & Workflows | Andrews Notebook</title>
  <meta name="description" content="Technology and Physics notes">
  
  <link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/advanced-techniques.html">
  
  <link rel="stylesheet" href="/Documentation/assets/css/main.css">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Advanced Techniques &amp; Workflows | Andrews Notebook</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Advanced Techniques &amp; Workflows" />
<meta name="author" content="Andrew" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technology and Physics notes" />
<meta property="og:description" content="Technology and Physics notes" />
<link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/advanced-techniques.html" />
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/ai-ml/advanced-techniques.html" />
<meta property="og:site_name" content="Andrews Notebook" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Advanced Techniques &amp; Workflows" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew"},"description":"Technology and Physics notes","headline":"Advanced Techniques &amp; Workflows","url":"https://andrewaltimit.github.io/Documentation/docs/ai-ml/advanced-techniques.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://andrewaltimit.github.io/Documentation/feed.xml" title="Andrews Notebook" />
</head>
<body>
  <div class="site">
    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://andrewaltimit.github.io/Documentation/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/docs" itemprop="item"><span itemprop="name">Docs</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/ai-ml" itemprop="item"><span itemprop="name">Ai ml</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Advanced Techniques &amp; Workflows</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Advanced Techniques &amp; Workflows">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Advanced Techniques &amp; Workflows
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-cog"></i> On This Page</h4></header>
              <ul class="toc__menu">
<li><a href="#latent-space-interpolation">Latent Space Interpolation</a></li>
<li><a href="#spherical-linear-interpolation-slerp">Spherical Linear Interpolation (SLERP)</a></li>
<li><a href="#latent-space-navigation">Latent Space Navigation</a></li>
<li><a href="#latent-composition">Latent Composition</a></li>
<li><a href="#attention-masking">Attention Masking</a></li>
<li><a href="#gligen-integration">GLIGEN Integration</a></li>
<li>
<a href="#prompt-weighting-techniques">Prompt Weighting Techniques</a><ul>
<li><a href="#alternating-prompts">Alternating Prompts</a></li>
<li><a href="#composable-diffusion">Composable Diffusion</a></li>
</ul>
</li>
<li><a href="#classifier-free-guidance-rescale">Classifier-Free Guidance Rescale</a></li>
<li><a href="#dynamic-thresholding">Dynamic Thresholding</a></li>
<li><a href="#karras-noise-schedule">Karras Noise Schedule</a></li>
<li><a href="#restart-sampling">Restart Sampling</a></li>
<li><a href="#progressive-upscaling">Progressive Upscaling</a></li>
<li><a href="#detail-enhancement-pipeline">Detail Enhancement Pipeline</a></li>
<li><a href="#style-mixing-workflow">Style Mixing Workflow</a></li>
<li>
<a href="#attention-optimization">Attention Optimization</a><ul>
<li><a href="#flash-attention">Flash Attention</a></li>
<li><a href="#token-merging-tome">Token Merging (ToMe)</a></li>
</ul>
</li>
<li>
<a href="#memory-optimization">Memory Optimization</a><ul>
<li><a href="#gradient-checkpointing">Gradient Checkpointing</a></li>
<li><a href="#sequential-generation">Sequential Generation</a></li>
</ul>
</li>
<li><a href="#semantic-prompt-optimization">Semantic Prompt Optimization</a></li>
<li><a href="#prompt-expansion">Prompt Expansion</a></li>
<li><a href="#ancestral-sampling-with-temperature">Ancestral Sampling with Temperature</a></li>
<li><a href="#importance-sampling">Importance Sampling</a></li>
<li><a href="#multi-scale-control">Multi-Scale Control</a></li>
<li><a href="#temporal-controlnet">Temporal ControlNet</a></li>
<li><a href="#diffusion-distillation">Diffusion Distillation</a></li>
<li><a href="#consistency-models">Consistency Models</a></li>
<li><a href="#neural-codec-integration">Neural Codec Integration</a></li>
<li><a href="#batch-processing-pipeline">Batch Processing Pipeline</a></li>
<li><a href="#ab-testing-framework">A/B Testing Framework</a></li>
<li><a href="#generation-metrics">Generation Metrics</a></li>
<li><a href="#workflow-design">Workflow Design</a></li>
<li><a href="#experimentation-guidelines">Experimentation Guidelines</a></li>
</ul>

            </nav>
          </aside>
        
        <aside class="sidebar sticky">
  <nav class="nav__list">
    
      
        <h3 class="nav__title">Getting Started</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/topic-map/">
                  <span class="nav__sub-title">üó∫Ô∏è Interactive Topic Map</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git-crash-course.html">
                  <span class="nav__sub-title">üå± Git in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker-crash-course.html">
                  <span class="nav__sub-title">üå± Docker in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-crash-course.html">
                  <span class="nav__sub-title">üå± Databases in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-fundamentals-simple.html">
                  <span class="nav__sub-title">üå± AI Fundamentals Simple</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Technology</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/technology/index.html">
                  <span class="nav__sub-title">Technology Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/terraform.html">
                  <span class="nav__sub-title">Terraform</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker.html">
                  <span class="nav__sub-title">Docker Containers</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/aws.html">
                  <span class="nav__sub-title">AWS</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/kubernetes.html">
                  <span class="nav__sub-title">Kubernetes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-design.html">
                  <span class="nav__sub-title">Database Design</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/networking.html">
                  <span class="nav__sub-title">Networking</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/cybersecurity.html">
                  <span class="nav__sub-title">Cybersecurity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git.html">
                  <span class="nav__sub-title">Git Version Control</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/branching.html">
                  <span class="nav__sub-title">Branching Strategies</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/unreal.html">
                  <span class="nav__sub-title">Unreal Engine</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/quantumcomputing.html">
                  <span class="nav__sub-title">Quantum Computing</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai.html">
                  <span class="nav__sub-title">Artificial Intelligence</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-lecture-2023.html">
                  <span class="nav__sub-title">AI Lecture 2023</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/please-build.html">
                  <span class="nav__sub-title">Please Build</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">AI/ML - Generative AI</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/ai-ml/index.html">
                  <span class="nav__sub-title">AI/ML Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html">
                  <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/base-models-comparison.html">
                  <span class="nav__sub-title">Base Models Comparison</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/model-types.html">
                  <span class="nav__sub-title">Model Types</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/lora-training.html">
                  <span class="nav__sub-title">LoRA Training</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/controlnet.html">
                  <span class="nav__sub-title">ControlNet Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/comfyui-guide.html">
                  <span class="nav__sub-title">ComfyUI Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/output-formats.html">
                  <span class="nav__sub-title">Output Formats</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/advanced-techniques.html" class="active">
                  <span class="nav__sub-title">Advanced Techniques</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Physics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/physics/index.html">
                  <span class="nav__sub-title">Physics Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/classical-mechanics.html">
                  <span class="nav__sub-title">Classical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/thermodynamics.html">
                  <span class="nav__sub-title">Thermodynamics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/statistical-mechanics.html">
                  <span class="nav__sub-title">Statistical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/relativity.html">
                  <span class="nav__sub-title">Relativity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-mechanics.html">
                  <span class="nav__sub-title">Quantum Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/condensed-matter.html">
                  <span class="nav__sub-title">Condensed Matter Physics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-field-theory.html">
                  <span class="nav__sub-title">Quantum Field Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/string-theory.html">
                  <span class="nav__sub-title">String Theory</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Advanced Topics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/advanced/index.html">
                  <span class="nav__sub-title">Research Hub</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/ai-mathematics/">
                  <span class="nav__sub-title">AI Mathematics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/distributed-systems-theory/">
                  <span class="nav__sub-title">Distributed Systems Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/quantum-algorithms-research/">
                  <span class="nav__sub-title">Quantum Algorithms Research</span>
                </a>
              </li>
            
          </ul>
        
      
    
  </nav>
</aside>


<div class="code-example">
  <p>Cutting-edge techniques and complex workflows for pushing the boundaries of AI image generation.</p>
</div>

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li>
<a href="#latent-space-techniques" id="markdown-toc-latent-space-techniques">Latent Space Techniques</a>    <ol>
      <li><a href="#latent-space-interpolation" id="markdown-toc-latent-space-interpolation">Latent Space Interpolation</a></li>
      <li><a href="#spherical-linear-interpolation-slerp" id="markdown-toc-spherical-linear-interpolation-slerp">Spherical Linear Interpolation (SLERP)</a></li>
      <li><a href="#latent-space-navigation" id="markdown-toc-latent-space-navigation">Latent Space Navigation</a></li>
      <li><a href="#latent-composition" id="markdown-toc-latent-composition">Latent Composition</a></li>
    </ol>
  </li>
  <li>
<a href="#regional-prompting" id="markdown-toc-regional-prompting">Regional Prompting</a>    <ol>
      <li><a href="#attention-masking" id="markdown-toc-attention-masking">Attention Masking</a></li>
      <li><a href="#gligen-integration" id="markdown-toc-gligen-integration">GLIGEN Integration</a></li>
      <li>
<a href="#prompt-weighting-techniques" id="markdown-toc-prompt-weighting-techniques">Prompt Weighting Techniques</a>        <ol>
          <li><a href="#alternating-prompts" id="markdown-toc-alternating-prompts">Alternating Prompts</a></li>
          <li><a href="#composable-diffusion" id="markdown-toc-composable-diffusion">Composable Diffusion</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
<a href="#advanced-sampling-methods" id="markdown-toc-advanced-sampling-methods">Advanced Sampling Methods</a>    <ol>
      <li><a href="#classifier-free-guidance-rescale" id="markdown-toc-classifier-free-guidance-rescale">Classifier-Free Guidance Rescale</a></li>
      <li><a href="#dynamic-thresholding" id="markdown-toc-dynamic-thresholding">Dynamic Thresholding</a></li>
      <li><a href="#karras-noise-schedule" id="markdown-toc-karras-noise-schedule">Karras Noise Schedule</a></li>
      <li><a href="#restart-sampling" id="markdown-toc-restart-sampling">Restart Sampling</a></li>
    </ol>
  </li>
  <li>
<a href="#multi-stage-workflows" id="markdown-toc-multi-stage-workflows">Multi-Stage Workflows</a>    <ol>
      <li><a href="#progressive-upscaling" id="markdown-toc-progressive-upscaling">Progressive Upscaling</a></li>
      <li><a href="#detail-enhancement-pipeline" id="markdown-toc-detail-enhancement-pipeline">Detail Enhancement Pipeline</a></li>
      <li><a href="#style-mixing-workflow" id="markdown-toc-style-mixing-workflow">Style Mixing Workflow</a></li>
    </ol>
  </li>
  <li>
<a href="#optimization-techniques" id="markdown-toc-optimization-techniques">Optimization Techniques</a>    <ol>
      <li>
<a href="#attention-optimization" id="markdown-toc-attention-optimization">Attention Optimization</a>        <ol>
          <li><a href="#flash-attention" id="markdown-toc-flash-attention">Flash Attention</a></li>
          <li><a href="#token-merging-tome" id="markdown-toc-token-merging-tome">Token Merging (ToMe)</a></li>
        </ol>
      </li>
      <li>
<a href="#memory-optimization" id="markdown-toc-memory-optimization">Memory Optimization</a>        <ol>
          <li><a href="#gradient-checkpointing" id="markdown-toc-gradient-checkpointing">Gradient Checkpointing</a></li>
          <li><a href="#sequential-generation" id="markdown-toc-sequential-generation">Sequential Generation</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li>
<a href="#prompt-engineering-advanced" id="markdown-toc-prompt-engineering-advanced">Prompt Engineering Advanced</a>    <ol>
      <li><a href="#semantic-prompt-optimization" id="markdown-toc-semantic-prompt-optimization">Semantic Prompt Optimization</a></li>
      <li><a href="#prompt-expansion" id="markdown-toc-prompt-expansion">Prompt Expansion</a></li>
    </ol>
  </li>
  <li>
<a href="#custom-sampling-algorithms" id="markdown-toc-custom-sampling-algorithms">Custom Sampling Algorithms</a>    <ol>
      <li><a href="#ancestral-sampling-with-temperature" id="markdown-toc-ancestral-sampling-with-temperature">Ancestral Sampling with Temperature</a></li>
      <li><a href="#importance-sampling" id="markdown-toc-importance-sampling">Importance Sampling</a></li>
    </ol>
  </li>
  <li>
<a href="#advanced-controlnet-techniques" id="markdown-toc-advanced-controlnet-techniques">Advanced ControlNet Techniques</a>    <ol>
      <li><a href="#multi-scale-control" id="markdown-toc-multi-scale-control">Multi-Scale Control</a></li>
      <li><a href="#temporal-controlnet" id="markdown-toc-temporal-controlnet">Temporal ControlNet</a></li>
    </ol>
  </li>
  <li>
<a href="#experimental-techniques" id="markdown-toc-experimental-techniques">Experimental Techniques</a>    <ol>
      <li><a href="#diffusion-distillation" id="markdown-toc-diffusion-distillation">Diffusion Distillation</a></li>
      <li><a href="#consistency-models" id="markdown-toc-consistency-models">Consistency Models</a></li>
      <li><a href="#neural-codec-integration" id="markdown-toc-neural-codec-integration">Neural Codec Integration</a></li>
    </ol>
  </li>
  <li>
<a href="#workflow-automation" id="markdown-toc-workflow-automation">Workflow Automation</a>    <ol>
      <li><a href="#batch-processing-pipeline" id="markdown-toc-batch-processing-pipeline">Batch Processing Pipeline</a></li>
      <li><a href="#ab-testing-framework" id="markdown-toc-ab-testing-framework">A/B Testing Framework</a></li>
    </ol>
  </li>
  <li>
<a href="#performance-monitoring" id="markdown-toc-performance-monitoring">Performance Monitoring</a>    <ol>
      <li><a href="#generation-metrics" id="markdown-toc-generation-metrics">Generation Metrics</a></li>
    </ol>
  </li>
  <li>
<a href="#best-practices" id="markdown-toc-best-practices">Best Practices</a>    <ol>
      <li><a href="#workflow-design" id="markdown-toc-workflow-design">Workflow Design</a></li>
      <li><a href="#experimentation-guidelines" id="markdown-toc-experimentation-guidelines">Experimentation Guidelines</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ol>

<hr>

<h2 id="overview">Overview</h2>

<p>This guide covers advanced techniques that go beyond basic image generation, including latent space manipulation, regional prompting, advanced sampling methods, and complex multi-stage workflows.</p>

<h2 id="latent-space-techniques">Latent Space Techniques</h2>

<h3 id="latent-space-interpolation">Latent Space Interpolation</h3>

<p>Smoothly transition between different concepts or images:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">latent_interpolation</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">latent_b</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">interpolated</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="n">steps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">interpolated_latent</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_a</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">latent_b</span>
        <span class="n">interpolated</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">interpolated_latent</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">interpolated</span>
</code></pre></div></div>

<h3 id="spherical-linear-interpolation-slerp">Spherical Linear Interpolation (SLERP)</h3>

<p>Better for maintaining consistency during interpolation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">slerp</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">latent_b</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="c1"># Normalize vectors
</span>    <span class="n">a_norm</span> <span class="o">=</span> <span class="n">latent_a</span> <span class="o">/</span> <span class="n">torch</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">latent_a</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">b_norm</span> <span class="o">=</span> <span class="n">latent_b</span> <span class="o">/</span> <span class="n">torch</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">latent_b</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Calculate angle
</span>    <span class="n">dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_norm</span> <span class="o">*</span> <span class="n">b_norm</span><span class="p">).</span><span class="nf">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">acos</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">clamp</span><span class="p">(</span><span class="n">dot</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="c1"># SLERP formula
</span>    <span class="n">sin_theta</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">wa</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_theta</span>
    <span class="n">wb</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sin_theta</span>
    
    <span class="k">return</span> <span class="n">wa</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_a</span> <span class="o">+</span> <span class="n">wb</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">latent_b</span>
</code></pre></div></div>

<h3 id="latent-space-navigation">Latent Space Navigation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ComfyUI workflow for latent exploration
</span><span class="p">[</span><span class="n">Latent</span> <span class="n">A</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Latent</span> <span class="n">Interpolate</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">KSampler</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Preview</span><span class="p">]</span>
                <span class="err">‚Üë</span>
          <span class="p">[</span><span class="n">Latent</span> <span class="n">B</span><span class="p">]</span>
          
<span class="c1"># Advanced: Multi-dimensional navigation
</span><span class="p">[</span><span class="n">Center</span> <span class="n">Latent</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Add</span> <span class="n">Noise</span> <span class="n">Direction</span> <span class="mi">1</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Blend</span><span class="p">]</span>
                <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Add</span> <span class="n">Noise</span> <span class="n">Direction</span> <span class="mi">2</span><span class="p">]</span> <span class="err">‚Üó</span>
</code></pre></div></div>

<h3 id="latent-composition">Latent Composition</h3>

<p>Combine multiple latents with masks:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">masked_latent_composite</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">masks</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Combine multiple latents using masks</span><span class="sh">"""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">latents</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">latent</span><span class="p">,</span> <span class="n">mask</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">masks</span><span class="p">):</span>
        <span class="c1"># Resize mask to latent dimensions
</span>        <span class="n">mask_resized</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="nf">interpolate</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">latent</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:])</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">latent</span> <span class="o">*</span> <span class="n">mask_resized</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="regional-prompting">Regional Prompting</h2>

<h3 id="attention-masking">Attention Masking</h3>

<p>Control where specific prompts apply:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Regional prompt structure
</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">detailed robot</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">mask</span><span class="sh">"</span><span class="p">:</span> <span class="n">left_half_mask</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.2</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lush forest</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">mask</span><span class="sh">"</span><span class="p">:</span> <span class="n">right_half_mask</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<h3 id="gligen-integration">GLIGEN Integration</h3>

<p>Grounded Language-to-Image Generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Bounding box control
</span><span class="n">gligen_inputs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">boxes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]],</span>  <span class="c1"># [x, y, w, h]
</span>    <span class="sh">"</span><span class="s">phrases</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">red car</span><span class="sh">"</span><span class="p">],</span>
    <span class="sh">"</span><span class="s">strengths</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="prompt-weighting-techniques">Prompt Weighting Techniques</h3>

<h4 id="alternating-prompts">Alternating Prompts</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Switch prompts during generation
</span><span class="n">prompt_schedule</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">0</span><span class="p">:</span> <span class="sh">"</span><span class="s">a cat sitting</span><span class="sh">"</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="sh">"</span><span class="s">[a cat sitting|a dog sitting]</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Alternate
</span>    <span class="mi">20</span><span class="p">:</span> <span class="sh">"</span><span class="s">a dog sitting</span><span class="sh">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="composable-diffusion">Composable Diffusion</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># AND operation
</span><span class="sh">"</span><span class="s">a cat AND a dog</span><span class="sh">"</span>  <span class="c1"># Both must appear
</span>
<span class="c1"># Weight distribution
</span><span class="sh">"</span><span class="s">(cat:1.2) and (dog:0.8)</span><span class="sh">"</span>  <span class="c1"># Cat emphasized
</span></code></pre></div></div>

<h2 id="advanced-sampling-methods">Advanced Sampling Methods</h2>

<h3 id="classifier-free-guidance-rescale">Classifier-Free Guidance Rescale</h3>

<p>Reduce oversaturation at high CFG values:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cfg_rescale</span><span class="p">(</span><span class="n">noise_pred_conditional</span><span class="p">,</span> <span class="n">noise_pred_unconditional</span><span class="p">,</span> 
                <span class="n">guidance_scale</span><span class="p">,</span> <span class="n">rescale_factor</span><span class="o">=</span><span class="mf">0.7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Rescale CFG to prevent oversaturation</span><span class="sh">"""</span>
    <span class="c1"># Standard CFG
</span>    <span class="n">noise_pred</span> <span class="o">=</span> <span class="n">noise_pred_unconditional</span> <span class="o">+</span> <span class="n">guidance_scale</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="n">noise_pred_conditional</span> <span class="o">-</span> <span class="n">noise_pred_unconditional</span><span class="p">)</span>
    
    <span class="c1"># Rescale
</span>    <span class="n">std_pos</span> <span class="o">=</span> <span class="n">noise_pred_conditional</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
    <span class="n">std_cfg</span> <span class="o">=</span> <span class="n">noise_pred</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
    
    <span class="n">rescale_factor</span> <span class="o">=</span> <span class="n">rescale_factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">std_pos</span> <span class="o">/</span> <span class="n">std_cfg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">noise_pred</span> <span class="o">*</span> <span class="n">rescale_factor</span>
</code></pre></div></div>

<h3 id="dynamic-thresholding">Dynamic Thresholding</h3>

<p>Prevent color artifacts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">dynamic_thresholding</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">percentile</span><span class="o">=</span><span class="mf">99.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Apply dynamic thresholding to prevent artifacts</span><span class="sh">"""</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">quantile</span><span class="p">(</span>
        <span class="n">x</span><span class="p">.</span><span class="nf">abs</span><span class="p">().</span><span class="nf">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
        <span class="n">percentile</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> 
        <span class="n">dim</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">torch</span><span class="p">.</span><span class="nf">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">clamp</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">s</span><span class="p">.</span><span class="nf">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span><span class="p">.</span><span class="nf">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="karras-noise-schedule">Karras Noise Schedule</h3>

<p>Optimized noise scheduling:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">karras_schedule</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">sigma_min</span><span class="o">=</span><span class="mf">0.002</span><span class="p">,</span> <span class="n">sigma_max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Generate Karras noise schedule</span><span class="sh">"""</span>
    <span class="n">ramp</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">min_inv_rho</span> <span class="o">=</span> <span class="n">sigma_min</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">max_inv_rho</span> <span class="o">=</span> <span class="n">sigma_max</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span>
    <span class="n">sigmas</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_inv_rho</span> <span class="o">+</span> <span class="n">ramp</span> <span class="o">*</span> <span class="p">(</span><span class="n">min_inv_rho</span> <span class="o">-</span> <span class="n">max_inv_rho</span><span class="p">))</span> <span class="o">**</span> <span class="n">rho</span>
    <span class="k">return</span> <span class="n">sigmas</span>
</code></pre></div></div>

<h3 id="restart-sampling">Restart Sampling</h3>

<p>Improve quality with strategic restarts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Restart sampling workflow
</span><span class="n">steps</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">restart_points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">35</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">restart_points</span><span class="p">:</span>
        <span class="c1"># Add controlled noise and continue
</span>        <span class="n">latents</span> <span class="o">=</span> <span class="n">latents</span> <span class="o">+</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
    
    <span class="n">latents</span> <span class="o">=</span> <span class="nf">sampler_step</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="multi-stage-workflows">Multi-Stage Workflows</h2>

<h3 id="progressive-upscaling">Progressive Upscaling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 4x upscale pipeline
</span><span class="n">stages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>    <span class="c1"># Base generation
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">768</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>    <span class="c1"># First upscale
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>   <span class="c1"># Second upscale
</span>    <span class="p">{</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2048</span><span class="p">,</span> <span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>   <span class="c1"># Final upscale
</span><span class="p">]</span>

<span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">512</span><span class="p">:</span>
        <span class="n">latent</span> <span class="o">=</span> <span class="nf">upscale_latent</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="n">latent</span> <span class="o">=</span> <span class="nf">generate</span><span class="p">(</span><span class="n">latent</span><span class="p">,</span> <span class="n">denoise</span><span class="o">=</span><span class="n">stage</span><span class="p">[</span><span class="sh">"</span><span class="s">denoise</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="detail-enhancement-pipeline">Detail Enhancement Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ComfyUI workflow
</span><span class="p">[</span><span class="n">Base</span> <span class="n">Generation</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Face</span> <span class="n">Detector</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">Face</span> <span class="n">Enhancement</span><span class="p">]</span>
        <span class="err">‚Üì</span>                                    <span class="err">‚Üì</span>
   <span class="p">[</span><span class="n">Background</span><span class="p">]</span>     <span class="err">‚Üí</span>    <span class="p">[</span><span class="n">Composite</span><span class="p">]</span>    <span class="err">‚Üê</span>  <span class="p">[</span><span class="n">Enhanced</span> <span class="n">Face</span><span class="p">]</span>
        <span class="err">‚Üì</span>
   <span class="p">[</span><span class="n">Final</span> <span class="n">Output</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="style-mixing-workflow">Style Mixing Workflow</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Multi-model style mixing
</span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">photorealistic.ckpt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">artistic.ckpt</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">anime.ckpt</span><span class="sh">"</span><span class="p">]</span>
<span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>

<span class="c1"># Generate with each model
</span><span class="n">latents</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">latent</span> <span class="o">=</span> <span class="nf">generate_with_model</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
    <span class="n">latents</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span>

<span class="c1"># Weighted combination
</span><span class="n">final_latent</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">l</span> <span class="o">*</span> <span class="n">w</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">weights</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="optimization-techniques">Optimization Techniques</h2>

<h3 id="attention-optimization">Attention Optimization</h3>

<h4 id="flash-attention">Flash Attention</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable flash attention for speed
</span><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">use_flash_attention</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">attention_slice_size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">auto</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">attention_processor</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xformers</span><span class="sh">"</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="token-merging-tome">Token Merging (ToMe)</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">token_merging</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">merge_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Merge similar tokens to reduce computation</span><span class="sh">"""</span>
    <span class="c1"># Calculate similarity matrix
</span>    <span class="n">similarity</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">matmul</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">tokens</span><span class="p">.</span><span class="nf">transpose</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Find most similar pairs
</span>    <span class="n">_</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">similarity</span><span class="p">.</span><span class="nf">topk</span><span class="p">(</span><span class="nf">int</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">*</span> <span class="n">merge_ratio</span><span class="p">))</span>
    
    <span class="c1"># Merge tokens
</span>    <span class="n">merged</span> <span class="o">=</span> <span class="nf">average_similar_tokens</span><span class="p">(</span><span class="n">tokens</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">merged</span>
</code></pre></div></div>

<h3 id="memory-optimization">Memory Optimization</h3>

<h4 id="gradient-checkpointing">Gradient Checkpointing</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Trade compute for memory
</span><span class="n">model</span><span class="p">.</span><span class="nf">enable_gradient_checkpointing</span><span class="p">()</span>

<span class="c1"># Custom checkpointing
</span><span class="k">def</span> <span class="nf">checkpoint_forward</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">checkpoint</span><span class="p">.</span><span class="nf">checkpoint</span><span class="p">(</span>
        <span class="n">module</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">use_reentrant</span><span class="o">=</span><span class="bp">False</span>
    <span class="p">)</span>
</code></pre></div></div>

<h4 id="sequential-generation">Sequential Generation</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generate in tiles for large images
</span><span class="k">def</span> <span class="nf">tiled_generation</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">tile_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tile_size</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tile_size</span> <span class="o">-</span> <span class="n">overlap</span><span class="p">):</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="nf">generate_tile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tile_size</span><span class="p">)</span>
            <span class="n">tiles</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tile</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="nf">blend_tiles</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">overlap</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="prompt-engineering-advanced">Prompt Engineering Advanced</h2>

<h3 id="semantic-prompt-optimization">Semantic Prompt Optimization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">optimize_prompt</span><span class="p">(</span><span class="n">base_prompt</span><span class="p">,</span> <span class="n">target_features</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Iteratively optimize prompt for target features</span><span class="sh">"""</span>
    <span class="n">current_prompt</span> <span class="o">=</span> <span class="n">base_prompt</span>
    
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># Generate with current prompt
</span>        <span class="n">features</span> <span class="o">=</span> <span class="nf">extract_features</span><span class="p">(</span><span class="nf">generate</span><span class="p">(</span><span class="n">current_prompt</span><span class="p">))</span>
        
        <span class="c1"># Calculate feature difference
</span>        <span class="n">diff</span> <span class="o">=</span> <span class="n">target_features</span> <span class="o">-</span> <span class="n">features</span>
        
        <span class="c1"># Update prompt based on difference
</span>        <span class="n">current_prompt</span> <span class="o">=</span> <span class="nf">update_prompt</span><span class="p">(</span><span class="n">current_prompt</span><span class="p">,</span> <span class="n">diff</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nf">convergence_reached</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
            <span class="k">break</span>
    
    <span class="k">return</span> <span class="n">current_prompt</span>
</code></pre></div></div>

<h3 id="prompt-expansion">Prompt Expansion</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">expand_prompt</span><span class="p">(</span><span class="n">simple_prompt</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Expand simple prompt with quality modifiers</span><span class="sh">"""</span>
    <span class="n">quality_tags</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">highly detailed</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">4k</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">professional</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">award winning</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">trending on artstation</span><span class="sh">"</span>
    <span class="p">]</span>
    
    <span class="n">style_hints</span> <span class="o">=</span> <span class="nf">analyze_intended_style</span><span class="p">(</span><span class="n">simple_prompt</span><span class="p">)</span>
    
    <span class="n">expanded</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">simple_prompt</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">quality_tags</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span>
    <span class="k">if</span> <span class="n">style_hints</span><span class="p">:</span>
        <span class="n">expanded</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">, </span><span class="si">{</span><span class="n">style_hints</span><span class="si">}</span><span class="sh">"</span>
    
    <span class="k">return</span> <span class="n">expanded</span>
</code></pre></div></div>

<h2 id="custom-sampling-algorithms">Custom Sampling Algorithms</h2>

<h3 id="ancestral-sampling-with-temperature">Ancestral Sampling with Temperature</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ancestral_sample_with_temp</span><span class="p">(</span><span class="n">noise_pred</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Ancestral sampling with temperature control</span><span class="sh">"""</span>
    <span class="c1"># Add noise with temperature scaling
</span>    <span class="n">noise</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">noise_pred</span><span class="p">)</span> <span class="o">*</span> <span class="n">temperature</span>
    
    <span class="c1"># Ancestral update
</span>    <span class="n">sigma_down</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">sigma_next</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="n">x_next</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">sigma_down</span> <span class="o">*</span> <span class="p">(</span><span class="n">noise_pred</span> <span class="o">+</span> <span class="n">noise</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">x_next</span>
</code></pre></div></div>

<h3 id="importance-sampling">Importance Sampling</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">importance_sampling</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">condition</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Generate multiple samples and select best</span><span class="sh">"""</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nf">generate_sample</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="n">score</span> <span class="o">=</span> <span class="nf">evaluate_quality</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">condition</span><span class="p">)</span>
        <span class="n">samples</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
    
    <span class="c1"># Return best sample
</span>    <span class="n">best_idx</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">argmax</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">tensor</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">samples</span><span class="p">[</span><span class="n">best_idx</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="advanced-controlnet-techniques">Advanced ControlNet Techniques</h2>

<h3 id="multi-scale-control">Multi-Scale Control</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Apply control at different resolutions
</span><span class="n">control_scales</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
    <span class="p">{</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">control_scales</span><span class="p">:</span>
    <span class="n">control_resized</span> <span class="o">=</span> <span class="nf">resize</span><span class="p">(</span><span class="n">control_image</span><span class="p">,</span> <span class="n">scale</span><span class="p">[</span><span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">apply_control</span><span class="p">(</span><span class="n">control_resized</span><span class="p">,</span> <span class="n">scale</span><span class="p">[</span><span class="sh">"</span><span class="s">strength</span><span class="sh">"</span><span class="p">])</span>
</code></pre></div></div>

<h3 id="temporal-controlnet">Temporal ControlNet</h3>

<p>For video consistency:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">temporal_controlnet</span><span class="p">(</span><span class="n">frames</span><span class="p">,</span> <span class="n">control_strength_decay</span><span class="o">=</span><span class="mf">0.95</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Apply control with temporal decay</span><span class="sh">"""</span>
    <span class="n">previous_control</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">controlled_frames</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">frame</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">previous_control</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Blend with previous frame's control
</span>            <span class="n">current_control</span> <span class="o">=</span> <span class="nf">blend_controls</span><span class="p">(</span>
                <span class="nf">extract_control</span><span class="p">(</span><span class="n">frame</span><span class="p">),</span>
                <span class="n">previous_control</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">control_strength_decay</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_control</span> <span class="o">=</span> <span class="nf">extract_control</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
        
        <span class="n">controlled_frame</span> <span class="o">=</span> <span class="nf">generate_with_control</span><span class="p">(</span>
            <span class="n">frame</span><span class="p">,</span> <span class="n">current_control</span>
        <span class="p">)</span>
        <span class="n">controlled_frames</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">controlled_frame</span><span class="p">)</span>
        <span class="n">previous_control</span> <span class="o">=</span> <span class="n">current_control</span>
    
    <span class="k">return</span> <span class="n">controlled_frames</span>
</code></pre></div></div>

<h2 id="experimental-techniques">Experimental Techniques</h2>

<h3 id="diffusion-distillation">Diffusion Distillation</h3>

<p>Create faster models:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Progressive distillation
</span><span class="n">teacher_steps</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">student_steps</span> <span class="o">=</span> <span class="mi">4</span>

<span class="c1"># Train student to match teacher
</span><span class="k">for</span> <span class="n">batch</span> <span class="ow">in</span> <span class="n">training_data</span><span class="p">:</span>
    <span class="n">teacher_output</span> <span class="o">=</span> <span class="nf">teacher_model</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">teacher_steps</span><span class="p">)</span>
    <span class="n">student_output</span> <span class="o">=</span> <span class="nf">student_model</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="n">student_steps</span><span class="p">)</span>
    
    <span class="n">loss</span> <span class="o">=</span> <span class="nf">mse_loss</span><span class="p">(</span><span class="n">student_output</span><span class="p">,</span> <span class="n">teacher_output</span><span class="p">.</span><span class="nf">detach</span><span class="p">())</span>
    <span class="nf">optimize_student</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="consistency-models">Consistency Models</h3>

<p>Single-step generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Consistency training
</span><span class="k">def</span> <span class="nf">consistency_loss</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">x_t</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Train model to be consistent across timesteps</span><span class="sh">"""</span>
    <span class="c1"># Get two adjacent timesteps
</span>    <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="nf">get_adjacent_timesteps</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Model should produce same output
</span>    <span class="n">output1</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
    <span class="n">output2</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">x_t</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">mse_loss</span><span class="p">(</span><span class="n">output1</span><span class="p">,</span> <span class="n">output2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="neural-codec-integration">Neural Codec Integration</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compress latents with neural codec
</span><span class="n">encoded</span> <span class="o">=</span> <span class="n">neural_codec</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">latent</span><span class="p">)</span>  <span class="c1"># Ultra-compressed
</span><span class="n">transmitted</span> <span class="o">=</span> <span class="nf">send_over_network</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span>
<span class="n">decoded</span> <span class="o">=</span> <span class="n">neural_codec</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">transmitted</span><span class="p">)</span>
<span class="n">final_image</span> <span class="o">=</span> <span class="n">vae</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">decoded</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="workflow-automation">Workflow Automation</h2>

<h3 id="batch-processing-pipeline">Batch Processing Pipeline</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">BatchPipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">base_workflow</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">workflow</span> <span class="o">=</span> <span class="n">base_workflow</span>
        <span class="n">self</span><span class="p">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">variations</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">input_data</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">variation</span> <span class="ow">in</span> <span class="n">variations</span><span class="p">:</span>
                <span class="c1"># Apply variation
</span>                <span class="n">modified_workflow</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply_variation</span><span class="p">(</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">workflow</span><span class="p">,</span> <span class="n">variation</span>
                <span class="p">)</span>
                
                <span class="c1"># Generate
</span>                <span class="n">result</span> <span class="o">=</span> <span class="nf">execute_workflow</span><span class="p">(</span>
                    <span class="n">modified_workflow</span><span class="p">,</span> <span class="n">input_data</span>
                <span class="p">)</span>
                
                <span class="n">self</span><span class="p">.</span><span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">input</span><span class="sh">"</span><span class="p">:</span> <span class="n">input_data</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">variation</span><span class="sh">"</span><span class="p">:</span> <span class="n">variation</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">:</span> <span class="n">result</span>
                <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">apply_variation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">,</span> <span class="n">variation</span><span class="p">):</span>
        <span class="c1"># Modify workflow parameters
</span>        <span class="k">return</span> <span class="n">modified_workflow</span>
</code></pre></div></div>

<h3 id="ab-testing-framework">A/B Testing Framework</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ab_test_parameters</span><span class="p">(</span><span class="n">base_config</span><span class="p">,</span> <span class="n">test_params</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Test different parameter combinations</span><span class="sh">"""</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_values</span> <span class="ow">in</span> <span class="n">test_params</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">param_results</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">param_values</span><span class="p">:</span>
            <span class="c1"># Update config
</span>            <span class="n">test_config</span> <span class="o">=</span> <span class="n">base_config</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            <span class="n">test_config</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            
            <span class="c1"># Generate samples
</span>            <span class="n">samples</span> <span class="o">=</span> <span class="nf">generate_samples</span><span class="p">(</span><span class="n">test_config</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
            
            <span class="c1"># Evaluate quality
</span>            <span class="n">quality_score</span> <span class="o">=</span> <span class="nf">evaluate_batch</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
            <span class="n">param_results</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">quality_score</span><span class="p">))</span>
        
        <span class="n">results</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_results</span>
    
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></div>

<h2 id="performance-monitoring">Performance Monitoring</h2>

<h3 id="generation-metrics">Generation Metrics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GenerationProfiler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">profile_generation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">workflow</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="n">profiler</span><span class="p">.</span><span class="nf">profile</span><span class="p">()</span> <span class="k">as</span> <span class="n">prof</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="nf">execute_workflow</span><span class="p">(</span><span class="n">workflow</span><span class="p">)</span>
        
        <span class="c1"># Extract metrics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">prof</span><span class="p">.</span><span class="n">total_time</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">memory_used</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">max_memory_allocated</span><span class="p">())</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">quality_score</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="nf">assess_quality</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">output</span>
    
    <span class="k">def</span> <span class="nf">get_report</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">metric</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">std</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">min</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">metric</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">.</span><span class="nf">items</span><span class="p">()</span>
        <span class="p">}</span>
</code></pre></div></div>

<h2 id="best-practices">Best Practices</h2>

<h3 id="workflow-design">Workflow Design</h3>

<ol>
  <li>
<strong>Modularity</strong>: Build reusable components</li>
  <li>
<strong>Validation</strong>: Test each stage independently</li>
  <li>
<strong>Documentation</strong>: Comment complex operations</li>
  <li>
<strong>Version Control</strong>: Track workflow changes</li>
  <li>
<strong>Performance</strong>: Profile and optimize bottlenecks</li>
</ol>

<h3 id="experimentation-guidelines">Experimentation Guidelines</h3>

<ol>
  <li>
<strong>Controlled Testing</strong>: Change one variable at a time</li>
  <li>
<strong>Reproducibility</strong>: Fix seeds for comparisons</li>
  <li>
<strong>Metrics</strong>: Define clear success criteria</li>
  <li>
<strong>Iteration</strong>: Start simple, add complexity</li>
  <li>
<strong>Documentation</strong>: Record successful configurations</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>Advanced techniques open up new possibilities in AI image generation, from precise control over the generation process to optimization for specific use cases. The key to mastering these techniques is understanding the underlying principles and experimenting with different combinations to achieve your desired results.</p>

<p>As the field evolves rapidly, staying updated with the latest research and community developments will help you leverage new techniques as they emerge. Remember that the most impressive results often come from creative combinations of multiple techniques rather than relying on any single advanced method.</p>




<div class="learning-mode-container" id="learning-mode-container">
  <button class="learning-mode-button" onclick="toggleLearningMode()" aria-label="Toggle learning mode">
    <svg class="mode-icon" width="20" height="20" fill="currentColor" viewbox="0 0 16 16">
      <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917l-7.5-3.5ZM8 8.46 1.758 5.965 8 3.052l6.242 2.913L8 8.46Z"></path>
      <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466 4.176 9.032Zm-.068 1.873.86-.23a.5.5 0 0 0 .372 0l2.66-.71.66 2.246L8 11.98l-3.892.156.5-1.231Z"></path>
    </svg>
    <span class="mode-text">Learning Mode</span>
    <span class="mode-status" id="mode-status">OFF</span>
  </button>
  
  <div class="learning-mode-panel" id="learning-mode-panel" style="display: none;">
    <div class="panel-header">
      <h3>Personalized Learning Mode</h3>
      <button class="close-panel" onclick="closeLearningPanel()">√ó</button>
    </div>
    
    <div class="panel-content">
      <div class="skill-level-section">
        <h4>Select Your Skill Level</h4>
        <div class="level-cards">
          <label class="level-card">
            <input type="radio" name="skill-level" value="beginner" onchange="updateSkillLevel('beginner')">
            <div class="card-content">
              <span class="level-emoji">üå±</span>
              <span class="level-name">Beginner</span>
              <span class="level-desc">New to this topic</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="intermediate" onchange="updateSkillLevel('intermediate')">
            <div class="card-content">
              <span class="level-emoji">üåø</span>
              <span class="level-name">Intermediate</span>
              <span class="level-desc">Some experience</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="advanced" onchange="updateSkillLevel('advanced')">
            <div class="card-content">
              <span class="level-emoji">üå≥</span>
              <span class="level-name">Advanced</span>
              <span class="level-desc">Deep knowledge</span>
            </div>
          </label>
        </div>
      </div>
      
      <div class="learning-preferences">
        <h4>Learning Preferences</h4>
        <div class="preference-options">
          <label class="preference-option">
            <input type="checkbox" id="show-prerequisites" checked onchange="updatePreferences()">
            <span>Show prerequisites for each topic</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="highlight-next-steps" checked onchange="updatePreferences()">
            <span>Highlight recommended next steps</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="adaptive-difficulty" onchange="updatePreferences()">
            <span>Automatically adjust difficulty based on progress</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="track-progress" checked onchange="updatePreferences()">
            <span>Track my learning progress</span>
          </label>
        </div>
      </div>
      
      <div class="progress-overview">
        <h4>Your Learning Journey</h4>
        <div class="journey-stats">
          <div class="stat-card">
            <span class="stat-value" id="pages-read">0</span>
            <span class="stat-label">Pages Read</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="topics-completed">0</span>
            <span class="stat-label">Topics Completed</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="current-streak">0</span>
            <span class="stat-label">Day Streak</span>
          </div>
        </div>
        
        <div class="recent-topics">
          <h5>Recently Viewed</h5>
          <ul id="recent-topics-list">
            <li class="empty-state">No topics viewed yet</li>
          </ul>
        </div>
      </div>
      
      <div class="panel-actions">
        <button class="action-btn secondary" onclick="resetProgress()">Reset Progress</button>
        <button class="action-btn primary" onclick="applyLearningMode()">Apply Settings</button>
      </div>
    </div>
  </div>
  
  <!-- Floating indicators when learning mode is active -->
  <div class="learning-indicators" id="learning-indicators" style="display: none;">
    <div class="indicator skill-level-indicator">
      <span class="indicator-label">Level:</span>
      <span class="indicator-value" id="current-skill-level">Intermediate</span>
    </div>
    
    <div class="indicator next-step-indicator" id="next-step-indicator" style="display: none;">
      <span class="indicator-label">Next:</span>
      <a href="#" class="indicator-link" id="next-step-link">Loading...</a>
    </div>
  </div>
</div>

<script>
// Learning mode state
let learningMode = {
  enabled: false,
  skillLevel: 'intermediate',
  preferences: {
    showPrerequisites: true,
    highlightNextSteps: true,
    adaptiveDifficulty: false,
    trackProgress: true
  },
  progress: {
    pagesRead: [],
    topicsCompleted: [],
    lastVisit: null,
    streak: 0
  }
};

// Initialize from localStorage
function initializeLearningMode() {
  const saved = localStorage.getItem('learningMode');
  if (saved) {
    learningMode = JSON.parse(saved);
    if (learningMode.enabled) {
      activateLearningMode();
    }
  }
  
  // Update UI
  updateLearningStats();
  updateRecentTopics();
}

// Toggle learning mode
function toggleLearningMode() {
  const panel = document.getElementById('learning-mode-panel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// Close panel
function closeLearningPanel() {
  document.getElementById('learning-mode-panel').style.display = 'none';
}

// Update skill level
function updateSkillLevel(level) {
  learningMode.skillLevel = level;
  saveLearningMode();
}

// Update preferences
function updatePreferences() {
  learningMode.preferences = {
    showPrerequisites: document.getElementById('show-prerequisites').checked,
    highlightNextSteps: document.getElementById('highlight-next-steps').checked,
    adaptiveDifficulty: document.getElementById('adaptive-difficulty').checked,
    trackProgress: document.getElementById('track-progress').checked
  };
  saveLearningMode();
}

// Apply learning mode
function applyLearningMode() {
  learningMode.enabled = true;
  saveLearningMode();
  activateLearningMode();
  closeLearningPanel();
}

// Activate learning mode
function activateLearningMode() {
  document.getElementById('mode-status').textContent = 'ON';
  document.getElementById('learning-mode-button').classList.add('active');
  document.getElementById('learning-indicators').style.display = 'flex';
  
  // Apply content filtering
  filterContentByLevel();
  
  // Track current page
  if (learningMode.preferences.trackProgress) {
    trackPageVisit();
  }
  
  // Show next steps
  if (learningMode.preferences.highlightNextSteps) {
    showNextSteps();
  }
  
  // Apply visual indicators
  applyLevelIndicators();
}

// Filter content by skill level
function filterContentByLevel() {
  const currentLevel = learningMode.skillLevel;
  document.getElementById('current-skill-level').textContent = 
    currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
  
  // Add class to body for CSS-based filtering
  document.body.setAttribute('data-learning-level', currentLevel);
  
  // Hide/show content based on level
  document.querySelectorAll('[data-difficulty]').forEach(element => {
    const difficulty = element.getAttribute('data-difficulty');
    if (shouldShowContent(difficulty, currentLevel)) {
      element.style.display = '';
      element.classList.add('learning-mode-visible');
    } else {
      element.style.display = 'none';
      element.classList.remove('learning-mode-visible');
    }
  });
}

// Determine if content should be shown
function shouldShowContent(contentLevel, userLevel) {
  const levels = ['beginner', 'intermediate', 'advanced'];
  const contentIndex = levels.indexOf(contentLevel);
  const userIndex = levels.indexOf(userLevel);
  
  // Show content at or below user level, plus one level up
  return contentIndex <= userIndex + 1;
}

// Track page visit
function trackPageVisit() {
  const currentPage = {
    path: window.location.pathname,
    title: document.title,
    timestamp: new Date().toISOString(),
    level: 'intermediate'
  };
  
  // Add to pages read
  if (!learningMode.progress.pagesRead.find(p => p.path === currentPage.path)) {
    learningMode.progress.pagesRead.push(currentPage);
  }
  
  // Update streak
  updateStreak();
  
  // Save progress
  saveLearningMode();
  updateLearningStats();
}

// Update learning streak
function updateStreak() {
  const today = new Date().toDateString();
  const lastVisit = learningMode.progress.lastVisit;
  
  if (!lastVisit) {
    learningMode.progress.streak = 1;
  } else {
    const lastDate = new Date(lastVisit).toDateString();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    if (lastDate === today) {
      // Already visited today
      return;
    } else if (lastDate === yesterday.toDateString()) {
      // Consecutive day
      learningMode.progress.streak++;
    } else {
      // Streak broken
      learningMode.progress.streak = 1;
    }
  }
  
  learningMode.progress.lastVisit = new Date().toISOString();
}

// Show next steps
function showNextSteps() {
  // This would be customized based on the current page and user's progress
  const nextSteps = getRecommendedNextSteps();
  
  if (nextSteps.length > 0) {
    const indicator = document.getElementById('next-step-indicator');
    const link = document.getElementById('next-step-link');
    
    indicator.style.display = 'block';
    link.href = nextSteps[0].url;
    link.textContent = nextSteps[0].title;
  }
}

// Get recommended next steps (mock implementation)
function getRecommendedNextSteps() {
  // In a real implementation, this would analyze the current page,
  // user's progress, and skill level to recommend appropriate next content
  return [
    {
      title: 'Advanced Concepts',
      url: '/docs/advanced/',
      reason: 'You\'ve completed the basics'
    }
  ];
}

// Apply visual indicators to content
function applyLevelIndicators() {
  // Add badges to links based on their difficulty
  document.querySelectorAll('a[data-difficulty]').forEach(link => {
    const difficulty = link.getAttribute('data-difficulty');
    if (!link.querySelector('.level-badge')) {
      const badge = document.createElement('span');
      badge.className = `level-badge inline-badge level-${difficulty}`;
      badge.textContent = difficulty.charAt(0).toUpperCase();
      link.appendChild(badge);
    }
  });
}

// Update learning statistics
function updateLearningStats() {
  document.getElementById('pages-read').textContent = learningMode.progress.pagesRead.length;
  document.getElementById('topics-completed').textContent = learningMode.progress.topicsCompleted.length;
  document.getElementById('current-streak').textContent = learningMode.progress.streak;
}

// Update recent topics list
function updateRecentTopics() {
  const list = document.getElementById('recent-topics-list');
  const recentPages = learningMode.progress.pagesRead.slice(-5).reverse();
  
  if (recentPages.length === 0) {
    return;
  }
  
  list.innerHTML = recentPages.map(page => `
    <li>
      <a href="${page.path}">${page.title}</a>
      <span class="topic-level">${page.level}</span>
    </li>
  `).join('');
}

// Reset progress
function resetProgress() {
  if (confirm('Are you sure you want to reset all your learning progress?')) {
    learningMode.progress = {
      pagesRead: [],
      topicsCompleted: [],
      lastVisit: null,
      streak: 0
    };
    saveLearningMode();
    updateLearningStats();
    updateRecentTopics();
  }
}

// Save learning mode to localStorage
function saveLearningMode() {
  localStorage.setItem('learningMode', JSON.stringify(learningMode));
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initializeLearningMode);

// Listen for visibility changes to update content
document.addEventListener('visibilitychange', () => {
  if (!document.hidden && learningMode.enabled) {
    filterContentByLevel();
  }
});
</script>

<style>
/* Learning mode button */
.learning-mode-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 900;
}

.learning-mode-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--btn-bg, #fff);
  border: 2px solid var(--btn-border, #0066cc);
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
  font-weight: 500;
}

.learning-mode-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.learning-mode-button.active {
  background: var(--btn-active-bg, #0066cc);
  color: white;
}

.mode-icon {
  flex-shrink: 0;
}

.mode-status {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--status-bg, #e0e0e0);
  color: var(--status-color, #666);
  border-radius: 10px;
  font-weight: 600;
}

.learning-mode-button.active .mode-status {
  background: var(--status-active-bg, #28a745);
  color: white;
}

/* Learning mode panel */
.learning-mode-panel {
  position: fixed;
  bottom: 5rem;
  right: 2rem;
  width: 420px;
  max-width: calc(100vw - 4rem);
  max-height: 600px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  overflow: hidden;
  z-index: 901;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  background: var(--header-bg, #f8f9fa);
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.panel-header h3 {
  margin: 0;
  font-size: 1.25rem;
}

.close-panel {
  width: 32px;
  height: 32px;
  background: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--close-color, #6c757d);
  border-radius: 4px;
  transition: all 0.2s ease;
}

.close-panel:hover {
  background: var(--close-hover-bg, #e9ecef);
  color: var(--close-hover-color, #000);
}

.panel-content {
  padding: 1.5rem;
  max-height: 500px;
  overflow-y: auto;
}

/* Skill level cards */
.level-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.level-card {
  cursor: pointer;
}

.level-card input {
  position: absolute;
  opacity: 0;
}

.card-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.5rem 0.5rem;
  background: var(--card-bg, #f8f9fa);
  border: 2px solid var(--card-border, #e0e0e0);
  border-radius: 8px;
  transition: all 0.2s ease;
  text-align: center;
}

.level-card input:checked + .card-content {
  background: var(--card-selected-bg, #e6f2ff);
  border-color: var(--card-selected-border, #0066cc);
}

.level-card:hover .card-content {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.level-emoji {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.level-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.level-desc {
  font-size: 0.75rem;
  color: var(--desc-color, #6c757d);
}

/* Preferences */
.preference-option {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 0;
  cursor: pointer;
}

.preference-option input {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* Journey stats */
.journey-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin: 1rem 0;
}

.stat-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  background: var(--stat-bg, #f8f9fa);
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--stat-color, #0066cc);
}

.stat-label {
  font-size: 0.75rem;
  color: var(--label-color, #6c757d);
  margin-top: 0.25rem;
}

/* Recent topics */
.recent-topics {
  margin-top: 1.5rem;
}

.recent-topics h5 {
  margin-bottom: 0.5rem;
  color: var(--heading-color, #495057);
}

#recent-topics-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

#recent-topics-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--list-border, #e0e0e0);
}

#recent-topics-list li:last-child {
  border-bottom: none;
}

.topic-level {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--level-bg, #e0e0e0);
  color: var(--level-color, #666);
  border-radius: 10px;
  text-transform: capitalize;
}

.empty-state {
  color: var(--empty-color, #6c757d);
  font-style: italic;
}

/* Panel actions */
.panel-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border-color, #e0e0e0);
}

.action-btn {
  flex: 1;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.action-btn.primary {
  background: var(--primary-bg, #0066cc);
  color: white;
}

.action-btn.primary:hover {
  background: var(--primary-hover, #0052a3);
}

.action-btn.secondary {
  background: var(--secondary-bg, #6c757d);
  color: white;
}

.action-btn.secondary:hover {
  background: var(--secondary-hover, #5a6268);
}

/* Learning indicators */
.learning-indicators {
  position: fixed;
  top: 5rem;
  right: 2rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  z-index: 800;
}

.indicator {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: white;
  border: 1px solid var(--indicator-border, #e0e0e0);
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  font-size: 0.875rem;
}

.indicator-label {
  color: var(--label-color, #6c757d);
}

.indicator-value {
  font-weight: 600;
  color: var(--value-color, #0066cc);
}

.indicator-link {
  color: var(--link-color, #0066cc);
  text-decoration: none;
}

.indicator-link:hover {
  text-decoration: underline;
}

/* Content filtering styles */
body[data-learning-level="beginner"] .advanced-only,
body[data-learning-level="beginner"] .intermediate-only {
  display: none !important;
}

body[data-learning-level="intermediate"] .advanced-only {
  opacity: 0.6;
}

/* Level badges */
.level-badge.inline-badge {
  display: inline-block;
  margin-left: 0.5rem;
  font-size: 0.65rem;
  padding: 0.1rem 0.3rem;
  vertical-align: super;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .learning-mode-button {
    --btn-bg: #2a2a2a;
    --btn-border: #4d94ff;
  }
  
  .learning-mode-panel {
    background: #1a1a1a;
    color: #f0f0f0;
  }
  
  .panel-header {
    --header-bg: #2a2a2a;
    --border-color: #333;
  }
  
  .card-content {
    --card-bg: #2a2a2a;
    --card-border: #444;
    --card-selected-bg: #1a3d66;
    --card-selected-border: #4d94ff;
  }
  
  .stat-card {
    --stat-bg: #2a2a2a;
  }
  
  .indicator {
    background: #2a2a2a;
    --indicator-border: #444;
  }
  
  /* More dark mode variables... */
}

/* Responsive design */
@media (max-width: 768px) {
  .learning-mode-container {
    bottom: 1rem;
    right: 1rem;
  }
  
  .learning-mode-panel {
    right: 1rem;
    width: calc(100vw - 2rem);
  }
  
  .level-cards {
    grid-template-columns: 1fr;
  }
  
  .journey-stats {
    grid-template-columns: 1fr;
  }
}
</style>
        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

  </div>
</body>
</html>