<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LoRA Training Guide | Andrews Notebook</title>
  <meta name="description" content="Technology and Physics notes">
  
  <link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/lora-training.html">
  
  <link rel="stylesheet" href="/Documentation/assets/css/main.css">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>LoRA Training Guide | Andrews Notebook</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="LoRA Training Guide" />
<meta name="author" content="Andrew" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technology and Physics notes" />
<meta property="og:description" content="Technology and Physics notes" />
<link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/lora-training.html" />
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/ai-ml/lora-training.html" />
<meta property="og:site_name" content="Andrews Notebook" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="LoRA Training Guide" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew"},"description":"Technology and Physics notes","headline":"LoRA Training Guide","url":"https://andrewaltimit.github.io/Documentation/docs/ai-ml/lora-training.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://andrewaltimit.github.io/Documentation/feed.xml" title="Andrews Notebook" />
</head>
<body>
  <div class="site">
    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://andrewaltimit.github.io/Documentation/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/docs" itemprop="item"><span itemprop="name">Docs</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/ai-ml" itemprop="item"><span itemprop="name">Ai ml</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">LoRA Training Guide</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="LoRA Training Guide">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">LoRA Training Guide
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-cog"></i> On This Page</h4></header>
              <ul class="toc__menu">
<li><a href="#key-benefits">Key Benefits</a></li>
<li><a href="#how-lora-works">How LoRA Works</a></li>
<li><a href="#using-docker-recommended">Using Docker (Recommended)</a></li>
<li><a href="#required-hardware">Required Hardware</a></li>
<li><a href="#image-requirements">Image Requirements</a></li>
<li>
<a href="#captioning-best-practices">Captioning Best Practices</a><ul>
<li><a href="#caption-structure">Caption Structure</a></li>
<li><a href="#flux-caption-guidelines">FLUX Caption Guidelines</a></li>
</ul>
</li>
<li><a href="#automated-captioning">Automated Captioning</a></li>
<li><a href="#basic-configuration-via-mcp">Basic Configuration via MCP</a></li>
<li>
<a href="#key-parameters-explained">Key Parameters Explained</a><ul>
<li><a href="#learning-rate">Learning Rate</a></li>
<li><a href="#steps-calculation">Steps Calculation</a></li>
<li><a href="#rank-selection">Rank Selection</a></li>
</ul>
</li>
<li><a href="#advanced-configuration">Advanced Configuration</a></li>
<li><a href="#starting-training">Starting Training</a></li>
<li><a href="#monitoring-progress">Monitoring Progress</a></li>
<li><a href="#understanding-training-metrics">Understanding Training Metrics</a></li>
<li><a href="#direct-upload-small-datasets">Direct Upload (Small Datasets)</a></li>
<li><a href="#chunked-upload-large-files">Chunked Upload (Large Files)</a></li>
<li><a href="#style-lora">Style LoRA</a></li>
<li><a href="#character-lora">Character LoRA</a></li>
<li><a href="#photographic-subject">Photographic Subject</a></li>
<li><a href="#memory-optimization">Memory Optimization</a></li>
<li><a href="#speed-optimization">Speed Optimization</a></li>
<li><a href="#quality-optimization">Quality Optimization</a></li>
<li>
<a href="#common-issues">Common Issues</a><ul>
<li><a href="#overfitting">Overfitting</a></li>
<li><a href="#underfitting">Underfitting</a></li>
<li><a href="#style-bleeding">Style Bleeding</a></li>
</ul>
</li>
<li><a href="#training-diagnostics">Training Diagnostics</a></li>
<li><a href="#multi-concept-training">Multi-Concept Training</a></li>
<li><a href="#dreambooth-style-training">DreamBooth-style Training</a></li>
<li><a href="#progressive-training">Progressive Training</a></li>
<li><a href="#in-comfyui">In ComfyUI</a></li>
<li><a href="#combining-multiple-loras">Combining Multiple LoRAs</a></li>
<li><a href="#optimal-strength-settings">Optimal Strength Settings</a></li>
<li><a href="#dos">Do‚Äôs</a></li>
<li><a href="#donts">Don‚Äôts</a></li>
</ul>

            </nav>
          </aside>
        
        <aside class="sidebar sticky">
  <nav class="nav__list">
    
      
        <h3 class="nav__title">Getting Started</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/topic-map/">
                  <span class="nav__sub-title">üó∫Ô∏è Interactive Topic Map</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git-crash-course.html">
                  <span class="nav__sub-title">üå± Git in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker-crash-course.html">
                  <span class="nav__sub-title">üå± Docker in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-crash-course.html">
                  <span class="nav__sub-title">üå± Databases in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-fundamentals-simple.html">
                  <span class="nav__sub-title">üå± AI Fundamentals Simple</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Technology</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/technology/index.html">
                  <span class="nav__sub-title">Technology Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/terraform.html">
                  <span class="nav__sub-title">Terraform</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker.html">
                  <span class="nav__sub-title">Docker Containers</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/aws.html">
                  <span class="nav__sub-title">AWS</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/kubernetes.html">
                  <span class="nav__sub-title">Kubernetes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-design.html">
                  <span class="nav__sub-title">Database Design</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/networking.html">
                  <span class="nav__sub-title">Networking</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/cybersecurity.html">
                  <span class="nav__sub-title">Cybersecurity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git.html">
                  <span class="nav__sub-title">Git Version Control</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/branching.html">
                  <span class="nav__sub-title">Branching Strategies</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/unreal.html">
                  <span class="nav__sub-title">Unreal Engine</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/quantumcomputing.html">
                  <span class="nav__sub-title">Quantum Computing</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai.html">
                  <span class="nav__sub-title">Artificial Intelligence</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-lecture-2023.html">
                  <span class="nav__sub-title">AI Lecture 2023</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/please-build.html">
                  <span class="nav__sub-title">Please Build</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">AI/ML - Generative AI</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/ai-ml/index.html">
                  <span class="nav__sub-title">AI/ML Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html">
                  <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/base-models-comparison.html">
                  <span class="nav__sub-title">Base Models Comparison</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/model-types.html">
                  <span class="nav__sub-title">Model Types</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/lora-training.html" class="active">
                  <span class="nav__sub-title">LoRA Training</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/controlnet.html">
                  <span class="nav__sub-title">ControlNet Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/comfyui-guide.html">
                  <span class="nav__sub-title">ComfyUI Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/output-formats.html">
                  <span class="nav__sub-title">Output Formats</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/advanced-techniques.html">
                  <span class="nav__sub-title">Advanced Techniques</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Physics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/physics/index.html">
                  <span class="nav__sub-title">Physics Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/classical-mechanics.html">
                  <span class="nav__sub-title">Classical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/thermodynamics.html">
                  <span class="nav__sub-title">Thermodynamics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/statistical-mechanics.html">
                  <span class="nav__sub-title">Statistical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/relativity.html">
                  <span class="nav__sub-title">Relativity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-mechanics.html">
                  <span class="nav__sub-title">Quantum Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/condensed-matter.html">
                  <span class="nav__sub-title">Condensed Matter Physics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-field-theory.html">
                  <span class="nav__sub-title">Quantum Field Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/string-theory.html">
                  <span class="nav__sub-title">String Theory</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Advanced Topics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/advanced/index.html">
                  <span class="nav__sub-title">Research Hub</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/ai-mathematics/">
                  <span class="nav__sub-title">AI Mathematics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/distributed-systems-theory/">
                  <span class="nav__sub-title">Distributed Systems Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/quantum-algorithms-research/">
                  <span class="nav__sub-title">Quantum Algorithms Research</span>
                </a>
              </li>
            
          </ul>
        
      
    
  </nav>
</aside>


<div class="code-example">
  <p>Learn how to train custom LoRA (Low-Rank Adaptation) models to add new styles, concepts, or characters to Stable Diffusion models.</p>
</div>

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li>
<a href="#what-is-lora" id="markdown-toc-what-is-lora">What is LoRA?</a>    <ol>
      <li><a href="#key-benefits" id="markdown-toc-key-benefits">Key Benefits</a></li>
      <li><a href="#how-lora-works" id="markdown-toc-how-lora-works">How LoRA Works</a></li>
    </ol>
  </li>
  <li>
<a href="#setup-with-ai-toolkit" id="markdown-toc-setup-with-ai-toolkit">Setup with AI Toolkit</a>    <ol>
      <li><a href="#using-docker-recommended" id="markdown-toc-using-docker-recommended">Using Docker (Recommended)</a></li>
      <li><a href="#required-hardware" id="markdown-toc-required-hardware">Required Hardware</a></li>
    </ol>
  </li>
  <li>
<a href="#dataset-preparation" id="markdown-toc-dataset-preparation">Dataset Preparation</a>    <ol>
      <li><a href="#image-requirements" id="markdown-toc-image-requirements">Image Requirements</a></li>
      <li>
<a href="#captioning-best-practices" id="markdown-toc-captioning-best-practices">Captioning Best Practices</a>        <ol>
          <li><a href="#caption-structure" id="markdown-toc-caption-structure">Caption Structure</a></li>
          <li><a href="#flux-caption-guidelines" id="markdown-toc-flux-caption-guidelines">FLUX Caption Guidelines</a></li>
        </ol>
      </li>
      <li><a href="#automated-captioning" id="markdown-toc-automated-captioning">Automated Captioning</a></li>
    </ol>
  </li>
  <li>
<a href="#training-configuration" id="markdown-toc-training-configuration">Training Configuration</a>    <ol>
      <li><a href="#basic-configuration-via-mcp" id="markdown-toc-basic-configuration-via-mcp">Basic Configuration via MCP</a></li>
      <li>
<a href="#key-parameters-explained" id="markdown-toc-key-parameters-explained">Key Parameters Explained</a>        <ol>
          <li><a href="#learning-rate" id="markdown-toc-learning-rate">Learning Rate</a></li>
          <li><a href="#steps-calculation" id="markdown-toc-steps-calculation">Steps Calculation</a></li>
          <li><a href="#rank-selection" id="markdown-toc-rank-selection">Rank Selection</a></li>
        </ol>
      </li>
      <li><a href="#advanced-configuration" id="markdown-toc-advanced-configuration">Advanced Configuration</a></li>
    </ol>
  </li>
  <li>
<a href="#training-process" id="markdown-toc-training-process">Training Process</a>    <ol>
      <li><a href="#starting-training" id="markdown-toc-starting-training">Starting Training</a></li>
      <li><a href="#monitoring-progress" id="markdown-toc-monitoring-progress">Monitoring Progress</a></li>
      <li><a href="#understanding-training-metrics" id="markdown-toc-understanding-training-metrics">Understanding Training Metrics</a></li>
    </ol>
  </li>
  <li>
<a href="#dataset-upload" id="markdown-toc-dataset-upload">Dataset Upload</a>    <ol>
      <li><a href="#direct-upload-small-datasets" id="markdown-toc-direct-upload-small-datasets">Direct Upload (Small Datasets)</a></li>
      <li><a href="#chunked-upload-large-files" id="markdown-toc-chunked-upload-large-files">Chunked Upload (Large Files)</a></li>
    </ol>
  </li>
  <li>
<a href="#common-training-scenarios" id="markdown-toc-common-training-scenarios">Common Training Scenarios</a>    <ol>
      <li><a href="#style-lora" id="markdown-toc-style-lora">Style LoRA</a></li>
      <li><a href="#character-lora" id="markdown-toc-character-lora">Character LoRA</a></li>
      <li><a href="#photographic-subject" id="markdown-toc-photographic-subject">Photographic Subject</a></li>
    </ol>
  </li>
  <li>
<a href="#optimization-techniques" id="markdown-toc-optimization-techniques">Optimization Techniques</a>    <ol>
      <li><a href="#memory-optimization" id="markdown-toc-memory-optimization">Memory Optimization</a></li>
      <li><a href="#speed-optimization" id="markdown-toc-speed-optimization">Speed Optimization</a></li>
      <li><a href="#quality-optimization" id="markdown-toc-quality-optimization">Quality Optimization</a></li>
    </ol>
  </li>
  <li>
<a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a>    <ol>
      <li>
<a href="#common-issues" id="markdown-toc-common-issues">Common Issues</a>        <ol>
          <li><a href="#overfitting" id="markdown-toc-overfitting">Overfitting</a></li>
          <li><a href="#underfitting" id="markdown-toc-underfitting">Underfitting</a></li>
          <li><a href="#style-bleeding" id="markdown-toc-style-bleeding">Style Bleeding</a></li>
        </ol>
      </li>
      <li><a href="#training-diagnostics" id="markdown-toc-training-diagnostics">Training Diagnostics</a></li>
    </ol>
  </li>
  <li>
<a href="#advanced-techniques" id="markdown-toc-advanced-techniques">Advanced Techniques</a>    <ol>
      <li><a href="#multi-concept-training" id="markdown-toc-multi-concept-training">Multi-Concept Training</a></li>
      <li><a href="#dreambooth-style-training" id="markdown-toc-dreambooth-style-training">DreamBooth-style Training</a></li>
      <li><a href="#progressive-training" id="markdown-toc-progressive-training">Progressive Training</a></li>
    </ol>
  </li>
  <li>
<a href="#using-trained-loras" id="markdown-toc-using-trained-loras">Using Trained LoRAs</a>    <ol>
      <li><a href="#in-comfyui" id="markdown-toc-in-comfyui">In ComfyUI</a></li>
      <li><a href="#combining-multiple-loras" id="markdown-toc-combining-multiple-loras">Combining Multiple LoRAs</a></li>
      <li><a href="#optimal-strength-settings" id="markdown-toc-optimal-strength-settings">Optimal Strength Settings</a></li>
    </ol>
  </li>
  <li>
<a href="#best-practices-summary" id="markdown-toc-best-practices-summary">Best Practices Summary</a>    <ol>
      <li><a href="#dos" id="markdown-toc-dos">Do‚Äôs</a></li>
      <li><a href="#donts" id="markdown-toc-donts">Don‚Äôts</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ol>

<hr>

<h2 id="what-is-lora">What is LoRA?</h2>

<p>LoRA (Low-Rank Adaptation) is a training technique that allows you to fine-tune large models like Stable Diffusion by training only a small number of parameters. Instead of modifying the entire model, LoRA adds trainable rank decomposition matrices to existing weights.</p>

<h3 id="key-benefits">Key Benefits</h3>

<ul>
  <li>
<strong>Efficient</strong>: Requires 100-1000x less storage than full fine-tuning</li>
  <li>
<strong>Flexible</strong>: Multiple LoRAs can be combined and weighted</li>
  <li>
<strong>Fast</strong>: Training takes hours instead of days</li>
  <li>
<strong>Preserves Base Model</strong>: Original model remains unchanged</li>
</ul>

<h3 id="how-lora-works">How LoRA Works</h3>

<p>LoRA decomposes weight updates into low-rank matrices:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>W' = W + ŒîW = W + BA
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">W</code> is the original weight matrix (frozen)</li>
  <li>
<code class="language-plaintext highlighter-rouge">B</code> and <code class="language-plaintext highlighter-rouge">A</code> are low-rank matrices (trainable)</li>
  <li>Rank <code class="language-plaintext highlighter-rouge">r &lt;&lt; d</code> (typically 4-128)</li>
</ul>

<h2 id="setup-with-ai-toolkit">Setup with AI Toolkit</h2>

<h3 id="using-docker-recommended">Using Docker (Recommended)</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone AI Toolkit MCP setup</span>
git clone https://github.com/andrewaltimit/Documentation ai-toolkit-trainer
<span class="nb">cd </span>ai-toolkit-trainer

<span class="c"># Build and start services</span>
docker-compose build
docker-compose up <span class="nt">-d</span>

<span class="c"># Access services</span>
<span class="c"># Web UI: http://localhost:8675</span>
<span class="c"># MCP API: http://localhost:8190</span>
</code></pre></div></div>

<h3 id="required-hardware">Required Hardware</h3>

<table>
  <thead>
    <tr>
      <th>Model Type</th>
      <th>Minimum VRAM</th>
      <th>Recommended VRAM</th>
      <th>Training Time (1k steps)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>SD 1.5</td>
      <td>6GB</td>
      <td>8GB</td>
      <td>15-30 min</td>
    </tr>
    <tr>
      <td>SDXL</td>
      <td>12GB</td>
      <td>16GB</td>
      <td>30-60 min</td>
    </tr>
    <tr>
      <td>FLUX</td>
      <td>16GB</td>
      <td>24GB</td>
      <td>60-120 min</td>
    </tr>
  </tbody>
</table>

<h2 id="dataset-preparation">Dataset Preparation</h2>

<h3 id="image-requirements">Image Requirements</h3>

<ol>
  <li>
<strong>Quality Standards</strong>:
    <ul>
      <li>High resolution (512x512 minimum, 1024x1024 for FLUX/SDXL)</li>
      <li>Clear, well-lit subjects</li>
      <li>Diverse angles and contexts</li>
      <li>Consistent quality across dataset</li>
    </ul>
  </li>
  <li>
<strong>Dataset Size Guidelines</strong>:
    <ul>
      <li>
<strong>Style LoRA</strong>: 10-50 images</li>
      <li>
<strong>Character/Person</strong>: 20-100 images</li>
      <li>
<strong>Object/Concept</strong>: 15-50 images</li>
      <li>
<strong>Complex Style</strong>: 50-200 images</li>
    </ul>
  </li>
</ol>

<h3 id="captioning-best-practices">Captioning Best Practices</h3>

<p>Each image needs a corresponding <code class="language-plaintext highlighter-rouge">.txt</code> file with the same name:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dataset/
‚îú‚îÄ‚îÄ image001.png
‚îú‚îÄ‚îÄ image001.txt
‚îú‚îÄ‚îÄ image002.png
‚îú‚îÄ‚îÄ image002.txt
‚îî‚îÄ‚îÄ ...
</code></pre></div></div>

<h4 id="caption-structure">Caption Structure</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[trigger_word] [subject] [details], [style], [quality], [composition]
</code></pre></div></div>

<p>Examples:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Character LoRA
xyz_person portrait of a woman, wearing a blue dress, soft lighting, professional photograph

# Style LoRA
xyz_style digital painting of a landscape, vibrant colors, fantasy art style, highly detailed

# Object LoRA
xyz_object a red sports car, studio lighting, product photography, white background
</code></pre></div></div>

<h4 id="flux-caption-guidelines">FLUX Caption Guidelines</h4>

<p>For FLUX models specifically, include these elements:</p>

<ol>
  <li>
<strong>Trigger Word</strong>: Always first (e.g., ‚Äúxyz_style‚Äù)</li>
  <li>
<strong>Subject</strong>: Clear description (e.g., ‚Äúa woman‚Äù, ‚Äúa building‚Äù)</li>
  <li>
<strong>Camera Angle</strong>: Perspective (e.g., ‚Äúfront view‚Äù, ‚Äúaerial shot‚Äù)</li>
  <li>
<strong>Environment</strong>: Setting (e.g., ‚Äúin a forest‚Äù, ‚Äústudio background‚Äù)</li>
  <li>
<strong>Lighting</strong>: Conditions (e.g., ‚Äúgolden hour‚Äù, ‚Äúdramatic lighting‚Äù)</li>
</ol>

<p>Example:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>xyz_style portrait of a knight, three-quarter view, in a medieval castle, torch lighting
</code></pre></div></div>

<h3 id="automated-captioning">Automated Captioning</h3>

<p>Using AI Toolkit‚Äôs caption generation:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Using BLIP or WD14 taggers
</span><span class="n">responses</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">generate-captions</span><span class="sh">"</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/my-dataset</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">caption_model</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">blip2</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">trigger_word</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_style</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></div></div>

<h2 id="training-configuration">Training Configuration</h2>

<h3 id="basic-configuration-via-mcp">Basic Configuration via MCP</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="c1"># Create training configuration
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">create-training-config</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">my-style-lora</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">model_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">runwayml/stable-diffusion-v1-5</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/my-style</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">512</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">batch_size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">learning_rate</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0002</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">alpha</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">trigger_word</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_style</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">test_prompts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">xyz_style portrait of a woman</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">xyz_style landscape with mountains</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">xyz_style still life painting</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">xyz_style in a cyberpunk city at night</span><span class="sh">"</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="key-parameters-explained">Key Parameters Explained</h3>

<h4 id="learning-rate">Learning Rate</h4>
<ul>
  <li>
<strong>Default</strong>: 2e-4 (0.0002) - Good for most cases</li>
  <li>
<strong>Conservative</strong>: 1e-4 (0.0001) - Slower but safer</li>
  <li>
<strong>Aggressive</strong>: 3e-4 (0.0003) - For stubborn concepts</li>
  <li>
<strong>Fine-tuning</strong>: 5e-5 (0.00005) - For existing styles</li>
</ul>

<h4 id="steps-calculation">Steps Calculation</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Optimal Steps = 100 √ó number_of_images
</code></pre></div></div>

<p>Examples:</p>
<ul>
  <li>20 images ‚Üí 2000 steps</li>
  <li>50 images ‚Üí 5000 steps</li>
  <li>Single image ‚Üí 100-500 steps</li>
</ul>

<h4 id="rank-selection">Rank Selection</h4>

<table>
  <thead>
    <tr>
      <th>Rank</th>
      <th>Use Case</th>
      <th>File Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>4-8</td>
      <td>Simple style adjustments</td>
      <td>~10MB</td>
    </tr>
    <tr>
      <td>16-32</td>
      <td>Standard character/style LoRAs</td>
      <td>~50MB</td>
    </tr>
    <tr>
      <td>64-96</td>
      <td>Complex concepts, multiple subjects</td>
      <td>~150MB</td>
    </tr>
    <tr>
      <td>128</td>
      <td>Maximum detail/flexibility</td>
      <td>~300MB</td>
    </tr>
  </tbody>
</table>

<h3 id="advanced-configuration">Advanced Configuration</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">advanced-lora</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">model_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ostris/Flex.1-alpha</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># FLUX model
</span>    <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/my-dataset</span><span class="sh">"</span><span class="p">,</span>
    
    <span class="c1"># Training parameters
</span>    <span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">batch_size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">gradient_accumulation_steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">learning_rate</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0002</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">lr_scheduler</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">cosine</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">lr_warmup_steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    
    <span class="c1"># LoRA parameters
</span>    <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">alpha</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">dropout</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
    
    <span class="c1"># Optimization
</span>    <span class="sh">"</span><span class="s">optimizer</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">adamw</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">mixed_precision</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">fp16</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">gradient_checkpointing</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">low_vram</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    
    <span class="c1"># Regularization
</span>    <span class="sh">"</span><span class="s">prior_preservation</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">prior_loss_weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    
    <span class="c1"># Sampling
</span>    <span class="sh">"</span><span class="s">sample_every</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">sample_prompts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[...],</span>
    
    <span class="c1"># Advanced
</span>    <span class="sh">"</span><span class="s">network_dim</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">network_alpha</span><span class="sh">"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">clip_skip</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">max_token_length</span><span class="sh">"</span><span class="p">:</span> <span class="mi">225</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="training-process">Training Process</h2>

<h3 id="starting-training">Starting Training</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Start training job
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">start-training</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">config_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">my-style-lora</span><span class="sh">"</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="n">job_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()[</span><span class="sh">"</span><span class="s">result</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">job_id</span><span class="sh">"</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="monitoring-progress">Monitoring Progress</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Check training status
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">get-training-status</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">job_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">job_id</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Get training logs
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">get-training-logs</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">job_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">lines</span><span class="sh">"</span><span class="p">:</span> <span class="mi">50</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="understanding-training-metrics">Understanding Training Metrics</h3>

<p>Key metrics to monitor:</p>
<ul>
  <li>
<strong>Loss</strong>: Should decrease over time (target: 0.05-0.15)</li>
  <li>
<strong>Learning Rate</strong>: Follows scheduler (cosine, linear, etc.)</li>
  <li>
<strong>Gradient Norm</strong>: Indicates training stability</li>
</ul>

<h2 id="dataset-upload">Dataset Upload</h2>

<h3 id="direct-upload-small-datasets">Direct Upload (Small Datasets)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">base64</span>

<span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">img_path</span><span class="p">,</span> <span class="n">caption_path</span> <span class="ow">in</span> <span class="n">dataset_files</span><span class="p">:</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">rb</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">img_content</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()).</span><span class="nf">decode</span><span class="p">()</span>
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">caption_path</span><span class="p">,</span> <span class="sh">"</span><span class="s">r</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">caption</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">strip</span><span class="p">()</span>
    
    <span class="n">images</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
        <span class="sh">"</span><span class="s">filename</span><span class="sh">"</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">img_path</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span> <span class="n">img_content</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">caption</span><span class="sh">"</span><span class="p">:</span> <span class="n">caption</span>
    <span class="p">})</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">upload-dataset</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">dataset_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">my-style</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">images</span><span class="sh">"</span><span class="p">:</span> <span class="n">images</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h3 id="chunked-upload-large-files">Chunked Upload (Large Files)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># For LoRAs &gt; 100MB
</span><span class="n">CHUNK_SIZE</span> <span class="o">=</span> <span class="mi">256</span> <span class="o">*</span> <span class="mi">1024</span>  <span class="c1"># 256KB chunks
</span>
<span class="c1"># Start upload
</span><span class="n">upload_id</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">())</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">upload-lora-chunked-start</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">upload_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">upload_id</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">filename</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">large_lora.safetensors</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">total_size</span><span class="sh">"</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">metadata</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">trigger_words</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">xyz_style</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">base_model</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">FLUX</span><span class="sh">"</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">})</span>

<span class="c1"># Upload chunks
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">file_size</span><span class="p">,</span> <span class="n">CHUNK_SIZE</span><span class="p">):</span>
    <span class="n">chunk</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">CHUNK_SIZE</span><span class="p">]</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">upload-lora-chunked-append</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">upload_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">upload_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">chunk</span><span class="sh">"</span><span class="p">:</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">chunk</span><span class="p">).</span><span class="nf">decode</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">chunk_index</span><span class="sh">"</span><span class="p">:</span> <span class="n">i</span> <span class="o">//</span> <span class="n">CHUNK_SIZE</span>
        <span class="p">}</span>
    <span class="p">})</span>

<span class="c1"># Finalize
</span><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:8190/mcp/tool</span><span class="sh">"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">tool</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">upload-lora-chunked-finish</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">arguments</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">upload_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">upload_id</span>
    <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<h2 id="common-training-scenarios">Common Training Scenarios</h2>

<h3 id="style-lora">Style LoRA</h3>

<p>Training an artistic style:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">watercolor-style</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/watercolor</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">trigger_word</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">wc_style</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1500</span><span class="p">,</span>  <span class="c1"># 15 images √ó 100
</span>    <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">test_prompts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">wc_style painting of a sunset</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">wc_style portrait of an elderly man</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">wc_style still life with flowers</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">wc_style abstract composition</span><span class="sh">"</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="character-lora">Character LoRA</h3>

<p>Training a specific character:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">game-character</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/character</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">trigger_word</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_character</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3000</span><span class="p">,</span>  <span class="c1"># 30 images √ó 100
</span>    <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">clip_skip</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="c1"># For anime styles
</span>    <span class="sh">"</span><span class="s">test_prompts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">xyz_character standing pose, full body</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_character portrait, smiling</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_character in battle armor</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_character in casual clothes</span><span class="sh">"</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="photographic-subject">Photographic Subject</h3>

<p>Training a person or object:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">product-photos</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">model_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stabilityai/stable-diffusion-2-1</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">dataset_path</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">/ai-toolkit/datasets/product</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">trigger_word</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_product</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">resolution</span><span class="sh">"</span><span class="p">:</span> <span class="mi">768</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">test_prompts</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="sh">"</span><span class="s">xyz_product on white background, product photography</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_product in use, lifestyle photography</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_product close-up detail shot</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">xyz_product with natural lighting</span><span class="sh">"</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="optimization-techniques">Optimization Techniques</h2>

<h3 id="memory-optimization">Memory Optimization</h3>

<p>For limited VRAM:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">low_vram</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">gradient_checkpointing</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">batch_size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">gradient_accumulation_steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">mixed_precision</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">fp16</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">optimizer</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">adafactor</span><span class="sh">"</span>  <span class="c1"># Uses less memory than AdamW
</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="speed-optimization">Speed Optimization</h3>

<p>For faster training:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">disable_sampling</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>  <span class="c1"># Skip sample generation
</span>    <span class="sh">"</span><span class="s">save_every</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span>  <span class="c1"># Less frequent saves
</span>    <span class="sh">"</span><span class="s">optimizer</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lion</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Faster convergence
</span>    <span class="sh">"</span><span class="s">lr_scheduler</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">constant</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Simple scheduler
</span>    <span class="sh">"</span><span class="s">cache_latents</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span>  <span class="c1"># Pre-compute VAE encodings
</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="quality-optimization">Quality Optimization</h3>

<p>For best results:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">:</span> <span class="mi">64</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">alpha</span><span class="sh">"</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>  <span class="c1"># Lower than rank for regularization
</span>    <span class="sh">"</span><span class="s">learning_rate</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0001</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">lr_scheduler</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">cosine_with_restarts</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">sample_every</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">save_every</span><span class="sh">"</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">prior_preservation</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="common-issues">Common Issues</h3>

<h4 id="overfitting">Overfitting</h4>

<p><strong>Symptoms</strong>: LoRA only generates training images
<strong>Solutions</strong>:</p>
<ul>
  <li>Reduce learning rate</li>
  <li>Decrease training steps</li>
  <li>Add dropout (0.1-0.3)</li>
  <li>Use more diverse captions</li>
  <li>Enable prior preservation</li>
</ul>

<h4 id="underfitting">Underfitting</h4>

<p><strong>Symptoms</strong>: LoRA has no effect
<strong>Solutions</strong>:</p>
<ul>
  <li>Increase learning rate</li>
  <li>Train for more steps</li>
  <li>Increase rank</li>
  <li>Check trigger word usage</li>
  <li>Verify dataset quality</li>
</ul>

<h4 id="style-bleeding">Style Bleeding</h4>

<p><strong>Symptoms</strong>: LoRA affects unintended aspects
<strong>Solutions</strong>:</p>
<ul>
  <li>Improve caption specificity</li>
  <li>Use regularization images</li>
  <li>Reduce LoRA strength when using</li>
  <li>Train with narrower focus</li>
</ul>

<h3 id="training-diagnostics">Training Diagnostics</h3>

<p>Monitor these indicators:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Good training
</span><span class="o">-</span> <span class="n">Loss</span><span class="p">:</span> <span class="n">Steadily</span> <span class="n">decreasing</span>
<span class="o">-</span> <span class="n">Sample</span> <span class="n">quality</span><span class="p">:</span> <span class="n">Improving</span> <span class="n">each</span> <span class="n">checkpoint</span>
<span class="o">-</span> <span class="n">Gradient</span> <span class="n">norm</span><span class="p">:</span> <span class="nc">Stable </span><span class="p">(</span><span class="ow">not</span> <span class="n">exploding</span><span class="p">)</span>

<span class="c1"># Problems
</span><span class="o">-</span> <span class="n">Loss</span><span class="p">:</span> <span class="n">Plateaued</span> <span class="n">early</span> <span class="err">‚Üí</span> <span class="n">Increase</span> <span class="n">learning</span> <span class="n">rate</span>
<span class="o">-</span> <span class="n">Loss</span><span class="p">:</span> <span class="n">Oscillating</span> <span class="err">‚Üí</span> <span class="n">Decrease</span> <span class="n">learning</span> <span class="n">rate</span>
<span class="o">-</span> <span class="n">Loss</span><span class="p">:</span> <span class="n">Sudden</span> <span class="n">spike</span> <span class="err">‚Üí</span> <span class="n">Check</span> <span class="k">for</span> <span class="n">corrupt</span> <span class="n">data</span>
</code></pre></div></div>

<h2 id="advanced-techniques">Advanced Techniques</h2>

<h3 id="multi-concept-training">Multi-Concept Training</h3>

<p>Train multiple concepts in one LoRA:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Dataset structure
</span><span class="n">dataset</span><span class="o">/</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="n">concept1</span><span class="o">/</span>
<span class="err">‚îÇ</span>   <span class="err">‚îú‚îÄ‚îÄ</span> <span class="n">xyz_cat_001</span><span class="p">.</span><span class="n">jpg</span>
<span class="err">‚îÇ</span>   <span class="err">‚îî‚îÄ‚îÄ</span> <span class="n">xyz_cat_001</span><span class="p">.</span><span class="n">txt</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_cat photo of a cat...</span><span class="sh">"</span>
<span class="err">‚îú‚îÄ‚îÄ</span> <span class="n">concept2</span><span class="o">/</span>
<span class="err">‚îÇ</span>   <span class="err">‚îú‚îÄ‚îÄ</span> <span class="n">xyz_dog_001</span><span class="p">.</span><span class="n">jpg</span>
<span class="err">‚îÇ</span>   <span class="err">‚îî‚îÄ‚îÄ</span> <span class="n">xyz_dog_001</span><span class="p">.</span><span class="n">txt</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_dog photo of a dog...</span><span class="sh">"</span>
</code></pre></div></div>

<h3 id="dreambooth-style-training">DreamBooth-style Training</h3>

<p>For maximum fidelity:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="sh">"</span><span class="s">model_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">runwayml/stable-diffusion-v1-5</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">instance_prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">xyz_person person</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">class_prompt</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">person</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">prior_preservation</span><span class="sh">"</span><span class="p">:</span> <span class="n">true</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">prior_preservation_weight</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">num_class_images</span><span class="sh">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3000</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="progressive-training">Progressive Training</h3>

<p>Train in stages for complex concepts:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Stage 1: Basic form
</span><span class="nf">train_config</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0002</span><span class="p">)</span>

<span class="c1"># Stage 2: Details
</span><span class="nf">train_config</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">resume_from</span><span class="o">=</span><span class="sh">"</span><span class="s">stage1</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Stage 3: Polish
</span><span class="nf">train_config</span><span class="p">(</span><span class="n">rank</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.00005</span><span class="p">,</span> <span class="n">resume_from</span><span class="o">=</span><span class="sh">"</span><span class="s">stage2</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="using-trained-loras">Using Trained LoRAs</h2>

<h3 id="in-comfyui">In ComfyUI</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load in workflow
</span><span class="p">{</span>
    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">LoraLoader</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">inputs</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
        <span class="sh">"</span><span class="s">lora_name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">my-style-lora.safetensors</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">strength_model</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">strength_clip</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.8</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="combining-multiple-loras">Combining Multiple LoRAs</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Stack LoRAs
</span><span class="p">[</span><span class="n">Base</span> <span class="n">Model</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">LoRA</span> <span class="mi">1</span> <span class="o">@</span> <span class="mf">0.6</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">LoRA</span> <span class="mi">2</span> <span class="o">@</span> <span class="mf">0.4</span><span class="p">]</span> <span class="err">‚Üí</span> <span class="p">[</span><span class="n">LoRA</span> <span class="mi">3</span> <span class="o">@</span> <span class="mf">0.3</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="optimal-strength-settings">Optimal Strength Settings</h3>

<table>
  <thead>
    <tr>
      <th>LoRA Type</th>
      <th>Model Strength</th>
      <th>CLIP Strength</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Style</td>
      <td>0.6-1.0</td>
      <td>0.6-1.0</td>
    </tr>
    <tr>
      <td>Character</td>
      <td>0.7-0.9</td>
      <td>0.7-0.9</td>
    </tr>
    <tr>
      <td>Pose</td>
      <td>0.4-0.7</td>
      <td>0.3-0.6</td>
    </tr>
    <tr>
      <td>Details</td>
      <td>0.3-0.6</td>
      <td>0.3-0.6</td>
    </tr>
  </tbody>
</table>

<h2 id="best-practices-summary">Best Practices Summary</h2>

<h3 id="dos">Do‚Äôs</h3>
<p>‚úì Use unique trigger words (xyz_style, not ‚Äústyle‚Äù)
‚úì Include trigger word in all captions
‚úì Vary descriptions while maintaining consistency
‚úì Test with prompts during training
‚úì Save checkpoints regularly
‚úì Start with conservative settings</p>

<h3 id="donts">Don‚Äôts</h3>
<p>‚úó Don‚Äôt overtrain (watch for overfitting)
‚úó Don‚Äôt use copyrighted content
‚úó Don‚Äôt skip dataset curation
‚úó Don‚Äôt use generic trigger words
‚úó Don‚Äôt ignore sampling results
‚úó Don‚Äôt train at full model resolution always</p>

<h2 id="conclusion">Conclusion</h2>

<p>LoRA training opens up endless possibilities for customizing AI image generation. With proper dataset preparation, configuration tuning, and monitoring, you can create LoRAs that seamlessly integrate new concepts while maintaining the flexibility of the base model. Start with simple projects and gradually tackle more complex training scenarios as you gain experience.</p>




<div class="learning-mode-container" id="learning-mode-container">
  <button class="learning-mode-button" onclick="toggleLearningMode()" aria-label="Toggle learning mode">
    <svg class="mode-icon" width="20" height="20" fill="currentColor" viewbox="0 0 16 16">
      <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917l-7.5-3.5ZM8 8.46 1.758 5.965 8 3.052l6.242 2.913L8 8.46Z"></path>
      <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466 4.176 9.032Zm-.068 1.873.86-.23a.5.5 0 0 0 .372 0l2.66-.71.66 2.246L8 11.98l-3.892.156.5-1.231Z"></path>
    </svg>
    <span class="mode-text">Learning Mode</span>
    <span class="mode-status" id="mode-status">OFF</span>
  </button>
  
  <div class="learning-mode-panel" id="learning-mode-panel" style="display: none;">
    <div class="panel-header">
      <h3>Personalized Learning Mode</h3>
      <button class="close-panel" onclick="closeLearningPanel()">√ó</button>
    </div>
    
    <div class="panel-content">
      <div class="skill-level-section">
        <h4>Select Your Skill Level</h4>
        <div class="level-cards">
          <label class="level-card">
            <input type="radio" name="skill-level" value="beginner" onchange="updateSkillLevel('beginner')">
            <div class="card-content">
              <span class="level-emoji">üå±</span>
              <span class="level-name">Beginner</span>
              <span class="level-desc">New to this topic</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="intermediate" onchange="updateSkillLevel('intermediate')">
            <div class="card-content">
              <span class="level-emoji">üåø</span>
              <span class="level-name">Intermediate</span>
              <span class="level-desc">Some experience</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="advanced" onchange="updateSkillLevel('advanced')">
            <div class="card-content">
              <span class="level-emoji">üå≥</span>
              <span class="level-name">Advanced</span>
              <span class="level-desc">Deep knowledge</span>
            </div>
          </label>
        </div>
      </div>
      
      <div class="learning-preferences">
        <h4>Learning Preferences</h4>
        <div class="preference-options">
          <label class="preference-option">
            <input type="checkbox" id="show-prerequisites" checked onchange="updatePreferences()">
            <span>Show prerequisites for each topic</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="highlight-next-steps" checked onchange="updatePreferences()">
            <span>Highlight recommended next steps</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="adaptive-difficulty" onchange="updatePreferences()">
            <span>Automatically adjust difficulty based on progress</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="track-progress" checked onchange="updatePreferences()">
            <span>Track my learning progress</span>
          </label>
        </div>
      </div>
      
      <div class="progress-overview">
        <h4>Your Learning Journey</h4>
        <div class="journey-stats">
          <div class="stat-card">
            <span class="stat-value" id="pages-read">0</span>
            <span class="stat-label">Pages Read</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="topics-completed">0</span>
            <span class="stat-label">Topics Completed</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="current-streak">0</span>
            <span class="stat-label">Day Streak</span>
          </div>
        </div>
        
        <div class="recent-topics">
          <h5>Recently Viewed</h5>
          <ul id="recent-topics-list">
            <li class="empty-state">No topics viewed yet</li>
          </ul>
        </div>
      </div>
      
      <div class="panel-actions">
        <button class="action-btn secondary" onclick="resetProgress()">Reset Progress</button>
        <button class="action-btn primary" onclick="applyLearningMode()">Apply Settings</button>
      </div>
    </div>
  </div>
  
  <!-- Floating indicators when learning mode is active -->
  <div class="learning-indicators" id="learning-indicators" style="display: none;">
    <div class="indicator skill-level-indicator">
      <span class="indicator-label">Level:</span>
      <span class="indicator-value" id="current-skill-level">Intermediate</span>
    </div>
    
    <div class="indicator next-step-indicator" id="next-step-indicator" style="display: none;">
      <span class="indicator-label">Next:</span>
      <a href="#" class="indicator-link" id="next-step-link">Loading...</a>
    </div>
  </div>
</div>

<script>
// Learning mode state
let learningMode = {
  enabled: false,
  skillLevel: 'intermediate',
  preferences: {
    showPrerequisites: true,
    highlightNextSteps: true,
    adaptiveDifficulty: false,
    trackProgress: true
  },
  progress: {
    pagesRead: [],
    topicsCompleted: [],
    lastVisit: null,
    streak: 0
  }
};

// Initialize from localStorage
function initializeLearningMode() {
  const saved = localStorage.getItem('learningMode');
  if (saved) {
    learningMode = JSON.parse(saved);
    if (learningMode.enabled) {
      activateLearningMode();
    }
  }
  
  // Update UI
  updateLearningStats();
  updateRecentTopics();
}

// Toggle learning mode
function toggleLearningMode() {
  const panel = document.getElementById('learning-mode-panel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// Close panel
function closeLearningPanel() {
  document.getElementById('learning-mode-panel').style.display = 'none';
}

// Update skill level
function updateSkillLevel(level) {
  learningMode.skillLevel = level;
  saveLearningMode();
}

// Update preferences
function updatePreferences() {
  learningMode.preferences = {
    showPrerequisites: document.getElementById('show-prerequisites').checked,
    highlightNextSteps: document.getElementById('highlight-next-steps').checked,
    adaptiveDifficulty: document.getElementById('adaptive-difficulty').checked,
    trackProgress: document.getElementById('track-progress').checked
  };
  saveLearningMode();
}

// Apply learning mode
function applyLearningMode() {
  learningMode.enabled = true;
  saveLearningMode();
  activateLearningMode();
  closeLearningPanel();
}

// Activate learning mode
function activateLearningMode() {
  document.getElementById('mode-status').textContent = 'ON';
  document.getElementById('learning-mode-button').classList.add('active');
  document.getElementById('learning-indicators').style.display = 'flex';
  
  // Apply content filtering
  filterContentByLevel();
  
  // Track current page
  if (learningMode.preferences.trackProgress) {
    trackPageVisit();
  }
  
  // Show next steps
  if (learningMode.preferences.highlightNextSteps) {
    showNextSteps();
  }
  
  // Apply visual indicators
  applyLevelIndicators();
}

// Filter content by skill level
function filterContentByLevel() {
  const currentLevel = learningMode.skillLevel;
  document.getElementById('current-skill-level').textContent = 
    currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
  
  // Add class to body for CSS-based filtering
  document.body.setAttribute('data-learning-level', currentLevel);
  
  // Hide/show content based on level
  document.querySelectorAll('[data-difficulty]').forEach(element => {
    const difficulty = element.getAttribute('data-difficulty');
    if (shouldShowContent(difficulty, currentLevel)) {
      element.style.display = '';
      element.classList.add('learning-mode-visible');
    } else {
      element.style.display = 'none';
      element.classList.remove('learning-mode-visible');
    }
  });
}

// Determine if content should be shown
function shouldShowContent(contentLevel, userLevel) {
  const levels = ['beginner', 'intermediate', 'advanced'];
  const contentIndex = levels.indexOf(contentLevel);
  const userIndex = levels.indexOf(userLevel);
  
  // Show content at or below user level, plus one level up
  return contentIndex <= userIndex + 1;
}

// Track page visit
function trackPageVisit() {
  const currentPage = {
    path: window.location.pathname,
    title: document.title,
    timestamp: new Date().toISOString(),
    level: 'intermediate'
  };
  
  // Add to pages read
  if (!learningMode.progress.pagesRead.find(p => p.path === currentPage.path)) {
    learningMode.progress.pagesRead.push(currentPage);
  }
  
  // Update streak
  updateStreak();
  
  // Save progress
  saveLearningMode();
  updateLearningStats();
}

// Update learning streak
function updateStreak() {
  const today = new Date().toDateString();
  const lastVisit = learningMode.progress.lastVisit;
  
  if (!lastVisit) {
    learningMode.progress.streak = 1;
  } else {
    const lastDate = new Date(lastVisit).toDateString();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    if (lastDate === today) {
      // Already visited today
      return;
    } else if (lastDate === yesterday.toDateString()) {
      // Consecutive day
      learningMode.progress.streak++;
    } else {
      // Streak broken
      learningMode.progress.streak = 1;
    }
  }
  
  learningMode.progress.lastVisit = new Date().toISOString();
}

// Show next steps
function showNextSteps() {
  // This would be customized based on the current page and user's progress
  const nextSteps = getRecommendedNextSteps();
  
  if (nextSteps.length > 0) {
    const indicator = document.getElementById('next-step-indicator');
    const link = document.getElementById('next-step-link');
    
    indicator.style.display = 'block';
    link.href = nextSteps[0].url;
    link.textContent = nextSteps[0].title;
  }
}

// Get recommended next steps (mock implementation)
function getRecommendedNextSteps() {
  // In a real implementation, this would analyze the current page,
  // user's progress, and skill level to recommend appropriate next content
  return [
    {
      title: 'Advanced Concepts',
      url: '/docs/advanced/',
      reason: 'You\'ve completed the basics'
    }
  ];
}

// Apply visual indicators to content
function applyLevelIndicators() {
  // Add badges to links based on their difficulty
  document.querySelectorAll('a[data-difficulty]').forEach(link => {
    const difficulty = link.getAttribute('data-difficulty');
    if (!link.querySelector('.level-badge')) {
      const badge = document.createElement('span');
      badge.className = `level-badge inline-badge level-${difficulty}`;
      badge.textContent = difficulty.charAt(0).toUpperCase();
      link.appendChild(badge);
    }
  });
}

// Update learning statistics
function updateLearningStats() {
  document.getElementById('pages-read').textContent = learningMode.progress.pagesRead.length;
  document.getElementById('topics-completed').textContent = learningMode.progress.topicsCompleted.length;
  document.getElementById('current-streak').textContent = learningMode.progress.streak;
}

// Update recent topics list
function updateRecentTopics() {
  const list = document.getElementById('recent-topics-list');
  const recentPages = learningMode.progress.pagesRead.slice(-5).reverse();
  
  if (recentPages.length === 0) {
    return;
  }
  
  list.innerHTML = recentPages.map(page => `
    <li>
      <a href="${page.path}">${page.title}</a>
      <span class="topic-level">${page.level}</span>
    </li>
  `).join('');
}

// Reset progress
function resetProgress() {
  if (confirm('Are you sure you want to reset all your learning progress?')) {
    learningMode.progress = {
      pagesRead: [],
      topicsCompleted: [],
      lastVisit: null,
      streak: 0
    };
    saveLearningMode();
    updateLearningStats();
    updateRecentTopics();
  }
}

// Save learning mode to localStorage
function saveLearningMode() {
  localStorage.setItem('learningMode', JSON.stringify(learningMode));
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initializeLearningMode);

// Listen for visibility changes to update content
document.addEventListener('visibilitychange', () => {
  if (!document.hidden && learningMode.enabled) {
    filterContentByLevel();
  }
});
</script>

<style>
/* Learning mode button */
.learning-mode-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 900;
}

.learning-mode-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--btn-bg, #fff);
  border: 2px solid var(--btn-border, #0066cc);
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
  font-weight: 500;
}

.learning-mode-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.learning-mode-button.active {
  background: var(--btn-active-bg, #0066cc);
  color: white;
}

.mode-icon {
  flex-shrink: 0;
}

.mode-status {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--status-bg, #e0e0e0);
  color: var(--status-color, #666);
  border-radius: 10px;
  font-weight: 600;
}

.learning-mode-button.active .mode-status {
  background: var(--status-active-bg, #28a745);
  color: white;
}

/* Learning mode panel */
.learning-mode-panel {
  position: fixed;
  bottom: 5rem;
  right: 2rem;
  width: 420px;
  max-width: calc(100vw - 4rem);
  max-height: 600px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  overflow: hidden;
  z-index: 901;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  background: var(--header-bg, #f8f9fa);
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.panel-header h3 {
  margin: 0;
  font-size: 1.25rem;
}

.close-panel {
  width: 32px;
  height: 32px;
  background: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--close-color, #6c757d);
  border-radius: 4px;
  transition: all 0.2s ease;
}

.close-panel:hover {
  background: var(--close-hover-bg, #e9ecef);
  color: var(--close-hover-color, #000);
}

.panel-content {
  padding: 1.5rem;
  max-height: 500px;
  overflow-y: auto;
}

/* Skill level cards */
.level-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.level-card {
  cursor: pointer;
}

.level-card input {
  position: absolute;
  opacity: 0;
}

.card-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.5rem 0.5rem;
  background: var(--card-bg, #f8f9fa);
  border: 2px solid var(--card-border, #e0e0e0);
  border-radius: 8px;
  transition: all 0.2s ease;
  text-align: center;
}

.level-card input:checked + .card-content {
  background: var(--card-selected-bg, #e6f2ff);
  border-color: var(--card-selected-border, #0066cc);
}

.level-card:hover .card-content {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.level-emoji {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.level-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.level-desc {
  font-size: 0.75rem;
  color: var(--desc-color, #6c757d);
}

/* Preferences */
.preference-option {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 0;
  cursor: pointer;
}

.preference-option input {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* Journey stats */
.journey-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin: 1rem 0;
}

.stat-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  background: var(--stat-bg, #f8f9fa);
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--stat-color, #0066cc);
}

.stat-label {
  font-size: 0.75rem;
  color: var(--label-color, #6c757d);
  margin-top: 0.25rem;
}

/* Recent topics */
.recent-topics {
  margin-top: 1.5rem;
}

.recent-topics h5 {
  margin-bottom: 0.5rem;
  color: var(--heading-color, #495057);
}

#recent-topics-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

#recent-topics-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--list-border, #e0e0e0);
}

#recent-topics-list li:last-child {
  border-bottom: none;
}

.topic-level {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--level-bg, #e0e0e0);
  color: var(--level-color, #666);
  border-radius: 10px;
  text-transform: capitalize;
}

.empty-state {
  color: var(--empty-color, #6c757d);
  font-style: italic;
}

/* Panel actions */
.panel-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border-color, #e0e0e0);
}

.action-btn {
  flex: 1;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.action-btn.primary {
  background: var(--primary-bg, #0066cc);
  color: white;
}

.action-btn.primary:hover {
  background: var(--primary-hover, #0052a3);
}

.action-btn.secondary {
  background: var(--secondary-bg, #6c757d);
  color: white;
}

.action-btn.secondary:hover {
  background: var(--secondary-hover, #5a6268);
}

/* Learning indicators */
.learning-indicators {
  position: fixed;
  top: 5rem;
  right: 2rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  z-index: 800;
}

.indicator {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: white;
  border: 1px solid var(--indicator-border, #e0e0e0);
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  font-size: 0.875rem;
}

.indicator-label {
  color: var(--label-color, #6c757d);
}

.indicator-value {
  font-weight: 600;
  color: var(--value-color, #0066cc);
}

.indicator-link {
  color: var(--link-color, #0066cc);
  text-decoration: none;
}

.indicator-link:hover {
  text-decoration: underline;
}

/* Content filtering styles */
body[data-learning-level="beginner"] .advanced-only,
body[data-learning-level="beginner"] .intermediate-only {
  display: none !important;
}

body[data-learning-level="intermediate"] .advanced-only {
  opacity: 0.6;
}

/* Level badges */
.level-badge.inline-badge {
  display: inline-block;
  margin-left: 0.5rem;
  font-size: 0.65rem;
  padding: 0.1rem 0.3rem;
  vertical-align: super;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .learning-mode-button {
    --btn-bg: #2a2a2a;
    --btn-border: #4d94ff;
  }
  
  .learning-mode-panel {
    background: #1a1a1a;
    color: #f0f0f0;
  }
  
  .panel-header {
    --header-bg: #2a2a2a;
    --border-color: #333;
  }
  
  .card-content {
    --card-bg: #2a2a2a;
    --card-border: #444;
    --card-selected-bg: #1a3d66;
    --card-selected-border: #4d94ff;
  }
  
  .stat-card {
    --stat-bg: #2a2a2a;
  }
  
  .indicator {
    background: #2a2a2a;
    --indicator-border: #444;
  }
  
  /* More dark mode variables... */
}

/* Responsive design */
@media (max-width: 768px) {
  .learning-mode-container {
    bottom: 1rem;
    right: 1rem;
  }
  
  .learning-mode-panel {
    right: 1rem;
    width: calc(100vw - 2rem);
  }
  
  .level-cards {
    grid-template-columns: 1fr;
  }
  
  .journey-stats {
    grid-template-columns: 1fr;
  }
}
</style>
        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

  </div>
</body>
</html>