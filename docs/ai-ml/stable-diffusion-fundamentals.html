<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stable Diffusion Fundamentals | Andrews Notebook</title>
  <meta name="description" content="Technology and Physics notes">
  
  <link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html">
  
  <link rel="stylesheet" href="/Documentation/assets/css/main.css">
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Stable Diffusion Fundamentals | Andrews Notebook</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Stable Diffusion Fundamentals" />
<meta name="author" content="Andrew" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Technology and Physics notes" />
<meta property="og:description" content="Technology and Physics notes" />
<link rel="canonical" href="https://andrewaltimit.github.io/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html" />
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html" />
<meta property="og:site_name" content="Andrews Notebook" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Stable Diffusion Fundamentals" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Andrew"},"description":"Technology and Physics notes","headline":"Stable Diffusion Fundamentals","url":"https://andrewaltimit.github.io/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html"}</script>
<!-- End Jekyll SEO tag -->

  <link type="application/atom+xml" rel="alternate" href="https://andrewaltimit.github.io/Documentation/feed.xml" title="Andrews Notebook" />
</head>
<body>
  <div class="site">
    


  
    



<nav class="breadcrumbs">
  <ol itemscope itemtype="https://schema.org/BreadcrumbList">
    
    
    
      
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="https://andrewaltimit.github.io/Documentation/" itemprop="item"><span itemprop="name">Home</span></a>
          <meta itemprop="position" content="1">
        </li>
        <span class="sep">/</span>
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/docs" itemprop="item"><span itemprop="name">Docs</span></a>
          <meta itemprop="position" content="2">
        </li>
        <span class="sep">/</span>
      
    
      
      
        
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
          <a href="/Documentation/ai-ml" itemprop="item"><span itemprop="name">Ai ml</span></a>
          <meta itemprop="position" content="3">
        </li>
        <span class="sep">/</span>
      
    
      
      
        <li class="current">Stable Diffusion Fundamentals</li>
      
    
  </ol>
</nav>

  


<div id="main" role="main">
  


  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Stable Diffusion Fundamentals">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Stable Diffusion Fundamentals
</h1>
          


        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title">
<i class="fas fa-cog"></i> On This Page</h4></header>
              <ul class="toc__menu">
<li><a href="#key-innovation-latent-space">Key Innovation: Latent Space</a></li>
<li><a href="#the-forward-process-training">The Forward Process (Training)</a></li>
<li><a href="#the-reverse-process-generation">The Reverse Process (Generation)</a></li>
<li><a href="#mathematical-foundation">Mathematical Foundation</a></li>
<li><a href="#1-vae-variational-autoencoder">1. VAE (Variational Autoencoder)</a></li>
<li><a href="#2-u-net">2. U-Net</a></li>
<li><a href="#3-clip-text-encoder">3. CLIP Text Encoder</a></li>
<li><a href="#step-by-step-process">Step-by-Step Process</a></li>
<li><a href="#deterministic-samplers">Deterministic Samplers</a></li>
<li><a href="#stochastic-samplers">Stochastic Samplers</a></li>
<li><a href="#cfg-scale-effects">CFG Scale Effects</a></li>
<li><a href="#resolution">Resolution</a></li>
<li><a href="#steps">Steps</a></li>
<li><a href="#seed">Seed</a></li>
<li><a href="#positive-prompts">Positive Prompts</a></li>
<li><a href="#negative-prompts">Negative Prompts</a></li>
<li><a href="#prompt-weighting">Prompt Weighting</a></li>
<li><a href="#attention-mechanisms">Attention Mechanisms</a></li>
<li><a href="#latent-space-manipulation">Latent Space Manipulation</a></li>
<li><a href="#noise-schedules">Noise Schedules</a></li>
<li><a href="#vram-requirements">VRAM Requirements</a></li>
<li><a href="#optimization-techniques">Optimization Techniques</a></li>
<li><a href="#artifact-types">Artifact Types</a></li>
<li><a href="#quality-improvements">Quality Improvements</a></li>
<li><a href="#score-function">Score Function</a></li>
<li><a href="#elbo-evidence-lower-bound">ELBO (Evidence Lower Bound)</a></li>
<li><a href="#emerging-techniques">Emerging Techniques</a></li>
<li><a href="#research-areas">Research Areas</a></li>
<li><a href="#prompt-engineering">Prompt Engineering</a></li>
<li><a href="#workflow-optimization">Workflow Optimization</a></li>
</ul>

            </nav>
          </aside>
        
        <aside class="sidebar sticky">
  <nav class="nav__list">
    
      
        <h3 class="nav__title">Getting Started</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/topic-map/">
                  <span class="nav__sub-title">üó∫Ô∏è Interactive Topic Map</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git-crash-course.html">
                  <span class="nav__sub-title">üå± Git in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker-crash-course.html">
                  <span class="nav__sub-title">üå± Docker in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-crash-course.html">
                  <span class="nav__sub-title">üå± Databases in 5 Minutes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-fundamentals-simple.html">
                  <span class="nav__sub-title">üå± AI Fundamentals Simple</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Technology</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/technology/index.html">
                  <span class="nav__sub-title">Technology Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/terraform.html">
                  <span class="nav__sub-title">Terraform</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/docker.html">
                  <span class="nav__sub-title">Docker Containers</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/aws.html">
                  <span class="nav__sub-title">AWS</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/kubernetes.html">
                  <span class="nav__sub-title">Kubernetes</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/database-design.html">
                  <span class="nav__sub-title">Database Design</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/networking.html">
                  <span class="nav__sub-title">Networking</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/cybersecurity.html">
                  <span class="nav__sub-title">Cybersecurity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/git.html">
                  <span class="nav__sub-title">Git Version Control</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/branching.html">
                  <span class="nav__sub-title">Branching Strategies</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/unreal.html">
                  <span class="nav__sub-title">Unreal Engine</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/quantumcomputing.html">
                  <span class="nav__sub-title">Quantum Computing</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai.html">
                  <span class="nav__sub-title">Artificial Intelligence</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/ai-lecture-2023.html">
                  <span class="nav__sub-title">AI Lecture 2023</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/technology/please-build.html">
                  <span class="nav__sub-title">Please Build</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">AI/ML - Generative AI</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/ai-ml/index.html">
                  <span class="nav__sub-title">AI/ML Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html" class="active">
                  <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/base-models-comparison.html">
                  <span class="nav__sub-title">Base Models Comparison</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/model-types.html">
                  <span class="nav__sub-title">Model Types</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/lora-training.html">
                  <span class="nav__sub-title">LoRA Training</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/controlnet.html">
                  <span class="nav__sub-title">ControlNet Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/comfyui-guide.html">
                  <span class="nav__sub-title">ComfyUI Guide</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/output-formats.html">
                  <span class="nav__sub-title">Output Formats</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/ai-ml/advanced-techniques.html">
                  <span class="nav__sub-title">Advanced Techniques</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Physics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/physics/index.html">
                  <span class="nav__sub-title">Physics Overview</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/classical-mechanics.html">
                  <span class="nav__sub-title">Classical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/thermodynamics.html">
                  <span class="nav__sub-title">Thermodynamics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/statistical-mechanics.html">
                  <span class="nav__sub-title">Statistical Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/relativity.html">
                  <span class="nav__sub-title">Relativity</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-mechanics.html">
                  <span class="nav__sub-title">Quantum Mechanics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/condensed-matter.html">
                  <span class="nav__sub-title">Condensed Matter Physics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/quantum-field-theory.html">
                  <span class="nav__sub-title">Quantum Field Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/physics/string-theory.html">
                  <span class="nav__sub-title">String Theory</span>
                </a>
              </li>
            
          </ul>
        
      
        <h3 class="nav__title">Advanced Topics</h3>
        
          <ul class="nav__items">
            
              <li>
                <a href="/Documentation/docs/advanced/index.html">
                  <span class="nav__sub-title">Research Hub</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/ai-mathematics/">
                  <span class="nav__sub-title">AI Mathematics</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/distributed-systems-theory/">
                  <span class="nav__sub-title">Distributed Systems Theory</span>
                </a>
              </li>
            
              <li>
                <a href="/Documentation/docs/advanced/quantum-algorithms-research/">
                  <span class="nav__sub-title">Quantum Algorithms Research</span>
                </a>
              </li>
            
          </ul>
        
      
    
  </nav>
</aside>


<div class="code-example">
  <p>Understanding the core concepts and mathematics behind Stable Diffusion and diffusion models in general.</p>
</div>

<h2 class="no_toc text-delta" id="table-of-contents">Table of contents</h2>

<ol id="markdown-toc">
  <li>
<a href="#what-is-stable-diffusion" id="markdown-toc-what-is-stable-diffusion">What is Stable Diffusion?</a>    <ol>
      <li><a href="#key-innovation-latent-space" id="markdown-toc-key-innovation-latent-space">Key Innovation: Latent Space</a></li>
    </ol>
  </li>
  <li>
<a href="#how-diffusion-models-work" id="markdown-toc-how-diffusion-models-work">How Diffusion Models Work</a>    <ol>
      <li><a href="#the-forward-process-training" id="markdown-toc-the-forward-process-training">The Forward Process (Training)</a></li>
      <li><a href="#the-reverse-process-generation" id="markdown-toc-the-reverse-process-generation">The Reverse Process (Generation)</a></li>
      <li><a href="#mathematical-foundation" id="markdown-toc-mathematical-foundation">Mathematical Foundation</a></li>
    </ol>
  </li>
  <li>
<a href="#architecture-components" id="markdown-toc-architecture-components">Architecture Components</a>    <ol>
      <li><a href="#1-vae-variational-autoencoder" id="markdown-toc-1-vae-variational-autoencoder">1. VAE (Variational Autoencoder)</a></li>
      <li><a href="#2-u-net" id="markdown-toc-2-u-net">2. U-Net</a></li>
      <li><a href="#3-clip-text-encoder" id="markdown-toc-3-clip-text-encoder">3. CLIP Text Encoder</a></li>
    </ol>
  </li>
  <li>
<a href="#the-generation-pipeline" id="markdown-toc-the-generation-pipeline">The Generation Pipeline</a>    <ol>
      <li><a href="#step-by-step-process" id="markdown-toc-step-by-step-process">Step-by-Step Process</a></li>
    </ol>
  </li>
  <li>
<a href="#sampling-methods" id="markdown-toc-sampling-methods">Sampling Methods</a>    <ol>
      <li><a href="#deterministic-samplers" id="markdown-toc-deterministic-samplers">Deterministic Samplers</a></li>
      <li><a href="#stochastic-samplers" id="markdown-toc-stochastic-samplers">Stochastic Samplers</a></li>
    </ol>
  </li>
  <li>
<a href="#classifier-free-guidance-cfg" id="markdown-toc-classifier-free-guidance-cfg">Classifier-Free Guidance (CFG)</a>    <ol>
      <li><a href="#cfg-scale-effects" id="markdown-toc-cfg-scale-effects">CFG Scale Effects</a></li>
    </ol>
  </li>
  <li>
<a href="#key-parameters" id="markdown-toc-key-parameters">Key Parameters</a>    <ol>
      <li><a href="#resolution" id="markdown-toc-resolution">Resolution</a></li>
      <li><a href="#steps" id="markdown-toc-steps">Steps</a></li>
      <li><a href="#seed" id="markdown-toc-seed">Seed</a></li>
    </ol>
  </li>
  <li>
<a href="#conditioning-mechanisms" id="markdown-toc-conditioning-mechanisms">Conditioning Mechanisms</a>    <ol>
      <li><a href="#positive-prompts" id="markdown-toc-positive-prompts">Positive Prompts</a></li>
      <li><a href="#negative-prompts" id="markdown-toc-negative-prompts">Negative Prompts</a></li>
      <li><a href="#prompt-weighting" id="markdown-toc-prompt-weighting">Prompt Weighting</a></li>
    </ol>
  </li>
  <li>
<a href="#advanced-concepts" id="markdown-toc-advanced-concepts">Advanced Concepts</a>    <ol>
      <li><a href="#attention-mechanisms" id="markdown-toc-attention-mechanisms">Attention Mechanisms</a></li>
      <li><a href="#latent-space-manipulation" id="markdown-toc-latent-space-manipulation">Latent Space Manipulation</a></li>
      <li><a href="#noise-schedules" id="markdown-toc-noise-schedules">Noise Schedules</a></li>
    </ol>
  </li>
  <li>
<a href="#memory-and-performance" id="markdown-toc-memory-and-performance">Memory and Performance</a>    <ol>
      <li><a href="#vram-requirements" id="markdown-toc-vram-requirements">VRAM Requirements</a></li>
      <li><a href="#optimization-techniques" id="markdown-toc-optimization-techniques">Optimization Techniques</a></li>
    </ol>
  </li>
  <li>
<a href="#common-issues-and-solutions" id="markdown-toc-common-issues-and-solutions">Common Issues and Solutions</a>    <ol>
      <li><a href="#artifact-types" id="markdown-toc-artifact-types">Artifact Types</a></li>
      <li><a href="#quality-improvements" id="markdown-toc-quality-improvements">Quality Improvements</a></li>
    </ol>
  </li>
  <li>
<a href="#mathematical-deep-dive" id="markdown-toc-mathematical-deep-dive">Mathematical Deep Dive</a>    <ol>
      <li><a href="#score-function" id="markdown-toc-score-function">Score Function</a></li>
      <li><a href="#elbo-evidence-lower-bound" id="markdown-toc-elbo-evidence-lower-bound">ELBO (Evidence Lower Bound)</a></li>
    </ol>
  </li>
  <li>
<a href="#future-directions" id="markdown-toc-future-directions">Future Directions</a>    <ol>
      <li><a href="#emerging-techniques" id="markdown-toc-emerging-techniques">Emerging Techniques</a></li>
      <li><a href="#research-areas" id="markdown-toc-research-areas">Research Areas</a></li>
    </ol>
  </li>
  <li>
<a href="#practical-tips" id="markdown-toc-practical-tips">Practical Tips</a>    <ol>
      <li><a href="#prompt-engineering" id="markdown-toc-prompt-engineering">Prompt Engineering</a></li>
      <li><a href="#workflow-optimization" id="markdown-toc-workflow-optimization">Workflow Optimization</a></li>
    </ol>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ol>

<hr>

<h2 id="what-is-stable-diffusion">What is Stable Diffusion?</h2>

<p>Stable Diffusion is a latent text-to-image diffusion model capable of generating detailed images from text descriptions. Released in 2022 by Stability AI, it democratized AI image generation by being open source and efficient enough to run on consumer GPUs.</p>

<h3 id="key-innovation-latent-space">Key Innovation: Latent Space</h3>

<p>Unlike earlier diffusion models that worked directly in pixel space, Stable Diffusion operates in a compressed latent space. This innovation:</p>
<ul>
  <li>Reduces computational requirements by ~50x</li>
  <li>Maintains high-quality outputs</li>
  <li>Enables consumer GPU deployment</li>
</ul>

<h2 id="how-diffusion-models-work">How Diffusion Models Work</h2>

<h3 id="the-forward-process-training">The Forward Process (Training)</h3>

<ol>
  <li>
<strong>Start with a clear image</strong> from the training dataset</li>
  <li>
<strong>Gradually add Gaussian noise</strong> over T timesteps</li>
  <li>
<strong>End with pure noise</strong> that follows a known distribution</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_0 ‚Üí x_1 ‚Üí x_2 ‚Üí ... ‚Üí x_T
(image) ‚Üí (slightly noisy) ‚Üí ... ‚Üí (pure noise)
</code></pre></div></div>

<h3 id="the-reverse-process-generation">The Reverse Process (Generation)</h3>

<ol>
  <li>
<strong>Start with random noise</strong> x_T</li>
  <li>
<strong>Predict and remove noise</strong> iteratively</li>
  <li>
<strong>End with a generated image</strong> x_0</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_T ‚Üí x_{T-1} ‚Üí x_{T-2} ‚Üí ... ‚Üí x_0
(noise) ‚Üí (less noisy) ‚Üí ... ‚Üí (clear image)
</code></pre></div></div>

<h3 id="mathematical-foundation">Mathematical Foundation</h3>

<p>The core equation for the denoising process:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_{t-1} = Œº_Œ∏(x_t, t) + œÉ_t * z
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">Œº_Œ∏</code> is the predicted mean (learned by the neural network)</li>
  <li>
<code class="language-plaintext highlighter-rouge">œÉ_t</code> is the noise schedule variance</li>
  <li>
<code class="language-plaintext highlighter-rouge">z</code> is random Gaussian noise</li>
</ul>

<h2 id="architecture-components">Architecture Components</h2>

<h3 id="1-vae-variational-autoencoder">1. VAE (Variational Autoencoder)</h3>

<p>The VAE compresses images between pixel space and latent space:</p>

<ul>
  <li>
<strong>Encoder</strong>: Image (512√ó512√ó3) ‚Üí Latent (64√ó64√ó4)</li>
  <li>
<strong>Decoder</strong>: Latent (64√ó64√ó4) ‚Üí Image (512√ó512√ó3)</li>
  <li>
<strong>Compression</strong>: 8x spatial compression</li>
</ul>

<h3 id="2-u-net">2. U-Net</h3>

<p>The U-Net is the core denoising network:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input: [Noisy Latent, Timestep, Text Embedding]
   ‚Üì
Encoder Blocks (Downsampling)
   ‚Üì
Middle Block (Bottleneck)
   ‚Üì
Decoder Blocks (Upsampling + Skip Connections)
   ‚Üì
Output: Predicted Noise
</code></pre></div></div>

<p>Key features:</p>
<ul>
  <li>
<strong>Cross-attention layers</strong>: Integrate text conditioning</li>
  <li>
<strong>Residual connections</strong>: Preserve fine details</li>
  <li>
<strong>Time embeddings</strong>: Handle different noise levels</li>
</ul>

<h3 id="3-clip-text-encoder">3. CLIP Text Encoder</h3>

<p>CLIP (Contrastive Language-Image Pre-training) converts text to embeddings:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"a cat" ‚Üí Tokenizer ‚Üí [49406, 320, 2368, 49407, ...] ‚Üí CLIP ‚Üí [768-dim embedding]
</code></pre></div></div>

<p>Features:</p>
<ul>
  <li>77 token maximum length</li>
  <li>768-dimensional embeddings (SD 1.5)</li>
  <li>Trained on image-text pairs</li>
</ul>

<h2 id="the-generation-pipeline">The Generation Pipeline</h2>

<h3 id="step-by-step-process">Step-by-Step Process</h3>

<ol>
  <li>
<strong>Text Processing</strong>:
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">prompt</span> <span class="o">=</span> <span class="sh">"</span><span class="s">a beautiful sunset over mountains</span><span class="sh">"</span>
<span class="n">tokens</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
<span class="n">text_embeddings</span> <span class="o">=</span> <span class="nf">clip_model</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
<strong>Initialize Noise</strong>:
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">Add</span> <span class="n">scheduler</span> <span class="n">noise</span> <span class="n">scaling</span>  <span class="c1"># Random noise in latent space
</span></code></pre></div>    </div>
  </li>
  <li>
<strong>Denoising Loop</strong>:
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">scheduler</span><span class="p">.</span><span class="n">timesteps</span><span class="p">:</span>
    <span class="c1"># Predict noise
</span>    <span class="n">noise_pred</span> <span class="o">=</span> <span class="nf">unet</span><span class="p">(</span><span class="n">latents</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">text_embeddings</span><span class="p">)</span>
       
    <span class="c1"># Remove predicted noise
</span>    <span class="n">latents</span> <span class="o">=</span> <span class="n">scheduler</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">noise_pred</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">latents</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
<strong>Decode to Image</strong>:
    <div class="language-python highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="n">image</span> <span class="o">=</span> <span class="n">vae</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">latents</span><span class="p">)</span>  <span class="c1"># Latent ‚Üí Pixel space
</span></code></pre></div>    </div>
  </li>
</ol>

<h2 id="sampling-methods">Sampling Methods</h2>

<h3 id="deterministic-samplers">Deterministic Samplers</h3>

<p><strong>DDIM (Denoising Diffusion Implicit Models)</strong>:</p>
<ul>
  <li>Faster sampling (10-50 steps vs 1000)</li>
  <li>Deterministic (same seed = same image)</li>
  <li>Trade-off between speed and quality</li>
</ul>

<p><strong>DPM++ (Diffusion Probabilistic Models++)</strong>:</p>
<ul>
  <li>Advanced ODE solvers</li>
  <li>Better quality/speed trade-off</li>
  <li>Popular variants: DPM++ 2M, DPM++ SDE</li>
</ul>

<h3 id="stochastic-samplers">Stochastic Samplers</h3>

<p><strong>Euler</strong>:</p>
<ul>
  <li>Simple first-order method</li>
  <li>Good balance of speed and quality</li>
  <li>More artistic variation</li>
</ul>

<p><strong>Euler Ancestral (Euler a)</strong>:</p>
<ul>
  <li>Adds noise during sampling</li>
  <li>More creative/varied outputs</li>
  <li>Less predictable</li>
</ul>

<p><strong>LMS (Linear Multi-Step)</strong>:</p>
<ul>
  <li>Uses history of previous steps</li>
  <li>Can produce smoother results</li>
  <li>Computationally efficient</li>
</ul>

<h2 id="classifier-free-guidance-cfg">Classifier-Free Guidance (CFG)</h2>

<p>CFG improves prompt adherence by comparing conditional and unconditional predictions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>guided_pred = unconditional_pred + cfg_scale * (conditional_pred - unconditional_pred)
</code></pre></div></div>

<h3 id="cfg-scale-effects">CFG Scale Effects</h3>

<ul>
  <li>
<strong>Low (1-3)</strong>: More creative, less prompt adherence</li>
  <li>
<strong>Medium (5-9)</strong>: Balanced results (7.5 is common default)</li>
  <li>
<strong>High (10-20)</strong>: Strong prompt adherence, potential artifacts</li>
</ul>

<h2 id="key-parameters">Key Parameters</h2>

<h3 id="resolution">Resolution</h3>

<p>Standard training resolutions:</p>
<ul>
  <li>
<strong>SD 1.5</strong>: 512√ó512</li>
  <li>
<strong>SD 2.x</strong>: 768√ó768</li>
  <li>
<strong>SDXL</strong>: 1024√ó1024</li>
  <li>
<strong>FLUX</strong>: 1024√ó1024+</li>
</ul>

<p>Higher resolutions require more VRAM and computation time.</p>

<h3 id="steps">Steps</h3>

<p>Number of denoising iterations:</p>
<ul>
  <li>
<strong>Low (10-25)</strong>: Fast, lower quality</li>
  <li>
<strong>Medium (25-50)</strong>: Good balance</li>
  <li>
<strong>High (50-150)</strong>: Diminishing returns</li>
</ul>

<h3 id="seed">Seed</h3>

<p>Controls randomness:</p>
<ul>
  <li>
<strong>-1</strong>: Random seed each time</li>
  <li>
<strong>Fixed value</strong>: Reproducible results</li>
  <li>
<strong>Seed traveling</strong>: Interpolate between seeds</li>
</ul>

<h2 id="conditioning-mechanisms">Conditioning Mechanisms</h2>

<h3 id="positive-prompts">Positive Prompts</h3>

<p>What you want in the image:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"masterpiece, best quality, ultra-detailed, 
 a majestic dragon, scales shimmering, 
 golden hour lighting, fantasy art style"
</code></pre></div></div>

<h3 id="negative-prompts">Negative Prompts</h3>

<p>What to avoid:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"low quality, blurry, bad anatomy, 
 watermark, signature, duplicate, 
 extra limbs, malformed hands"
</code></pre></div></div>

<h3 id="prompt-weighting">Prompt Weighting</h3>

<p>Emphasize specific elements:</p>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">(word)</code> = 1.1x weight</li>
  <li>
<code class="language-plaintext highlighter-rouge">((word))</code> = 1.21x weight</li>
  <li>
<code class="language-plaintext highlighter-rouge">(word:1.5)</code> = 1.5x weight</li>
  <li>
<code class="language-plaintext highlighter-rouge">[word]</code> = 0.9x weight</li>
</ul>

<h2 id="advanced-concepts">Advanced Concepts</h2>

<h3 id="attention-mechanisms">Attention Mechanisms</h3>

<p>Cross-attention layers control where the model ‚Äúlooks‚Äù:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Attention(Q, K, V) = softmax(QK^T / ‚àöd) V
</code></pre></div></div>

<p>Where:</p>
<ul>
  <li>Q: Query (from image features)</li>
  <li>K: Key (from text embeddings)</li>
  <li>V: Value (from text embeddings)</li>
</ul>

<h3 id="latent-space-manipulation">Latent Space Manipulation</h3>

<p>Working in latent space enables:</p>
<ul>
  <li>
<strong>Prompt mixing</strong>: Blend multiple concepts</li>
  <li>
<strong>Latent interpolation</strong>: Smooth transitions</li>
  <li>
<strong>Style injection</strong>: Transfer artistic styles</li>
</ul>

<h3 id="noise-schedules">Noise Schedules</h3>

<p>Different schedules affect generation:</p>
<ul>
  <li>
<strong>Linear</strong>: Simple, predictable</li>
  <li>
<strong>Cosine</strong>: Better perceptual quality</li>
  <li>
<strong>Karras</strong>: Optimized for fewer steps</li>
</ul>

<h2 id="memory-and-performance">Memory and Performance</h2>

<h3 id="vram-requirements">VRAM Requirements</h3>

<p>Approximate VRAM usage for generation:</p>

<table>
  <thead>
    <tr>
      <th>Resolution</th>
      <th>SD 1.5</th>
      <th>SDXL</th>
      <th>FLUX</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>512√ó512</td>
      <td>2.5GB</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>768√ó768</td>
      <td>3.5GB</td>
      <td>-</td>
      <td>-</td>
    </tr>
    <tr>
      <td>1024√ó1024</td>
      <td>5GB</td>
      <td>8GB</td>
      <td>12GB</td>
    </tr>
  </tbody>
</table>

<h3 id="optimization-techniques">Optimization Techniques</h3>

<ol>
  <li>
<strong>Float16 Precision</strong>: Halve VRAM usage</li>
  <li>
<strong>Attention Slicing</strong>: Process attention in chunks</li>
  <li>
<strong>VAE Tiling</strong>: Decode large images in tiles</li>
  <li>
<strong>CPU Offloading</strong>: Move unused components to RAM</li>
</ol>

<h2 id="common-issues-and-solutions">Common Issues and Solutions</h2>

<h3 id="artifact-types">Artifact Types</h3>

<ol>
  <li>
<strong>Duplicate Elements</strong>: Reduce CFG scale, improve negative prompts</li>
  <li>
<strong>Blurry Results</strong>: Increase steps, check sampler choice</li>
  <li>
<strong>Wrong Composition</strong>: Refine prompt structure, use ControlNet</li>
  <li>
<strong>Color Issues</strong>: Adjust CFG, check VAE model</li>
</ol>

<h3 id="quality-improvements">Quality Improvements</h3>

<ol>
  <li>
<strong>Use quality tags</strong>: ‚Äúmasterpiece, best quality, highly detailed‚Äù</li>
  <li>
<strong>Specify art style</strong>: ‚Äúoil painting, digital art, photorealistic‚Äù</li>
  <li>
<strong>Include lighting</strong>: ‚Äúdramatic lighting, soft shadows, rim light‚Äù</li>
  <li>
<strong>Add camera details</strong>: ‚Äú85mm lens, shallow depth of field‚Äù</li>
</ol>

<h2 id="mathematical-deep-dive">Mathematical Deep Dive</h2>

<h3 id="score-function">Score Function</h3>

<p>The neural network learns to approximate the score function:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚àá_x log p(x) ‚âà -Œµ_Œ∏(x, t) / œÉ_t
</code></pre></div></div>

<p>This gradient points toward higher probability regions in data space.</p>

<h3 id="elbo-evidence-lower-bound">ELBO (Evidence Lower Bound)</h3>

<p>Training optimizes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L = E[||Œµ - Œµ_Œ∏(x_t, t)||¬≤]
</code></pre></div></div>

<p>Where <code class="language-plaintext highlighter-rouge">Œµ</code> is the actual noise added and <code class="language-plaintext highlighter-rouge">Œµ_Œ∏</code> is the predicted noise.</p>

<h2 id="future-directions">Future Directions</h2>

<h3 id="emerging-techniques">Emerging Techniques</h3>

<ol>
  <li>
<strong>Consistency Models</strong>: Single-step generation</li>
  <li>
<strong>Flow Matching</strong>: Alternative to diffusion</li>
  <li>
<strong>Rectified Flows</strong>: Straighter generation paths</li>
  <li>
<strong>Latent Consistency Models</strong>: 1-4 step generation</li>
</ol>

<h3 id="research-areas">Research Areas</h3>

<ul>
  <li>Higher resolution without increased compute</li>
  <li>Better text understanding and adherence</li>
  <li>Video and 3D generation</li>
  <li>Real-time generation</li>
  <li>Improved control mechanisms</li>
</ul>

<h2 id="practical-tips">Practical Tips</h2>

<h3 id="prompt-engineering">Prompt Engineering</h3>

<ol>
  <li>
<strong>Front-load important elements</strong>: Model pays more attention to early tokens</li>
  <li>
<strong>Use descriptive language</strong>: ‚Äúvibrant, ethereal, crystalline‚Äù</li>
  <li>
<strong>Specify medium</strong>: ‚Äúoil painting, 3D render, photograph‚Äù</li>
  <li>
<strong>Include composition</strong>: ‚Äúcentered, rule of thirds, close-up‚Äù</li>
</ol>

<h3 id="workflow-optimization">Workflow Optimization</h3>

<ol>
  <li>
<strong>Start with low resolution</strong>: Test concepts quickly</li>
  <li>
<strong>Use consistent seeds</strong>: For iterative refinement</li>
  <li>
<strong>Batch generation</strong>: Generate multiple variants</li>
  <li>
<strong>Save good seeds</strong>: Build a library of successful parameters</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>Stable Diffusion represents a breakthrough in generative AI, making high-quality image generation accessible to everyone. Understanding its fundamentals - from the mathematical foundations to practical parameters - enables more effective and creative use of this powerful technology.</p>

<p>The key to mastery is experimentation: try different models, samplers, and techniques to discover what works best for your specific use cases. As the field rapidly evolves, staying informed about new developments will help you leverage the latest capabilities.</p>




<div class="learning-mode-container" id="learning-mode-container">
  <button class="learning-mode-button" onclick="toggleLearningMode()" aria-label="Toggle learning mode">
    <svg class="mode-icon" width="20" height="20" fill="currentColor" viewbox="0 0 16 16">
      <path d="M8.211 2.047a.5.5 0 0 0-.422 0l-7.5 3.5a.5.5 0 0 0 .025.917l7.5 3a.5.5 0 0 0 .372 0L14 7.14V13a1 1 0 0 0-1 1v2h3v-2a1 1 0 0 0-1-1V6.739l.686-.275a.5.5 0 0 0 .025-.917l-7.5-3.5ZM8 8.46 1.758 5.965 8 3.052l6.242 2.913L8 8.46Z"></path>
      <path d="M4.176 9.032a.5.5 0 0 0-.656.327l-.5 1.7a.5.5 0 0 0 .294.605l4.5 1.8a.5.5 0 0 0 .372 0l4.5-1.8a.5.5 0 0 0 .294-.605l-.5-1.7a.5.5 0 0 0-.656-.327L8 10.466 4.176 9.032Zm-.068 1.873.86-.23a.5.5 0 0 0 .372 0l2.66-.71.66 2.246L8 11.98l-3.892.156.5-1.231Z"></path>
    </svg>
    <span class="mode-text">Learning Mode</span>
    <span class="mode-status" id="mode-status">OFF</span>
  </button>
  
  <div class="learning-mode-panel" id="learning-mode-panel" style="display: none;">
    <div class="panel-header">
      <h3>Personalized Learning Mode</h3>
      <button class="close-panel" onclick="closeLearningPanel()">√ó</button>
    </div>
    
    <div class="panel-content">
      <div class="skill-level-section">
        <h4>Select Your Skill Level</h4>
        <div class="level-cards">
          <label class="level-card">
            <input type="radio" name="skill-level" value="beginner" onchange="updateSkillLevel('beginner')">
            <div class="card-content">
              <span class="level-emoji">üå±</span>
              <span class="level-name">Beginner</span>
              <span class="level-desc">New to this topic</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="intermediate" onchange="updateSkillLevel('intermediate')">
            <div class="card-content">
              <span class="level-emoji">üåø</span>
              <span class="level-name">Intermediate</span>
              <span class="level-desc">Some experience</span>
            </div>
          </label>
          
          <label class="level-card">
            <input type="radio" name="skill-level" value="advanced" onchange="updateSkillLevel('advanced')">
            <div class="card-content">
              <span class="level-emoji">üå≥</span>
              <span class="level-name">Advanced</span>
              <span class="level-desc">Deep knowledge</span>
            </div>
          </label>
        </div>
      </div>
      
      <div class="learning-preferences">
        <h4>Learning Preferences</h4>
        <div class="preference-options">
          <label class="preference-option">
            <input type="checkbox" id="show-prerequisites" checked onchange="updatePreferences()">
            <span>Show prerequisites for each topic</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="highlight-next-steps" checked onchange="updatePreferences()">
            <span>Highlight recommended next steps</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="adaptive-difficulty" onchange="updatePreferences()">
            <span>Automatically adjust difficulty based on progress</span>
          </label>
          
          <label class="preference-option">
            <input type="checkbox" id="track-progress" checked onchange="updatePreferences()">
            <span>Track my learning progress</span>
          </label>
        </div>
      </div>
      
      <div class="progress-overview">
        <h4>Your Learning Journey</h4>
        <div class="journey-stats">
          <div class="stat-card">
            <span class="stat-value" id="pages-read">0</span>
            <span class="stat-label">Pages Read</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="topics-completed">0</span>
            <span class="stat-label">Topics Completed</span>
          </div>
          <div class="stat-card">
            <span class="stat-value" id="current-streak">0</span>
            <span class="stat-label">Day Streak</span>
          </div>
        </div>
        
        <div class="recent-topics">
          <h5>Recently Viewed</h5>
          <ul id="recent-topics-list">
            <li class="empty-state">No topics viewed yet</li>
          </ul>
        </div>
      </div>
      
      <div class="panel-actions">
        <button class="action-btn secondary" onclick="resetProgress()">Reset Progress</button>
        <button class="action-btn primary" onclick="applyLearningMode()">Apply Settings</button>
      </div>
    </div>
  </div>
  
  <!-- Floating indicators when learning mode is active -->
  <div class="learning-indicators" id="learning-indicators" style="display: none;">
    <div class="indicator skill-level-indicator">
      <span class="indicator-label">Level:</span>
      <span class="indicator-value" id="current-skill-level">Intermediate</span>
    </div>
    
    <div class="indicator next-step-indicator" id="next-step-indicator" style="display: none;">
      <span class="indicator-label">Next:</span>
      <a href="#" class="indicator-link" id="next-step-link">Loading...</a>
    </div>
  </div>
</div>

<script>
// Learning mode state
let learningMode = {
  enabled: false,
  skillLevel: 'intermediate',
  preferences: {
    showPrerequisites: true,
    highlightNextSteps: true,
    adaptiveDifficulty: false,
    trackProgress: true
  },
  progress: {
    pagesRead: [],
    topicsCompleted: [],
    lastVisit: null,
    streak: 0
  }
};

// Initialize from localStorage
function initializeLearningMode() {
  const saved = localStorage.getItem('learningMode');
  if (saved) {
    learningMode = JSON.parse(saved);
    if (learningMode.enabled) {
      activateLearningMode();
    }
  }
  
  // Update UI
  updateLearningStats();
  updateRecentTopics();
}

// Toggle learning mode
function toggleLearningMode() {
  const panel = document.getElementById('learning-mode-panel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// Close panel
function closeLearningPanel() {
  document.getElementById('learning-mode-panel').style.display = 'none';
}

// Update skill level
function updateSkillLevel(level) {
  learningMode.skillLevel = level;
  saveLearningMode();
}

// Update preferences
function updatePreferences() {
  learningMode.preferences = {
    showPrerequisites: document.getElementById('show-prerequisites').checked,
    highlightNextSteps: document.getElementById('highlight-next-steps').checked,
    adaptiveDifficulty: document.getElementById('adaptive-difficulty').checked,
    trackProgress: document.getElementById('track-progress').checked
  };
  saveLearningMode();
}

// Apply learning mode
function applyLearningMode() {
  learningMode.enabled = true;
  saveLearningMode();
  activateLearningMode();
  closeLearningPanel();
}

// Activate learning mode
function activateLearningMode() {
  document.getElementById('mode-status').textContent = 'ON';
  document.getElementById('learning-mode-button').classList.add('active');
  document.getElementById('learning-indicators').style.display = 'flex';
  
  // Apply content filtering
  filterContentByLevel();
  
  // Track current page
  if (learningMode.preferences.trackProgress) {
    trackPageVisit();
  }
  
  // Show next steps
  if (learningMode.preferences.highlightNextSteps) {
    showNextSteps();
  }
  
  // Apply visual indicators
  applyLevelIndicators();
}

// Filter content by skill level
function filterContentByLevel() {
  const currentLevel = learningMode.skillLevel;
  document.getElementById('current-skill-level').textContent = 
    currentLevel.charAt(0).toUpperCase() + currentLevel.slice(1);
  
  // Add class to body for CSS-based filtering
  document.body.setAttribute('data-learning-level', currentLevel);
  
  // Hide/show content based on level
  document.querySelectorAll('[data-difficulty]').forEach(element => {
    const difficulty = element.getAttribute('data-difficulty');
    if (shouldShowContent(difficulty, currentLevel)) {
      element.style.display = '';
      element.classList.add('learning-mode-visible');
    } else {
      element.style.display = 'none';
      element.classList.remove('learning-mode-visible');
    }
  });
}

// Determine if content should be shown
function shouldShowContent(contentLevel, userLevel) {
  const levels = ['beginner', 'intermediate', 'advanced'];
  const contentIndex = levels.indexOf(contentLevel);
  const userIndex = levels.indexOf(userLevel);
  
  // Show content at or below user level, plus one level up
  return contentIndex <= userIndex + 1;
}

// Track page visit
function trackPageVisit() {
  const currentPage = {
    path: window.location.pathname,
    title: document.title,
    timestamp: new Date().toISOString(),
    level: 'intermediate'
  };
  
  // Add to pages read
  if (!learningMode.progress.pagesRead.find(p => p.path === currentPage.path)) {
    learningMode.progress.pagesRead.push(currentPage);
  }
  
  // Update streak
  updateStreak();
  
  // Save progress
  saveLearningMode();
  updateLearningStats();
}

// Update learning streak
function updateStreak() {
  const today = new Date().toDateString();
  const lastVisit = learningMode.progress.lastVisit;
  
  if (!lastVisit) {
    learningMode.progress.streak = 1;
  } else {
    const lastDate = new Date(lastVisit).toDateString();
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    
    if (lastDate === today) {
      // Already visited today
      return;
    } else if (lastDate === yesterday.toDateString()) {
      // Consecutive day
      learningMode.progress.streak++;
    } else {
      // Streak broken
      learningMode.progress.streak = 1;
    }
  }
  
  learningMode.progress.lastVisit = new Date().toISOString();
}

// Show next steps
function showNextSteps() {
  // This would be customized based on the current page and user's progress
  const nextSteps = getRecommendedNextSteps();
  
  if (nextSteps.length > 0) {
    const indicator = document.getElementById('next-step-indicator');
    const link = document.getElementById('next-step-link');
    
    indicator.style.display = 'block';
    link.href = nextSteps[0].url;
    link.textContent = nextSteps[0].title;
  }
}

// Get recommended next steps (mock implementation)
function getRecommendedNextSteps() {
  // In a real implementation, this would analyze the current page,
  // user's progress, and skill level to recommend appropriate next content
  return [
    {
      title: 'Advanced Concepts',
      url: '/docs/advanced/',
      reason: 'You\'ve completed the basics'
    }
  ];
}

// Apply visual indicators to content
function applyLevelIndicators() {
  // Add badges to links based on their difficulty
  document.querySelectorAll('a[data-difficulty]').forEach(link => {
    const difficulty = link.getAttribute('data-difficulty');
    if (!link.querySelector('.level-badge')) {
      const badge = document.createElement('span');
      badge.className = `level-badge inline-badge level-${difficulty}`;
      badge.textContent = difficulty.charAt(0).toUpperCase();
      link.appendChild(badge);
    }
  });
}

// Update learning statistics
function updateLearningStats() {
  document.getElementById('pages-read').textContent = learningMode.progress.pagesRead.length;
  document.getElementById('topics-completed').textContent = learningMode.progress.topicsCompleted.length;
  document.getElementById('current-streak').textContent = learningMode.progress.streak;
}

// Update recent topics list
function updateRecentTopics() {
  const list = document.getElementById('recent-topics-list');
  const recentPages = learningMode.progress.pagesRead.slice(-5).reverse();
  
  if (recentPages.length === 0) {
    return;
  }
  
  list.innerHTML = recentPages.map(page => `
    <li>
      <a href="${page.path}">${page.title}</a>
      <span class="topic-level">${page.level}</span>
    </li>
  `).join('');
}

// Reset progress
function resetProgress() {
  if (confirm('Are you sure you want to reset all your learning progress?')) {
    learningMode.progress = {
      pagesRead: [],
      topicsCompleted: [],
      lastVisit: null,
      streak: 0
    };
    saveLearningMode();
    updateLearningStats();
    updateRecentTopics();
  }
}

// Save learning mode to localStorage
function saveLearningMode() {
  localStorage.setItem('learningMode', JSON.stringify(learningMode));
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', initializeLearningMode);

// Listen for visibility changes to update content
document.addEventListener('visibilitychange', () => {
  if (!document.hidden && learningMode.enabled) {
    filterContentByLevel();
  }
});
</script>

<style>
/* Learning mode button */
.learning-mode-container {
  position: fixed;
  bottom: 2rem;
  right: 2rem;
  z-index: 900;
}

.learning-mode-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.75rem 1.5rem;
  background: var(--btn-bg, #fff);
  border: 2px solid var(--btn-border, #0066cc);
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
  font-weight: 500;
}

.learning-mode-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

.learning-mode-button.active {
  background: var(--btn-active-bg, #0066cc);
  color: white;
}

.mode-icon {
  flex-shrink: 0;
}

.mode-status {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--status-bg, #e0e0e0);
  color: var(--status-color, #666);
  border-radius: 10px;
  font-weight: 600;
}

.learning-mode-button.active .mode-status {
  background: var(--status-active-bg, #28a745);
  color: white;
}

/* Learning mode panel */
.learning-mode-panel {
  position: fixed;
  bottom: 5rem;
  right: 2rem;
  width: 420px;
  max-width: calc(100vw - 4rem);
  max-height: 600px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  overflow: hidden;
  z-index: 901;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1.5rem;
  background: var(--header-bg, #f8f9fa);
  border-bottom: 1px solid var(--border-color, #e0e0e0);
}

.panel-header h3 {
  margin: 0;
  font-size: 1.25rem;
}

.close-panel {
  width: 32px;
  height: 32px;
  background: transparent;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: var(--close-color, #6c757d);
  border-radius: 4px;
  transition: all 0.2s ease;
}

.close-panel:hover {
  background: var(--close-hover-bg, #e9ecef);
  color: var(--close-hover-color, #000);
}

.panel-content {
  padding: 1.5rem;
  max-height: 500px;
  overflow-y: auto;
}

/* Skill level cards */
.level-cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin-bottom: 2rem;
}

.level-card {
  cursor: pointer;
}

.level-card input {
  position: absolute;
  opacity: 0;
}

.card-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1.5rem 0.5rem;
  background: var(--card-bg, #f8f9fa);
  border: 2px solid var(--card-border, #e0e0e0);
  border-radius: 8px;
  transition: all 0.2s ease;
  text-align: center;
}

.level-card input:checked + .card-content {
  background: var(--card-selected-bg, #e6f2ff);
  border-color: var(--card-selected-border, #0066cc);
}

.level-card:hover .card-content {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.level-emoji {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

.level-name {
  font-weight: 600;
  margin-bottom: 0.25rem;
}

.level-desc {
  font-size: 0.75rem;
  color: var(--desc-color, #6c757d);
}

/* Preferences */
.preference-option {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.75rem 0;
  cursor: pointer;
}

.preference-option input {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* Journey stats */
.journey-stats {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  margin: 1rem 0;
}

.stat-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  background: var(--stat-bg, #f8f9fa);
  border-radius: 8px;
  text-align: center;
}

.stat-value {
  font-size: 1.5rem;
  font-weight: bold;
  color: var(--stat-color, #0066cc);
}

.stat-label {
  font-size: 0.75rem;
  color: var(--label-color, #6c757d);
  margin-top: 0.25rem;
}

/* Recent topics */
.recent-topics {
  margin-top: 1.5rem;
}

.recent-topics h5 {
  margin-bottom: 0.5rem;
  color: var(--heading-color, #495057);
}

#recent-topics-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

#recent-topics-list li {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--list-border, #e0e0e0);
}

#recent-topics-list li:last-child {
  border-bottom: none;
}

.topic-level {
  font-size: 0.75rem;
  padding: 0.125rem 0.5rem;
  background: var(--level-bg, #e0e0e0);
  color: var(--level-color, #666);
  border-radius: 10px;
  text-transform: capitalize;
}

.empty-state {
  color: var(--empty-color, #6c757d);
  font-style: italic;
}

/* Panel actions */
.panel-actions {
  display: flex;
  gap: 1rem;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border-color, #e0e0e0);
}

.action-btn {
  flex: 1;
  padding: 0.75rem 1.5rem;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
}

.action-btn.primary {
  background: var(--primary-bg, #0066cc);
  color: white;
}

.action-btn.primary:hover {
  background: var(--primary-hover, #0052a3);
}

.action-btn.secondary {
  background: var(--secondary-bg, #6c757d);
  color: white;
}

.action-btn.secondary:hover {
  background: var(--secondary-hover, #5a6268);
}

/* Learning indicators */
.learning-indicators {
  position: fixed;
  top: 5rem;
  right: 2rem;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  z-index: 800;
}

.indicator {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: white;
  border: 1px solid var(--indicator-border, #e0e0e0);
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  font-size: 0.875rem;
}

.indicator-label {
  color: var(--label-color, #6c757d);
}

.indicator-value {
  font-weight: 600;
  color: var(--value-color, #0066cc);
}

.indicator-link {
  color: var(--link-color, #0066cc);
  text-decoration: none;
}

.indicator-link:hover {
  text-decoration: underline;
}

/* Content filtering styles */
body[data-learning-level="beginner"] .advanced-only,
body[data-learning-level="beginner"] .intermediate-only {
  display: none !important;
}

body[data-learning-level="intermediate"] .advanced-only {
  opacity: 0.6;
}

/* Level badges */
.level-badge.inline-badge {
  display: inline-block;
  margin-left: 0.5rem;
  font-size: 0.65rem;
  padding: 0.1rem 0.3rem;
  vertical-align: super;
}

/* Dark mode support */
@media (prefers-color-scheme: dark) {
  .learning-mode-button {
    --btn-bg: #2a2a2a;
    --btn-border: #4d94ff;
  }
  
  .learning-mode-panel {
    background: #1a1a1a;
    color: #f0f0f0;
  }
  
  .panel-header {
    --header-bg: #2a2a2a;
    --border-color: #333;
  }
  
  .card-content {
    --card-bg: #2a2a2a;
    --card-border: #444;
    --card-selected-bg: #1a3d66;
    --card-selected-border: #4d94ff;
  }
  
  .stat-card {
    --stat-bg: #2a2a2a;
  }
  
  .indicator {
    background: #2a2a2a;
    --indicator-border: #444;
  }
  
  /* More dark mode variables... */
}

/* Responsive design */
@media (max-width: 768px) {
  .learning-mode-container {
    bottom: 1rem;
    right: 1rem;
  }
  
  .learning-mode-panel {
    right: 1rem;
    width: calc(100vw - 2rem);
  }
  
  .level-cards {
    grid-template-columns: 1fr;
  }
  
  .journey-stats {
    grid-template-columns: 1fr;
  }
}
</style>
        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

  </div>
</body>
</html>