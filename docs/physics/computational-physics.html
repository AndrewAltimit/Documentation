<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

<!-- SEO Meta Tags -->
<meta name="description" content="Technology and Physics notes">
<meta name="author" content="{"name"=>"Andrew", "avatar"=>"/assets/images/avatar.png", "bio"=>"Technologist & Physics Enthusiast", "location"=>"Earth"}">

<!-- Open Graph -->
<meta property="og:title" content="Computational Physics">
<meta property="og:description" content="Technology and Physics notes">
<meta property="og:type" content="website">
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/physics/computational-physics.html">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Computational Physics">
<meta name="twitter:description" content="Technology and Physics notes">

<title>Computational Physics | Andrews Notebook</title>


  <link href="/Documentation/feed.xml" type="application/atom+xml" rel="alternate" title="Andrews Notebook Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Documentation/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<!-- Custom styles -->
<!-- Custom styles for documentation -->
<link rel="stylesheet" href="/Documentation/style.css?v=2.0.1">
<link rel="stylesheet" href="/Documentation/assets/css/condensed.css?v=2.0.1">
<style>
  /* Widescreen optimized layout */
  body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  /* Main container - full width */
  #main {
    display: flex;
    position: relative;
    min-height: 100vh;
    width: 100%;
    max-width: 100%;
  }
  
  /* Sidebar fixed to left edge */
  .sidebar.sticky {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-right: 1px solid #e1e4e8;
    padding: 2rem 1rem;
    z-index: 100;
  }
  
  /* Sidebar navigation styling */
  .nav__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__title {
    margin: 1.5rem 0 0.5rem;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    border-bottom: 1px solid #e1e4e8;
  }
  
  .nav__items {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__items a {
    display: block;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }
  
  .nav__items a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }
  
  .nav__items a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }
  
  /* Content area with left margin for sidebar */
  article.page {
    margin-left: 280px;
    min-height: 100vh;
    background: white;
    width: calc(100% - 280px);
    max-width: none;
  }
  
  /* Content wrapper - use full width */
  .page__inner-wrap {
    max-width: none;
    margin: 0;
    padding: 2rem 3rem;
  }
  
  .page__title {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Let content use available width */
  .page__content {
    max-width: none;
    width: 100%;
  }
  
  /* For optimal reading, constrain just the text paragraphs */
  .page__content > p,
  .page__content > ul,
  .page__content > ol {
    max-width: 65ch;
  }
  
  /* Let code blocks, tables, and special content use full width */
  .page__content pre,
  .page__content table,
  .page__content .noteBoxes,
  .page__content figure,
  .page__content .highlight {
    max-width: 100%;
  }
  
  /* Wide note boxes */
  .noteBoxes {
    width: 90% !important;
    max-width: 800px;
  }
  
  /* Tables use available width */
  table {
    width: 100%;
    max-width: 100%;
  }
  
  /* Code blocks optimization */
  pre {
    max-width: 100%;
    overflow-x: auto;
  }
  
  .highlight {
    max-width: 100%;
    margin: 1rem 0;
  }
  
  /* Responsive adjustments */
  @media (min-width: 2000px) {
    .sidebar.sticky {
      width: 320px;
    }
    
    article.page {
      margin-left: 320px;
      width: calc(100% - 320px);
    }
    
    .page__inner-wrap {
      padding: 2rem 4rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 75ch;
    }
  }
  
  @media (min-width: 1024px) and (max-width: 1439px) {
    .sidebar.sticky {
      width: 250px;
    }
    
    article.page {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    
    .page__inner-wrap {
      padding: 2rem 2rem;
    }
  }
  
  /* Tablet and mobile */
  @media (max-width: 1023px) {
    #main {
      flex-direction: column;
    }
    
    .sidebar.sticky {
      position: relative;
      width: 100%;
      height: auto;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
      padding: 1rem;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
    
    .page__inner-wrap {
      padding: 1rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 100%;
    }
  }
  
  /* Mobile navigation toggle */
  .nav-toggle {
    display: none;
  }
  
  @media (max-width: 1023px) {
    .nav-toggle {
      display: block;
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 200;
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .sidebar.sticky {
      position: fixed;
      left: -100%;
      top: 0;
      transition: left 0.3s ease;
      z-index: 150;
      height: 100vh;
      width: 280px;
    }
    
    .sidebar.sticky.active {
      left: 0;
    }
    
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 140;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
  }
</style>

<!-- Mobile navigation toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  if (window.innerWidth <= 1023) {
    if (!document.querySelector('.nav-toggle')) {
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'nav-toggle';
      toggleBtn.innerHTML = '‚ò∞ Menu';
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
      document.body.appendChild(toggleBtn);
      
      const overlay = document.createElement('div');
      overlay.className = 'sidebar-overlay';
      document.body.appendChild(overlay);
      
      toggleBtn.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });
      
      overlay.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    }
  }
  
  // Handle window resize
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const sidebar = document.querySelector('.sidebar.sticky');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggle = document.querySelector('.nav-toggle');
      
      if (window.innerWidth > 1023) {
        if (sidebar) sidebar.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        if (toggle) toggle.style.display = 'none';
      } else {
        if (toggle) toggle.style.display = 'block';
      }
    }, 250);
  });
});
</script>


  
    <script src="/Documentation/assets/js/custom.js"></script>
  

</head>
<body>
  <div id="main" role="main">
  <aside class="sidebar sticky">
    <nav class="nav__list">
      
        
          <h3 class="nav__title">Tutorials Hub</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/tutorials/">
                    <span class="nav__sub-title">üìö All Tutorials</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/tutorials/#learning-paths">
                    <span class="nav__sub-title">üéØ Learning Paths</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/tutorials/">
                    <span class="nav__sub-title">üöÄ Quick Starts</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Getting Started</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/topic-map/">
                    <span class="nav__sub-title">üó∫Ô∏è Interactive Topic Map</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/git-crash-course.html">
                    <span class="nav__sub-title">üå± Git in 5 Minutes</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/docker-crash-course.html">
                    <span class="nav__sub-title">üå± Docker in 5 Minutes</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/database-crash-course.html">
                    <span class="nav__sub-title">üå± Databases in 5 Minutes</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai-fundamentals-simple.html">
                    <span class="nav__sub-title">üå± AI Fundamentals Simple</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Technology</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/technology/index.html">
                    <span class="nav__sub-title">Technology Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/terraform.html">
                    <span class="nav__sub-title">Terraform</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/docker.html">
                    <span class="nav__sub-title">Docker Containers</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/aws.html">
                    <span class="nav__sub-title">AWS</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/kubernetes.html">
                    <span class="nav__sub-title">Kubernetes</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/database-design.html">
                    <span class="nav__sub-title">Database Design</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/networking.html">
                    <span class="nav__sub-title">Networking</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/cybersecurity.html">
                    <span class="nav__sub-title">Cybersecurity</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/git.html">
                    <span class="nav__sub-title">Git Version Control</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/branching.html">
                    <span class="nav__sub-title">Branching Strategies</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/unreal.html">
                    <span class="nav__sub-title">Unreal Engine</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/quantumcomputing.html">
                    <span class="nav__sub-title">Quantum Computing</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai.html">
                    <span class="nav__sub-title">Artificial Intelligence</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/ai-lecture-2023.html">
                    <span class="nav__sub-title">AI Lecture 2023</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/technology/please-build.html">
                    <span class="nav__sub-title">Please Build</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">AI/ML - Generative AI</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/ai-ml/index.html">
                    <span class="nav__sub-title">AI/ML Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html">
                    <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/base-models-comparison.html">
                    <span class="nav__sub-title">Base Models Comparison</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/model-types.html">
                    <span class="nav__sub-title">Model Types</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/lora-training.html">
                    <span class="nav__sub-title">LoRA Training</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/controlnet.html">
                    <span class="nav__sub-title">ControlNet Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/comfyui-guide.html">
                    <span class="nav__sub-title">ComfyUI Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/output-formats.html">
                    <span class="nav__sub-title">Output Formats</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/ai-ml/advanced-techniques.html">
                    <span class="nav__sub-title">Advanced Techniques</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Physics</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/physics/index.html">
                    <span class="nav__sub-title">Physics Overview</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/classical-mechanics.html">
                    <span class="nav__sub-title">Classical Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/thermodynamics.html">
                    <span class="nav__sub-title">Thermodynamics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/statistical-mechanics.html">
                    <span class="nav__sub-title">Statistical Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/relativity.html">
                    <span class="nav__sub-title">Relativity</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/quantum-mechanics.html">
                    <span class="nav__sub-title">Quantum Mechanics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/condensed-matter.html">
                    <span class="nav__sub-title">Condensed Matter Physics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/quantum-field-theory.html">
                    <span class="nav__sub-title">Quantum Field Theory</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/physics/string-theory.html">
                    <span class="nav__sub-title">String Theory</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Advanced Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/advanced/index.html">
                    <span class="nav__sub-title">Research Hub</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/ai-mathematics/">
                    <span class="nav__sub-title">AI Mathematics</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/distributed-systems-theory/">
                    <span class="nav__sub-title">Distributed Systems Theory</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/advanced/quantum-algorithms-research/">
                    <span class="nav__sub-title">Quantum Algorithms Research</span>
                  </a>
                </li>
              
            </ul>
          
        
          <h3 class="nav__title">Quick Reference</h3>
          
            <ul class="nav__items">
              
                <li>
                  <a href="/Documentation/docs/reference/index.html">
                    <span class="nav__sub-title">üìã Reference Guide</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#command-line-references">
                    <span class="nav__sub-title">üîç Command Cheat Sheets</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#physics-formulas--constants">
                    <span class="nav__sub-title">üî¨ Physics Formulas</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#algorithms--data-structures">
                    <span class="nav__sub-title">üíª Algorithms &amp; Big O</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#api-reference-patterns">
                    <span class="nav__sub-title">üåê API Reference</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#troubleshooting-flowcharts">
                    <span class="nav__sub-title">üîß Troubleshooting</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#best-practices-checklists">
                    <span class="nav__sub-title">‚úÖ Best Practices</span>
                  </a>
                </li>
              
                <li>
                  <a href="/Documentation/docs/reference/index.html#quick-links">
                    <span class="nav__sub-title">üîó Quick Links</span>
                  </a>
                </li>
              
            </ul>
          
        
      
    </nav>
  </aside>

  <article class="page">
    <div class="page__inner-wrap">
      <header>
        <h1 id="page-title" class="page__title">Computational Physics</h1>
      </header>
      
      <section class="page__content">
        <!-- Custom styles are now loaded via main.scss -->

<hr>

<p><strong>Where Physics Meets Computation: Solving Nature with Algorithms</strong></p>

<p><em>Discover how computers revolutionized our ability to understand and predict physical phenomena</em></p>

<p>Imagine trying to predict the weather, design a fusion reactor, or simulate the birth of galaxies. These problems are far too complex for pencil-and-paper solutions. Computational physics bridges this gap, transforming intractable equations into solvable algorithms. It‚Äôs where the elegance of physical laws meets the power of modern computing.</p>

<p>From simulating quantum systems to modeling climate change, computational physics has become an indispensable tool in modern science. Whether you‚Äôre a student learning numerical methods or a researcher pushing the boundaries of simulation, this guide will help you master the computational techniques that drive modern physics forward.</p>

<hr>

<h2 id="journey-through-computational-physics">Journey Through Computational Physics</h2>

<p><strong>Getting Started</strong></p>
<ul>
  <li><a href="#introduction-to-computational-physics">Why Computational Physics?</a></li>
  <li><a href="#fundamental-numerical-methods">Essential Numerical Methods</a></li>
  <li><a href="#getting-started-with-simulations">Your First Simulations</a></li>
</ul>

<p><strong>Core Techniques</strong></p>
<ul>
  <li><a href="#differential-equations">Solving Differential Equations</a></li>
  <li><a href="#monte-carlo-methods">Monte Carlo Methods</a></li>
  <li><a href="#molecular-dynamics">Molecular Dynamics</a></li>
</ul>

<p><strong>Advanced Methods</strong></p>
<ul>
  <li><a href="#finite-element-methods">Finite Element Analysis</a></li>
  <li><a href="#computational-fluid-dynamics">Computational Fluid Dynamics</a></li>
  <li><a href="#quantum-computational-methods">Quantum Simulations</a></li>
</ul>

<p><strong>Modern Tools &amp; Applications</strong></p>
<ul>
  <li><a href="#parallel-computing-for-physics">Parallel Computing</a></li>
  <li><a href="#machine-learning-applications">Machine Learning in Physics</a></li>
  <li><a href="#visualization-and-analysis">Visualization Techniques</a></li>
</ul>

<hr>

<h2 id="introduction-to-computational-physics">Introduction to Computational Physics</h2>

<h3 id="what-is-computational-physics">What is Computational Physics?</h3>

<p>Computational physics is the study and implementation of numerical analysis to solve physical problems. It forms the third pillar of modern physics, alongside experimental and theoretical physics:</p>

<ul>
  <li>
<strong>Theoretical Physics</strong>: Develops mathematical models and equations</li>
  <li>
<strong>Experimental Physics</strong>: Tests predictions through observation</li>
  <li>
<strong>Computational Physics</strong>: Bridges theory and experiment through simulation</li>
</ul>

<h3 id="why-do-we-need-it">Why Do We Need It?</h3>

<p>Many physical systems involve equations that cannot be solved analytically:</p>

<ol>
  <li>
<strong>Nonlinear Systems</strong>: Most real-world physics is nonlinear</li>
  <li>
<strong>Many-Body Problems</strong>: Systems with more than two interacting particles</li>
  <li>
<strong>Complex Geometries</strong>: Real-world shapes rarely have simple mathematical forms</li>
  <li>
<strong>Time Evolution</strong>: Following systems through long time periods</li>
</ol>

<h3 id="the-computational-approach">The Computational Approach</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># A simple example: projectile motion with air resistance
</span><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">def</span> <span class="nf">projectile_with_drag</span><span class="p">(</span><span class="n">v0</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Simulate projectile motion with quadratic air resistance</span><span class="sh">"""</span>
    <span class="c1"># Constants
</span>    <span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>  <span class="c1"># gravity (m/s^2)
</span>    <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.225</span>  <span class="c1"># air density (kg/m^3)
</span>    <span class="n">Cd</span> <span class="o">=</span> <span class="mf">0.47</span>  <span class="c1"># drag coefficient for sphere
</span>    <span class="n">A</span> <span class="o">=</span> <span class="mf">0.045</span>  <span class="c1"># cross-sectional area (m^2)
</span>    <span class="n">m</span> <span class="o">=</span> <span class="mf">0.145</span>  <span class="c1"># mass (kg)
</span>    
    <span class="c1"># Initial conditions
</span>    <span class="n">vx</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
    <span class="n">vy</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">))</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    
    <span class="c1"># Store trajectory
</span>    <span class="n">trajectory</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
    
    <span class="k">while</span> <span class="n">y</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Calculate drag force
</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">vx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Fd</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">Cd</span> <span class="o">*</span> <span class="n">A</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Update velocities
</span>        <span class="n">ax</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">Fd</span><span class="o">/</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vx</span><span class="o">/</span><span class="n">v</span><span class="p">)</span>
        <span class="n">ay</span> <span class="o">=</span> <span class="o">-</span><span class="n">g</span> <span class="o">-</span> <span class="p">(</span><span class="n">Fd</span><span class="o">/</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">vy</span><span class="o">/</span><span class="n">v</span><span class="p">)</span>
        
        <span class="n">vx</span> <span class="o">+=</span> <span class="n">ax</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">vy</span> <span class="o">+=</span> <span class="n">ay</span> <span class="o">*</span> <span class="n">dt</span>
        
        <span class="c1"># Update position
</span>        <span class="n">x</span> <span class="o">+=</span> <span class="n">vx</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">y</span> <span class="o">+=</span> <span class="n">vy</span> <span class="o">*</span> <span class="n">dt</span>
        
        <span class="n">trajectory</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>

<span class="c1"># Compare with and without air resistance
</span><span class="n">trajectory_drag</span> <span class="o">=</span> <span class="nf">projectile_with_drag</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>
<span class="n">trajectory_no_drag</span> <span class="o">=</span> <span class="nf">projectile_with_drag</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">45</span><span class="p">)</span>  <span class="c1"># Modify to remove drag
</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">trajectory_drag</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">trajectory_drag</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">With air resistance</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Distance (m)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Height (m)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<hr>

<h2 id="fundamental-numerical-methods">Fundamental Numerical Methods</h2>

<h3 id="numerical-integration">Numerical Integration</h3>

<h4 id="riemann-sums-to-sophisticated-quadrature">Riemann Sums to Sophisticated Quadrature</h4>

<p>The simplest integration methods approximate the area under a curve:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">integrate_simpson</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Simpson</span><span class="sh">'</span><span class="s">s rule for numerical integration</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># Simpson's rule needs even intervals
</span>    
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    
    <span class="c1"># Simpson's rule: (h/3) * [y0 + 4(y1+y3+...) + 2(y2+y4+...) + yn]
</span>    <span class="n">integral</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">integral</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># odd indices
</span>    <span class="n">integral</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># even indices
</span>    
    <span class="k">return</span> <span class="n">integral</span> <span class="o">*</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">3</span>

<span class="c1"># Example: Calculate the integral of sin(x) from 0 to œÄ
</span><span class="n">result</span> <span class="o">=</span> <span class="nf">integrate_simpson</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚à´sin(x)dx from 0 to œÄ = </span><span class="si">{</span><span class="n">result</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s"> (exact: 2.0)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="advanced-integration-methods">Advanced Integration Methods</h4>

<p>For higher dimensions and complex domains:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">monte_carlo_integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Monte Carlo integration for arbitrary dimensions</span><span class="sh">"""</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">bounds</span><span class="p">)</span>
    <span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">prod</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">])</span>
    
    <span class="c1"># Generate random points
</span>    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">bounds</span><span class="p">):</span>
        <span class="n">points</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">high</span> <span class="o">-</span> <span class="n">low</span><span class="p">)</span> <span class="o">+</span> <span class="n">low</span>
    
    <span class="c1"># Evaluate function at random points
</span>    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="nf">f</span><span class="p">(</span><span class="o">*</span><span class="n">point</span><span class="p">)</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">])</span>
    
    <span class="c1"># Monte Carlo estimate
</span>    <span class="n">integral</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">volume</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">n_samples</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">integral</span><span class="p">,</span> <span class="n">error</span>
</code></pre></div></div>

<h3 id="numerical-differentiation">Numerical Differentiation</h3>

<h4 id="finite-difference-methods">Finite Difference Methods</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">derivative_schemes</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Various finite difference schemes for derivatives</span><span class="sh">"""</span>
    <span class="c1"># Forward difference: O(h)
</span>    <span class="n">forward</span> <span class="o">=</span> <span class="p">(</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">h</span>
    
    <span class="c1"># Backward difference: O(h)
</span>    <span class="n">backward</span> <span class="o">=</span> <span class="p">(</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="n">h</span>
    
    <span class="c1"># Central difference: O(h¬≤)
</span>    <span class="n">central</span> <span class="o">=</span> <span class="p">(</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
    
    <span class="c1"># Five-point stencil: O(h‚Å¥)
</span>    <span class="n">five_point</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">+</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">forward</span><span class="sh">'</span><span class="p">:</span> <span class="n">forward</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">backward</span><span class="sh">'</span><span class="p">:</span> <span class="n">backward</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">central</span><span class="sh">'</span><span class="p">:</span> <span class="n">central</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">five_point</span><span class="sh">'</span><span class="p">:</span> <span class="n">five_point</span>
    <span class="p">}</span>
</code></pre></div></div>

<hr>

<h2 id="differential-equations">Differential Equations</h2>

<h3 id="ordinary-differential-equations-odes">Ordinary Differential Equations (ODEs)</h3>

<h4 id="the-runge-kutta-family">The Runge-Kutta Family</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rk4_step</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Fourth-order Runge-Kutta step</span><span class="sh">"""</span>
    <span class="n">k1</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">k2</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">k1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">k3</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">k2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">k4</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">k3</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span>

<span class="k">def</span> <span class="nf">solve_ode</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Solve ODE using RK4</span><span class="sh">"""</span>
    <span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_span</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">y0</span><span class="p">)))</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">t</span><span class="p">)):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">rk4_step</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dt</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span>

<span class="c1"># Example: Damped harmonic oscillator
</span><span class="k">def</span> <span class="nf">harmonic_oscillator</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">dx/dt = v, dv/dt = -k*x - c*v</span><span class="sh">"""</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">state</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># spring constant
</span>    <span class="n">c</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># damping coefficient
</span>    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">v</span><span class="p">])</span>

<span class="n">t</span><span class="p">,</span> <span class="n">solution</span> <span class="o">=</span> <span class="nf">solve_ode</span><span class="p">(</span><span class="n">harmonic_oscillator</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
</code></pre></div></div>

<h4 id="adaptive-step-size-methods">Adaptive Step Size Methods</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">rk45_adaptive</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">t_span</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Adaptive Runge-Kutta-Fehlberg method</span><span class="sh">"""</span>
    <span class="c1"># Butcher tableau coefficients
</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">3</span><span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="mi">9</span><span class="o">/</span><span class="mi">32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">1932</span><span class="o">/</span><span class="mi">2197</span><span class="p">,</span> <span class="o">-</span><span class="mi">7200</span><span class="o">/</span><span class="mi">2197</span><span class="p">,</span> <span class="mi">7296</span><span class="o">/</span><span class="mi">2197</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">439</span><span class="o">/</span><span class="mi">216</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3680</span><span class="o">/</span><span class="mi">513</span><span class="p">,</span> <span class="o">-</span><span class="mi">845</span><span class="o">/</span><span class="mi">4104</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="mi">27</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">3544</span><span class="o">/</span><span class="mi">2565</span><span class="p">,</span> <span class="mi">1859</span><span class="o">/</span><span class="mi">4104</span><span class="p">,</span> <span class="o">-</span><span class="mi">11</span><span class="o">/</span><span class="mi">40</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">])</span>
    
    <span class="n">b4</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">25</span><span class="o">/</span><span class="mi">216</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1408</span><span class="o">/</span><span class="mi">2565</span><span class="p">,</span> <span class="mi">2197</span><span class="o">/</span><span class="mi">4104</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">b5</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">16</span><span class="o">/</span><span class="mi">135</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6656</span><span class="o">/</span><span class="mi">12825</span><span class="p">,</span> <span class="mi">28561</span><span class="o">/</span><span class="mi">56430</span><span class="p">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">/</span><span class="mi">50</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">55</span><span class="p">])</span>
    
    <span class="n">t</span><span class="p">,</span> <span class="n">t_end</span> <span class="o">=</span> <span class="n">t_span</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_span</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">h</span> <span class="o">=</span> <span class="mf">0.01</span>  <span class="c1"># initial step size
</span>    
    <span class="n">t_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="n">y_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">.</span><span class="nf">copy</span><span class="p">()]</span>
    
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>
        <span class="c1"># Calculate k values
</span>        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span>
        <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">y_temp</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">k</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="n">i</span><span class="p">]),</span> <span class="n">y_temp</span><span class="p">)</span>
        
        <span class="c1"># Calculate two different approximations
</span>        <span class="n">y4</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="nf">sum</span><span class="p">(</span><span class="n">b4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">y5</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="nf">sum</span><span class="p">(</span><span class="n">b5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
        
        <span class="c1"># Estimate error
</span>        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">y5</span> <span class="o">-</span> <span class="n">y4</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
            <span class="c1"># Accept step
</span>            <span class="n">t</span> <span class="o">+=</span> <span class="n">h</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y5</span>
            <span class="n">t_values</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
            <span class="n">y_values</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">y</span><span class="p">.</span><span class="nf">copy</span><span class="p">())</span>
        
        <span class="c1"># Adjust step size
</span>        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="nf">min</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nf">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="p">(</span><span class="n">tol</span> <span class="o">/</span> <span class="n">error</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.2</span><span class="p">))</span>
        
        <span class="c1"># Don't overshoot
</span>        <span class="k">if</span> <span class="n">t</span> <span class="o">+</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">t_end</span><span class="p">:</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">t_end</span> <span class="o">-</span> <span class="n">t</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">t_values</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">y_values</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="partial-differential-equations-pdes">Partial Differential Equations (PDEs)</h3>

<h4 id="finite-difference-methods-for-pdes">Finite Difference Methods for PDEs</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">heat_equation_2d</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">nt</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Solve 2D heat equation using finite differences</span><span class="sh">"""</span>
    <span class="c1"># Grid setup
</span>    <span class="n">dx</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">alpha</span>  <span class="c1"># Stability condition
</span>    
    <span class="c1"># Initial condition: hot spot in center
</span>    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>
    <span class="n">u</span><span class="p">[</span><span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">nx</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">ny</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">5</span><span class="p">:</span><span class="n">ny</span><span class="o">//</span><span class="mi">2</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    
    <span class="c1"># Time evolution
</span>    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">nt</span><span class="p">):</span>
        <span class="n">un</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="c1"># Update interior points
</span>        <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">un</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
        <span class="p">)</span>
        
        <span class="c1"># Boundary conditions (Dirichlet: u = 0 at boundaries)
</span>        <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">u</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>

<span class="c1"># Visualize heat diffusion
</span><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">matplotlib.animation</span> <span class="kn">import</span> <span class="n">FuncAnimation</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="nf">next</span><span class="p">(</span><span class="nf">heat_equation_2d</span><span class="p">()),</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">hot</span><span class="sh">'</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="sh">'</span><span class="s">bilinear</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">2D Heat Diffusion</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
    <span class="n">im</span><span class="p">.</span><span class="nf">set_array</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">im</span><span class="p">]</span>

<span class="c1"># Create animation
</span><span class="n">heat_gen</span> <span class="o">=</span> <span class="nf">heat_equation_2d</span><span class="p">()</span>
<span class="n">ani</span> <span class="o">=</span> <span class="nc">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="n">heat_gen</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="spectral-methods">Spectral Methods</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">solve_poisson_spectral</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Solve Poisson equation using spectral methods</span><span class="sh">"""</span>
    <span class="c1"># Create grid
</span>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Right-hand side
</span>    <span class="n">F</span> <span class="o">=</span> <span class="nf">f</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">)</span>
    
    <span class="c1"># Take FFT
</span>    <span class="n">F_hat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fft2</span><span class="p">(</span><span class="n">F</span><span class="p">)</span>
    
    <span class="c1"># Wave numbers
</span>    <span class="n">kx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">N</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span>
    <span class="n">ky</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">L</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">*</span><span class="n">N</span><span class="p">))</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span>
    <span class="n">KX</span><span class="p">,</span> <span class="n">KY</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">)</span>
    
    <span class="c1"># Solve in Fourier space (avoid division by zero)
</span>    <span class="n">K2</span> <span class="o">=</span> <span class="n">KX</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">KY</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">K2</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Set DC component
</span>    <span class="n">U_hat</span> <span class="o">=</span> <span class="o">-</span><span class="n">F_hat</span> <span class="o">/</span> <span class="n">K2</span>
    <span class="n">U_hat</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Set mean to zero
</span>    
    <span class="c1"># Transform back
</span>    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">ifft2</span><span class="p">(</span><span class="n">U_hat</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span>
</code></pre></div></div>

<hr>

<h2 id="monte-carlo-methods">Monte Carlo Methods</h2>

<h3 id="basic-monte-carlo-principles">Basic Monte Carlo Principles</h3>

<p>Monte Carlo methods use random sampling to solve problems that might be deterministic in principle:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MonteCarloSampler</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Base class for Monte Carlo sampling</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nc">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">estimate_pi</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">100000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Classic example: estimate œÄ using random sampling</span><span class="sh">"""</span>
        <span class="c1"># Generate random points in unit square
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">rng</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">rng</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
        
        <span class="c1"># Count points inside unit circle
</span>        <span class="n">inside</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Area ratio: circle/square = œÄ/4
</span>        <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">inside</span> <span class="o">/</span> <span class="n">n_samples</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">pi_estimate</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">pi_estimate</span><span class="p">,</span> <span class="n">error</span>
    
    <span class="k">def</span> <span class="nf">importance_sampling</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Importance sampling for variance reduction</span><span class="sh">"""</span>
        <span class="c1"># Sample from importance distribution q
</span>        <span class="n">samples</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="nf">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">rng</span><span class="p">)</span>
        
        <span class="c1"># Compute weights
</span>        <span class="n">weights</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">pdf</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span> <span class="o">/</span> <span class="n">q</span><span class="p">.</span><span class="nf">pdf</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        
        <span class="c1"># Estimate expectation
</span>        <span class="n">expectation</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">var</span><span class="p">(</span><span class="n">weights</span> <span class="o">*</span> <span class="nf">f</span><span class="p">(</span><span class="n">samples</span><span class="p">))</span> <span class="o">/</span> <span class="n">n_samples</span>
        
        <span class="k">return</span> <span class="n">expectation</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">variance</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="markov-chain-monte-carlo-mcmc">Markov Chain Monte Carlo (MCMC)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MetropolisHastings</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Metropolis-Hastings algorithm for sampling from complex distributions</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">target_pdf</span><span class="p">,</span> <span class="n">proposal_std</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">target_pdf</span> <span class="o">=</span> <span class="n">target_pdf</span>
        <span class="n">self</span><span class="p">.</span><span class="n">proposal_std</span> <span class="o">=</span> <span class="n">proposal_std</span>
    
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">,</span> <span class="n">burn_in</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Generate samples using Metropolis-Hastings</span><span class="sh">"""</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="n">n_accepted</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">):</span>
            <span class="c1"># Propose new state
</span>            <span class="n">x_proposed</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">proposal_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">)</span>
            
            <span class="c1"># Calculate acceptance ratio
</span>            <span class="n">ratio</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">target_pdf</span><span class="p">(</span><span class="n">x_proposed</span><span class="p">)</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="nf">target_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
            <span class="c1"># Accept or reject
</span>            <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">ratio</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x_proposed</span>
                <span class="n">n_accepted</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># Store sample after burn-in
</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">burn_in</span><span class="p">:</span>
                <span class="n">samples</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nf">copy</span><span class="p">())</span>
        
        <span class="n">acceptance_rate</span> <span class="o">=</span> <span class="n">n_accepted</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_samples</span> <span class="o">+</span> <span class="n">burn_in</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">samples</span><span class="p">),</span> <span class="n">acceptance_rate</span>

<span class="c1"># Example: Sample from a bimodal distribution
</span><span class="k">def</span> <span class="nf">bimodal_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Mixture of two Gaussians</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">sampler</span> <span class="o">=</span> <span class="nc">MetropolisHastings</span><span class="p">(</span><span class="n">bimodal_pdf</span><span class="p">)</span>
<span class="n">samples</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">sampler</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="n">x0</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]),</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Acceptance rate: </span><span class="si">{</span><span class="n">acc_rate</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="quantum-monte-carlo">Quantum Monte Carlo</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">variational_monte_carlo</span><span class="p">(</span><span class="n">psi_trial</span><span class="p">,</span> <span class="n">hamiltonian</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Variational Monte Carlo for quantum systems</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">local_energy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate local energy: Hùúì/ùúì</span><span class="sh">"""</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="nf">psi_trial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">H_psi</span> <span class="o">=</span> <span class="nf">hamiltonian</span><span class="p">(</span><span class="n">psi_trial</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">H_psi</span> <span class="o">/</span> <span class="n">psi</span>
    
    <span class="c1"># Sample from |ùúì|¬≤
</span>    <span class="n">samples</span> <span class="o">=</span> <span class="nf">metropolis_sample</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="nf">psi_trial</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_samples</span><span class="p">)</span>
    
    <span class="c1"># Calculate expectation value of energy
</span>    <span class="n">E_local</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="nf">local_energy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">])</span>
    <span class="n">E_mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">E_local</span><span class="p">)</span>
    <span class="n">E_var</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">var</span><span class="p">(</span><span class="n">E_local</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_samples</span>
    
    <span class="k">return</span> <span class="n">E_mean</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">E_var</span><span class="p">)</span>

<span class="c1"># Example: Hydrogen atom ground state
</span><span class="k">def</span> <span class="nf">hydrogen_trial</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Trial wavefunction: exp(-alpha * r)</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">hydrogen_hamiltonian</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Hamiltonian for hydrogen atom</span><span class="sh">"""</span>
    <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
    
    <span class="c1"># Kinetic energy (using analytical expression)
</span>    <span class="n">T</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="mi">2</span><span class="o">/</span><span class="n">r_norm</span><span class="p">)</span>
    
    <span class="c1"># Potential energy
</span>    <span class="n">V</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">r_norm</span>
    
    <span class="nf">return </span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">V</span><span class="p">)</span> <span class="o">*</span> <span class="nf">psi</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
</code></pre></div></div>

<hr>

<h2 id="molecular-dynamics">Molecular Dynamics</h2>

<h3 id="classical-molecular-dynamics">Classical Molecular Dynamics</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MolecularDynamics</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Classical molecular dynamics simulation</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_particles</span><span class="p">,</span> <span class="n">box_size</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span> <span class="o">=</span> <span class="n">n_particles</span>
        <span class="n">self</span><span class="p">.</span><span class="n">box_size</span> <span class="o">=</span> <span class="n">box_size</span>
        <span class="n">self</span><span class="p">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">temperature</span>
        
        <span class="c1"># Initialize positions randomly
</span>        <span class="n">self</span><span class="p">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">n_particles</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">box_size</span>
        
        <span class="c1"># Initialize velocities from Maxwell-Boltzmann distribution
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span> 
                                         <span class="p">(</span><span class="n">n_particles</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        
        <span class="c1"># Remove center of mass motion
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">-=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">velocities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">lennard_jones_force</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Lennard-Jones potential: 4Œµ[(œÉ/r)¬π¬≤ - (œÉ/r)‚Å∂]</span><span class="sh">"""</span>
        <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r_norm</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">:</span>  <span class="c1"># Avoid singularity
</span>            <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        
        <span class="n">r6</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">/</span> <span class="n">r_norm</span><span class="p">)</span> <span class="o">**</span> <span class="mi">6</span>
        <span class="n">force_magnitude</span> <span class="o">=</span> <span class="mi">24</span> <span class="o">*</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r6</span><span class="p">)</span> <span class="o">/</span> <span class="n">r_norm</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">force_magnitude</span> <span class="o">*</span> <span class="n">r</span>
    
    <span class="k">def</span> <span class="nf">calculate_forces</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate all pairwise forces</span><span class="sh">"""</span>
        <span class="n">forces</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
                <span class="c1"># Minimum image convention
</span>                <span class="n">r</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span><span class="p">)</span>
                
                <span class="c1"># Calculate force
</span>                <span class="n">f</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">lennard_jones_force</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                <span class="n">forces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">f</span>
                <span class="n">forces</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">f</span>  <span class="c1"># Newton's third law
</span>        
        <span class="k">return</span> <span class="n">forces</span>
    
    <span class="k">def</span> <span class="nf">velocity_verlet_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Velocity Verlet integration</span><span class="sh">"""</span>
        <span class="c1"># Update positions
</span>        <span class="n">forces</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_forces</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">positions</span> <span class="o">+=</span> <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">forces</span> <span class="o">*</span> <span class="n">dt</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Apply periodic boundary conditions
</span>        <span class="n">self</span><span class="p">.</span><span class="n">positions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span>
        
        <span class="c1"># Update velocities (half step)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">forces</span> <span class="o">*</span> <span class="n">dt</span>
        
        <span class="c1"># Calculate new forces
</span>        <span class="n">forces_new</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_forces</span><span class="p">()</span>
        
        <span class="c1"># Complete velocity update
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">+=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">forces_new</span> <span class="o">*</span> <span class="n">dt</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run MD simulation</span><span class="sh">"""</span>
        <span class="n">trajectory</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">velocity_verlet_step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">trajectory</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="nf">copy</span><span class="p">())</span>
                
                <span class="c1"># Calculate total energy
</span>                <span class="n">ke</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">velocities</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">pe</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_potential_energy</span><span class="p">()</span>
                <span class="n">energies</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span><span class="sh">'</span><span class="s">kinetic</span><span class="sh">'</span><span class="p">:</span> <span class="n">ke</span><span class="p">,</span> <span class="sh">'</span><span class="s">potential</span><span class="sh">'</span><span class="p">:</span> <span class="n">pe</span><span class="p">,</span> 
                               <span class="sh">'</span><span class="s">total</span><span class="sh">'</span><span class="p">:</span> <span class="n">ke</span> <span class="o">+</span> <span class="n">pe</span><span class="p">})</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">trajectory</span><span class="p">),</span> <span class="n">energies</span>
    
    <span class="k">def</span> <span class="nf">calculate_potential_energy</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate total potential energy</span><span class="sh">"""</span>
        <span class="n">pe</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span><span class="p">)</span>
                <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">r_norm</span> <span class="o">&lt;</span> <span class="mf">2.5</span><span class="p">:</span>  <span class="c1"># Cutoff distance
</span>                    <span class="n">r6</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">r_norm</span><span class="p">)</span> <span class="o">**</span> <span class="mi">6</span>
                    <span class="n">pe</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">r6</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">r6</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">pe</span>

<span class="c1"># Run a simple MD simulation
</span><span class="n">md</span> <span class="o">=</span> <span class="nc">MolecularDynamics</span><span class="p">(</span><span class="n">n_particles</span><span class="o">=</span><span class="mi">108</span><span class="p">,</span> <span class="n">box_size</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">trajectory</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="advanced-md-techniques">Advanced MD Techniques</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AdvancedMD</span><span class="p">(</span><span class="n">MolecularDynamics</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Advanced molecular dynamics techniques</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">nose_hoover_thermostat</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">Q</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">target_temp</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Nos√©-Hoover thermostat for constant temperature</span><span class="sh">"""</span>
        <span class="c1"># Calculate current temperature
</span>        <span class="n">ke</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">velocities</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">current_temp</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">ke</span> <span class="o">/</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">)</span>
        
        <span class="c1"># Update thermostat variable
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">'</span><span class="s">xi</span><span class="sh">'</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">xi</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="n">xi_dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_temp</span> <span class="o">-</span> <span class="n">target_temp</span><span class="p">)</span> <span class="o">/</span> <span class="n">Q</span>
        <span class="n">self</span><span class="p">.</span><span class="n">xi</span> <span class="o">+=</span> <span class="n">xi_dot</span> <span class="o">*</span> <span class="n">dt</span>
        
        <span class="c1"># Apply thermostat to velocities
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocities</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">xi</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">neighbor_list</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">2.5</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Verlet neighbor list for efficiency</span><span class="sh">"""</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">)}</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">cutoff</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">:</span>  <span class="c1"># Include buffer
</span>                    <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                    <span class="n">neighbors</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">neighbors</span>
    
    <span class="k">def</span> <span class="nf">ewald_summation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">charges</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">5.0</span><span class="o">/</span><span class="n">self</span><span class="p">.</span><span class="n">box_size</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Ewald summation for long-range electrostatics</span><span class="sh">"""</span>
        <span class="c1"># Real space contribution
</span>        <span class="n">energy_real</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">forces_real</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_particles</span><span class="p">):</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">round</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">box_size</span><span class="p">)</span>
                <span class="n">r_norm</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
                
                <span class="c1"># Real space interaction
</span>                <span class="n">erfc_term</span> <span class="o">=</span> <span class="nf">erfc</span><span class="p">(</span><span class="n">alpha</span> <span class="o">*</span> <span class="n">r_norm</span><span class="p">)</span>
                <span class="n">energy_real</span> <span class="o">+=</span> <span class="n">charges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">charges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">erfc_term</span> <span class="o">/</span> <span class="n">r_norm</span>
                
                <span class="n">force_mag</span> <span class="o">=</span> <span class="n">charges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">charges</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">erfc_term</span> <span class="o">/</span> <span class="n">r_norm</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> 
                    <span class="mi">2</span> <span class="o">*</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_norm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">r_norm</span>
                <span class="p">)</span>
                <span class="n">forces_real</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">force_mag</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="n">r_norm</span>
                <span class="n">forces_real</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-=</span> <span class="n">force_mag</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="n">r_norm</span>
        
        <span class="c1"># Reciprocal space contribution (simplified)
</span>        <span class="c1"># ... (implementation of k-space sum)
</span>        
        <span class="k">return</span> <span class="n">energy_real</span><span class="p">,</span> <span class="n">forces_real</span>
</code></pre></div></div>

<hr>

<h2 id="finite-element-methods">Finite Element Methods</h2>

<h3 id="basic-fem-implementation">Basic FEM Implementation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FiniteElement1D</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">1D finite element method for solving differential equations</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_elements</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_elements</span> <span class="o">=</span> <span class="n">n_elements</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="n">n_elements</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">self</span><span class="p">.</span><span class="n">domain</span> <span class="o">=</span> <span class="n">domain</span>
        <span class="n">self</span><span class="p">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">n_elements</span>
        
        <span class="c1"># Node positions
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="n">domain</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">domain</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">shape_functions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Linear shape functions on reference element [-1, 1]</span><span class="sh">"""</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">shape_derivatives</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Derivatives of shape functions</span><span class="sh">"""</span>
        <span class="n">dN1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
        <span class="n">dN2</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">dN1</span><span class="p">,</span> <span class="n">dN2</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">element_stiffness_matrix</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Stiffness matrix for linear element</span><span class="sh">"""</span>
        <span class="c1"># Gauss quadrature points and weights
</span>        <span class="n">gauss_points</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        
        <span class="n">K_e</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">gp</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">gauss_points</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
            <span class="n">dN</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">shape_derivatives</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
            
            <span class="c1"># Jacobian for transformation
</span>            <span class="n">J</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
            
            <span class="c1"># Add contribution
</span>            <span class="n">K_e</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">outer</span><span class="p">(</span><span class="n">dN</span><span class="p">,</span> <span class="n">dN</span><span class="p">)</span> <span class="o">/</span> <span class="n">J</span>
        
        <span class="k">return</span> <span class="n">K_e</span>
    
    <span class="k">def</span> <span class="nf">element_mass_matrix</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Mass matrix for linear element</span><span class="sh">"""</span>
        <span class="n">gauss_points</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        
        <span class="n">M_e</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">gp</span><span class="p">,</span> <span class="n">w</span> <span class="ow">in</span> <span class="nf">zip</span><span class="p">(</span><span class="n">gauss_points</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">shape_functions</span><span class="p">(</span><span class="n">gp</span><span class="p">)</span>
            <span class="n">J</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">h</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">M_e</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">outer</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">J</span>
        
        <span class="k">return</span> <span class="n">M_e</span>
    
    <span class="k">def</span> <span class="nf">assemble_global_matrices</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Assemble global stiffness and mass matrices</span><span class="sh">"""</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">))</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">))</span>
        
        <span class="n">K_e</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">element_stiffness_matrix</span><span class="p">()</span>
        <span class="n">M_e</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">element_mass_matrix</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_elements</span><span class="p">):</span>
            <span class="c1"># Global node numbers for element e
</span>            <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="p">,</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># Add element contributions
</span>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">K_e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                    <span class="n">M</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">M_e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">M</span>
    
    <span class="k">def</span> <span class="nf">solve_poisson</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">bc_left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bc_right</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Solve -u</span><span class="sh">''</span><span class="s"> = f with Dirichlet boundary conditions</span><span class="sh">"""</span>
        <span class="n">K</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">assemble_global_matrices</span><span class="p">()</span>
        
        <span class="c1"># Load vector
</span>        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_nodes</span><span class="p">):</span>
            <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nf">f</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">h</span>
        
        <span class="c1"># Apply boundary conditions
</span>        <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_left</span>
        
        <span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">K</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">F</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bc_right</span>
        
        <span class="c1"># Solve
</span>        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">F</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">nodes</span><span class="p">,</span> <span class="n">u</span>

<span class="c1"># Example: Solve -u'' = sin(œÄx) on [0, 1]
</span><span class="n">fem</span> <span class="o">=</span> <span class="nc">FiniteElement1D</span><span class="p">(</span><span class="n">n_elements</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nf">solve_poisson</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">))</span>

<span class="c1"># Exact solution for comparison
</span><span class="n">u_exact</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="sh">'</span><span class="s">o-</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">FEM solution</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">u_exact</span><span class="p">,</span> <span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Exact solution</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">u</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="2d-finite-elements">2D Finite Elements</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FiniteElement2D</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">2D finite element method using triangular elements</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_vertices</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_elements</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">shape_functions_2d</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Linear shape functions for triangular element</span><span class="sh">"""</span>
        <span class="n">N1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span> <span class="o">-</span> <span class="n">eta</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">xi</span>
        <span class="n">N3</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">N1</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="n">N3</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">shape_derivatives_2d</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Derivatives of shape functions</span><span class="sh">"""</span>
        <span class="c1"># dN/dxi
</span>        <span class="n">dN_dxi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="c1"># dN/deta
</span>        <span class="n">dN_deta</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">dN_dxi</span><span class="p">,</span> <span class="n">dN_deta</span>
    
    <span class="k">def</span> <span class="nf">element_stiffness_2d</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">element_idx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Stiffness matrix for triangular element</span><span class="sh">"""</span>
        <span class="c1"># Get vertex coordinates
</span>        <span class="n">v_idx</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">elements</span><span class="p">[</span><span class="n">element_idx</span><span class="p">]</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">v_idx</span><span class="p">]</span>
        
        <span class="c1"># Jacobian matrix
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        
        <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="p">])</span>
        
        <span class="n">det_J</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">det</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
        <span class="n">J_inv</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">inv</span><span class="p">(</span><span class="n">J</span><span class="p">)</span>
        
        <span class="c1"># Shape function derivatives in physical coordinates
</span>        <span class="n">dN_dxi</span><span class="p">,</span> <span class="n">dN_deta</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">shape_derivatives_2d</span><span class="p">()</span>
        <span class="n">dN_local</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">dN_dxi</span><span class="p">,</span> <span class="n">dN_deta</span><span class="p">])</span>
        <span class="n">dN_physical</span> <span class="o">=</span> <span class="n">J_inv</span><span class="p">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">dN_local</span>
        
        <span class="c1"># Element stiffness matrix
</span>        <span class="n">K_e</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">K_e</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">det_J</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="n">dN_physical</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN_physical</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+</span>
                    <span class="n">dN_physical</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dN_physical</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">K_e</span>
    
    <span class="k">def</span> <span class="nf">create_mesh_grid</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Create a structured triangular mesh</span><span class="sh">"""</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Create vertices
</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                <span class="n">vertices</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
        
        <span class="c1"># Create elements (two triangles per square)
</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Bottom-left vertex of square
</span>                <span class="n">v0</span> <span class="o">=</span> <span class="n">j</span> <span class="o">*</span> <span class="n">nx</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">v1</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">v2</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">+</span> <span class="n">nx</span>
                <span class="n">v3</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">+</span> <span class="mi">1</span>
                
                <span class="c1"># Lower triangle
</span>                <span class="n">elements</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="n">v0</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">])</span>
                <span class="c1"># Upper triangle
</span>                <span class="n">elements</span><span class="p">.</span><span class="nf">append</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="n">v2</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">vertices</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</code></pre></div></div>

<hr>

<h2 id="computational-fluid-dynamics">Computational Fluid Dynamics</h2>

<h3 id="basic-cfd-navier-stokes-solver">Basic CFD: Navier-Stokes Solver</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">FluidSolver2D</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">2D incompressible Navier-Stokes solver using finite differences</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
        <span class="n">self</span><span class="p">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">L</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">dy</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>  <span class="c1"># kinematic viscosity
</span>        
        <span class="c1"># Grid
</span>        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span>
        
        <span class="c1"># Flow variables
</span>        <span class="n">self</span><span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>  <span class="c1"># x-velocity
</span>        <span class="n">self</span><span class="p">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>  <span class="c1"># y-velocity
</span>        <span class="n">self</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>  <span class="c1"># pressure
</span>        
    <span class="k">def</span> <span class="nf">set_lid_driven_cavity_bc</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Boundary conditions for lid-driven cavity</span><span class="sh">"""</span>
        <span class="c1"># Top lid moves with velocity 1
</span>        <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">1.0</span>
        
        <span class="c1"># All other boundaries: no-slip (u = v = 0)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">solve_poisson_pressure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">div_u</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Solve pressure Poisson equation using Jacobi iteration</span><span class="sh">"""</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">p</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">p_old</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            
            <span class="c1"># Jacobi iteration
</span>            <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">p_old</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_old</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                <span class="n">p_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">p_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span>
                <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">div_u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            
            <span class="c1"># Neumann BC: dp/dn = 0
</span>            <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">p</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            
            <span class="c1"># Check convergence
</span>            <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p_old</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">p</span>
    
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Single time step using projection method</span><span class="sh">"""</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">p</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">dy</span>
        
        <span class="c1"># Step 1: Compute intermediate velocity (ignore pressure)
</span>        <span class="c1"># Advection terms (upwind scheme)
</span>        <span class="n">u_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span>
        
        <span class="n">v_x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
        <span class="n">v_y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">,</span>
                      <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span>
        
        <span class="c1"># Diffusion terms
</span>        <span class="n">u_xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">u_yy</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="n">v_xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">v_yy</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dy</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Update intermediate velocity
</span>        <span class="n">u_star</span> <span class="o">=</span> <span class="n">u</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">v_star</span> <span class="o">=</span> <span class="n">v</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
        
        <span class="n">u_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_x</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">u_y</span> <span class="o">+</span>
            <span class="n">self</span><span class="p">.</span><span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">u_xx</span> <span class="o">+</span> <span class="n">u_yy</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="n">v_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
            <span class="o">-</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_x</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v_y</span> <span class="o">+</span>
            <span class="n">self</span><span class="p">.</span><span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">v_xx</span> <span class="o">+</span> <span class="n">v_yy</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Apply boundary conditions
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">set_lid_driven_cavity_bc</span><span class="p">()</span>
        
        <span class="c1"># Step 2: Solve pressure Poisson equation
</span>        <span class="n">div_u_star</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">u_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">u_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">v_star</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_star</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="n">div_field</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">div_field</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">div_u_star</span> <span class="o">/</span> <span class="n">dt</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">solve_poisson_pressure</span><span class="p">(</span><span class="n">div_field</span><span class="p">)</span>
        
        <span class="c1"># Step 3: Correct velocity with pressure gradient
</span>        <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_star</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># Re-apply boundary conditions
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">set_lid_driven_cavity_bc</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run simulation</span><span class="sh">"""</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">step_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
            <span class="n">step_count</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">step_count</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Time: </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s">, Max velocity: </span><span class="si">{</span><span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">u</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">v</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">p</span>

<span class="c1"># Run lid-driven cavity simulation
</span><span class="n">solver</span> <span class="o">=</span> <span class="nc">FluidSolver2D</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">solver</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">t_end</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># Visualize results
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">131</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">contourf</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">solver</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Velocity magnitude</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Velocity Magnitude</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">132</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">streamplot</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">solver</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Streamlines</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">133</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">contourf</span><span class="p">(</span><span class="n">solver</span><span class="p">.</span><span class="n">X</span><span class="p">,</span> <span class="n">solver</span><span class="p">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Pressure</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Pressure Field</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="lattice-boltzmann-method">Lattice Boltzmann Method</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">LatticeBoltzmann2D</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">2D Lattice Boltzmann Method for fluid simulation</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">Re</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">U</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">nx</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ny</span> <span class="o">=</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span>
        <span class="n">self</span><span class="p">.</span><span class="n">Re</span> <span class="o">=</span> <span class="n">Re</span>  <span class="c1"># Reynolds number
</span>        <span class="n">self</span><span class="p">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">U</span>    <span class="c1"># Characteristic velocity
</span>        
        <span class="c1"># D2Q9 lattice
</span>        <span class="n">self</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">])</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span>
            <span class="mi">4</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span>
            <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">9</span><span class="p">,</span>
            <span class="mi">1</span><span class="o">/</span><span class="mi">36</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">36</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">36</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">36</span>
        <span class="p">])</span>
        
        <span class="c1"># Relaxation time (related to viscosity)
</span>        <span class="n">self</span><span class="p">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">U</span> <span class="o">*</span> <span class="n">ny</span> <span class="o">/</span> <span class="n">Re</span>
        <span class="n">self</span><span class="p">.</span><span class="n">tau</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">nu</span> <span class="o">+</span> <span class="mf">0.5</span>
        
        <span class="c1"># Initialize distribution functions
</span>        <span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">9</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">self</span><span class="p">.</span><span class="n">feq</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="mi">9</span><span class="p">,</span> <span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        
        <span class="c1"># Initialize to equilibrium
</span>        <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">ones</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        
        <span class="n">self</span><span class="p">.</span><span class="nf">equilibrium</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">feq</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">equilibrium</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate equilibrium distribution</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">cu</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">u</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">v</span>
            <span class="n">self</span><span class="p">.</span><span class="n">feq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">cu</span> <span class="o">+</span> <span class="mf">4.5</span><span class="o">*</span><span class="n">cu</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">macroscopic</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate macroscopic variables from distribution</span><span class="sh">"""</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">c</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">rho</span>
        <span class="k">return</span> <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>
    
    <span class="k">def</span> <span class="nf">collision</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">BGK collision operator</span><span class="sh">"""</span>
        <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">macroscopic</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">equilibrium</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">-</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">feq</span><span class="p">)</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">tau</span>
    
    <span class="k">def</span> <span class="nf">streaming</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Stream distribution functions</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">roll</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">self</span><span class="p">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">boundary_conditions</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Apply boundary conditions</span><span class="sh">"""</span>
        <span class="c1"># Lid-driven cavity: top wall moves with velocity U
</span>        <span class="c1"># Zou-He boundary conditions
</span>        
        <span class="c1"># Top wall (moving)
</span>        <span class="n">rho_top</span> <span class="o">=</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span>
                  <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">U</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">rho_top</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">U</span>
        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">rho_top</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">U</span>
        
        <span class="c1"># Other walls (no-slip)
</span>        <span class="c1"># Bottom
</span>        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="c1"># Left
</span>        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Right
</span>        <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">f</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span> <span class="p">:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Single LBM step</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">collision</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">streaming</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">boundary_conditions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run simulation</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">1000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">macroscopic</span><span class="p">()</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s">: Max velocity = </span><span class="si">{</span><span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">macroscopic</span><span class="p">()</span>

<span class="c1"># Run LBM simulation
</span><span class="n">lbm</span> <span class="o">=</span> <span class="nc">LatticeBoltzmann2D</span><span class="p">(</span><span class="n">nx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">Re</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">lbm</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</code></pre></div></div>

<hr>

<h2 id="quantum-computational-methods">Quantum Computational Methods</h2>

<h3 id="time-dependent-schr√∂dinger-equation">Time-Dependent Schr√∂dinger Equation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QuantumEvolution</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Solve time-dependent Schr√∂dinger equation</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x_min</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">x_range</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n_points</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x_max</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">x_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_points</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x_min</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">x_max</span><span class="p">,</span> <span class="n">n_points</span><span class="p">)</span>
        
        <span class="c1"># Momentum space
</span>        <span class="n">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">gaussian_wavepacket</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">k0</span><span class="p">,</span> <span class="n">sigma</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize Gaussian wavepacket</span><span class="sh">"""</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">psi</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">k0</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">/=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.25</span>
        <span class="k">return</span> <span class="n">psi</span>
    
    <span class="k">def</span> <span class="nf">split_operator_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Split-operator method for time evolution</span><span class="sh">"""</span>
        <span class="c1"># Half step in position space
</span>        <span class="n">psi</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">V</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Full step in momentum space
</span>        <span class="n">psi_k</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fft</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
        <span class="n">psi_k</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">ifft</span><span class="p">(</span><span class="n">psi_k</span><span class="p">)</span>
        
        <span class="c1"># Half step in position space
</span>        <span class="n">psi</span> <span class="o">*=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">V</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">psi</span>
    
    <span class="k">def</span> <span class="nf">crank_nicolson_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Crank-Nicolson method for time evolution</span><span class="sh">"""</span>
        <span class="c1"># (1 + i*dt*H/2)ùúì(t+dt) = (1 - i*dt*H/2)ùúì(t)
</span>        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">eye</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">I</span> <span class="o">+</span> <span class="mf">1j</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">I</span> <span class="o">-</span> <span class="mf">1j</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="c1"># Solve linear system
</span>        <span class="n">b</span> <span class="o">=</span> <span class="n">B</span> <span class="o">@</span> <span class="n">psi</span>
        <span class="n">psi_new</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">psi_new</span>
    
    <span class="k">def</span> <span class="nf">finite_difference_hamiltonian</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Construct Hamiltonian matrix using finite differences</span><span class="sh">"""</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">n</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        
        <span class="c1"># Kinetic energy (second derivative)
</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Boundary conditions
</span>        <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">H</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">H</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">H</span>
    
    <span class="k">def</span> <span class="nf">tunnel_barrier_simulation</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Quantum tunneling through a barrier</span><span class="sh">"""</span>
        <span class="c1"># Potential barrier
</span>        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">barrier_width</span> <span class="o">=</span> <span class="mf">2.0</span>
        <span class="n">barrier_height</span> <span class="o">=</span> <span class="mf">5.0</span>
        <span class="n">V</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">barrier_width</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">barrier_height</span>
        
        <span class="c1"># Initial wavepacket
</span>        <span class="n">psi</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gaussian_wavepacket</span><span class="p">(</span><span class="n">x0</span><span class="o">=-</span><span class="mi">5</span><span class="p">,</span> <span class="n">k0</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Time evolution
</span>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">1000</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="n">psi</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">split_operator_step</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Calculate transmission and reflection
</span>                <span class="n">transmitted</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">barrier_width</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span>
                <span class="n">reflected</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">psi</span><span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">barrier_width</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span>
                
                <span class="n">results</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">:</span> <span class="n">step</span> <span class="o">*</span> <span class="n">dt</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">psi</span><span class="sh">'</span><span class="p">:</span> <span class="n">psi</span><span class="p">.</span><span class="nf">copy</span><span class="p">(),</span>
                    <span class="sh">'</span><span class="s">transmitted</span><span class="sh">'</span><span class="p">:</span> <span class="n">transmitted</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">reflected</span><span class="sh">'</span><span class="p">:</span> <span class="n">reflected</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">V</span>

<span class="c1"># Visualize quantum tunneling
</span><span class="n">qe</span> <span class="o">=</span> <span class="nc">QuantumEvolution</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">n_points</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span class="n">results</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">qe</span><span class="p">.</span><span class="nf">tunnel_barrier_simulation</span><span class="p">()</span>

<span class="c1"># Animation of wavefunction
</span><span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Wavefunction plot
</span><span class="n">line1</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">qe</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">psi</span><span class="sh">'</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="sh">'</span><span class="s">b-</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">|ùúì|¬≤</span><span class="sh">'</span><span class="p">)</span>
<span class="n">line2</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">qe</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">psi</span><span class="sh">'</span><span class="p">]),</span> <span class="sh">'</span><span class="s">r--</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Re(ùúì)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">qe</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">V</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Potential</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Wavefunction</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">ax1</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Transmission/Reflection plot
</span><span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
<span class="n">trans</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="sh">'</span><span class="s">transmitted</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>
<span class="n">refl</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="sh">'</span><span class="s">reflected</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

<span class="n">ax2</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">trans</span><span class="p">,</span> <span class="sh">'</span><span class="s">g-</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Transmitted</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">refl</span><span class="p">,</span> <span class="sh">'</span><span class="s">r-</span><span class="sh">'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Reflected</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Probability</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">ax2</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="density-functional-theory-dft">Density Functional Theory (DFT)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">SimpleDFT</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Simplified 1D DFT implementation</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_grid</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">box_length</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n_grid</span>
        <span class="n">self</span><span class="p">.</span><span class="n">L</span> <span class="o">=</span> <span class="n">box_length</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">L</span> <span class="o">/</span> <span class="n">n_grid</span>
        <span class="n">self</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">self</span><span class="p">.</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_grid</span><span class="p">)</span>
        
        <span class="c1"># Kinetic energy operator in momentum space
</span>        <span class="n">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">T_k</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">def</span> <span class="nf">thomas_fermi_functional</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Thomas-Fermi kinetic energy functional</span><span class="sh">"""</span>
        <span class="n">C_TF</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">C_TF</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="mi">5</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span>
    
    <span class="k">def</span> <span class="nf">exchange_functional</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Local density approximation for exchange</span><span class="sh">"""</span>
        <span class="n">C_x</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">C_x</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="mi">4</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span>
    
    <span class="k">def</span> <span class="nf">hartree_potential</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Solve Poisson equation for Hartree potential</span><span class="sh">"""</span>
        <span class="c1"># Fourier space solution
</span>        <span class="n">n_k</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fft</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">V_H_k</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">n_k</span><span class="p">)</span>
        
        <span class="c1"># V_H = 4œÄ n / k¬≤ (avoiding k=0)
</span>        <span class="n">V_H_k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">n_k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">V_H_k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># Set DC component
</span>        
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">ifft</span><span class="p">(</span><span class="n">V_H_k</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">kohn_sham_step</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">V_ext</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Single Kohn-Sham iteration</span><span class="sh">"""</span>
        <span class="c1"># Calculate potentials
</span>        <span class="n">V_H</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">hartree_potential</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># Exchange-correlation potential (LDA)
</span>        <span class="n">V_xc</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># Total effective potential
</span>        <span class="n">V_eff</span> <span class="o">=</span> <span class="n">V_ext</span> <span class="o">+</span> <span class="n">V_H</span> <span class="o">+</span> <span class="n">V_xc</span>
        
        <span class="c1"># Solve Kohn-Sham equation
</span>        <span class="c1"># Convert to momentum space
</span>        <span class="n">H_diag</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">T_k</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fft</span><span class="p">(</span><span class="n">V_eff</span><span class="p">)</span>
        
        <span class="c1"># Find eigenvalues and eigenvectors
</span>        <span class="c1"># (Simplified: assuming non-interacting electrons)
</span>        <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sort</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">H_diag</span><span class="p">))</span>
        
        <span class="c1"># Construct new density (simplified)
</span>        <span class="c1"># In real DFT, we'd solve for eigenfunctions
</span>        <span class="n">n_new</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">initial_density</span><span class="p">(</span><span class="n">V_ext</span><span class="p">)</span>  <span class="c1"># Placeholder
</span>        
        <span class="k">return</span> <span class="n">n_new</span><span class="p">,</span> <span class="n">energies</span>
    
    <span class="k">def</span> <span class="nf">initial_density</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">V_ext</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initial guess for electron density</span><span class="sh">"""</span>
        <span class="c1"># Use Thomas-Fermi approximation
</span>        <span class="n">mu</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># Chemical potential (adjust as needed)
</span>        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mu</span> <span class="o">-</span> <span class="n">V_ext</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Normalize to correct number of electrons
</span>        <span class="n">N_electrons</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Example
</span>        <span class="n">n</span> <span class="o">*=</span> <span class="n">N_electrons</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">dx</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">n</span>
    
    <span class="k">def</span> <span class="nf">self_consistent_field</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">V_ext</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Self-consistent field iteration</span><span class="sh">"""</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">initial_density</span><span class="p">(</span><span class="n">V_ext</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
            <span class="n">n_old</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
            
            <span class="c1"># Kohn-Sham step
</span>            <span class="n">n</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">kohn_sham_step</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">V_ext</span><span class="p">)</span>
            
            <span class="c1"># Mix old and new density
</span>            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># Mixing parameter
</span>            <span class="n">n</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_old</span>
            
            <span class="c1"># Check convergence
</span>            <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">n_old</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Converged in </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s"> iterations</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">energies</span>
</code></pre></div></div>

<hr>

<h2 id="parallel-computing-for-physics">Parallel Computing for Physics</h2>

<h3 id="mpi-for-distributed-computing">MPI for Distributed Computing</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example: Parallel Monte Carlo simulation
# Run with: mpirun -n 4 python script.py
</span>
<span class="kn">from</span> <span class="n">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">class</span> <span class="nc">ParallelMonteCarlo</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Parallel Monte Carlo simulation using MPI</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">comm</span> <span class="o">=</span> <span class="n">MPI</span><span class="p">.</span><span class="n">COMM_WORLD</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_size</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">parallel_pi_estimation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_samples_total</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Estimate œÄ using parallel Monte Carlo</span><span class="sh">"""</span>
        <span class="c1"># Divide work among processes
</span>        <span class="n">n_samples_local</span> <span class="o">=</span> <span class="n">n_samples_total</span> <span class="o">//</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        
        <span class="c1"># Handle remainder
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">&lt;</span> <span class="n">n_samples_total</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">n_samples_local</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="c1"># Local random number generation with different seeds
</span>        <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">42</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span><span class="p">)</span>
        
        <span class="c1"># Generate random points
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples_local</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n_samples_local</span><span class="p">)</span>
        
        <span class="c1"># Count points inside unit circle
</span>        <span class="n">inside_local</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Gather results from all processes
</span>        <span class="n">inside_total</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nf">reduce</span><span class="p">(</span><span class="n">inside_local</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="p">.</span><span class="n">SUM</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pi_estimate</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">inside_total</span> <span class="o">/</span> <span class="n">n_samples_total</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">œÄ estimate: </span><span class="si">{</span><span class="n">pi_estimate</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: </span><span class="si">{</span><span class="nf">abs</span><span class="p">(</span><span class="n">pi_estimate</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pi_estimate</span>
        
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">parallel_domain_decomposition</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">global_shape</span><span class="p">,</span> <span class="n">local_func</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Domain decomposition for PDEs</span><span class="sh">"""</span>
        <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="n">global_shape</span>
        
        <span class="c1"># 2D processor grid
</span>        <span class="n">px</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">px</span>
        
        <span class="c1"># Local domain size
</span>        <span class="n">nx_local</span> <span class="o">=</span> <span class="n">nx</span> <span class="o">//</span> <span class="n">px</span>
        <span class="n">ny_local</span> <span class="o">=</span> <span class="n">ny</span> <span class="o">//</span> <span class="n">py</span>
        
        <span class="c1"># Processor coordinates
</span>        <span class="n">px_coord</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">%</span> <span class="n">px</span>
        <span class="n">py_coord</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">//</span> <span class="n">px</span>
        
        <span class="c1"># Local domain boundaries
</span>        <span class="n">x_start</span> <span class="o">=</span> <span class="n">px_coord</span> <span class="o">*</span> <span class="n">nx_local</span>
        <span class="n">x_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">px_coord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nx_local</span>
        <span class="n">y_start</span> <span class="o">=</span> <span class="n">py_coord</span> <span class="o">*</span> <span class="n">ny_local</span>
        <span class="n">y_end</span> <span class="o">=</span> <span class="p">(</span><span class="n">py_coord</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ny_local</span>
        
        <span class="c1"># Create local array with ghost cells
</span>        <span class="n">local_array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">nx_local</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ny_local</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
        
        <span class="c1"># Apply local function
</span>        <span class="n">local_array</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nf">local_func</span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span> <span class="n">x_end</span><span class="p">,</span> <span class="n">y_start</span><span class="p">,</span> <span class="n">y_end</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">local_array</span><span class="p">,</span> <span class="p">(</span><span class="n">px_coord</span><span class="p">,</span> <span class="n">py_coord</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">exchange_ghost_cells</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">local_array</span><span class="p">,</span> <span class="n">proc_coords</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Exchange ghost cells with neighbors</span><span class="sh">"""</span>
        <span class="n">px_coord</span><span class="p">,</span> <span class="n">py_coord</span> <span class="o">=</span> <span class="n">proc_coords</span>
        
        <span class="c1"># Define neighbor ranks
</span>        <span class="n">north</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span> <span class="k">if</span> <span class="n">py_coord</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">south</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span> <span class="k">if</span> <span class="n">py_coord</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">west</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span> <span class="k">if</span> <span class="n">px_coord</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">-</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        <span class="n">east</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Get_rank</span><span class="p">()</span> <span class="k">if</span> <span class="n">px_coord</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="n">rank</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">size</span>
        
        <span class="c1"># Exchange in y-direction
</span>        <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Sendrecv</span><span class="p">(</span><span class="n">local_array</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">south</span><span class="p">,</span> 
                          <span class="n">recvbuf</span><span class="o">=</span><span class="n">local_array</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">source</span><span class="o">=</span><span class="n">north</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Sendrecv</span><span class="p">(</span><span class="n">local_array</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">north</span><span class="p">,</span>
                          <span class="n">recvbuf</span><span class="o">=</span><span class="n">local_array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">source</span><span class="o">=</span><span class="n">south</span><span class="p">)</span>
        
        <span class="c1"># Exchange in x-direction
</span>        <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Sendrecv</span><span class="p">(</span><span class="n">local_array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">east</span><span class="p">,</span>
                          <span class="n">recvbuf</span><span class="o">=</span><span class="n">local_array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">source</span><span class="o">=</span><span class="n">west</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nc">Sendrecv</span><span class="p">(</span><span class="n">local_array</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">west</span><span class="p">,</span>
                          <span class="n">recvbuf</span><span class="o">=</span><span class="n">local_array</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">source</span><span class="o">=</span><span class="n">east</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">local_array</span>
</code></pre></div></div>

<h3 id="gpu-computing-with-cudacupy">GPU Computing with CUDA/CuPy</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">cupy</span> <span class="k">as</span> <span class="n">cp</span>

<span class="k">class</span> <span class="nc">GPUPhysics</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">GPU-accelerated physics simulations using CuPy</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nc">Device</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Using GPU: </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">device</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gpu_nbody_simulation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_bodies</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">n_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">N-body gravitational simulation on GPU</span><span class="sh">"""</span>
        <span class="c1"># Initialize positions and velocities
</span>        <span class="n">pos</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">n_bodies</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">cp</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">n_bodies</span><span class="p">,</span> <span class="mi">3</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">cp</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">ones</span><span class="p">(</span><span class="n">n_bodies</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">cp</span><span class="p">.</span><span class="n">float32</span><span class="p">)</span>
        
        <span class="c1"># Softening parameter to avoid singularities
</span>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
        
        <span class="c1"># Custom CUDA kernel for force calculation
</span>        <span class="n">force_kernel</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nc">RawKernel</span><span class="p">(</span><span class="sa">r</span><span class="sh">'''</span><span class="s">
        extern </span><span class="sh">"</span><span class="s">C</span><span class="sh">"</span><span class="s"> __global__
        void compute_forces(float* pos, float* mass, float* forces, 
                           int n_bodies, float eps) {
            int i = blockIdx.x * blockDim.x + threadIdx.x;
            if (i &gt;= n_bodies) return;
            
            float3 f = make_float3(0.0f, 0.0f, 0.0f);
            float3 pi = make_float3(pos[3*i], pos[3*i+1], pos[3*i+2]);
            
            for (int j = 0; j &lt; n_bodies; j++) {
                if (i == j) continue;
                
                float3 pj = make_float3(pos[3*j], pos[3*j+1], pos[3*j+2]);
                float3 r = make_float3(pj.x - pi.x, pj.y - pi.y, pj.z - pi.z);
                
                float r2 = r.x*r.x + r.y*r.y + r.z*r.z + eps*eps;
                float r3 = r2 * sqrtf(r2);
                
                float f_mag = mass[j] / r3;
                f.x += f_mag * r.x;
                f.y += f_mag * r.y;
                f.z += f_mag * r.z;
            }
            
            forces[3*i] = f.x;
            forces[3*i+1] = f.y;
            forces[3*i+2] = f.z;
        }
        </span><span class="sh">'''</span><span class="p">,</span> <span class="sh">'</span><span class="s">compute_forces</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Simulation loop
</span>        <span class="n">forces</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="c1"># Compute forces
</span>            <span class="n">threads_per_block</span> <span class="o">=</span> <span class="mi">256</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_bodies</span> <span class="o">+</span> <span class="n">threads_per_block</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">threads_per_block</span>
            
            <span class="nf">force_kernel</span><span class="p">((</span><span class="n">blocks</span><span class="p">,),</span> <span class="p">(</span><span class="n">threads_per_block</span><span class="p">,),</span> 
                        <span class="p">(</span><span class="n">pos</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(),</span> <span class="n">mass</span><span class="p">,</span> <span class="n">forces</span><span class="p">.</span><span class="nf">ravel</span><span class="p">(),</span> <span class="n">n_bodies</span><span class="p">,</span> <span class="n">eps</span><span class="p">))</span>
            
            <span class="c1"># Update velocities and positions (Leapfrog integration)
</span>            <span class="n">vel</span> <span class="o">+=</span> <span class="n">forces</span> <span class="o">*</span> <span class="n">dt</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="n">vel</span> <span class="o">*</span> <span class="n">dt</span>
            
            <span class="k">if</span> <span class="n">step</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Calculate total energy
</span>                <span class="n">kinetic</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">cp</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">mass</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">vel</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                
                <span class="c1"># Potential energy (simplified)
</span>                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Step </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s">: KE = </span><span class="si">{</span><span class="nf">float</span><span class="p">(</span><span class="n">kinetic</span><span class="p">)</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">cp</span><span class="p">.</span><span class="nf">asnumpy</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="n">cp</span><span class="p">.</span><span class="nf">asnumpy</span><span class="p">(</span><span class="n">vel</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">gpu_fft_spectral_method</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Spectral method for PDEs using GPU FFT</span><span class="sh">"""</span>
        <span class="c1"># Create grid
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        
        <span class="c1"># Initial condition
</span>        <span class="n">u</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">cp</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Y</span><span class="p">)</span>
        
        <span class="c1"># Wave numbers
</span>        <span class="n">kx</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cp</span><span class="p">.</span><span class="n">pi</span>
        <span class="n">ky</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fftfreq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">cp</span><span class="p">.</span><span class="n">pi</span>
        <span class="n">KX</span><span class="p">,</span> <span class="n">KY</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">meshgrid</span><span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">)</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">KX</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">KY</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="c1"># Time stepping
</span>        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">n_steps</span> <span class="o">=</span> <span class="mi">100</span>
        
        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
            <span class="c1"># Transform to Fourier space
</span>            <span class="n">u_hat</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">fft2</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            
            <span class="c1"># Solve in Fourier space (heat equation example)
</span>            <span class="n">u_hat</span> <span class="o">*=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">K2</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
            
            <span class="c1"># Transform back
</span>            <span class="n">u</span> <span class="o">=</span> <span class="n">cp</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">cp</span><span class="p">.</span><span class="n">fft</span><span class="p">.</span><span class="nf">ifft2</span><span class="p">(</span><span class="n">u_hat</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">cp</span><span class="p">.</span><span class="nf">asnumpy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="parallel-linear-algebra">Parallel Linear Algebra</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">scipy.sparse</span> <span class="kn">import</span> <span class="n">diags</span>
<span class="kn">from</span> <span class="n">scipy.sparse.linalg</span> <span class="kn">import</span> <span class="n">spsolve</span><span class="p">,</span> <span class="n">eigsh</span>
<span class="kn">import</span> <span class="n">multiprocessing</span> <span class="k">as</span> <span class="n">mp</span>

<span class="k">class</span> <span class="nc">ParallelLinearAlgebra</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Parallel solutions for large linear systems in physics</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">n_cores</span> <span class="o">=</span> <span class="n">n_cores</span> <span class="ow">or</span> <span class="n">mp</span><span class="p">.</span><span class="nf">cpu_count</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">parallel_jacobi</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Parallel Jacobi iteration for Ax = b</span><span class="sh">"""</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span> <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># Extract diagonal
</span>        <span class="n">D</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">diag</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">diag</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">update_chunk</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
            <span class="sh">"""</span><span class="s">Update a chunk of the solution vector</span><span class="sh">"""</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">x_old</span><span class="p">,</span> <span class="n">D_chunk</span><span class="p">,</span> <span class="n">R_chunk</span><span class="p">,</span> <span class="n">b_chunk</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">x_new</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_chunk</span> <span class="o">-</span> <span class="n">R_chunk</span> <span class="o">@</span> <span class="n">x_old</span><span class="p">)</span> <span class="o">/</span> <span class="n">D_chunk</span>
            <span class="k">return</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">x_new</span>
        
        <span class="c1"># Create chunks for parallel processing
</span>        <span class="n">chunk_size</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="n">self</span><span class="p">.</span><span class="n">n_cores</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_cores</span><span class="p">):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">chunk_size</span>
            <span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">chunk_size</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">n_cores</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span>
            <span class="n">chunks</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        
        <span class="c1"># Iteration
</span>        <span class="k">with</span> <span class="n">mp</span><span class="p">.</span><span class="nc">Pool</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">n_cores</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
                <span class="n">x_old</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">copy</span><span class="p">()</span>
                
                <span class="c1"># Prepare arguments for parallel execution
</span>                <span class="n">args_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="n">chunks</span><span class="p">:</span>
                    <span class="n">args_list</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span>
                        <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">x_old</span><span class="p">,</span>
                        <span class="n">D</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">],</span>
                        <span class="n">R</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">,</span> <span class="p">:],</span>
                        <span class="n">b</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
                    <span class="p">))</span>
                
                <span class="c1"># Parallel update
</span>                <span class="n">results</span> <span class="o">=</span> <span class="n">pool</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">update_chunk</span><span class="p">,</span> <span class="n">args_list</span><span class="p">)</span>
                
                <span class="c1"># Gather results
</span>                <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">x_chunk</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_chunk</span>
                
                <span class="c1"># Check convergence
</span>                <span class="k">if</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_old</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Converged in </span><span class="si">{</span><span class="n">iteration</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s"> iterations</span><span class="sh">"</span><span class="p">)</span>
                    <span class="k">break</span>
        
        <span class="k">return</span> <span class="n">x</span>
    
    <span class="k">def</span> <span class="nf">lanczos_eigenvalues</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">H_func</span><span class="p">,</span> <span class="n">n_eigs</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">n_lanczos</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Lanczos algorithm for sparse eigenvalue problems</span><span class="sh">"""</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">H_func</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Random initial vector
</span>        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">/=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        
        <span class="c1"># Lanczos vectors and tridiagonal matrix elements
</span>        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">n_lanczos</span><span class="p">))</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_lanczos</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_lanczos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="n">V</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_lanczos</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># Apply Hamiltonian
</span>            <span class="n">w</span> <span class="o">=</span> <span class="n">H_func</span> <span class="o">@</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
            
            <span class="c1"># Orthogonalize
</span>            <span class="n">alpha</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span>
            <span class="n">w</span> <span class="o">-=</span> <span class="n">alpha</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">-=</span> <span class="n">beta</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="n">beta</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">beta</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lanczos breakdown at iteration </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">break</span>
            
            <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">beta</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        
        <span class="c1"># Final alpha
</span>        <span class="n">w</span> <span class="o">=</span> <span class="n">H_func</span> <span class="o">@</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">V</span><span class="p">[:,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Construct tridiagonal matrix
</span>        <span class="n">T</span> <span class="o">=</span> <span class="nf">diags</span><span class="p">([</span><span class="n">beta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="n">beta</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Solve eigenvalue problem for T
</span>        <span class="n">eigs</span><span class="p">,</span> <span class="n">eigvecs</span> <span class="o">=</span> <span class="nf">eigsh</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="nf">min</span><span class="p">(</span><span class="n">n_eigs</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">which</span><span class="o">=</span><span class="sh">'</span><span class="s">SA</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">eigs</span><span class="p">,</span> <span class="n">V</span><span class="p">[:,</span> <span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">@</span> <span class="n">eigvecs</span>
</code></pre></div></div>

<hr>

<h2 id="machine-learning-applications">Machine Learning Applications</h2>

<h3 id="physics-informed-neural-networks-pinns">Physics-Informed Neural Networks (PINNs)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="n">torch.optim</span> <span class="k">as</span> <span class="n">optim</span>

<span class="k">class</span> <span class="nc">PhysicsInformedNN</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Neural network for solving PDEs</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="c1"># Build network
</span>        <span class="n">self</span><span class="p">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ModuleList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">layers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        
        <span class="c1"># Activation
</span>        <span class="n">self</span><span class="p">.</span><span class="n">activation</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Tanh</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Forward pass through network</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">layers</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">activation</span><span class="p">(</span><span class="nf">layer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">physics_loss</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Physics-informed loss for heat equation</span><span class="sh">"""</span>
        <span class="n">x</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">t</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="c1"># Network output
</span>        <span class="n">u</span> <span class="o">=</span> <span class="nf">self</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="c1"># Compute derivatives
</span>        <span class="n">u_t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                                 <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">ones_like</span><span class="p">(</span><span class="n">u</span><span class="p">),</span>
                                 <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">u_xx</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">grad_outputs</span><span class="o">=</span><span class="n">torch</span><span class="p">.</span><span class="nf">ones_like</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                                  <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># Heat equation: u_t - Œ±*u_xx = 0
</span>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">u_t</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">u_xx</span>
        
        <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">f</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">train_pinn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">n_epochs</span><span class="o">=</span><span class="mi">5000</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Train physics-informed neural network</span><span class="sh">"""</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
    
    <span class="c1"># Training points
</span>    <span class="n">n_points</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># x in [-1, 1]
</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">n_points</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># t in [0, 1]
</span>    
    <span class="c1"># Boundary conditions
</span>    <span class="n">n_bc</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">x_bc</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">ones</span><span class="p">(</span><span class="n">n_bc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">t_bc</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">n_bc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">u_bc</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_bc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># u(-1, t) = 0
</span>    
    <span class="c1"># Initial condition
</span>    <span class="n">x_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="n">n_bc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">t_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_bc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">u_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x_ic</span><span class="p">)</span>  <span class="c1"># u(x, 0) = sin(œÄx)
</span>    
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>
        
        <span class="c1"># Physics loss
</span>        <span class="n">loss_physics</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">physics_loss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Boundary condition loss
</span>        <span class="n">u_pred_bc</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">x_bc</span><span class="p">,</span> <span class="n">t_bc</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">loss_bc</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">mean</span><span class="p">((</span><span class="n">u_pred_bc</span> <span class="o">-</span> <span class="n">u_bc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Initial condition loss
</span>        <span class="n">u_pred_ic</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">x_ic</span><span class="p">,</span> <span class="n">t_ic</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">loss_ic</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">mean</span><span class="p">((</span><span class="n">u_pred_ic</span> <span class="o">-</span> <span class="n">u_ic</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1"># Total loss
</span>        <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_physics</span> <span class="o">+</span> <span class="n">loss_bc</span> <span class="o">+</span> <span class="n">loss_ic</span>
        
        <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s">: Loss = </span><span class="si">{</span><span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">losses</span>

<span class="c1"># Example usage
</span><span class="n">model</span> <span class="o">=</span> <span class="nc">PhysicsInformedNN</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># 2 inputs (x, t), 1 output (u)
</span><span class="n">losses</span> <span class="o">=</span> <span class="nf">train_pinn</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="neural-network-potentials">Neural Network Potentials</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NeuralPotential</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Neural network for learning interatomic potentials</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">hidden_layers</span><span class="o">=</span><span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">]):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_features</span><span class="p">]</span> <span class="o">+</span> <span class="n">hidden_layers</span> <span class="o">+</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_build_network</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span>
        
        <span class="c1"># Symmetry functions for atomic environments
</span>        <span class="n">self</span><span class="p">.</span><span class="n">symmetry_params</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_init_symmetry_functions</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_build_network</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Build the neural network</span><span class="sh">"""</span>
        <span class="n">network</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">network</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">layers</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">layers</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">network</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">network</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_init_symmetry_functions</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Initialize Behler-Parrinello symmetry functions</span><span class="sh">"""</span>
        <span class="c1"># Radial symmetry function parameters
</span>        <span class="n">eta_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
        <span class="n">Rs_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
        
        <span class="c1"># Angular symmetry function parameters
</span>        <span class="n">zeta_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">]</span>
        <span class="n">lambda_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">eta</span><span class="sh">'</span><span class="p">:</span> <span class="n">eta_values</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Rs</span><span class="sh">'</span><span class="p">:</span> <span class="n">Rs_values</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">zeta</span><span class="sh">'</span><span class="p">:</span> <span class="n">zeta_values</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">lambda</span><span class="sh">'</span><span class="p">:</span> <span class="n">lambda_values</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">compute_symmetry_functions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">types</span><span class="p">,</span> <span class="n">cutoff</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compute symmetry functions for atomic environments</span><span class="sh">"""</span>
        <span class="n">n_atoms</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">n_features</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">symmetry_params</span><span class="p">[</span><span class="sh">'</span><span class="s">eta</span><span class="sh">'</span><span class="p">])</span> <span class="o">*</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">symmetry_params</span><span class="p">[</span><span class="sh">'</span><span class="s">Rs</span><span class="sh">'</span><span class="p">])</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
            <span class="n">feature_idx</span> <span class="o">=</span> <span class="mi">0</span>
            
            <span class="c1"># Radial symmetry functions
</span>            <span class="k">for</span> <span class="n">eta</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">symmetry_params</span><span class="p">[</span><span class="sh">'</span><span class="s">eta</span><span class="sh">'</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">Rs</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">symmetry_params</span><span class="p">[</span><span class="sh">'</span><span class="s">Rs</span><span class="sh">'</span><span class="p">]:</span>
                    <span class="n">G_rad</span> <span class="o">=</span> <span class="mi">0</span>
                    
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_atoms</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">:</span>
                            <span class="k">continue</span>
                        
                        <span class="n">r_ij</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">positions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        
                        <span class="k">if</span> <span class="n">r_ij</span> <span class="o">&lt;</span> <span class="n">cutoff</span><span class="p">:</span>
                            <span class="n">fc</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">r_ij</span> <span class="o">/</span> <span class="n">cutoff</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="n">G_rad</span> <span class="o">+=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="o">-</span><span class="n">eta</span> <span class="o">*</span> <span class="p">(</span><span class="n">r_ij</span> <span class="o">-</span> <span class="n">Rs</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">fc</span>
                    
                    <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">feature_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">G_rad</span>
                    <span class="n">feature_idx</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">return</span> <span class="n">features</span>
    
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">features</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Predict energy from symmetry functions</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">network</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">calculate_forces</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span> <span class="n">types</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate forces as negative gradient of energy</span><span class="sh">"""</span>
        <span class="n">positions</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="c1"># Compute features
</span>        <span class="n">features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">compute_symmetry_functions</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">types</span><span class="p">)</span>
        
        <span class="c1"># Predict atomic energies
</span>        <span class="n">atomic_energies</span> <span class="o">=</span> <span class="nf">self</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>
        <span class="n">total_energy</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">atomic_energies</span><span class="p">)</span>
        
        <span class="c1"># Calculate forces
</span>        <span class="n">forces</span> <span class="o">=</span> <span class="o">-</span><span class="n">torch</span><span class="p">.</span><span class="n">autograd</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">total_energy</span><span class="p">,</span> <span class="n">positions</span><span class="p">,</span>
                                     <span class="n">create_graph</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">forces</span><span class="p">,</span> <span class="n">total_energy</span>
</code></pre></div></div>

<hr>

<h2 id="visualization-and-analysis">Visualization and Analysis</h2>

<h3 id="advanced-scientific-visualization">Advanced Scientific Visualization</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="n">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">import</span> <span class="n">matplotlib.animation</span> <span class="k">as</span> <span class="n">animation</span>

<span class="k">class</span> <span class="nc">PhysicsVisualizer</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Advanced visualization for physics simulations</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">)):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="n">figsize</span>
    
    <span class="k">def</span> <span class="nf">plot_phase_space</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">trajectories</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Phase Space</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Plot phase space trajectories</span><span class="sh">"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">figsize</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajectories</span><span class="p">:</span>
            <span class="c1"># Position vs velocity
</span>            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">traj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">traj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Position</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Velocity</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Phase Portrait</span><span class="sh">'</span><span class="p">)</span>
            
            <span class="c1"># Poincar√© section
</span>            <span class="c1"># (simplified: when x crosses zero with positive velocity)
</span>            <span class="n">crossings</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">traj</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># Linear interpolation
</span>                    <span class="n">alpha</span> <span class="o">=</span> <span class="o">-</span><span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                    <span class="n">v_crossing</span> <span class="o">=</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">traj</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">crossings</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">v_crossing</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">crossings</span><span class="p">:</span>
                <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="nf">scatter</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">crossings</span><span class="p">)),</span> <span class="n">crossings</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Crossing Number</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Velocity at x=0</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Poincar√© Section</span><span class="sh">'</span><span class="p">)</span>
            
            <span class="c1"># Energy over time
</span>            <span class="n">E</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">traj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">traj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># Example: harmonic oscillator
</span>            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">plot</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Time Step</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Total Energy</span><span class="sh">'</span><span class="p">)</span>
            <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">].</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Energy Conservation</span><span class="sh">'</span><span class="p">)</span>
            
            <span class="c1"># 3D trajectory (if available)
</span>            <span class="k">if</span> <span class="n">traj</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">ax3d</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="sh">'</span><span class="s">3d</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">ax3d</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">traj</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">traj</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">traj</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
                <span class="n">ax3d</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">X</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">ax3d</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Y</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">ax3d</span><span class="p">.</span><span class="nf">set_zlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Z</span><span class="sh">'</span><span class="p">)</span>
                <span class="n">ax3d</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">3D Trajectory</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">animate_field</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">field_data</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Field Evolution</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Animate 2D field evolution</span><span class="sh">"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        
        <span class="c1"># Initial plot
</span>        <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">field_data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> - Time: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">frame</span><span class="p">):</span>
            <span class="n">im</span><span class="p">.</span><span class="nf">set_array</span><span class="p">(</span><span class="n">field_data</span><span class="p">[</span><span class="n">frame</span><span class="p">])</span>
            <span class="n">ax</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> - Time: </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">im</span><span class="p">]</span>
        
        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="p">.</span><span class="nc">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">field_data</span><span class="p">),</span>
                                    <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ani</span>
    
    <span class="k">def</span> <span class="nf">plot_spectrum</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">amplitudes</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Plot frequency spectrum</span><span class="sh">"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        
        <span class="c1"># Amplitude spectrum
</span>        <span class="k">if</span> <span class="n">log_scale</span><span class="p">:</span>
            <span class="n">ax1</span><span class="p">.</span><span class="nf">semilogy</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">))</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Amplitude</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Amplitude Spectrum</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Phase spectrum
</span>        <span class="n">phase</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">angle</span><span class="p">(</span><span class="n">amplitudes</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Frequency</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Phase (radians)</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Phase Spectrum</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">vector_field_plot</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sh">"</span><span class="s">Vector Field</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Plot 2D vector field with streamlines</span><span class="sh">"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">figsize</span><span class="p">)</span>
        
        <span class="c1"># Quiver plot
</span>        <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">U</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">magnitude</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">plasma</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> - Quiver Plot</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_aspect</span><span class="p">(</span><span class="sh">'</span><span class="s">equal</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Streamline plot
</span>        <span class="n">ax2</span><span class="p">.</span><span class="nf">streamplot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">magnitude</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">plasma</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s"> - Streamlines</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_aspect</span><span class="p">(</span><span class="sh">'</span><span class="s">equal</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">contour_analysis</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Detailed contour analysis of 2D data</span><span class="sh">"""</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        
        <span class="c1"># 3D surface plot
</span>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">221</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="sh">'</span><span class="s">3d</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        <span class="n">ax1</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">3D Surface</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Filled contour
</span>        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">222</span><span class="p">)</span>
        <span class="n">cf</span> <span class="o">=</span> <span class="n">ax2</span><span class="p">.</span><span class="nf">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">cf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">ax2</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Filled Contour</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Gradient magnitude
</span>        <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">223</span><span class="p">)</span>
        <span class="n">Zy</span><span class="p">,</span> <span class="n">Zx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">gradient</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="n">grad_mag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">Zx</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">Zy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">ax3</span><span class="p">.</span><span class="nf">imshow</span><span class="p">(</span><span class="n">grad_mag</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">X</span><span class="p">.</span><span class="nf">max</span><span class="p">(),</span> <span class="n">Y</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">Y</span><span class="p">.</span><span class="nf">max</span><span class="p">()],</span>
                       <span class="n">origin</span><span class="o">=</span><span class="sh">'</span><span class="s">lower</span><span class="sh">'</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">hot</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
        <span class="n">ax3</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Gradient Magnitude</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Critical points
</span>        <span class="n">ax4</span> <span class="o">=</span> <span class="n">fig</span><span class="p">.</span><span class="nf">add_subplot</span><span class="p">(</span><span class="mi">224</span><span class="p">)</span>
        <span class="n">ax4</span><span class="p">.</span><span class="nf">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># Find approximate critical points (where gradient is small)
</span>        <span class="n">threshold</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">grad_mag</span><span class="p">)</span>
        <span class="n">critical</span> <span class="o">=</span> <span class="n">grad_mag</span> <span class="o">&lt;</span> <span class="n">threshold</span>
        <span class="n">ax4</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">critical</span><span class="p">],</span> <span class="n">Y</span><span class="p">[</span><span class="n">critical</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Critical regions</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">ax4</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
        <span class="n">ax4</span><span class="p">.</span><span class="nf">set_title</span><span class="p">(</span><span class="sh">'</span><span class="s">Critical Points</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="data-analysis-tools">Data Analysis Tools</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PhysicsDataAnalysis</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Tools for analyzing physics simulation data</span><span class="sh">"""</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">autocorrelation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_lag</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate autocorrelation function</span><span class="sh">"""</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_lag</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">max_lag</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">4</span>
        
        <span class="c1"># Normalize data
</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">c0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
        
        <span class="n">acf</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">max_lag</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">max_lag</span><span class="p">):</span>
            <span class="n">c_lag</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="n">lag</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">lag</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">lag</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">acf</span><span class="p">[</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">c_lag</span> <span class="o">/</span> <span class="n">c0</span>
        
        <span class="k">return</span> <span class="n">acf</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">power_spectrum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate power spectrum using Welch</span><span class="sh">'</span><span class="s">s method</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
        
        <span class="c1"># Welch's method for smoother spectrum
</span>        <span class="n">frequencies</span><span class="p">,</span> <span class="n">psd</span> <span class="o">=</span> <span class="n">signal</span><span class="p">.</span><span class="nf">welch</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">dt</span><span class="p">,</span> <span class="n">nperseg</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">frequencies</span><span class="p">,</span> <span class="n">psd</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">lyapunov_exponent</span><span class="p">(</span><span class="n">trajectory</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Estimate largest Lyapunov exponent</span><span class="sh">"""</span>
        <span class="n">n_steps</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">trajectory</span><span class="p">)</span>
        <span class="n">n_dim</span> <span class="o">=</span> <span class="n">trajectory</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Initialize nearby trajectory
</span>        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-8</span>
        <span class="n">separation</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="n">n_dim</span><span class="p">)</span>
        
        <span class="n">lyap_sum</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_steps</span><span class="p">):</span>
            <span class="c1"># Evolution of separation vector (linearized dynamics)
</span>            <span class="c1"># This is simplified - real implementation needs Jacobian
</span>            <span class="n">separation_new</span> <span class="o">=</span> <span class="n">separation</span> <span class="o">*</span> <span class="mf">1.1</span>  <span class="c1"># Placeholder
</span>            
            <span class="c1"># Renormalization
</span>            <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">separation_new</span><span class="p">)</span>
            <span class="n">lyap_sum</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="n">eps</span><span class="p">)</span>
            
            <span class="n">separation</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">*</span> <span class="n">separation_new</span> <span class="o">/</span> <span class="n">d</span>
        
        <span class="n">lyapunov</span> <span class="o">=</span> <span class="n">lyap_sum</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_steps</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lyapunov</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">structure_factor</span><span class="p">(</span><span class="n">positions</span><span class="p">,</span> <span class="n">k_vectors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Calculate structure factor S(k) for particle system</span><span class="sh">"""</span>
        <span class="n">n_particles</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">n_k</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">k_vectors</span><span class="p">)</span>
        
        <span class="n">S_k</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n_k</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">k_vectors</span><span class="p">):</span>
            <span class="c1"># Calculate density fluctuation
</span>            <span class="n">rho_k</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">positions</span><span class="p">:</span>
                <span class="n">rho_k</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="nf">exp</span><span class="p">(</span><span class="mf">1j</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
            
            <span class="n">S_k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">rho_k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">n_particles</span>
        
        <span class="k">return</span> <span class="n">S_k</span>
</code></pre></div></div>

<hr>

<h2 id="popular-physics-libraries">Popular Physics Libraries</h2>

<h3 id="core-libraries">Core Libraries</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Essential imports for computational physics
</span><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">scipy</span>
<span class="kn">from</span> <span class="n">scipy</span> <span class="kn">import</span> <span class="n">integrate</span><span class="p">,</span> <span class="n">optimize</span><span class="p">,</span> <span class="n">linalg</span>
<span class="kn">from</span> <span class="n">scipy.sparse</span> <span class="kn">import</span> <span class="n">csr_matrix</span><span class="p">,</span> <span class="n">diags</span>
<span class="kn">from</span> <span class="n">scipy.fft</span> <span class="kn">import</span> <span class="n">fft</span><span class="p">,</span> <span class="n">ifft</span><span class="p">,</span> <span class="n">fft2</span><span class="p">,</span> <span class="n">ifft2</span>

<span class="c1"># Specialized physics libraries
</span><span class="kn">import</span> <span class="n">sympy</span>  <span class="c1"># Symbolic mathematics
</span><span class="kn">import</span> <span class="n">h5py</span>   <span class="c1"># HDF5 for large datasets
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>  <span class="c1"># Data analysis
</span>
<span class="c1"># Visualization
</span><span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">plotly.graph_objects</span> <span class="k">as</span> <span class="n">go</span>  <span class="c1"># Interactive plots
</span>
<span class="c1"># Example: Using SciPy for physics problems
</span><span class="kn">from</span> <span class="n">scipy.integrate</span> <span class="kn">import</span> <span class="n">solve_ivp</span>
<span class="kn">from</span> <span class="n">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="n">scipy.special</span> <span class="kn">import</span> <span class="n">jv</span><span class="p">,</span> <span class="n">yv</span>  <span class="c1"># Bessel functions
</span></code></pre></div></div>

<h3 id="qutip---quantum-toolbox-in-python">QuTiP - Quantum Toolbox in Python</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">qutip</span> <span class="k">as</span> <span class="n">qt</span>

<span class="c1"># Quantum harmonic oscillator
</span><span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Number of Fock states
</span><span class="n">a</span> <span class="o">=</span> <span class="n">qt</span><span class="p">.</span><span class="nf">destroy</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>  <span class="c1"># Annihilation operator
</span><span class="n">H</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="nf">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">a</span>  <span class="c1"># Hamiltonian
</span>
<span class="c1"># Initial state: coherent state
</span><span class="n">alpha</span> <span class="o">=</span> <span class="mf">2.0</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="n">qt</span><span class="p">.</span><span class="nf">coherent</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

<span class="c1"># Time evolution
</span><span class="n">times</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">qt</span><span class="p">.</span><span class="nf">mesolve</span><span class="p">(</span><span class="n">H</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

<span class="c1"># Expectation values
</span><span class="n">n_expect</span> <span class="o">=</span> <span class="n">qt</span><span class="p">.</span><span class="nf">expect</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="nf">dag</span><span class="p">()</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">states</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="mdanalysis---molecular-dynamics-analysis">MDAnalysis - Molecular Dynamics Analysis</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">MDAnalysis</span> <span class="k">as</span> <span class="n">mda</span>

<span class="c1"># Load trajectory
</span><span class="n">u</span> <span class="o">=</span> <span class="n">mda</span><span class="p">.</span><span class="nc">Universe</span><span class="p">(</span><span class="sh">'</span><span class="s">topology.pdb</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">trajectory.dcd</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Analysis example: Radial distribution function
</span><span class="kn">from</span> <span class="n">MDAnalysis.analysis</span> <span class="kn">import</span> <span class="n">rdf</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">rdf</span><span class="p">.</span><span class="nc">InterRDF</span><span class="p">(</span><span class="n">u</span><span class="p">.</span><span class="nf">select_atoms</span><span class="p">(</span><span class="sh">'</span><span class="s">name O</span><span class="sh">'</span><span class="p">),</span>
                 <span class="n">u</span><span class="p">.</span><span class="nf">select_atoms</span><span class="p">(</span><span class="sh">'</span><span class="s">name O</span><span class="sh">'</span><span class="p">),</span>
                 <span class="n">nbins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">g</span><span class="p">.</span><span class="nf">run</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="fenics---finite-element-library">FEniCS - Finite Element Library</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">fenics</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Create mesh and function space
</span><span class="n">mesh</span> <span class="o">=</span> <span class="nc">UnitSquareMesh</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="nc">FunctionSpace</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="sh">'</span><span class="s">Lagrange</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Define boundary condition
</span><span class="n">u_D</span> <span class="o">=</span> <span class="nc">Expression</span><span class="p">(</span><span class="sh">'</span><span class="s">1 + x[0]*x[0] + 2*x[1]*x[1]</span><span class="sh">'</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">bc</span> <span class="o">=</span> <span class="nc">DirichletBC</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">u_D</span><span class="p">,</span> <span class="sh">'</span><span class="s">on_boundary</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Define variational problem
</span><span class="n">u</span> <span class="o">=</span> <span class="nc">TrialFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="nc">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="nc">Constant</span><span class="p">(</span><span class="o">-</span><span class="mf">6.0</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="nf">dot</span><span class="p">(</span><span class="nf">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="nf">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">f</span><span class="o">*</span><span class="n">v</span><span class="o">*</span><span class="n">dx</span>

<span class="c1"># Solve
</span><span class="n">u</span> <span class="o">=</span> <span class="nc">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
<span class="nf">solve</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">L</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">bc</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="pycudapyopencl---gpu-computing">PyCUDA/PyOpenCL - GPU Computing</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pycuda.autoinit</span>
<span class="kn">import</span> <span class="n">pycuda.driver</span> <span class="k">as</span> <span class="n">cuda</span>
<span class="kn">from</span> <span class="n">pycuda.compiler</span> <span class="kn">import</span> <span class="n">SourceModule</span>

<span class="c1"># CUDA kernel
</span><span class="n">mod</span> <span class="o">=</span> <span class="nc">SourceModule</span><span class="p">(</span><span class="sh">"""</span><span class="s">
__global__ void add_vectors(float *a, float *b, float *c, int n)
{
    int idx = blockIdx.x * blockDim.x + threadIdx.x;
    if (idx &lt; n)
        c[idx] = a[idx] + b[idx];
}
</span><span class="sh">"""</span><span class="p">)</span>

<span class="n">add_vectors</span> <span class="o">=</span> <span class="n">mod</span><span class="p">.</span><span class="nf">get_function</span><span class="p">(</span><span class="sh">"</span><span class="s">add_vectors</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr>

<h2 id="best-practices-and-tips">Best Practices and Tips</h2>

<h3 id="performance-optimization">Performance Optimization</h3>

<ol>
  <li>
<strong>Vectorization</strong>: Always use NumPy operations instead of loops</li>
  <li>
<strong>Memory Management</strong>: Pre-allocate arrays, use in-place operations</li>
  <li>
<strong>Profiling</strong>: Use <code class="language-plaintext highlighter-rouge">cProfile</code> and <code class="language-plaintext highlighter-rouge">line_profiler</code> to find bottlenecks</li>
  <li>
<strong>Numba</strong>: JIT compilation for numerical functions</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">numba</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">njit</span><span class="p">,</span> <span class="n">prange</span>

<span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fast_matrix_multiply</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Numba-accelerated matrix multiplication</span><span class="sh">"""</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">A</span><span class="p">.</span><span class="n">shape</span>
    <span class="n">n2</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">shape</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">prange</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
                <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">C</span>
</code></pre></div></div>

<h3 id="debugging-and-validation">Debugging and Validation</h3>

<ol>
  <li>
<strong>Conservation Laws</strong>: Always check energy, momentum conservation</li>
  <li>
<strong>Dimensional Analysis</strong>: Verify units are consistent</li>
  <li>
<strong>Limiting Cases</strong>: Test known analytical solutions</li>
  <li>
<strong>Convergence Studies</strong>: Vary discretization parameters</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">validate_simulation</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Validation checks for physics simulations</span><span class="sh">"""</span>
    <span class="c1"># Energy conservation
</span>    <span class="n">energy</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">kinetic</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">potential</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">energy_drift</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">energy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="nf">abs</span><span class="p">(</span><span class="n">energy_drift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Energy drift: </span><span class="si">{</span><span class="n">energy_drift</span><span class="si">}</span><span class="sh">"</span>
    
    <span class="c1"># Momentum conservation
</span>    <span class="n">momentum</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="sh">'</span><span class="s">momenta</span><span class="sh">'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">momentum_change</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">momentum</span> <span class="o">-</span> <span class="n">momentum</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">assert</span> <span class="n">momentum_change</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Momentum not conserved: </span><span class="si">{</span><span class="n">momentum_change</span><span class="si">}</span><span class="sh">"</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úì Validation passed</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr>

<h2 id="summary">Summary</h2>

<p>Computational physics has transformed our ability to understand and predict physical phenomena. From solving complex differential equations to simulating quantum systems, the combination of physics knowledge and computational techniques opens up endless possibilities for discovery.</p>

<h3 id="key-takeaways">Key Takeaways</h3>

<ol>
  <li>
<strong>Start Simple</strong>: Master basic numerical methods before tackling complex algorithms</li>
  <li>
<strong>Validate Constantly</strong>: Always check your results against known solutions</li>
  <li>
<strong>Optimize Wisely</strong>: Profile first, optimize the bottlenecks</li>
  <li>
<strong>Use the Right Tool</strong>: Choose algorithms based on problem characteristics</li>
  <li>
<strong>Visualize Results</strong>: Good visualization leads to physical insight</li>
</ol>

<h3 id="next-steps">Next Steps</h3>

<ul>
  <li>Implement a complete simulation for a physical system of interest</li>
  <li>Explore parallel computing for large-scale problems</li>
  <li>Learn specialized libraries for your domain</li>
  <li>Contribute to open-source physics software</li>
  <li>Apply machine learning to enhance traditional methods</li>
</ul>

<p>Remember: computational physics is not just about writing code‚Äîit‚Äôs about understanding the physics deeply enough to translate it into efficient, accurate algorithms. The computer is a tool for exploration, but physical intuition guides the journey.</p>

<p>For more physics topics, explore our guides on:</p>
<ul>
  <li>
<a href="/home/miku/Documents/repos/Documentation/github-pages/docs/physics/classical-mechanics.md">Classical Mechanics</a> - Where computational methods bring complex systems to life</li>
  <li>
<a href="/home/miku/Documents/repos/Documentation/github-pages/docs/physics/quantum-mechanics.md">Quantum Mechanics</a> - Numerical solutions to the Schr√∂dinger equation</li>
  <li>
<a href="/home/miku/Documents/repos/Documentation/github-pages/docs/physics/statistical-mechanics.md">Statistical Mechanics</a> - Monte Carlo and molecular dynamics applications</li>
</ul>

      </section>
    </div>
  </article>
</div>
</body>
</html>