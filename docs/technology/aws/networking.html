<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

<!-- SEO Meta Tags -->
<meta name="description" content="Technology and Physics notes">
<meta name="author" content="Andrew">

<!-- Open Graph -->
<meta property="og:title" content="AWS Networking & Content Delivery">
<meta property="og:description" content="Technology and Physics notes">
<meta property="og:type" content="website">
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/technology/aws/networking.html">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AWS Networking & Content Delivery">
<meta name="twitter:description" content="Technology and Physics notes">

<title>AWS Networking & Content Delivery | Andrews Notebook</title>


  <link href="/Documentation/feed.xml" type="application/atom+xml" rel="alternate" title="Andrews Notebook Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Documentation/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<!-- Custom styles -->
<!-- MathJax for LaTeX equation rendering -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
/* MathJax equation styling */
mjx-container {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
}

mjx-container[display="true"] {
  display: block !important;
  margin: 1.5em 0 !important;
  text-align: center;
}

mjx-container[display="true"] svg {
  max-width: 100%;
  height: auto;
}

/* Inline equations */
mjx-container:not([display="true"]) {
  display: inline !important;
  margin: 0 0.1em;
}

/* Equation numbering (if used) */
.MathJax .mjx-mtr {
  margin: 0.25em 0;
}

/* Better scrolling for wide equations on mobile */
@media (max-width: 768px) {
  mjx-container[display="true"] {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}
</style>

<!-- Custom styles for documentation -->
<link rel="stylesheet" href="/Documentation/style.css?v=2.0.1">
<link rel="stylesheet" href="/Documentation/assets/css/condensed.css?v=2.0.1">
<style>
  /* Widescreen optimized layout */
  body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  /* Main container - full width */
  #main {
    display: flex;
    position: relative;
    min-height: 100vh;
    width: 100%;
    max-width: 100%;
  }
  
  /* Sidebar fixed to left edge */
  .sidebar.sticky {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-right: 1px solid #e1e4e8;
    padding: 2rem 1rem;
    z-index: 100;
  }
  
  /* Sidebar navigation styling */
  .nav__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__title {
    margin: 1.5rem 0 0.5rem;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    border-bottom: 1px solid #e1e4e8;
  }
  
  .nav__items {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__items a {
    display: block;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }
  
  .nav__items a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }
  
  .nav__items a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Collapsible navigation sections */
  .nav__item--collapsible {
    margin: 0.25rem 0;
  }

  .nav__item--collapsible details {
    margin: 0;
  }

  .nav__item--collapsible summary {
    display: flex;
    align-items: center;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
    list-style: none;
  }

  .nav__item--collapsible summary::-webkit-details-marker {
    display: none;
  }

  .nav__item--collapsible summary::before {
    content: "‚ñ∏";
    display: inline-block;
    margin-right: 0.5rem;
    font-size: 0.7rem;
    transition: transform 0.2s ease;
  }

  .nav__item--collapsible details[open] > summary::before {
    transform: rotate(90deg);
  }

  .nav__item--collapsible summary:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }

  .nav__item--collapsible summary a {
    display: inline;
    padding: 0;
    border-left: none;
    font-weight: 500;
  }

  .nav__item--collapsible summary a:hover {
    background: none;
    border-left: none;
  }

  .nav__item--collapsible summary a.active {
    color: #0066cc;
    font-weight: 600;
    background: none;
    border-left: none;
  }

  /* Nested sub-items */
  .nav__subitems {
    margin: 0;
    padding: 0;
    list-style: none;
    padding-left: 1.25rem;
    border-left: 1px solid #e1e4e8;
    margin-left: 1rem;
  }

  .nav__subitems li {
    margin: 0;
  }

  .nav__subitems a {
    display: block;
    padding: 0.25rem 0.5rem;
    font-size: 0.8125rem;
    color: #555;
    text-decoration: none;
    border-left: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .nav__subitems a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.03);
    border-left-color: #0066cc;
  }

  .nav__subitems a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Content area with left margin for sidebar */
  article.page {
    margin-left: 280px;
    min-height: 100vh;
    background: white;
    width: calc(100% - 280px);
    max-width: none;
  }
  
  /* Content wrapper - use full width */
  .page__inner-wrap {
    max-width: none;
    margin: 0;
    padding: 2rem 3rem;
  }
  
  .page__title {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Let content use available width */
  .page__content {
    max-width: none;
    width: 100%;
  }
  
  /* For optimal reading, constrain just the text paragraphs */
  .page__content > p,
  .page__content > ul,
  .page__content > ol {
    max-width: 65ch;
  }
  
  /* Let code blocks, tables, and special content use full width */
  .page__content pre,
  .page__content table,
  .page__content .noteBoxes,
  .page__content figure,
  .page__content .highlight {
    max-width: 100%;
  }
  
  /* Wide note boxes */
  .noteBoxes {
    width: 90% !important;
    max-width: 800px;
  }
  
  /* Tables use available width */
  table {
    width: 100%;
    max-width: 100%;
  }
  
  /* Code blocks optimization */
  pre {
    max-width: 100%;
    overflow-x: auto;
  }
  
  .highlight {
    max-width: 100%;
    margin: 1rem 0;
  }
  
  /* Responsive adjustments */
  @media (min-width: 2000px) {
    .sidebar.sticky {
      width: 320px;
    }
    
    article.page {
      margin-left: 320px;
      width: calc(100% - 320px);
    }
    
    .page__inner-wrap {
      padding: 2rem 4rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 75ch;
    }
  }
  
  @media (min-width: 1024px) and (max-width: 1439px) {
    .sidebar.sticky {
      width: 250px;
    }
    
    article.page {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    
    .page__inner-wrap {
      padding: 2rem 2rem;
    }
  }
  
  /* Tablet and mobile */
  @media (max-width: 1023px) {
    #main {
      flex-direction: column;
    }
    
    .sidebar.sticky {
      position: relative;
      width: 100%;
      height: auto;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
      padding: 1rem;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
    
    .page__inner-wrap {
      padding: 1rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 100%;
    }
  }
  
  /* Mobile navigation toggle */
  .nav-toggle {
    display: none;
  }
  
  @media (max-width: 1023px) {
    .nav-toggle {
      display: block;
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 200;
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .sidebar.sticky {
      position: fixed;
      left: -100%;
      top: 0;
      transition: left 0.3s ease;
      z-index: 150;
      height: 100vh;
      width: 280px;
    }
    
    .sidebar.sticky.active {
      left: 0;
    }
    
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 140;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
  }
</style>

<!-- Mobile navigation toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  if (window.innerWidth <= 1023) {
    if (!document.querySelector('.nav-toggle')) {
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'nav-toggle';
      toggleBtn.innerHTML = '‚ò∞ Menu';
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
      document.body.appendChild(toggleBtn);
      
      const overlay = document.createElement('div');
      overlay.className = 'sidebar-overlay';
      document.body.appendChild(overlay);
      
      toggleBtn.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });
      
      overlay.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    }
  }
  
  // Handle window resize
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const sidebar = document.querySelector('.sidebar.sticky');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggle = document.querySelector('.nav-toggle');
      
      if (window.innerWidth > 1023) {
        if (sidebar) sidebar.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        if (toggle) toggle.style.display = 'none';
      } else {
        if (toggle) toggle.style.display = 'block';
      }
    }, 250);
  });
});
</script>


  
    <script src="/Documentation/assets/js/custom.js"></script>
  

</head>
<body>
  <div id="main" role="main">
  <aside class="sidebar sticky">
    <nav class="nav__list">
      
        
          <h3 class="nav__title">Navigation</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/topic-map.html"
                       >
                      <span class="nav__sub-title">üó∫Ô∏è Topic Map</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/search.html"
                       >
                      <span class="nav__sub-title">üîç Search</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">üìã Reference Index</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Technology</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/technology/index.html"
                       >
                      <span class="nav__sub-title">Technology Overview</span>
                    </a>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details open data-nav-section="aws">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/aws/"
                             >
                            AWS
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/compute.html"
                               >
                              Compute
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/storage.html"
                               >
                              Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/databases.html"
                               >
                              Databases
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/networking.html"
                               class="active">
                              Networking
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/security.html"
                               >
                              Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/infrastructure.html"
                               >
                              Infrastructure
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="terraform">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/terraform/"
                             >
                            Terraform
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/core-concepts.html"
                               >
                              Core Concepts
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/state-modules.html"
                               >
                              State & Modules
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/patterns.html"
                               >
                              Enterprise Patterns
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="kubernetes">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/kubernetes/"
                             >
                            Kubernetes
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/workloads.html"
                               >
                              Workloads & Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/operations.html"
                               >
                              Operations
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="docker">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/docker/"
                             >
                            Docker
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/storage-security.html"
                               >
                              Storage & Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/dockerfiles.html"
                               >
                              Dockerfiles & CI/CD
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/advanced.html"
                               >
                              Advanced Patterns
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/docker-essentials.html"
                       >
                      <span class="nav__sub-title">Docker Essentials</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git.html"
                       >
                      <span class="nav__sub-title">Git</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git-reference.html"
                       >
                      <span class="nav__sub-title">Git Command Reference</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/branching.html"
                       >
                      <span class="nav__sub-title">Branching Strategies</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/database-design.html"
                       >
                      <span class="nav__sub-title">Database Design</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/networking.html"
                       >
                      <span class="nav__sub-title">Networking</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/cybersecurity.html"
                       >
                      <span class="nav__sub-title">Cybersecurity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ci-cd.html"
                       >
                      <span class="nav__sub-title">CI/CD</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/unreal.html"
                       >
                      <span class="nav__sub-title">Unreal Engine</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-fundamentals-simple.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals (Simple)</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-lecture-2023.html"
                       >
                      <span class="nav__sub-title">AI Lecture 2023</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/please-build.html"
                       >
                      <span class="nav__sub-title">Please Build</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Specialized Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/distributed-systems/index.html"
                       >
                      <span class="nav__sub-title">Distributed Systems Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/quantum-computing/index.html"
                       >
                      <span class="nav__sub-title">Quantum Computing Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/artificial-intelligence/index.html"
                       >
                      <span class="nav__sub-title">Artificial Intelligence Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/gamedev/index.html"
                       >
                      <span class="nav__sub-title">Game Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/graphics/3d-rendering.html"
                       >
                      <span class="nav__sub-title">3D Graphics & Rendering</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/vr-ar/index.html"
                       >
                      <span class="nav__sub-title">VR/AR Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/optimization/index.html"
                       >
                      <span class="nav__sub-title">Performance Optimization</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">AI/ML - Generative AI</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/ai-ml/index.html"
                       >
                      <span class="nav__sub-title">AI/ML Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html"
                       >
                      <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/base-models-comparison.html"
                       >
                      <span class="nav__sub-title">Base Models Comparison</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/model-types.html"
                       >
                      <span class="nav__sub-title">Model Types</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/lora-training.html"
                       >
                      <span class="nav__sub-title">LoRA Training</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/controlnet.html"
                       >
                      <span class="nav__sub-title">ControlNet Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/comfyui-guide.html"
                       >
                      <span class="nav__sub-title">ComfyUI Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/output-formats.html"
                       >
                      <span class="nav__sub-title">Output Formats</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/advanced-techniques.html"
                       >
                      <span class="nav__sub-title">Advanced Techniques</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Physics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/physics/index.html"
                       >
                      <span class="nav__sub-title">Physics Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/classical-mechanics.html"
                       >
                      <span class="nav__sub-title">Classical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/thermodynamics.html"
                       >
                      <span class="nav__sub-title">Thermodynamics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/statistical-mechanics.html"
                       >
                      <span class="nav__sub-title">Statistical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/relativity.html"
                       >
                      <span class="nav__sub-title">Relativity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-mechanics.html"
                       >
                      <span class="nav__sub-title">Quantum Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/condensed-matter.html"
                       >
                      <span class="nav__sub-title">Condensed Matter Physics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-field-theory.html"
                       >
                      <span class="nav__sub-title">Quantum Field Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/string-theory.html"
                       >
                      <span class="nav__sub-title">String Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/computational-physics.html"
                       >
                      <span class="nav__sub-title">Computational Physics</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Advanced Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/advanced/index.html"
                       >
                      <span class="nav__sub-title">Research Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/ai-mathematics/"
                       >
                      <span class="nav__sub-title">AI Mathematics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/distributed-systems-theory/"
                       >
                      <span class="nav__sub-title">Distributed Systems Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/quantum-algorithms-research/"
                       >
                      <span class="nav__sub-title">Quantum Algorithms Research</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/monorepo/"
                       >
                      <span class="nav__sub-title">Monorepo Architecture</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Quick Reference</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">Reference Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#command-line-references"
                       >
                      <span class="nav__sub-title">Command Cheat Sheets</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#physics-formulas--constants"
                       >
                      <span class="nav__sub-title">Physics Formulas</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#algorithms--data-structures"
                       >
                      <span class="nav__sub-title">Algorithms & Big O</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#api-reference-patterns"
                       >
                      <span class="nav__sub-title">API Patterns</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#troubleshooting-flowcharts"
                       >
                      <span class="nav__sub-title">Troubleshooting</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#best-practices-checklists"
                       >
                      <span class="nav__sub-title">Best Practices</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
      
    </nav>
  </aside>

  <article class="page">
    <div class="page__inner-wrap">
      <header>
        <h1 id="page-title" class="page__title">AWS Networking & Content Delivery</h1>
      </header>

      <section class="page__content">
        <h1 id="aws-networking--content-delivery">AWS Networking &amp; Content Delivery</h1>

<p>This guide covers VPC networking, CloudFront CDN, API Gateway, and load balancing. Learn how to build secure, high-performance network architectures on AWS.</p>

<h2 id="vpc---your-private-cloud-network">VPC - Your Private Cloud Network</h2>

<p>VPC (Virtual Private Cloud) lets you create isolated networks in AWS. Think of it as your own private data center in the cloud, complete with subnets, routing rules, and security controls.</p>

<h3 id="key-vpc-concepts">Key VPC Concepts</h3>

<ol>
  <li><strong>Subnets</strong>: Subdivide your VPC into public and private segments</li>
  <li><strong>Internet Gateway</strong>: Allows public internet access</li>
  <li><strong>NAT Gateway</strong>: Enables private instances to reach the internet</li>
  <li><strong>Security Groups</strong>: Virtual firewalls for instances</li>
  <li><strong>Network ACLs</strong>: Stateless subnet-level firewalls</li>
  <li><strong>Route Tables</strong>: Control traffic routing</li>
</ol>

<h3 id="multi-az-architecture">Multi-AZ Architecture</h3>

<p>Spread resources across Availability Zones for resilience:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPC (10.0.0.0/16)
‚îú‚îÄ‚îÄ Public Subnet AZ-A (10.0.1.0/24)
‚îÇ   ‚îú‚îÄ‚îÄ NAT Gateway
‚îÇ   ‚îî‚îÄ‚îÄ Load Balancer
‚îú‚îÄ‚îÄ Public Subnet AZ-B (10.0.2.0/24)
‚îÇ   ‚îú‚îÄ‚îÄ NAT Gateway  
‚îÇ   ‚îî‚îÄ‚îÄ Load Balancer
‚îú‚îÄ‚îÄ Private Subnet AZ-A (10.0.10.0/24)
‚îÇ   ‚îî‚îÄ‚îÄ Application Servers
‚îú‚îÄ‚îÄ Private Subnet AZ-B (10.0.20.0/24)
‚îÇ   ‚îî‚îÄ‚îÄ Application Servers
‚îú‚îÄ‚îÄ Data Subnet AZ-A (10.0.100.0/24)
‚îÇ   ‚îî‚îÄ‚îÄ RDS Primary
‚îî‚îÄ‚îÄ Data Subnet AZ-B (10.0.200.0/24)
    ‚îî‚îÄ‚îÄ RDS Standby
</code></pre></div></div>

<h3 id="networking-connecting-your-application">Networking: Connecting Your Application</h3>

<h4 id="amazon-vpc---your-private-cloud-network">Amazon VPC - Your Private Cloud Network</h4>
<p>VPC (Virtual Private Cloud) lets you create isolated networks in AWS. Think of it as your own private data center in the cloud, complete with subnets, routing rules, and security controls.</p>

<p>This is where things get more complex, but understanding VPC is crucial for production applications. Let‚Äôs build up gradually:</p>

<ol>
  <li><strong>Basic VPC</strong>: A simple network with public and private subnets</li>
  <li><strong>Internet Access</strong>: Add an Internet Gateway for public-facing resources</li>
  <li><strong>Security Groups</strong>: Virtual firewalls controlling traffic to your resources</li>
  <li><strong>Multi-AZ Design</strong>: Spread resources across Availability Zones for resilience</li>
</ol>

<p><strong>Real-world example</strong>: An enterprise application runs web servers in public subnets (accessible from internet) and databases in private subnets (only accessible from web servers). This layered security approach protects sensitive data while serving public traffic.</p>

<h3 id="api-gateway-advanced-patterns">API Gateway Advanced Patterns</h3>

<h4 id="rest-api-with-request-validation">REST API with Request Validation</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># api-gateway.tf - Advanced API Gateway with request validation</span>

<span class="c1"># REST API</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_rest_api"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>        <span class="o">=</span> <span class="s2">"${var.environment}-advanced-api"</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"Advanced REST API with validation and security"</span>
  
  <span class="nx">endpoint_configuration</span> <span class="p">{</span>
    <span class="nx">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"REGIONAL"</span><span class="p">]</span>
  <span class="p">}</span>
  
  <span class="c1"># API Policy for resource limits</span>
  <span class="nx">policy</span> <span class="o">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
    <span class="nx">Version</span> <span class="o">=</span> <span class="s2">"2012-10-17"</span>
    <span class="nx">Statement</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nx">Effect</span> <span class="o">=</span> <span class="s2">"Allow"</span>
        <span class="nx">Principal</span> <span class="o">=</span> <span class="s2">"*"</span>
        <span class="nx">Action</span> <span class="o">=</span> <span class="s2">"execute-api:Invoke"</span>
        <span class="nx">Resource</span> <span class="o">=</span> <span class="s2">"*"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="nx">Effect</span> <span class="o">=</span> <span class="s2">"Deny"</span>
        <span class="nx">Principal</span> <span class="o">=</span> <span class="s2">"*"</span>
        <span class="nx">Action</span> <span class="o">=</span> <span class="s2">"execute-api:Invoke"</span>
        <span class="nx">Resource</span> <span class="o">=</span> <span class="s2">"*"</span>
        <span class="nx">Condition</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">IpAddressNotEquals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"aws:SourceIp"</span> <span class="p">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">allowed_ip_ranges</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># Request validator</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_request_validator"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                        <span class="o">=</span> <span class="s2">"${var.environment}-validator"</span>
  <span class="nx">rest_api_id</span>                 <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">validate_request_body</span>       <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">validate_request_parameters</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="c1"># API Models for request/response validation</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_model"</span> <span class="s2">"user"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span>  <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">name</span>         <span class="o">=</span> <span class="s2">"User"</span>
  <span class="nx">content_type</span> <span class="o">=</span> <span class="s2">"application/json"</span>
  
  <span class="nx">schema</span> <span class="o">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
    <span class="s2">"$schema"</span> <span class="p">=</span> <span class="s2">"http://json-schema.org/draft-04/schema#"</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="s2">"object"</span>
    <span class="nx">required</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"email"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">]</span>
    <span class="nx">properties</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">email</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
        <span class="nx">format</span> <span class="o">=</span> <span class="s2">"email"</span>
        <span class="nx">pattern</span> <span class="o">=</span> <span class="s2">"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+</span><span class="err">\\</span><span class="s2">.[a-zA-Z]{2,}$"</span>
      <span class="p">}</span>
      <span class="nx">name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
        <span class="nx">minLength</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="nx">maxLength</span> <span class="o">=</span> <span class="mi">100</span>
      <span class="p">}</span>
      <span class="nx">age</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"integer"</span>
        <span class="nx">minimum</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="nx">maximum</span> <span class="o">=</span> <span class="mi">150</span>
      <span class="p">}</span>
      <span class="nx">preferences</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"object"</span>
        <span class="nx">properties</span> <span class="o">=</span> <span class="p">{</span>
          <span class="nx">notifications</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="s2">"boolean"</span>
          <span class="p">}</span>
          <span class="nx">theme</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
            <span class="nx">enum</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"light"</span><span class="p">,</span> <span class="s2">"dark"</span><span class="p">,</span> <span class="s2">"auto"</span><span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_model"</span> <span class="s2">"error"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span>  <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">name</span>         <span class="o">=</span> <span class="s2">"Error"</span>
  <span class="nx">content_type</span> <span class="o">=</span> <span class="s2">"application/json"</span>
  
  <span class="nx">schema</span> <span class="o">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
    <span class="s2">"$schema"</span> <span class="p">=</span> <span class="s2">"http://json-schema.org/draft-04/schema#"</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="s2">"object"</span>
    <span class="nx">required</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"message"</span><span class="p">]</span>
    <span class="nx">properties</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
      <span class="p">}</span>
      <span class="nx">code</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
      <span class="p">}</span>
      <span class="nx">requestId</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="s2">"string"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1"># API Resources</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_resource"</span> <span class="s2">"v1"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">parent_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">root_resource_id</span>
  <span class="nx">path_part</span>   <span class="o">=</span> <span class="s2">"v1"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_resource"</span> <span class="s2">"users"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">parent_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">v1</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">path_part</span>   <span class="o">=</span> <span class="s2">"users"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_resource"</span> <span class="s2">"user"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">parent_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">path_part</span>   <span class="o">=</span> <span class="s2">"{userId}"</span>
<span class="p">}</span>

<span class="c1"># OPTIONS method for CORS</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method"</span> <span class="s2">"users_options"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span>   <span class="o">=</span> <span class="s2">"OPTIONS"</span>
  <span class="nx">authorization</span> <span class="o">=</span> <span class="s2">"NONE"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_integration"</span> <span class="s2">"users_options"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">users_options</span><span class="p">.</span><span class="nx">http_method</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="s2">"MOCK"</span>
  
  <span class="nx">request_templates</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="s2">"{</span><span class="se">\"</span><span class="s2">statusCode</span><span class="se">\"</span><span class="s2">: 200}"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method_response"</span> <span class="s2">"users_options"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">users_options</span><span class="p">.</span><span class="nx">http_method</span>
  <span class="nx">status_code</span> <span class="o">=</span> <span class="s2">"200"</span>
  
  <span class="nx">response_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Headers"</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Methods"</span> <span class="p">=</span> <span class="kc">true</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Origin"</span>  <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="nx">response_models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="s2">"Empty"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_integration_response"</span> <span class="s2">"users_options"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">users_options</span><span class="p">.</span><span class="nx">http_method</span>
  <span class="nx">status_code</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method_response</span><span class="p">.</span><span class="nx">users_options</span><span class="p">.</span><span class="nx">status_code</span>
  
  <span class="nx">response_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Headers"</span> <span class="p">=</span> <span class="s2">"'Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token'"</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Methods"</span> <span class="p">=</span> <span class="s2">"'GET,OPTIONS,POST,PUT,DELETE'"</span>
    <span class="s2">"method.response.header.Access-Control-Allow-Origin"</span>  <span class="p">=</span> <span class="s2">"'*'"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># POST method with validation</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method"</span> <span class="s2">"create_user"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span>          <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span>          <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span>          <span class="o">=</span> <span class="s2">"POST"</span>
  <span class="nx">authorization</span>        <span class="o">=</span> <span class="s2">"CUSTOM"</span>
  <span class="nx">authorizer_id</span>        <span class="o">=</span> <span class="nx">aws_api_gateway_authorizer</span><span class="p">.</span><span class="nx">jwt</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">request_validator_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_request_validator</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  
  <span class="nx">request_models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="nx">aws_api_gateway_model</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">}</span>
  
  <span class="nx">request_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"method.request.header.X-Correlation-ID"</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Lambda integration</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_integration"</span> <span class="s2">"create_user"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">http_method</span>
  
  <span class="nx">integration_http_method</span> <span class="o">=</span> <span class="s2">"POST"</span>
  <span class="nx">type</span>                    <span class="o">=</span> <span class="s2">"AWS_PROXY"</span>
  <span class="nx">uri</span>                     <span class="o">=</span> <span class="nx">aws_lambda_function</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">invoke_arn</span>
  
  <span class="nx">timeout_milliseconds</span> <span class="o">=</span> <span class="mi">29000</span>
  
  <span class="nx">request_templates</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
      <span class="nx">statusCode</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="p">})</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Method responses</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method_response"</span> <span class="s2">"create_user_200"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">http_method</span>
  <span class="nx">status_code</span> <span class="o">=</span> <span class="s2">"200"</span>
  
  <span class="nx">response_models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="nx">aws_api_gateway_model</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">}</span>
  
  <span class="nx">response_parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"method.response.header.X-Correlation-ID"</span> <span class="p">=</span> <span class="kc">true</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method_response"</span> <span class="s2">"create_user_400"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">resource_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">http_method</span> <span class="o">=</span> <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">http_method</span>
  <span class="nx">status_code</span> <span class="o">=</span> <span class="s2">"400"</span>
  
  <span class="nx">response_models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"application/json"</span> <span class="p">=</span> <span class="nx">aws_api_gateway_model</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">name</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Custom authorizer</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_authorizer"</span> <span class="s2">"jwt"</span> <span class="p">{</span>
  <span class="nx">name</span>                   <span class="o">=</span> <span class="s2">"${var.environment}-jwt-authorizer"</span>
  <span class="nx">rest_api_id</span>            <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">type</span>                   <span class="o">=</span> <span class="s2">"TOKEN"</span>
  <span class="nx">authorizer_uri</span>         <span class="o">=</span> <span class="nx">aws_lambda_function</span><span class="p">.</span><span class="nx">authorizer</span><span class="p">.</span><span class="nx">invoke_arn</span>
  <span class="nx">authorizer_credentials</span> <span class="o">=</span> <span class="nx">aws_iam_role</span><span class="p">.</span><span class="nx">api_gateway_authorizer</span><span class="p">.</span><span class="nx">arn</span>
  <span class="nx">identity_source</span>        <span class="o">=</span> <span class="s2">"method.request.header.Authorization"</span>
  
  <span class="c1"># Cache auth results</span>
  <span class="nx">authorizer_result_ttl_in_seconds</span> <span class="o">=</span> <span class="mi">300</span>
<span class="p">}</span>

<span class="c1"># Lambda authorizer function</span>
<span class="nx">resource</span> <span class="s2">"aws_lambda_function"</span> <span class="s2">"authorizer"</span> <span class="p">{</span>
  <span class="nx">filename</span>         <span class="o">=</span> <span class="s2">"authorizer.zip"</span>
  <span class="nx">function_name</span>    <span class="o">=</span> <span class="s2">"${var.environment}-api-authorizer"</span>
  <span class="nx">role</span>            <span class="o">=</span> <span class="nx">aws_iam_role</span><span class="p">.</span><span class="nx">lambda_authorizer</span><span class="p">.</span><span class="nx">arn</span>
  <span class="nx">handler</span>         <span class="o">=</span> <span class="s2">"index.handler"</span>
  <span class="nx">runtime</span>         <span class="o">=</span> <span class="s2">"python3.9"</span>
  <span class="nx">timeout</span>         <span class="o">=</span> <span class="mi">5</span>
  <span class="nx">memory_size</span>     <span class="o">=</span> <span class="mi">256</span>
  
  <span class="nx">environment</span> <span class="p">{</span>
    <span class="nx">variables</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">JWT_SECRET</span>        <span class="o">=</span> <span class="nx">aws_secretsmanager_secret_version</span><span class="p">.</span><span class="nx">jwt_secret</span><span class="p">.</span><span class="nx">secret_string</span>
      <span class="nx">ENVIRONMENT</span>       <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
      <span class="nx">USER_POOL_ID</span>      <span class="o">=</span> <span class="nx">aws_cognito_user_pool</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
      <span class="nx">TOKEN_USE</span>         <span class="o">=</span> <span class="s2">"access"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># API deployment</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_deployment"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  
  <span class="nx">triggers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">redeployment</span> <span class="o">=</span> <span class="nx">sha1</span><span class="p">(</span><span class="nx">jsonencode</span><span class="p">([</span>
      <span class="nx">aws_api_gateway_resource</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
      <span class="nx">aws_api_gateway_integration</span><span class="p">.</span><span class="nx">create_user</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
    <span class="p">]))</span>
  <span class="p">}</span>
  
  <span class="nx">lifecycle</span> <span class="p">{</span>
    <span class="nx">create_before_destroy</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="nx">depends_on</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">aws_api_gateway_method</span><span class="p">.</span><span class="nx">create_user</span><span class="p">,</span>
    <span class="nx">aws_api_gateway_integration</span><span class="p">.</span><span class="nx">create_user</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># API stages</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_stage"</span> <span class="s2">"prod"</span> <span class="p">{</span>
  <span class="nx">deployment_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_deployment</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">rest_api_id</span>   <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">stage_name</span>    <span class="o">=</span> <span class="s2">"prod"</span>
  
  <span class="c1"># Enable logging</span>
  <span class="nx">access_log_settings</span> <span class="p">{</span>
    <span class="nx">destination_arn</span> <span class="o">=</span> <span class="nx">aws_cloudwatch_log_group</span><span class="p">.</span><span class="nx">api_gateway</span><span class="p">.</span><span class="nx">arn</span>
    <span class="nx">format</span> <span class="o">=</span> <span class="nx">jsonencode</span><span class="p">({</span>
      <span class="nx">requestId</span>               <span class="o">=</span> <span class="s2">"$context.requestId"</span>
      <span class="nx">extendedRequestId</span>       <span class="o">=</span> <span class="s2">"$context.extendedRequestId"</span>
      <span class="nx">ip</span>                      <span class="o">=</span> <span class="s2">"$context.identity.sourceIp"</span>
      <span class="nx">caller</span>                  <span class="o">=</span> <span class="s2">"$context.identity.caller"</span>
      <span class="nx">user</span>                    <span class="o">=</span> <span class="s2">"$context.identity.user"</span>
      <span class="nx">requestTime</span>             <span class="o">=</span> <span class="s2">"$context.requestTime"</span>
      <span class="nx">httpMethod</span>              <span class="o">=</span> <span class="s2">"$context.httpMethod"</span>
      <span class="nx">resourcePath</span>            <span class="o">=</span> <span class="s2">"$context.resourcePath"</span>
      <span class="nx">status</span>                  <span class="o">=</span> <span class="s2">"$context.status"</span>
      <span class="nx">protocol</span>                <span class="o">=</span> <span class="s2">"$context.protocol"</span>
      <span class="nx">responseLength</span>          <span class="o">=</span> <span class="s2">"$context.responseLength"</span>
      <span class="nx">error</span>                   <span class="o">=</span> <span class="s2">"$context.error.message"</span>
      <span class="nx">integrationLatency</span>      <span class="o">=</span> <span class="s2">"$context.integration.latency"</span>
      <span class="nx">integrationStatus</span>       <span class="o">=</span> <span class="s2">"$context.integration.status"</span>
      <span class="nx">integrationErrorMessage</span> <span class="o">=</span> <span class="s2">"$context.integrationErrorMessage"</span>
      <span class="nx">authorizerError</span>         <span class="o">=</span> <span class="s2">"$context.authorizer.error"</span>
    <span class="err">})</span>
  <span class="err">}</span>
  
  <span class="c1"># Caching</span>
  <span class="nx">cache_cluster_enabled</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">cache_cluster_size</span>    <span class="o">=</span> <span class="s2">"0.5"</span>
  
  <span class="c1"># Throttling</span>
  <span class="nx">throttle_burst_limit</span> <span class="o">=</span> <span class="mi">5000</span>
  <span class="nx">throttle_rate_limit</span>  <span class="o">=</span> <span class="mi">10000</span>
  
  <span class="c1"># X-Ray tracing</span>
  <span class="nx">xray_tracing_enabled</span> <span class="o">=</span> <span class="kc">true</span>
  
  <span class="nx">variables</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">deployed_at</span> <span class="o">=</span> <span class="nx">timestamp</span><span class="p">()</span>
  <span class="p">}</span>
<span class="err">}</span>

<span class="c1"># Method settings for all methods</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_method_settings"</span> <span class="s2">"all"</span> <span class="p">{</span>
  <span class="nx">rest_api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">stage_name</span>  <span class="o">=</span> <span class="nx">aws_api_gateway_stage</span><span class="p">.</span><span class="nx">prod</span><span class="p">.</span><span class="nx">stage_name</span>
  <span class="nx">method_path</span> <span class="o">=</span> <span class="s2">"*/*"</span>
  
  <span class="nx">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">metrics_enabled</span>        <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">logging_level</span>          <span class="o">=</span> <span class="s2">"INFO"</span>
    <span class="nx">data_trace_enabled</span>     <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">throttling_burst_limit</span> <span class="o">=</span> <span class="mi">2000</span>
    <span class="nx">throttling_rate_limit</span>  <span class="o">=</span> <span class="mi">1000</span>
    <span class="nx">caching_enabled</span>        <span class="o">=</span> <span class="kc">false</span>
  <span class="err">}</span>
<span class="p">}</span>

<span class="c1"># API key and usage plan</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_api_key"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s2">"${var.environment}-api-key"</span>
  
  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Environment</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_usage_plan"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>         <span class="o">=</span> <span class="s2">"${var.environment}-usage-plan"</span>
  <span class="nx">description</span>  <span class="o">=</span> <span class="s2">"Usage plan for API clients"</span>
  
  <span class="nx">api_stages</span> <span class="p">{</span>
    <span class="nx">api_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">stage</span>  <span class="o">=</span> <span class="nx">aws_api_gateway_stage</span><span class="p">.</span><span class="nx">prod</span><span class="p">.</span><span class="nx">stage_name</span>
  <span class="p">}</span>
  
  <span class="nx">quota_settings</span> <span class="p">{</span>
    <span class="nx">limit</span>  <span class="o">=</span> <span class="mi">10000</span>
    <span class="nx">period</span> <span class="o">=</span> <span class="s2">"DAY"</span>
  <span class="p">}</span>
  
  <span class="nx">throttle_settings</span> <span class="p">{</span>
    <span class="nx">rate_limit</span>  <span class="o">=</span> <span class="mi">500</span>
    <span class="nx">burst_limit</span> <span class="o">=</span> <span class="mi">1000</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_usage_plan_key"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">key_id</span>        <span class="o">=</span> <span class="nx">aws_api_gateway_api_key</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">key_type</span>      <span class="o">=</span> <span class="s2">"API_KEY"</span>
  <span class="nx">usage_plan_id</span> <span class="o">=</span> <span class="nx">aws_api_gateway_usage_plan</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
<span class="p">}</span>

<span class="c1"># Custom domain</span>
<span class="nx">resource</span> <span class="s2">"aws_api_gateway_domain_name"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">domain_name</span>              <span class="o">=</span> <span class="s2">"api.${var.domain_name}"</span>
  <span class="nx">regional_certificate_arn</span> <span class="o">=</span> <span class="nx">aws_acm_certificate_validation</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">certificate_arn</span>
  
  <span class="nx">endpoint_configuration</span> <span class="p">{</span>
    <span class="nx">types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"REGIONAL"</span><span class="p">]</span>
  <span class="p">}</span>
  
  <span class="nx">security_policy</span> <span class="o">=</span> <span class="s2">"TLS_1_2"</span>
  
  <span class="nx">mutual_tls_authentication</span> <span class="p">{</span>
    <span class="nx">truststore_uri</span> <span class="o">=</span> <span class="s2">"s3://${aws_s3_bucket.truststore.bucket}/truststore.pem"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_api_gateway_base_path_mapping"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">api_id</span>      <span class="o">=</span> <span class="nx">aws_api_gateway_rest_api</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="nx">stage_name</span>  <span class="o">=</span> <span class="nx">aws_api_gateway_stage</span><span class="p">.</span><span class="nx">prod</span><span class="p">.</span><span class="nx">stage_name</span>
  <span class="nx">domain_name</span> <span class="o">=</span> <span class="nx">aws_api_gateway_domain_name</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">domain_name</span>
  <span class="nx">base_path</span>   <span class="o">=</span> <span class="s2">"v1"</span>
<span class="p">}</span>

<span class="c1"># WAF for API Gateway</span>
<span class="nx">resource</span> <span class="s2">"aws_wafv2_web_acl_association"</span> <span class="s2">"api_gateway"</span> <span class="p">{</span>
  <span class="nx">resource_arn</span> <span class="o">=</span> <span class="nx">aws_api_gateway_stage</span><span class="p">.</span><span class="nx">prod</span><span class="p">.</span><span class="nx">arn</span>
  <span class="nx">web_acl_arn</span>  <span class="o">=</span> <span class="nx">aws_wafv2_web_acl</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">arn</span>
<span class="p">}</span>
</code></pre></div></div>
<h2 id="performance-at-scale-making-applications-fast">Performance at Scale: Making Applications Fast</h2>

<p>Performance isn‚Äôt just about speed - it‚Äôs about delivering consistent experiences whether you have 10 or 10 million users. AWS provides tools to optimize every layer of your application.</p>

<h3 id="the-performance-journey">The Performance Journey</h3>

<p>Most applications follow a predictable performance evolution:</p>

<ol>
  <li><strong>Single Region, Basic Setup</strong>: Works fine for hundreds of users</li>
  <li><strong>Caching Added</strong>: Handles thousands without breaking a sweat</li>
  <li><strong>Multi-Region Deployment</strong>: Serves millions with low latency globally</li>
  <li><strong>Edge Optimization</strong>: Delivers content in milliseconds worldwide</li>
</ol>

<p>Let‚Äôs explore each optimization technique and when to apply it.</p>

<h3 id="cloudfront-your-global-accelerator">CloudFront: Your Global Accelerator</h3>

<p>CloudFront is AWS‚Äôs content delivery network (CDN). Instead of users fetching data from your servers in Virginia, CloudFront caches content at 400+ edge locations worldwide. Users get data from the nearest location, reducing latency from seconds to milliseconds.</p>

<p><strong>When to Use CloudFront:</strong></p>
<ul>
  <li>Static assets (images, CSS, JavaScript) - immediate 10x performance boost</li>
  <li>API responses that don‚Äôt change frequently</li>
  <li>Video streaming - adaptive bitrate based on user connection</li>
  <li>Global applications - consistent performance worldwide</li>
</ul>

<p><strong>Real-world impact</strong>: A news website serving images from S3 in US-East to users in Australia saw 2-second load times. After adding CloudFront, Australian users get 200ms load times from the Sydney edge location.</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cloudfront.tf - CloudFront distribution with Lambda@Edge</span>

<span class="c1"># S3 bucket for static content</span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"static_content"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"${var.environment}-static-content-${data.aws_caller_identity.current.account_id}"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_s3_bucket_versioning"</span> <span class="s2">"static_content"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">static_content</span><span class="p">.</span><span class="nx">id</span>
  
  <span class="nx">versioning_configuration</span> <span class="p">{</span>
    <span class="nx">status</span> <span class="o">=</span> <span class="s2">"Enabled"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_s3_bucket_server_side_encryption_configuration"</span> <span class="s2">"static_content"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">static_content</span><span class="p">.</span><span class="nx">id</span>
  
  <span class="nx">rule</span> <span class="p">{</span>
    <span class="nx">apply_server_side_encryption_by_default</span> <span class="p">{</span>
      <span class="nx">sse_algorithm</span>     <span class="o">=</span> <span class="s2">"aws:kms"</span>
      <span class="nx">kms_master_key_id</span> <span class="o">=</span> <span class="nx">aws_kms_key</span><span class="p">.</span><span class="nx">s3</span><span class="p">.</span><span class="nx">id</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># CloudFront Origin Access Control</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_origin_access_control"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span>                              <span class="o">=</span> <span class="s2">"${var.environment}-oac"</span>
  <span class="nx">description</span>                       <span class="o">=</span> <span class="s2">"Origin Access Control for S3"</span>
  <span class="nx">origin_access_control_origin_type</span> <span class="o">=</span> <span class="s2">"s3"</span>
  <span class="nx">signing_behavior</span>                  <span class="o">=</span> <span class="s2">"always"</span>
  <span class="nx">signing_protocol</span>                  <span class="o">=</span> <span class="s2">"sigv4"</span>
<span class="p">}</span>

<span class="c1"># Lambda@Edge functions</span>
<span class="nx">data</span> <span class="s2">"archive_file"</span> <span class="s2">"lambda_edge_viewer_request"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="s2">"zip"</span>
  <span class="nx">source_file</span> <span class="o">=</span> <span class="s2">"lambda-edge/viewer-request.js"</span>
  <span class="nx">output_path</span> <span class="o">=</span> <span class="s2">"lambda-edge-viewer-request.zip"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_lambda_function"</span> <span class="s2">"edge_viewer_request"</span> <span class="p">{</span>
  <span class="nx">provider</span>         <span class="o">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">us_east_1</span>  <span class="c1"># Lambda@Edge must be in us-east-1</span>
  <span class="nx">filename</span>         <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">archive_file</span><span class="p">.</span><span class="nx">lambda_edge_viewer_request</span><span class="p">.</span><span class="nx">output_path</span>
  <span class="nx">function_name</span>    <span class="o">=</span> <span class="s2">"${var.environment}-edge-viewer-request"</span>
  <span class="nx">role</span>            <span class="o">=</span> <span class="nx">aws_iam_role</span><span class="p">.</span><span class="nx">lambda_edge</span><span class="p">.</span><span class="nx">arn</span>
  <span class="nx">handler</span>         <span class="o">=</span> <span class="s2">"viewer-request.handler"</span>
  <span class="nx">runtime</span>         <span class="o">=</span> <span class="s2">"nodejs18.x"</span>
  <span class="nx">timeout</span>         <span class="o">=</span> <span class="mi">5</span>
  <span class="nx">memory_size</span>     <span class="o">=</span> <span class="mi">128</span>
  <span class="nx">publish</span>         <span class="o">=</span> <span class="kc">true</span>
  
  <span class="nx">source_code_hash</span> <span class="o">=</span> <span class="nx">data</span><span class="err">.</span><span class="nx">archive_file</span><span class="p">.</span><span class="nx">lambda_edge_viewer_request</span><span class="p">.</span><span class="nx">output_base64sha256</span>
<span class="p">}</span>

<span class="nx">data</span> <span class="s2">"archive_file"</span> <span class="s2">"lambda_edge_origin_response"</span> <span class="p">{</span>
  <span class="nx">type</span>        <span class="o">=</span> <span class="s2">"zip"</span>
  <span class="nx">source_file</span> <span class="o">=</span> <span class="s2">"lambda-edge/origin-response.js"</span>
  <span class="nx">output_path</span> <span class="o">=</span> <span class="s2">"lambda-edge-origin-response.zip"</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_lambda_function"</span> <span class="s2">"edge_origin_response"</span> <span class="p">{</span>
  <span class="nx">provider</span>         <span class="o">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">us_east_1</span>
  <span class="nx">filename</span>         <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">archive_file</span><span class="p">.</span><span class="nx">lambda_edge_origin_response</span><span class="p">.</span><span class="nx">output_path</span>
  <span class="nx">function_name</span>    <span class="o">=</span> <span class="s2">"${var.environment}-edge-origin-response"</span>
  <span class="nx">role</span>            <span class="o">=</span> <span class="nx">aws_iam_role</span><span class="p">.</span><span class="nx">lambda_edge</span><span class="p">.</span><span class="nx">arn</span>
  <span class="nx">handler</span>         <span class="o">=</span> <span class="s2">"origin-response.handler"</span>
  <span class="nx">runtime</span>         <span class="o">=</span> <span class="s2">"nodejs18.x"</span>
  <span class="nx">timeout</span>         <span class="o">=</span> <span class="mi">5</span>
  <span class="nx">memory_size</span>     <span class="o">=</span> <span class="mi">128</span>
  <span class="nx">publish</span>         <span class="o">=</span> <span class="kc">true</span>
  
  <span class="nx">source_code_hash</span> <span class="o">=</span> <span class="nx">data</span><span class="err">.</span><span class="nx">archive_file</span><span class="p">.</span><span class="nx">lambda_edge_origin_response</span><span class="p">.</span><span class="nx">output_base64sha256</span>
<span class="p">}</span>

<span class="c1"># CloudFront Distribution</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_distribution"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">enabled</span>             <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">is_ipv6_enabled</span>     <span class="o">=</span> <span class="kc">true</span>
  <span class="nx">comment</span>             <span class="o">=</span> <span class="s2">"${var.environment} CloudFront distribution"</span>
  <span class="nx">default_root_object</span> <span class="o">=</span> <span class="s2">"index.html"</span>
  <span class="nx">aliases</span>             <span class="o">=</span> <span class="p">[</span><span class="nx">var</span><span class="p">.</span><span class="nx">domain_name</span><span class="p">,</span> <span class="s2">"www.${var.domain_name}"</span><span class="p">]</span>
  <span class="nx">price_class</span>         <span class="o">=</span> <span class="s2">"PriceClass_200"</span>  <span class="c1"># US, Canada, Europe, Asia</span>
  
  <span class="c1"># S3 origin</span>
  <span class="nx">origin</span> <span class="p">{</span>
    <span class="nx">domain_name</span>              <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">static_content</span><span class="p">.</span><span class="nx">bucket_regional_domain_name</span>
    <span class="nx">origin_access_control_id</span> <span class="o">=</span> <span class="nx">aws_cloudfront_origin_access_control</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">origin_id</span>                <span class="o">=</span> <span class="s2">"S3-${aws_s3_bucket.static_content.id}"</span>
    
    <span class="nx">origin_shield</span> <span class="p">{</span>
      <span class="nx">enabled</span>              <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">origin_shield_region</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">aws_region</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1"># ALB origin for dynamic content</span>
  <span class="nx">origin</span> <span class="p">{</span>
    <span class="nx">domain_name</span> <span class="o">=</span> <span class="nx">aws_lb</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">dns_name</span>
    <span class="nx">origin_id</span>   <span class="o">=</span> <span class="s2">"ALB-${aws_lb.main.id}"</span>
    
    <span class="nx">custom_origin_config</span> <span class="p">{</span>
      <span class="nx">http_port</span>              <span class="o">=</span> <span class="mi">80</span>
      <span class="nx">https_port</span>             <span class="o">=</span> <span class="mi">443</span>
      <span class="nx">origin_protocol_policy</span> <span class="o">=</span> <span class="s2">"https-only"</span>
      <span class="nx">origin_ssl_protocols</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"TLSv1.2"</span><span class="p">]</span>
      
      <span class="nx">origin_keepalive_timeout</span> <span class="o">=</span> <span class="mi">60</span>
      <span class="nx">origin_read_timeout</span>      <span class="o">=</span> <span class="mi">60</span>
    <span class="p">}</span>
    
    <span class="nx">custom_header</span> <span class="p">{</span>
      <span class="nx">name</span>  <span class="o">=</span> <span class="s2">"X-Origin-Verify"</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">random_password</span><span class="p">.</span><span class="nx">origin_verify</span><span class="p">.</span><span class="nx">result</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1"># Origin group for failover</span>
  <span class="nx">origin_group</span> <span class="p">{</span>
    <span class="nx">origin_id</span> <span class="o">=</span> <span class="s2">"origin-group-1"</span>
    
    <span class="nx">failover_criteria</span> <span class="p">{</span>
      <span class="nx">status_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">502</span><span class="p">,</span> <span class="mi">503</span><span class="p">,</span> <span class="mi">504</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">member</span> <span class="p">{</span>
      <span class="nx">origin_id</span> <span class="o">=</span> <span class="s2">"ALB-${aws_lb.main.id}"</span>
    <span class="p">}</span>
    
    <span class="nx">member</span> <span class="p">{</span>
      <span class="nx">origin_id</span> <span class="o">=</span> <span class="s2">"ALB-${aws_lb.secondary.id}"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="c1"># Default cache behavior</span>
  <span class="nx">default_cache_behavior</span> <span class="p">{</span>
    <span class="nx">allowed_methods</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">"DELETE"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">,</span> <span class="s2">"PATCH"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"PUT"</span><span class="p">]</span>
    <span class="nx">cached_methods</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">]</span>
    <span class="nx">target_origin_id</span> <span class="o">=</span> <span class="s2">"S3-${aws_s3_bucket.static_content.id}"</span>
    
    <span class="nx">forwarded_values</span> <span class="p">{</span>
      <span class="nx">query_string</span> <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">headers</span>      <span class="o">=</span> <span class="p">[</span><span class="s2">"Origin"</span><span class="p">,</span> <span class="s2">"Access-Control-Request-Method"</span><span class="p">,</span> <span class="s2">"Access-Control-Request-Headers"</span><span class="p">]</span>
      
      <span class="nx">cookies</span> <span class="p">{</span>
        <span class="nx">forward</span> <span class="o">=</span> <span class="s2">"none"</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">viewer_protocol_policy</span> <span class="o">=</span> <span class="s2">"redirect-to-https"</span>
    <span class="nx">min_ttl</span>                <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">default_ttl</span>            <span class="o">=</span> <span class="mi">86400</span>
    <span class="nx">max_ttl</span>                <span class="o">=</span> <span class="mi">31536000</span>
    <span class="nx">compress</span>               <span class="o">=</span> <span class="kc">true</span>
    
    <span class="c1"># Lambda@Edge associations</span>
    <span class="nx">lambda_function_association</span> <span class="p">{</span>
      <span class="nx">event_type</span>   <span class="o">=</span> <span class="s2">"viewer-request"</span>
      <span class="nx">lambda_arn</span>   <span class="o">=</span> <span class="nx">aws_lambda_function</span><span class="p">.</span><span class="nx">edge_viewer_request</span><span class="p">.</span><span class="nx">qualified_arn</span>
      <span class="nx">include_body</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    
    <span class="nx">lambda_function_association</span> <span class="p">{</span>
      <span class="nx">event_type</span>   <span class="o">=</span> <span class="s2">"origin-response"</span>
      <span class="nx">lambda_arn</span>   <span class="o">=</span> <span class="nx">aws_lambda_function</span><span class="p">.</span><span class="nx">edge_origin_response</span><span class="p">.</span><span class="nx">qualified_arn</span>
      <span class="nx">include_body</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="err">}</span>
  
  <span class="c1"># Cache behavior for API</span>
  <span class="nx">ordered_cache_behavior</span> <span class="p">{</span>
    <span class="nx">path_pattern</span>     <span class="o">=</span> <span class="s2">"/api/*"</span>
    <span class="nx">allowed_methods</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">"DELETE"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">,</span> <span class="s2">"PATCH"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"PUT"</span><span class="p">]</span>
    <span class="nx">cached_methods</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">]</span>
    <span class="nx">target_origin_id</span> <span class="o">=</span> <span class="s2">"origin-group-1"</span>
    
    <span class="nx">cache_policy_id</span>            <span class="o">=</span> <span class="nx">aws_cloudfront_cache_policy</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">origin_request_policy_id</span>   <span class="o">=</span> <span class="nx">aws_cloudfront_origin_request_policy</span><span class="p">.</span><span class="nx">api</span><span class="p">.</span><span class="nx">id</span>
    <span class="nx">response_headers_policy_id</span> <span class="o">=</span> <span class="nx">aws_cloudfront_response_headers_policy</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">id</span>
    
    <span class="nx">viewer_protocol_policy</span> <span class="o">=</span> <span class="s2">"https-only"</span>
    <span class="nx">compress</span>               <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="c1"># Cache behavior for static assets</span>
  <span class="nx">ordered_cache_behavior</span> <span class="p">{</span>
    <span class="nx">path_pattern</span>     <span class="o">=</span> <span class="s2">"/static/*"</span>
    <span class="nx">allowed_methods</span>  <span class="o">=</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">]</span>
    <span class="nx">cached_methods</span>   <span class="o">=</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">]</span>
    <span class="nx">target_origin_id</span> <span class="o">=</span> <span class="s2">"S3-${aws_s3_bucket.static_content.id}"</span>
    
    <span class="nx">viewer_protocol_policy</span> <span class="o">=</span> <span class="s2">"redirect-to-https"</span>
    <span class="nx">min_ttl</span>                <span class="o">=</span> <span class="mi">0</span>
    <span class="nx">default_ttl</span>            <span class="o">=</span> <span class="mi">604800</span>   <span class="c1"># 7 days</span>
    <span class="nx">max_ttl</span>                <span class="o">=</span> <span class="mi">31536000</span>  <span class="c1"># 1 year</span>
    <span class="nx">compress</span>               <span class="o">=</span> <span class="kc">true</span>
    
    <span class="nx">forwarded_values</span> <span class="p">{</span>
      <span class="nx">query_string</span> <span class="o">=</span> <span class="kc">false</span>
      
      <span class="nx">cookies</span> <span class="p">{</span>
        <span class="nx">forward</span> <span class="o">=</span> <span class="s2">"none"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="err">}</span>
  
  <span class="nx">restrictions</span> <span class="p">{</span>
    <span class="nx">geo_restriction</span> <span class="p">{</span>
      <span class="nx">restriction_type</span> <span class="o">=</span> <span class="s2">"none"</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">viewer_certificate</span> <span class="p">{</span>
    <span class="nx">acm_certificate_arn</span>      <span class="o">=</span> <span class="nx">aws_acm_certificate_validation</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">certificate_arn</span>
    <span class="nx">minimum_protocol_version</span> <span class="o">=</span> <span class="s2">"TLSv1.2_2021"</span>
    <span class="nx">ssl_support_method</span>       <span class="o">=</span> <span class="s2">"sni-only"</span>
  <span class="p">}</span>
  
  <span class="nx">web_acl_id</span> <span class="o">=</span> <span class="nx">aws_wafv2_web_acl</span><span class="p">.</span><span class="nx">cloudfront</span><span class="p">.</span><span class="nx">arn</span>
  
  <span class="nx">logging_config</span> <span class="p">{</span>
    <span class="nx">include_cookies</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="nx">bucket</span>          <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">cloudfront_logs</span><span class="p">.</span><span class="nx">bucket_domain_name</span>
    <span class="nx">prefix</span>          <span class="o">=</span> <span class="s2">"cloudfront/"</span>
  <span class="p">}</span>
  
  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Environment</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
  <span class="p">}</span>
  
  <span class="nx">depends_on</span> <span class="o">=</span> <span class="p">[</span>
    <span class="nx">aws_s3_bucket_policy</span><span class="p">.</span><span class="nx">static_content</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Cache policy for API</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_cache_policy"</span> <span class="s2">"api"</span> <span class="p">{</span>
  <span class="nx">name</span>        <span class="o">=</span> <span class="s2">"${var.environment}-api-cache-policy"</span>
  <span class="nx">comment</span>     <span class="o">=</span> <span class="s2">"Cache policy for API endpoints"</span>
  <span class="nx">default_ttl</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nx">max_ttl</span>     <span class="o">=</span> <span class="mi">3600</span>
  <span class="nx">min_ttl</span>     <span class="o">=</span> <span class="mi">0</span>
  
  <span class="nx">parameters_in_cache_key_and_forwarded_to_origin</span> <span class="p">{</span>
    <span class="nx">enable_accept_encoding_gzip</span>   <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">enable_accept_encoding_brotli</span> <span class="o">=</span> <span class="kc">true</span>
    
    <span class="nx">cookies_config</span> <span class="p">{</span>
      <span class="nx">cookie_behavior</span> <span class="o">=</span> <span class="s2">"all"</span>
    <span class="p">}</span>
    
    <span class="nx">headers_config</span> <span class="p">{</span>
      <span class="nx">header_behavior</span> <span class="o">=</span> <span class="s2">"whitelist"</span>
      <span class="nx">headers</span> <span class="p">{</span>
        <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s2">"Authorization"</span><span class="p">,</span>
          <span class="s2">"CloudFront-Viewer-Country"</span><span class="p">,</span>
          <span class="s2">"CloudFront-Is-Mobile-Viewer"</span><span class="p">,</span>
          <span class="s2">"CloudFront-Is-Tablet-Viewer"</span><span class="p">,</span>
          <span class="s2">"CloudFront-Is-Desktop-Viewer"</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">query_strings_config</span> <span class="p">{</span>
      <span class="nx">query_string_behavior</span> <span class="o">=</span> <span class="s2">"all"</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Origin request policy</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_origin_request_policy"</span> <span class="s2">"api"</span> <span class="p">{</span>
  <span class="nx">name</span>    <span class="o">=</span> <span class="s2">"${var.environment}-api-origin-request-policy"</span>
  <span class="nx">comment</span> <span class="o">=</span> <span class="s2">"Origin request policy for API"</span>
  
  <span class="nx">cookies_config</span> <span class="p">{</span>
    <span class="nx">cookie_behavior</span> <span class="o">=</span> <span class="s2">"all"</span>
  <span class="p">}</span>
  
  <span class="nx">headers_config</span> <span class="p">{</span>
    <span class="nx">header_behavior</span> <span class="o">=</span> <span class="s2">"allViewer"</span>
  <span class="p">}</span>
  
  <span class="nx">query_strings_config</span> <span class="p">{</span>
    <span class="nx">query_string_behavior</span> <span class="o">=</span> <span class="s2">"all"</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Response headers policy</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_response_headers_policy"</span> <span class="s2">"security"</span> <span class="p">{</span>
  <span class="nx">name</span>    <span class="o">=</span> <span class="s2">"${var.environment}-security-headers-policy"</span>
  <span class="nx">comment</span> <span class="o">=</span> <span class="s2">"Security headers policy"</span>
  
  <span class="nx">security_headers_config</span> <span class="p">{</span>
    <span class="nx">content_type_options</span> <span class="p">{</span>
      <span class="nx">override</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    
    <span class="nx">frame_options</span> <span class="p">{</span>
      <span class="nx">frame_option</span> <span class="o">=</span> <span class="s2">"DENY"</span>
      <span class="nx">override</span>     <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    
    <span class="nx">referrer_policy</span> <span class="p">{</span>
      <span class="nx">referrer_policy</span> <span class="o">=</span> <span class="s2">"strict-origin-when-cross-origin"</span>
      <span class="nx">override</span>        <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    
    <span class="nx">xss_protection</span> <span class="p">{</span>
      <span class="nx">mode_block</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">protection</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">override</span>   <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    
    <span class="nx">strict_transport_security</span> <span class="p">{</span>
      <span class="nx">access_control_max_age_sec</span> <span class="o">=</span> <span class="mi">63072000</span>
      <span class="nx">include_subdomains</span>         <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">preload</span>                    <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">override</span>                   <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    
    <span class="nx">content_security_policy</span> <span class="p">{</span>
      <span class="nx">content_security_policy</span> <span class="o">=</span> <span class="s2">"default-src 'self'; img-src 'self' data: https:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';"</span>
      <span class="nx">override</span>                <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">cors_config</span> <span class="p">{</span>
    <span class="nx">access_control_allow_credentials</span> <span class="o">=</span> <span class="kc">true</span>
    
    <span class="nx">access_control_allow_headers</span> <span class="p">{</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"*"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">access_control_allow_methods</span> <span class="p">{</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"HEAD"</span><span class="p">,</span> <span class="s2">"PUT"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"DELETE"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">access_control_allow_origins</span> <span class="p">{</span>
      <span class="nx">items</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"https://${var.domain_name}"</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="nx">access_control_max_age_sec</span> <span class="o">=</span> <span class="mi">86400</span>
    <span class="nx">origin_override</span>            <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="nx">custom_headers_config</span> <span class="p">{</span>
    <span class="nx">items</span> <span class="p">{</span>
      <span class="nx">header</span>   <span class="o">=</span> <span class="s2">"X-Environment"</span>
      <span class="nx">value</span>    <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">environment</span>
      <span class="nx">override</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># CloudFront monitoring</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudwatch_metric_alarm"</span> <span class="s2">"4xx_errors"</span> <span class="p">{</span>
  <span class="nx">alarm_name</span>          <span class="o">=</span> <span class="s2">"${var.environment}-cloudfront-4xx-errors"</span>
  <span class="nx">comparison_operator</span> <span class="o">=</span> <span class="s2">"GreaterThanThreshold"</span>
  <span class="nx">evaluation_periods</span>  <span class="o">=</span> <span class="s2">"2"</span>
  <span class="nx">metric_name</span>         <span class="o">=</span> <span class="s2">"4xxErrorRate"</span>
  <span class="nx">namespace</span>           <span class="o">=</span> <span class="s2">"AWS/CloudFront"</span>
  <span class="nx">period</span>              <span class="o">=</span> <span class="s2">"300"</span>
  <span class="nx">statistic</span>           <span class="o">=</span> <span class="s2">"Average"</span>
  <span class="nx">threshold</span>           <span class="o">=</span> <span class="s2">"5"</span>
  <span class="nx">alarm_description</span>   <span class="o">=</span> <span class="s2">"This metric monitors CloudFront 4xx error rate"</span>
  <span class="nx">alarm_actions</span>       <span class="o">=</span> <span class="p">[</span><span class="nx">aws_sns_topic</span><span class="p">.</span><span class="nx">alerts</span><span class="p">.</span><span class="nx">arn</span><span class="p">]</span>
  
  <span class="nx">dimensions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">DistributionId</span> <span class="o">=</span> <span class="nx">aws_cloudfront_distribution</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">id</span>
  <span class="p">}</span>
<span class="err">}</span>

<span class="c1"># Real-time logs</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudfront_realtime_log_config"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="o">=</span> <span class="s2">"${var.environment}-realtime-logs"</span>
  
  <span class="nx">endpoint</span> <span class="p">{</span>
    <span class="nx">stream_type</span> <span class="o">=</span> <span class="s2">"Kinesis"</span>
    
    <span class="nx">kinesis_stream_config</span> <span class="p">{</span>
      <span class="nx">role_arn</span>   <span class="o">=</span> <span class="nx">aws_iam_role</span><span class="p">.</span><span class="nx">cloudfront_logs</span><span class="p">.</span><span class="nx">arn</span>
      <span class="nx">stream_arn</span> <span class="o">=</span> <span class="nx">aws_kinesis_stream</span><span class="p">.</span><span class="nx">cloudfront_logs</span><span class="p">.</span><span class="nx">arn</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">fields</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">"timestamp"</span><span class="p">,</span>
    <span class="s2">"c-ip"</span><span class="p">,</span>
    <span class="s2">"sc-status"</span><span class="p">,</span>
    <span class="s2">"cs-uri-stem"</span><span class="p">,</span>
    <span class="s2">"cs-user-agent"</span><span class="p">,</span>
    <span class="s2">"cs-referer"</span><span class="p">,</span>
    <span class="s2">"x-edge-location"</span><span class="p">,</span>
    <span class="s2">"x-edge-request-id"</span><span class="p">,</span>
    <span class="s2">"x-edge-response-result-type"</span><span class="p">,</span>
    <span class="s2">"time-taken"</span>
  <span class="p">]</span>
  
  <span class="nx">sampling_rate</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 1% sampling</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="load-balancing-options">Load Balancing Options</h2>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Use Case</th>
      <th>Layer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Application Load Balancer (ALB)</td>
      <td>HTTP/HTTPS traffic, path-based routing</td>
      <td>Layer 7</td>
    </tr>
    <tr>
      <td>Network Load Balancer (NLB)</td>
      <td>Ultra-low latency, TCP/UDP</td>
      <td>Layer 4</td>
    </tr>
    <tr>
      <td>Gateway Load Balancer (GWLB)</td>
      <td>Third-party appliances</td>
      <td>Layer 3</td>
    </tr>
    <tr>
      <td>Classic Load Balancer</td>
      <td>Legacy applications</td>
      <td>Layer 4/7</td>
    </tr>
  </tbody>
</table>

<h2 id="see-also">See Also</h2>

<ul>
  <li><a href="./">AWS Hub</a> - Overview of all AWS documentation</li>
  <li><a href="compute.html">Compute Services</a> - EC2 and Lambda in VPC</li>
  <li><a href="security.html">Security</a> - Network security and WAF</li>
  <li><a href="infrastructure.html">Infrastructure &amp; Operations</a> - VPC IaC templates</li>
  <li><a href="../networking.html">Networking Fundamentals</a> - General networking concepts</li>
  <li><a href="../kubernetes/">Kubernetes on AWS</a> - EKS networking</li>
</ul>

      </section>
    </div>
  </article>
</div>
</body>
</html>