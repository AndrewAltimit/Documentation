<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

<!-- SEO Meta Tags -->
<meta name="description" content="Technology and Physics notes">
<meta name="author" content="Andrew">

<!-- Open Graph -->
<meta property="og:title" content="Docker: Dockerfiles & CI/CD">
<meta property="og:description" content="Technology and Physics notes">
<meta property="og:type" content="website">
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/technology/docker/dockerfiles.html">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Docker: Dockerfiles & CI/CD">
<meta name="twitter:description" content="Technology and Physics notes">

<title>Docker: Dockerfiles & CI/CD | Andrews Notebook</title>


  <link href="/Documentation/feed.xml" type="application/atom+xml" rel="alternate" title="Andrews Notebook Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Documentation/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<!-- Custom styles -->
<!-- MathJax for LaTeX equation rendering -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
/* MathJax equation styling */
mjx-container {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
}

mjx-container[display="true"] {
  display: block !important;
  margin: 1.5em 0 !important;
  text-align: center;
}

mjx-container[display="true"] svg {
  max-width: 100%;
  height: auto;
}

/* Inline equations */
mjx-container:not([display="true"]) {
  display: inline !important;
  margin: 0 0.1em;
}

/* Equation numbering (if used) */
.MathJax .mjx-mtr {
  margin: 0.25em 0;
}

/* Better scrolling for wide equations on mobile */
@media (max-width: 768px) {
  mjx-container[display="true"] {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}
</style>

<!-- Custom styles for documentation -->
<link rel="stylesheet" href="/Documentation/style.css?v=2.0.1">
<link rel="stylesheet" href="/Documentation/assets/css/condensed.css?v=2.0.1">
<style>
  /* Widescreen optimized layout */
  body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  /* Main container - full width */
  #main {
    display: flex;
    position: relative;
    min-height: 100vh;
    width: 100%;
    max-width: 100%;
  }
  
  /* Sidebar fixed to left edge */
  .sidebar.sticky {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-right: 1px solid #e1e4e8;
    padding: 2rem 1rem;
    z-index: 100;
  }
  
  /* Sidebar navigation styling */
  .nav__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__title {
    margin: 1.5rem 0 0.5rem;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    border-bottom: 1px solid #e1e4e8;
  }
  
  .nav__items {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__items a {
    display: block;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }
  
  .nav__items a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }
  
  .nav__items a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Collapsible navigation sections */
  .nav__item--collapsible {
    margin: 0.25rem 0;
  }

  .nav__item--collapsible details {
    margin: 0;
  }

  .nav__item--collapsible summary {
    display: flex;
    align-items: center;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
    list-style: none;
  }

  .nav__item--collapsible summary::-webkit-details-marker {
    display: none;
  }

  .nav__item--collapsible summary::before {
    content: "‚ñ∏";
    display: inline-block;
    margin-right: 0.5rem;
    font-size: 0.7rem;
    transition: transform 0.2s ease;
  }

  .nav__item--collapsible details[open] > summary::before {
    transform: rotate(90deg);
  }

  .nav__item--collapsible summary:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }

  .nav__item--collapsible summary a {
    display: inline;
    padding: 0;
    border-left: none;
    font-weight: 500;
  }

  .nav__item--collapsible summary a:hover {
    background: none;
    border-left: none;
  }

  .nav__item--collapsible summary a.active {
    color: #0066cc;
    font-weight: 600;
    background: none;
    border-left: none;
  }

  /* Nested sub-items */
  .nav__subitems {
    margin: 0;
    padding: 0;
    list-style: none;
    padding-left: 1.25rem;
    border-left: 1px solid #e1e4e8;
    margin-left: 1rem;
  }

  .nav__subitems li {
    margin: 0;
  }

  .nav__subitems a {
    display: block;
    padding: 0.25rem 0.5rem;
    font-size: 0.8125rem;
    color: #555;
    text-decoration: none;
    border-left: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .nav__subitems a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.03);
    border-left-color: #0066cc;
  }

  .nav__subitems a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Content area with left margin for sidebar */
  article.page {
    margin-left: 280px;
    min-height: 100vh;
    background: white;
    width: calc(100% - 280px);
    max-width: none;
  }
  
  /* Content wrapper - use full width */
  .page__inner-wrap {
    max-width: none;
    margin: 0;
    padding: 2rem 3rem;
  }
  
  .page__title {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Let content use available width */
  .page__content {
    max-width: none;
    width: 100%;
  }
  
  /* For optimal reading, constrain just the text paragraphs */
  .page__content > p,
  .page__content > ul,
  .page__content > ol {
    max-width: 65ch;
  }
  
  /* Let code blocks, tables, and special content use full width */
  .page__content pre,
  .page__content table,
  .page__content .noteBoxes,
  .page__content figure,
  .page__content .highlight {
    max-width: 100%;
  }
  
  /* Wide note boxes */
  .noteBoxes {
    width: 90% !important;
    max-width: 800px;
  }
  
  /* Tables use available width */
  table {
    width: 100%;
    max-width: 100%;
  }
  
  /* Code blocks optimization */
  pre {
    max-width: 100%;
    overflow-x: auto;
  }
  
  .highlight {
    max-width: 100%;
    margin: 1rem 0;
  }
  
  /* Responsive adjustments */
  @media (min-width: 2000px) {
    .sidebar.sticky {
      width: 320px;
    }
    
    article.page {
      margin-left: 320px;
      width: calc(100% - 320px);
    }
    
    .page__inner-wrap {
      padding: 2rem 4rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 75ch;
    }
  }
  
  @media (min-width: 1024px) and (max-width: 1439px) {
    .sidebar.sticky {
      width: 250px;
    }
    
    article.page {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    
    .page__inner-wrap {
      padding: 2rem 2rem;
    }
  }
  
  /* Tablet and mobile */
  @media (max-width: 1023px) {
    #main {
      flex-direction: column;
    }
    
    .sidebar.sticky {
      position: relative;
      width: 100%;
      height: auto;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
      padding: 1rem;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
    
    .page__inner-wrap {
      padding: 1rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 100%;
    }
  }
  
  /* Mobile navigation toggle */
  .nav-toggle {
    display: none;
  }
  
  @media (max-width: 1023px) {
    .nav-toggle {
      display: block;
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 200;
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .sidebar.sticky {
      position: fixed;
      left: -100%;
      top: 0;
      transition: left 0.3s ease;
      z-index: 150;
      height: 100vh;
      width: 280px;
    }
    
    .sidebar.sticky.active {
      left: 0;
    }
    
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 140;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
  }
</style>

<!-- Mobile navigation toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  if (window.innerWidth <= 1023) {
    if (!document.querySelector('.nav-toggle')) {
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'nav-toggle';
      toggleBtn.innerHTML = '‚ò∞ Menu';
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
      document.body.appendChild(toggleBtn);
      
      const overlay = document.createElement('div');
      overlay.className = 'sidebar-overlay';
      document.body.appendChild(overlay);
      
      toggleBtn.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });
      
      overlay.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    }
  }
  
  // Handle window resize
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const sidebar = document.querySelector('.sidebar.sticky');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggle = document.querySelector('.nav-toggle');
      
      if (window.innerWidth > 1023) {
        if (sidebar) sidebar.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        if (toggle) toggle.style.display = 'none';
      } else {
        if (toggle) toggle.style.display = 'block';
      }
    }, 250);
  });
});
</script>


  
    <script src="/Documentation/assets/js/custom.js"></script>
  

</head>
<body>
  <div id="main" role="main">
  <aside class="sidebar sticky">
    <nav class="nav__list">
      
        
          <h3 class="nav__title">Navigation</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/topic-map.html"
                       >
                      <span class="nav__sub-title">üó∫Ô∏è Topic Map</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/search.html"
                       >
                      <span class="nav__sub-title">üîç Search</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">üìã Reference Index</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Technology</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/technology/index.html"
                       >
                      <span class="nav__sub-title">Technology Overview</span>
                    </a>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="aws">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/aws/"
                             >
                            AWS
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/compute.html"
                               >
                              Compute
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/storage.html"
                               >
                              Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/databases.html"
                               >
                              Databases
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/networking.html"
                               >
                              Networking
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/security.html"
                               >
                              Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/infrastructure.html"
                               >
                              Infrastructure
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="terraform">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/terraform/"
                             >
                            Terraform
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/core-concepts.html"
                               >
                              Core Concepts
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/state-modules.html"
                               >
                              State & Modules
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/patterns.html"
                               >
                              Enterprise Patterns
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="kubernetes">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/kubernetes/"
                             >
                            Kubernetes
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/workloads.html"
                               >
                              Workloads & Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/operations.html"
                               >
                              Operations
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details open data-nav-section="docker">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/docker/"
                             >
                            Docker
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/storage-security.html"
                               >
                              Storage & Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/dockerfiles.html"
                               class="active">
                              Dockerfiles & CI/CD
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/advanced.html"
                               >
                              Advanced Patterns
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/docker-essentials.html"
                       >
                      <span class="nav__sub-title">Docker Essentials</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git.html"
                       >
                      <span class="nav__sub-title">Git</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git-reference.html"
                       >
                      <span class="nav__sub-title">Git Command Reference</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/branching.html"
                       >
                      <span class="nav__sub-title">Branching Strategies</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/database-design.html"
                       >
                      <span class="nav__sub-title">Database Design</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/networking.html"
                       >
                      <span class="nav__sub-title">Networking</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/cybersecurity.html"
                       >
                      <span class="nav__sub-title">Cybersecurity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ci-cd.html"
                       >
                      <span class="nav__sub-title">CI/CD</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/unreal.html"
                       >
                      <span class="nav__sub-title">Unreal Engine</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-fundamentals-simple.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals (Simple)</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-lecture-2023.html"
                       >
                      <span class="nav__sub-title">AI Lecture 2023</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/please-build.html"
                       >
                      <span class="nav__sub-title">Please Build</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Specialized Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/distributed-systems/index.html"
                       >
                      <span class="nav__sub-title">Distributed Systems Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/quantum-computing/index.html"
                       >
                      <span class="nav__sub-title">Quantum Computing Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/artificial-intelligence/index.html"
                       >
                      <span class="nav__sub-title">Artificial Intelligence Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/gamedev/index.html"
                       >
                      <span class="nav__sub-title">Game Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/graphics/3d-rendering.html"
                       >
                      <span class="nav__sub-title">3D Graphics & Rendering</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/vr-ar/index.html"
                       >
                      <span class="nav__sub-title">VR/AR Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/optimization/index.html"
                       >
                      <span class="nav__sub-title">Performance Optimization</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">AI/ML - Generative AI</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/ai-ml/index.html"
                       >
                      <span class="nav__sub-title">AI/ML Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html"
                       >
                      <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/base-models-comparison.html"
                       >
                      <span class="nav__sub-title">Base Models Comparison</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/model-types.html"
                       >
                      <span class="nav__sub-title">Model Types</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/lora-training.html"
                       >
                      <span class="nav__sub-title">LoRA Training</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/controlnet.html"
                       >
                      <span class="nav__sub-title">ControlNet Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/comfyui-guide.html"
                       >
                      <span class="nav__sub-title">ComfyUI Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/output-formats.html"
                       >
                      <span class="nav__sub-title">Output Formats</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/advanced-techniques.html"
                       >
                      <span class="nav__sub-title">Advanced Techniques</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Physics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/physics/index.html"
                       >
                      <span class="nav__sub-title">Physics Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/classical-mechanics.html"
                       >
                      <span class="nav__sub-title">Classical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/thermodynamics.html"
                       >
                      <span class="nav__sub-title">Thermodynamics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/statistical-mechanics.html"
                       >
                      <span class="nav__sub-title">Statistical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/relativity.html"
                       >
                      <span class="nav__sub-title">Relativity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-mechanics.html"
                       >
                      <span class="nav__sub-title">Quantum Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/condensed-matter.html"
                       >
                      <span class="nav__sub-title">Condensed Matter Physics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-field-theory.html"
                       >
                      <span class="nav__sub-title">Quantum Field Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/string-theory.html"
                       >
                      <span class="nav__sub-title">String Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/computational-physics.html"
                       >
                      <span class="nav__sub-title">Computational Physics</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Advanced Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/advanced/index.html"
                       >
                      <span class="nav__sub-title">Research Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/ai-mathematics/"
                       >
                      <span class="nav__sub-title">AI Mathematics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/distributed-systems-theory/"
                       >
                      <span class="nav__sub-title">Distributed Systems Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/quantum-algorithms-research/"
                       >
                      <span class="nav__sub-title">Quantum Algorithms Research</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/monorepo/"
                       >
                      <span class="nav__sub-title">Monorepo Architecture</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Quick Reference</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">Reference Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#command-line-references"
                       >
                      <span class="nav__sub-title">Command Cheat Sheets</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#physics-formulas--constants"
                       >
                      <span class="nav__sub-title">Physics Formulas</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#algorithms--data-structures"
                       >
                      <span class="nav__sub-title">Algorithms & Big O</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#api-reference-patterns"
                       >
                      <span class="nav__sub-title">API Patterns</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#troubleshooting-flowcharts"
                       >
                      <span class="nav__sub-title">Troubleshooting</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#best-practices-checklists"
                       >
                      <span class="nav__sub-title">Best Practices</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
      
    </nav>
  </aside>

  <article class="page">
    <div class="page__inner-wrap">
      <header>
        <h1 id="page-title" class="page__title">Docker: Dockerfiles & CI/CD</h1>
      </header>

      <section class="page__content">
        <h2 id="writing-dockerfiles">Writing Dockerfiles</h2>

<p>A Dockerfile is a script containing instructions to build a Docker image. It automates the process of creating a container by specifying the base image, configuration, application code, and dependencies. This documentation will cover the basics of writing a Dockerfile, its syntax, and using multistage builds.</p>

<h3 id="dockerfile-example">Dockerfile Example</h3>

<p>A Dockerfile consists of a series of instructions, each starting with an uppercase keyword followed by arguments. The instructions are executed in the order they appear, and each instruction creates a new layer in the Docker image. Comments can be added using the # symbol.</p>

<p>Here‚Äôs a simple example:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Use an official Python runtime as a parent image</span>
<span class="k">FROM</span><span class="s"> python:3.8-slim</span>

<span class="c"># Set the working directory to /app</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>

<span class="c"># Copy the current directory contents into the container at /app</span>
<span class="k">COPY</span><span class="s"> . /app</span>

<span class="c"># Install any needed packages specified in requirements.txt</span>
<span class="k">RUN </span>pip <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nt">-r</span> requirements.txt

<span class="c"># Make port 80 available to the world outside this container</span>
<span class="k">EXPOSE</span><span class="s"> 80</span>

<span class="c"># Define environment variable</span>
<span class="k">ENV</span><span class="s"> NAME World</span>

<span class="c"># Run app.py when the container launches</span>
<span class="k">CMD</span><span class="s"> ["python", "app.py"]</span>
</code></pre></div></div>

<h3 id="dockerfile-instructions">Dockerfile Instructions</h3>

<h4 id="from">FROM</h4>

<p>The <strong>FROM</strong> instruction sets the base image for your Dockerfile. It must be the first instruction in the file. You can use an official image from the Docker Hub or a custom image.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">FROM</span><span class="s"> &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]</span>
</code></pre></div></div>

<h4 id="workdir">WORKDIR</h4>

<p>The <strong>WORKDIR</strong> instruction sets the working directory for any subsequent <strong>RUN</strong>, <strong>CMD</strong>, <strong>ENTRYPOINT</strong>, <strong>COPY</strong>, and <strong>ADD</strong> instructions. If the directory does not exist, it will be created.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">WORKDIR</span><span class="s"> &lt;path&gt;</span>
</code></pre></div></div>

<h4 id="copy">COPY</h4>

<p>The <strong>COPY</strong> instruction copies files or directories from the local filesystem to the container‚Äôs filesystem.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">COPY</span><span class="s"> &lt;src&gt; &lt;dest&gt;</span>
</code></pre></div></div>

<h4 id="add">ADD</h4>

<p>The <strong>ADD</strong> instruction is similar to <strong>COPY</strong>, but it can also download remote files and extract compressed files.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ADD</span><span class="s"> &lt;src&gt; &lt;dest&gt;</span>
</code></pre></div></div>

<h4 id="run">RUN</h4>

<p>The <strong>RUN</strong> instruction executes a command during the build process, creating a new layer.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">RUN </span>&lt;<span class="nb">command</span><span class="o">&gt;</span>
</code></pre></div></div>

<h4 id="cmd">CMD</h4>

<p>The <strong>CMD</strong> instruction provides the default command that will be executed when running a container.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CMD</span><span class="s"> ["executable", "param1", "param2"]</span>
</code></pre></div></div>

<h4 id="entrypoint">ENTRYPOINT</h4>

<p>The <strong>ENTRYPOINT</strong> instruction allows you to configure a container that will run as an executable.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ENTRYPOINT</span><span class="s"> ["executable", "param1", "param2"]</span>
</code></pre></div></div>

<h4 id="expose">EXPOSE</h4>

<p>The <strong>EXPOSE</strong> instruction informs Docker that the container listens on the specified network ports at runtime.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">EXPOSE</span><span class="s"> &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]</span>
</code></pre></div></div>

<h4 id="env">ENV</h4>

<p>The <strong>ENV</strong> instruction sets an environment variable.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ENV</span><span class="s"> &lt;key&gt;=&lt;value&gt; ...</span>
</code></pre></div></div>

<h4 id="arg">ARG</h4>

<p>The <strong>ARG</strong> instruction defines a variable that can be passed to the build process using the <code class="language-plaintext highlighter-rouge">--build-arg</code> flag.</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ARG</span><span class="s"> &lt;name&gt;[=&lt;default value&gt;]</span>
</code></pre></div></div>

<h3 id="multistage-builds">Multistage Builds</h3>

<p>Multistage builds allow you to optimize the Dockerfile by using multiple FROM instructions, each with a unique name. This is useful when you need to use multiple images or want to reduce the final image size.</p>

<p>Here‚Äôs an example:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Stage 1: Build the application</span>
<span class="k">FROM</span><span class="w"> </span><span class="s">node:14</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="s">build</span>
<span class="k">WORKDIR</span><span class="s"> /app</span>
<span class="k">COPY</span><span class="s"> package*.json ./</span>
<span class="k">RUN </span>npm <span class="nb">install</span>
<span class="k">COPY</span><span class="s"> . .</span>
<span class="k">RUN </span>npm run build

<span class="c"># Stage 2: Create the final image</span>
<span class="k">FROM</span><span class="s"> nginx:1.19-alpine</span>
<span class="k">COPY</span><span class="s"> --from=build /app/build /usr/share/nginx/html</span>
<span class="k">EXPOSE</span><span class="s"> 80</span>
<span class="k">CMD</span><span class="s"> ["nginx", "-g", "daemon off;"]</span>
</code></pre></div></div>

<p>In this example, the first stage uses the node:14 image to build the application, and the second stage uses the nginx:1.19-alpine image to serve the application. The <code class="language-plaintext highlighter-rouge">COPY --from=build</code> command copies the built application files from the first stage to the final image. This results in a smaller final image without the build dependencies.</p>

<h2 id="best-practices">Best Practices</h2>

<ul>
  <li>Use official base images: Official images are maintained and optimized by the creators of the respective software.</li>
  <li>Be specific with base image tags: Specify an exact version or use a specific tag to avoid breaking changes in the future.</li>
  <li>Keep layers to a minimum: Group related commands together and use a single RUN instruction whenever possible.</li>
  <li>Use .dockerignore file: Exclude unnecessary files from the build context to reduce build time and prevent sensitive data from being included in the image.</li>
  <li>Cache dependencies: Copy dependency files separately from the application code to take advantage of Docker‚Äôs build cache and avoid unnecessary re-installations.</li>
  <li>Use multi-stage builds: Multi-stage builds can help reduce the final image size by only including the necessary files for the runtime environment.</li>
  <li>Run as non-root user: Always specify a non-root user in your Dockerfile for security.</li>
  <li>Order layers efficiently: Put commands that change less frequently (like package installation) before frequently changing items (like application code).</li>
  <li>Use COPY instead of ADD: Unless you need ADD‚Äôs tar extraction or URL features, COPY is more predictable.</li>
  <li>Set WORKDIR early: Establish your working directory early to avoid using long paths.</li>
  <li>Combine RUN commands: Reduce layers by combining related commands with &amp;&amp; operators.</li>
</ul>

<h2 id="performance-optimization">Performance Optimization</h2>

<div class="performance-section">
  <h3><i class="fas fa-tachometer-alt"></i> Docker Performance Tuning</h3>
  
  <p class="perf-intro">Optimizing Docker performance involves understanding resource allocation, storage drivers, networking overhead, and build optimization. These techniques can significantly improve your container performance.</p>
  
  <h3><i class="fas fa-memory"></i> Resource Management</h3>
  
  <div class="resource-optimization">
    <h4>Memory Optimization</h4>
    <pre><code class="language-bash"># Set memory limits and reservations
docker run -d \
  --name optimized-app \
  --memory="1g" \
  --memory-reservation="750m" \
  --memory-swap="2g" \
  --oom-kill-disable=false \
  my-app

# Java application optimization
docker run -d \
  --name java-app \
  --memory="2g" \
  -e JAVA_OPTS="-Xmx1800m -Xms1800m -XX:MaxMetaspaceSize=256m" \
  my-java-app</code></pre>
    
    <h4>CPU Optimization</h4>
    <pre><code class="language-bash"># CPU limits and shares
docker run -d \
  --name cpu-app \
  --cpus="2.5" \
  --cpu-shares=1024 \
  --cpuset-cpus="0-3" \
  my-app

# Real-time scheduling
docker run -d \
  --name realtime-app \
  --cpu-rt-runtime=950000 \
  --cpu-rt-period=1000000 \
  my-realtime-app</code></pre>
  </div>
  
  <h3><i class="fas fa-hdd"></i> Storage Driver Performance</h3>
  
  <div class="storage-performance">
    <h4>Choosing the Right Storage Driver</h4>
    <pre><code class="language-bash"># Check current storage driver
docker info | grep -i storage

# Configure storage driver (daemon.json)
{
  "storage-driver": "overlay2",
  "storage-opts": [
    "overlay2.override_kernel_check=true",
    "overlay2.size=20G"
  ]
}

# Performance comparison
# overlay2: Best overall performance
# devicemapper: Good for high I/O workloads
# btrfs: Good for snapshots, CoW operations
# zfs: Best for data integrity, compression</code></pre>
    
    <h4>Build Cache Optimization</h4>
    <pre><code class="language-dockerfile"># Optimize Dockerfile for caching
FROM node:18-alpine

# Dependencies change less frequently
COPY package*.json ./
RUN npm ci --only=production

# Application code changes frequently
COPY . .

# BuildKit cache mounts
# syntax=docker/dockerfile:1
FROM golang:1.20-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN --mount=type=cache,target=/go/pkg/mod \
    --mount=type=cache,target=/root/.cache/go-build \
    go mod download</code></pre>
  </div>
  
  <h3><i class="fas fa-network-wired"></i> Network Performance</h3>
  
  <div class="network-performance">
    <h4>Network Driver Performance</h4>
    <pre><code class="language-bash"># Host networking for maximum performance
docker run -d --network host high-perf-app

# SR-IOV for near-native performance
docker run -d \
  --name sriov-app \
  --network sriov-net \
  --device=/dev/vfio/vfio \
  high-bandwidth-app

# Optimize bridge network
sudo sysctl -w net.bridge.bridge-nf-call-iptables=0
sudo sysctl -w net.bridge.bridge-nf-call-ip6tables=0</code></pre>
  </div>
  
  <h3><i class="fas fa-chart-line"></i> Monitoring and Profiling</h3>
  
  <div class="performance-monitoring">
    <h4>Container Profiling</h4>
    <pre><code class="language-bash"># CPU profiling with perf
docker run -d --name app --cap-add SYS_ADMIN my-app
docker exec app perf record -g -p 1 -- sleep 30
docker exec app perf report

# Memory profiling
docker stats --no-stream
docker exec app cat /proc/1/smaps | grep -E "^Rss|^Pss|^Shared"

# I/O profiling
docker exec app iotop -b -n 1</code></pre>
    
    <h4>Metrics Collection</h4>
    <pre><code class="language-yaml"># docker-compose.yml with Prometheus monitoring
version: '3.8'
services:
  app:
    image: my-app
    ports:
      - "8080:8080"
      
  cadvisor:
    image: gcr.io/cadvisor/cadvisor:latest
    volumes:
      - /:/rootfs:ro
      - /var/run:/var/run:ro
      - /sys:/sys:ro
      - /var/lib/docker/:/var/lib/docker:ro
    ports:
      - "8081:8080"
      
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"</code></pre>
  </div>
</div>

<h2 id="docker-swarm-native-orchestration">Docker Swarm: Native Orchestration</h2>

<div class="swarm-section">
  <h3><i class="fas fa-th"></i> Introduction to Docker Swarm</h3>
  
  <p class="swarm-intro">Docker Swarm is Docker's native clustering and orchestration solution. It turns a pool of Docker hosts into a single, virtual Docker host, providing high availability and load balancing for your services.</p>
  
  <h3><i class="fas fa-server"></i> Setting Up a Swarm Cluster</h3>
  
  <div class="swarm-setup">
    <h4>Initialize Swarm</h4>
    <pre><code class="language-bash"># On manager node
docker swarm init --advertise-addr 192.168.1.100

# Output will include join token:
# docker swarm join --token SWMTKN-1-xxx 192.168.1.100:2377

# Get join tokens
docker swarm join-token worker
docker swarm join-token manager

# On worker nodes
docker swarm join --token SWMTKN-1-xxx 192.168.1.100:2377

# Verify cluster
docker node ls</code></pre>
    
    <h4>Deploy Services</h4>
    <pre><code class="language-bash"># Create a service
docker service create \
  --name web \
  --replicas 3 \
  --publish 80:80 \
  --mount type=volume,source=web-data,destination=/data \
  --constraint 'node.role==worker' \
  --update-delay 10s \
  --update-parallelism 2 \
  nginx:alpine

# Scale service
docker service scale web=5

# Rolling update
docker service update \
  --image nginx:latest \
  --update-failure-action rollback \
  web</code></pre>
    
    <h4>Stack Deployment</h4>
    <pre><code class="language-yaml"># stack.yml
version: '3.8'

services:
  web:
    image: nginx:alpine
    deploy:
      replicas: 3
      update_config:
        parallelism: 1
        delay: 10s
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
      placement:
        constraints:
          - node.role == worker
          - node.labels.zone == frontend
    ports:
      - "80:80"
    networks:
      - webnet
      
  api:
    image: my-api:latest
    deploy:
      replicas: 2
      placement:
        constraints:
          - node.labels.zone == backend
    environment:
      - DB_HOST=db
    networks:
      - webnet
      - backend
      
  db:
    image: postgres:15
    deploy:
      placement:
        constraints:
          - node.labels.type == database
    volumes:
      - db-data:/var/lib/postgresql/data
    networks:
      - backend
    environment:
      POSTGRES_PASSWORD_FILE: /run/secrets/db_password
    secrets:
      - db_password

networks:
  webnet:
    driver: overlay
    encrypted: true
  backend:
    driver: overlay
    internal: true

volumes:
  db-data:
    driver: local

secrets:
  db_password:
    external: true</code></pre>
    <pre><code class="language-bash"># Deploy stack
docker stack deploy -c stack.yml myapp

# Monitor stack
docker stack services myapp
docker stack ps myapp

# Remove stack
docker stack rm myapp</code></pre>
  </div>
  
  <h3><i class="fas fa-balance-scale"></i> High Availability</h3>
  
  <div class="swarm-ha">
    <h4>Multi-Manager Setup</h4>
    <pre><code class="language-bash"># Best practice: odd number of managers (3, 5, 7)
# Promote workers to managers
docker node promote worker1 worker2

# Verify manager status
docker node ls

# Configure manager availability
docker node update --availability drain manager1</code></pre>
    
    <h4>Service Constraints and Preferences</h4>
    <pre><code class="language-bash"># Node labels
docker node update --label-add zone=frontend worker1
docker node update --label-add zone=backend worker2
docker node update --label-add type=database worker3

# Deploy with constraints
docker service create \
  --name frontend \
  --constraint 'node.labels.zone==frontend' \
  --placement-pref 'spread=node.labels.zone' \
  nginx</code></pre>
  </div>
</div>

<h2 id="cicd-integration-with-docker">CI/CD Integration with Docker</h2>

<div class="cicd-section">
  <h3><i class="fas fa-infinity"></i> Docker in CI/CD Pipelines</h3>
  
  <p class="cicd-intro">Docker revolutionizes CI/CD by providing consistent environments across all pipeline stages. Here's how to integrate Docker into popular CI/CD platforms.</p>
  
  <h3><i class="fas fa-github"></i> GitHub Actions</h3>
  
  <div class="github-actions">
    <h4>Basic Docker Build and Push</h4>
    <pre><code class="language-yaml"># .github/workflows/docker.yml
name: Docker CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: $

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
      
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2
      
    - name: Log in to Container Registry
      uses: docker/login-action@v2
      with:
        registry: $
        username: $
        password: $
        
    - name: Extract metadata
      id: meta
      uses: docker/metadata-action@v4
      with:
        images: $/$
        tags: |
          type=ref,event=branch
          type=ref,event=pr
          type=semver,pattern=
          type=semver,pattern=.
          type=sha
          
    - name: Build and push Docker image
      uses: docker/build-push-action@v4
      with:
        context: .
        push: true
        tags: $
        labels: $
        cache-from: type=registry,ref=$/$:buildcache
        cache-to: type=registry,ref=$/$:buildcache,mode=max</code></pre>
    
    <h4>Multi-Platform Builds</h4>
    <pre><code class="language-yaml"># Multi-architecture build
    - name: Set up QEMU
      uses: docker/setup-qemu-action@v2
      
    - name: Build and push
      uses: docker/build-push-action@v4
      with:
        context: .
        platforms: linux/amd64,linux/arm64,linux/arm/v7
        push: true
        tags: $</code></pre>
  </div>
  
  <h3><i class="fas fa-gitlab"></i> GitLab CI/CD</h3>
  
  <div class="gitlab-ci">
    <h4>GitLab Pipeline with Docker</h4>
    <pre><code class="language-yaml"># .gitlab-ci.yml
variables:
  DOCKER_DRIVER: overlay2
  DOCKER_TLS_CERTDIR: "/certs"
  IMAGE_TAG: $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_SLUG

stages:
  - build
  - test
  - deploy

build:
  stage: build
  image: docker:latest
  services:
    - docker:dind
  before_script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
  script:
    - docker build --pull -t $IMAGE_TAG .
    - docker push $IMAGE_TAG
    
test:
  stage: test
  image: $IMAGE_TAG
  script:
    - pytest tests/
    - flake8 .
    
scan:
  stage: test
  image: docker:latest
  services:
    - docker:dind
  script:
    - docker pull $IMAGE_TAG
    - docker run --rm -v /var/run/docker.sock:/var/run/docker.sock \
        aquasec/trivy image --exit-code 1 --severity HIGH,CRITICAL $IMAGE_TAG
        
deploy:
  stage: deploy
  image: bitnami/kubectl:latest
  script:
    - kubectl set image deployment/app app=$IMAGE_TAG
  only:
    - main</code></pre>
  </div>
  
  <h3><i class="fas fa-jenkins"></i> Jenkins Pipeline</h3>
  
  <div class="jenkins-pipeline">
    <h4>Declarative Pipeline with Docker</h4>
    <pre><code class="language-groovy">// Jenkinsfile
pipeline {
    agent any
    
    environment {
        DOCKER_REGISTRY = 'registry.company.com'
        DOCKER_CREDENTIALS = credentials('docker-registry-creds')
        IMAGE_NAME = "${DOCKER_REGISTRY}/myapp"
        IMAGE_TAG = "${BUILD_NUMBER}-${GIT_COMMIT.take(7)}"
    }
    
    stages {
        stage('Build') {
            steps {
                script {
                    docker.build("${IMAGE_NAME}:${IMAGE_TAG}")
                }
            }
        }
        
        stage('Test') {
            steps {
                script {
                    docker.image("${IMAGE_NAME}:${IMAGE_TAG}").inside {
                        sh 'npm test'
                        sh 'npm run lint'
                    }
                }
            }
        }
        
        stage('Security Scan') {
            steps {
                sh '''
                    docker run --rm \
                      -v /var/run/docker.sock:/var/run/docker.sock \
                      -v $HOME/.cache:/root/.cache \
                      aquasec/trivy image ${IMAGE_NAME}:${IMAGE_TAG}
                '''
            }
        }
        
        stage('Push') {
            when {
                branch 'main'
            }
            steps {
                script {
                    docker.withRegistry("https://${DOCKER_REGISTRY}", 'docker-registry-creds') {
                        docker.image("${IMAGE_NAME}:${IMAGE_TAG}").push()
                        docker.image("${IMAGE_NAME}:${IMAGE_TAG}").push('latest')
                    }
                }
            }
        }
        
        stage('Deploy') {
            when {
                branch 'main'
            }
            steps {
                sh '''
                    kubectl set image deployment/myapp \
                      myapp=${IMAGE_NAME}:${IMAGE_TAG} \
                      --record=true
                '''
            }
        }
    }
    
    post {
        always {
            cleanWs()
            sh 'docker system prune -f'
        }
    }
}</code></pre>
  </div>
  
  <h3><i class="fas fa-cloud"></i> Cloud Native CI/CD</h3>
  
  <div class="cloud-native-cicd">
    <h4>Tekton Pipeline</h4>
    <pre><code class="language-yaml"># tekton-pipeline.yaml
apiVersion: tekton.dev/v1beta1
kind: Pipeline
metadata:
  name: docker-build-push
spec:
  params:
    - name: repo-url
      type: string
    - name: image-reference
      type: string
  workspaces:
    - name: shared-data
  tasks:
    - name: fetch-source
      taskRef:
        name: git-clone
      workspaces:
        - name: output
          workspace: shared-data
      params:
        - name: url
          value: $(params.repo-url)
          
    - name: build-push
      runAfter: ["fetch-source"]
      taskRef:
        name: kaniko
      workspaces:
        - name: source
          workspace: shared-data
      params:
        - name: IMAGE
          value: $(params.image-reference)
        - name: DOCKERFILE
          value: ./Dockerfile
        - name: CONTEXT
          value: ./
        - name: EXTRA_ARGS
          value:
            - --cache=true
            - --cache-ttl=24h</code></pre>
  </div>
</div>


      </section>
    </div>
  </article>
</div>
</body>
</html>