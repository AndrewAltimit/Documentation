<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

<!-- SEO Meta Tags -->
<meta name="description" content="Technology and Physics notes">
<meta name="author" content="Andrew">

<!-- Open Graph -->
<meta property="og:title" content="Terraform: State & Modules">
<meta property="og:description" content="Technology and Physics notes">
<meta property="og:type" content="website">
<meta property="og:url" content="https://andrewaltimit.github.io/Documentation/docs/technology/terraform/state-modules.html">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Terraform: State & Modules">
<meta name="twitter:description" content="Technology and Physics notes">

<title>Terraform: State & Modules | Andrews Notebook</title>


  <link href="/Documentation/feed.xml" type="application/atom+xml" rel="alternate" title="Andrews Notebook Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Documentation/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>

<!-- Custom styles -->
<!-- MathJax for LaTeX equation rendering -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true,
    processEnvironments: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>

<style>
/* MathJax equation styling */
mjx-container {
  overflow-x: auto;
  overflow-y: hidden;
  max-width: 100%;
}

mjx-container[display="true"] {
  display: block !important;
  margin: 1.5em 0 !important;
  text-align: center;
}

mjx-container[display="true"] svg {
  max-width: 100%;
  height: auto;
}

/* Inline equations */
mjx-container:not([display="true"]) {
  display: inline !important;
  margin: 0 0.1em;
}

/* Equation numbering (if used) */
.MathJax .mjx-mtr {
  margin: 0.25em 0;
}

/* Better scrolling for wide equations on mobile */
@media (max-width: 768px) {
  mjx-container[display="true"] {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
}
</style>

<!-- Custom styles for documentation -->
<link rel="stylesheet" href="/Documentation/style.css?v=2.0.1">
<link rel="stylesheet" href="/Documentation/assets/css/condensed.css?v=2.0.1">
<style>
  /* Widescreen optimized layout */
  body {
    overflow-x: hidden;
    margin: 0;
    padding: 0;
  }
  
  /* Main container - full width */
  #main {
    display: flex;
    position: relative;
    min-height: 100vh;
    width: 100%;
    max-width: 100%;
  }
  
  /* Sidebar fixed to left edge */
  .sidebar.sticky {
    position: fixed;
    left: 0;
    top: 0;
    width: 280px;
    height: 100vh;
    overflow-y: auto;
    background-color: #f8f9fa;
    border-right: 1px solid #e1e4e8;
    padding: 2rem 1rem;
    z-index: 100;
  }
  
  /* Sidebar navigation styling */
  .nav__list {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__title {
    margin: 1.5rem 0 0.5rem;
    padding: 0.25rem 0;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    border-bottom: 1px solid #e1e4e8;
  }
  
  .nav__items {
    margin: 0;
    padding: 0;
    list-style: none;
  }
  
  .nav__items a {
    display: block;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    text-decoration: none;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
  }
  
  .nav__items a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }
  
  .nav__items a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Collapsible navigation sections */
  .nav__item--collapsible {
    margin: 0.25rem 0;
  }

  .nav__item--collapsible details {
    margin: 0;
  }

  .nav__item--collapsible summary {
    display: flex;
    align-items: center;
    padding: 0.3rem 0.75rem;
    font-size: 0.875rem;
    color: #333;
    cursor: pointer;
    border-left: 3px solid transparent;
    transition: all 0.2s ease;
    list-style: none;
  }

  .nav__item--collapsible summary::-webkit-details-marker {
    display: none;
  }

  .nav__item--collapsible summary::before {
    content: "‚ñ∏";
    display: inline-block;
    margin-right: 0.5rem;
    font-size: 0.7rem;
    transition: transform 0.2s ease;
  }

  .nav__item--collapsible details[open] > summary::before {
    transform: rotate(90deg);
  }

  .nav__item--collapsible summary:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
    border-left-color: #0066cc;
  }

  .nav__item--collapsible summary a {
    display: inline;
    padding: 0;
    border-left: none;
    font-weight: 500;
  }

  .nav__item--collapsible summary a:hover {
    background: none;
    border-left: none;
  }

  .nav__item--collapsible summary a.active {
    color: #0066cc;
    font-weight: 600;
    background: none;
    border-left: none;
  }

  /* Nested sub-items */
  .nav__subitems {
    margin: 0;
    padding: 0;
    list-style: none;
    padding-left: 1.25rem;
    border-left: 1px solid #e1e4e8;
    margin-left: 1rem;
  }

  .nav__subitems li {
    margin: 0;
  }

  .nav__subitems a {
    display: block;
    padding: 0.25rem 0.5rem;
    font-size: 0.8125rem;
    color: #555;
    text-decoration: none;
    border-left: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .nav__subitems a:hover {
    color: #0066cc;
    background-color: rgba(0, 102, 204, 0.03);
    border-left-color: #0066cc;
  }

  .nav__subitems a.active {
    color: #0066cc;
    font-weight: 600;
    border-left-color: #0066cc;
    background-color: rgba(0, 102, 204, 0.05);
  }

  /* Content area with left margin for sidebar */
  article.page {
    margin-left: 280px;
    min-height: 100vh;
    background: white;
    width: calc(100% - 280px);
    max-width: none;
  }
  
  /* Content wrapper - use full width */
  .page__inner-wrap {
    max-width: none;
    margin: 0;
    padding: 2rem 3rem;
  }
  
  .page__title {
    margin-top: 0;
    margin-bottom: 2rem;
    font-size: 2.5rem;
    font-weight: 700;
    line-height: 1.2;
  }
  
  /* Let content use available width */
  .page__content {
    max-width: none;
    width: 100%;
  }
  
  /* For optimal reading, constrain just the text paragraphs */
  .page__content > p,
  .page__content > ul,
  .page__content > ol {
    max-width: 65ch;
  }
  
  /* Let code blocks, tables, and special content use full width */
  .page__content pre,
  .page__content table,
  .page__content .noteBoxes,
  .page__content figure,
  .page__content .highlight {
    max-width: 100%;
  }
  
  /* Wide note boxes */
  .noteBoxes {
    width: 90% !important;
    max-width: 800px;
  }
  
  /* Tables use available width */
  table {
    width: 100%;
    max-width: 100%;
  }
  
  /* Code blocks optimization */
  pre {
    max-width: 100%;
    overflow-x: auto;
  }
  
  .highlight {
    max-width: 100%;
    margin: 1rem 0;
  }
  
  /* Responsive adjustments */
  @media (min-width: 2000px) {
    .sidebar.sticky {
      width: 320px;
    }
    
    article.page {
      margin-left: 320px;
      width: calc(100% - 320px);
    }
    
    .page__inner-wrap {
      padding: 2rem 4rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 75ch;
    }
  }
  
  @media (min-width: 1024px) and (max-width: 1439px) {
    .sidebar.sticky {
      width: 250px;
    }
    
    article.page {
      margin-left: 250px;
      width: calc(100% - 250px);
    }
    
    .page__inner-wrap {
      padding: 2rem 2rem;
    }
  }
  
  /* Tablet and mobile */
  @media (max-width: 1023px) {
    #main {
      flex-direction: column;
    }
    
    .sidebar.sticky {
      position: relative;
      width: 100%;
      height: auto;
      border-right: none;
      border-bottom: 1px solid #e1e4e8;
      padding: 1rem;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
    
    .page__inner-wrap {
      padding: 1rem;
    }
    
    .page__content > p,
    .page__content > ul,
    .page__content > ol {
      max-width: 100%;
    }
  }
  
  /* Mobile navigation toggle */
  .nav-toggle {
    display: none;
  }
  
  @media (max-width: 1023px) {
    .nav-toggle {
      display: block;
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 200;
      background: #0066cc;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    
    .sidebar.sticky {
      position: fixed;
      left: -100%;
      top: 0;
      transition: left 0.3s ease;
      z-index: 150;
      height: 100vh;
      width: 280px;
    }
    
    .sidebar.sticky.active {
      left: 0;
    }
    
    .sidebar-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      z-index: 140;
    }
    
    .sidebar-overlay.active {
      display: block;
    }
    
    article.page {
      margin-left: 0;
      width: 100%;
    }
  }
</style>

<!-- Mobile navigation toggle script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Mobile menu functionality
  if (window.innerWidth <= 1023) {
    if (!document.querySelector('.nav-toggle')) {
      const toggleBtn = document.createElement('button');
      toggleBtn.className = 'nav-toggle';
      toggleBtn.innerHTML = '‚ò∞ Menu';
      toggleBtn.setAttribute('aria-label', 'Toggle navigation menu');
      document.body.appendChild(toggleBtn);
      
      const overlay = document.createElement('div');
      overlay.className = 'sidebar-overlay';
      document.body.appendChild(overlay);
      
      toggleBtn.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });
      
      overlay.addEventListener('click', function() {
        const sidebar = document.querySelector('.sidebar.sticky');
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });
    }
  }
  
  // Handle window resize
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const sidebar = document.querySelector('.sidebar.sticky');
      const overlay = document.querySelector('.sidebar-overlay');
      const toggle = document.querySelector('.nav-toggle');
      
      if (window.innerWidth > 1023) {
        if (sidebar) sidebar.classList.remove('active');
        if (overlay) overlay.classList.remove('active');
        if (toggle) toggle.style.display = 'none';
      } else {
        if (toggle) toggle.style.display = 'block';
      }
    }, 250);
  });
});
</script>


  
    <script src="/Documentation/assets/js/custom.js"></script>
  

</head>
<body>
  <div id="main" role="main">
  <aside class="sidebar sticky">
    <nav class="nav__list">
      
        
          <h3 class="nav__title">Navigation</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/topic-map.html"
                       >
                      <span class="nav__sub-title">üó∫Ô∏è Topic Map</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/search.html"
                       >
                      <span class="nav__sub-title">üîç Search</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">üìã Reference Index</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Technology</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/technology/index.html"
                       >
                      <span class="nav__sub-title">Technology Overview</span>
                    </a>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="aws">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/aws/"
                             >
                            AWS
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/compute.html"
                               >
                              Compute
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/storage.html"
                               >
                              Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/databases.html"
                               >
                              Databases
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/networking.html"
                               >
                              Networking
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/security.html"
                               >
                              Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/aws/infrastructure.html"
                               >
                              Infrastructure
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details open data-nav-section="terraform">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/terraform/"
                             >
                            Terraform
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/core-concepts.html"
                               >
                              Core Concepts
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/state-modules.html"
                               class="active">
                              State & Modules
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/patterns.html"
                               >
                              Enterprise Patterns
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/terraform/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="kubernetes">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/kubernetes/"
                             >
                            Kubernetes
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/workloads.html"
                               >
                              Workloads & Storage
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/operations.html"
                               >
                              Operations
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/kubernetes/advanced.html"
                               >
                              Advanced Topics
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                
                  
                  
                  <li class="nav__item--collapsible">
                    <details  data-nav-section="docker">
                      <summary>
                        
                          <a href="/Documentation/docs/technology/docker/"
                             >
                            Docker
                          </a>
                        
                      </summary>
                      <ul class="nav__subitems">
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/fundamentals.html"
                               >
                              Fundamentals
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/storage-security.html"
                               >
                              Storage & Security
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/dockerfiles.html"
                               >
                              Dockerfiles & CI/CD
                            </a>
                          </li>
                        
                          <li>
                            <a href="/Documentation/docs/technology/docker/advanced.html"
                               >
                              Advanced Patterns
                            </a>
                          </li>
                        
                      </ul>
                    </details>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/docker-essentials.html"
                       >
                      <span class="nav__sub-title">Docker Essentials</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git.html"
                       >
                      <span class="nav__sub-title">Git</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/git-reference.html"
                       >
                      <span class="nav__sub-title">Git Command Reference</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/branching.html"
                       >
                      <span class="nav__sub-title">Branching Strategies</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/database-design.html"
                       >
                      <span class="nav__sub-title">Database Design</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/networking.html"
                       >
                      <span class="nav__sub-title">Networking</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/cybersecurity.html"
                       >
                      <span class="nav__sub-title">Cybersecurity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ci-cd.html"
                       >
                      <span class="nav__sub-title">CI/CD</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/unreal.html"
                       >
                      <span class="nav__sub-title">Unreal Engine</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-fundamentals-simple.html"
                       >
                      <span class="nav__sub-title">AI Fundamentals (Simple)</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/ai-lecture-2023.html"
                       >
                      <span class="nav__sub-title">AI Lecture 2023</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/technology/please-build.html"
                       >
                      <span class="nav__sub-title">Please Build</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Specialized Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/distributed-systems/index.html"
                       >
                      <span class="nav__sub-title">Distributed Systems Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/quantum-computing/index.html"
                       >
                      <span class="nav__sub-title">Quantum Computing Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/artificial-intelligence/index.html"
                       >
                      <span class="nav__sub-title">Artificial Intelligence Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/gamedev/index.html"
                       >
                      <span class="nav__sub-title">Game Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/graphics/3d-rendering.html"
                       >
                      <span class="nav__sub-title">3D Graphics & Rendering</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/vr-ar/index.html"
                       >
                      <span class="nav__sub-title">VR/AR Development</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/optimization/index.html"
                       >
                      <span class="nav__sub-title">Performance Optimization</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">AI/ML - Generative AI</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/ai-ml/index.html"
                       >
                      <span class="nav__sub-title">AI/ML Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/stable-diffusion-fundamentals.html"
                       >
                      <span class="nav__sub-title">Stable Diffusion Fundamentals</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/base-models-comparison.html"
                       >
                      <span class="nav__sub-title">Base Models Comparison</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/model-types.html"
                       >
                      <span class="nav__sub-title">Model Types</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/lora-training.html"
                       >
                      <span class="nav__sub-title">LoRA Training</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/controlnet.html"
                       >
                      <span class="nav__sub-title">ControlNet Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/comfyui-guide.html"
                       >
                      <span class="nav__sub-title">ComfyUI Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/output-formats.html"
                       >
                      <span class="nav__sub-title">Output Formats</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/ai-ml/advanced-techniques.html"
                       >
                      <span class="nav__sub-title">Advanced Techniques</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Physics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/physics/index.html"
                       >
                      <span class="nav__sub-title">Physics Overview</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/classical-mechanics.html"
                       >
                      <span class="nav__sub-title">Classical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/thermodynamics.html"
                       >
                      <span class="nav__sub-title">Thermodynamics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/statistical-mechanics.html"
                       >
                      <span class="nav__sub-title">Statistical Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/relativity.html"
                       >
                      <span class="nav__sub-title">Relativity</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-mechanics.html"
                       >
                      <span class="nav__sub-title">Quantum Mechanics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/condensed-matter.html"
                       >
                      <span class="nav__sub-title">Condensed Matter Physics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/quantum-field-theory.html"
                       >
                      <span class="nav__sub-title">Quantum Field Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/string-theory.html"
                       >
                      <span class="nav__sub-title">String Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/physics/computational-physics.html"
                       >
                      <span class="nav__sub-title">Computational Physics</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Advanced Topics</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/advanced/index.html"
                       >
                      <span class="nav__sub-title">Research Hub</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/ai-mathematics/"
                       >
                      <span class="nav__sub-title">AI Mathematics</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/distributed-systems-theory/"
                       >
                      <span class="nav__sub-title">Distributed Systems Theory</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/quantum-algorithms-research/"
                       >
                      <span class="nav__sub-title">Quantum Algorithms Research</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/advanced/monorepo/"
                       >
                      <span class="nav__sub-title">Monorepo Architecture</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
          <h3 class="nav__title">Quick Reference</h3>
          
            <ul class="nav__items">
              
                <li>
                    <a href="/Documentation/docs/reference/index.html"
                       >
                      <span class="nav__sub-title">Reference Guide</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#command-line-references"
                       >
                      <span class="nav__sub-title">Command Cheat Sheets</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#physics-formulas--constants"
                       >
                      <span class="nav__sub-title">Physics Formulas</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#algorithms--data-structures"
                       >
                      <span class="nav__sub-title">Algorithms & Big O</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#api-reference-patterns"
                       >
                      <span class="nav__sub-title">API Patterns</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#troubleshooting-flowcharts"
                       >
                      <span class="nav__sub-title">Troubleshooting</span>
                    </a>
                  </li>
                
              
                <li>
                    <a href="/Documentation/docs/reference/index.html#best-practices-checklists"
                       >
                      <span class="nav__sub-title">Best Practices</span>
                    </a>
                  </li>
                
              
            </ul>
          
        
      
    </nav>
  </aside>

  <article class="page">
    <div class="page__inner-wrap">
      <header>
        <h1 id="page-title" class="page__title">Terraform: State & Modules</h1>
      </header>

      <section class="page__content">
        <h2 id="state-management-in-depth">State Management in Depth</h2>

<h3 id="why-state-is-terraforms-secret-weapon">Why State is Terraform‚Äôs Secret Weapon</h3>

<p>Unlike traditional scripts that run blindly, Terraform maintains a state file that tracks:</p>
<ul>
  <li>What resources it created</li>
  <li>Their current configuration</li>
  <li>Relationships between resources</li>
  <li>Resource metadata and IDs</li>
</ul>

<p>This state enables Terraform to:</p>
<ul>
  <li><strong>Calculate Minimal Changes</strong>: Only update what‚Äôs necessary</li>
  <li><strong>Handle Drift</strong>: Detect when reality doesn‚Äôt match configuration</li>
  <li><strong>Manage Dependencies</strong>: Know the order for updates and deletions</li>
  <li><strong>Enable Collaboration</strong>: Share infrastructure state across teams</li>
</ul>

<h3 id="distributed-state-challenges">Distributed State Challenges</h3>

<p>When teams collaborate on infrastructure, state management becomes a distributed systems problem. Multiple engineers might run Terraform simultaneously, leading to:</p>
<ul>
  <li><strong>Race Conditions</strong>: Two applies modifying the same resource</li>
  <li><strong>State Corruption</strong>: Partial writes creating invalid state</li>
  <li><strong>Lost Updates</strong>: Changes being overwritten</li>
</ul>

<p>Terraform solves these with distributed systems principles:</p>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// State backend interface with consistency guarantees</span>
<span class="k">type</span> <span class="n">StateBackend</span> <span class="k">interface</span> <span class="p">{</span>
    <span class="c">// Lock acquires a distributed lock with timeout</span>
    <span class="n">Lock</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">info</span> <span class="o">*</span><span class="n">LockInfo</span><span class="p">)</span> <span class="p">(</span><span class="n">LockID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    
    <span class="c">// Unlock releases the lock</span>
    <span class="n">Unlock</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">id</span> <span class="n">LockID</span><span class="p">)</span> <span class="kt">error</span>
    
    <span class="c">// Get retrieves state with consistency level</span>
    <span class="n">Get</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">consistency</span> <span class="n">ConsistencyLevel</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="n">State</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
    
    <span class="c">// Put stores state with conditional update</span>
    <span class="n">Put</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">state</span> <span class="o">*</span><span class="n">State</span><span class="p">,</span> <span class="n">condition</span> <span class="o">*</span><span class="n">Condition</span><span class="p">)</span> <span class="kt">error</span>
    
    <span class="c">// Watch monitors state changes</span>
    <span class="n">Watch</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">)</span> <span class="o">&lt;-</span><span class="k">chan</span> <span class="n">StateChange</span>
<span class="p">}</span>

<span class="c">// S3 backend with DynamoDB locking</span>
<span class="k">type</span> <span class="n">S3Backend</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">bucket</span>    <span class="kt">string</span>
    <span class="n">key</span>       <span class="kt">string</span>
    <span class="n">s3Client</span>  <span class="o">*</span><span class="n">s3</span><span class="o">.</span><span class="n">Client</span>
    <span class="n">ddbClient</span> <span class="o">*</span><span class="n">dynamodb</span><span class="o">.</span><span class="n">Client</span>
    <span class="n">lockTable</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="k">func</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">S3Backend</span><span class="p">)</span> <span class="n">Lock</span><span class="p">(</span><span class="n">ctx</span> <span class="n">context</span><span class="o">.</span><span class="n">Context</span><span class="p">,</span> <span class="n">info</span> <span class="o">*</span><span class="n">LockInfo</span><span class="p">)</span> <span class="p">(</span><span class="n">LockID</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">lockID</span> <span class="o">:=</span> <span class="n">generateLockID</span><span class="p">()</span>
    
    <span class="c">// Attempt to acquire lock in DynamoDB</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">err</span> <span class="o">:=</span> <span class="n">b</span><span class="o">.</span><span class="n">ddbClient</span><span class="o">.</span><span class="n">PutItem</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dynamodb</span><span class="o">.</span><span class="n">PutItemInput</span><span class="p">{</span>
        <span class="n">TableName</span><span class="o">:</span> <span class="n">aws</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">lockTable</span><span class="p">),</span>
        <span class="n">Item</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValue</span><span class="p">{</span>
            <span class="s">"LockID"</span><span class="o">:</span>    <span class="o">&amp;</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValueMemberS</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="kt">string</span><span class="p">(</span><span class="n">lockID</span><span class="p">)},</span>
            <span class="s">"Path"</span><span class="o">:</span>      <span class="o">&amp;</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValueMemberS</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">b</span><span class="o">.</span><span class="n">key</span><span class="p">},</span>
            <span class="s">"Info"</span><span class="o">:</span>      <span class="o">&amp;</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValueMemberS</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">info</span><span class="o">.</span><span class="n">String</span><span class="p">()},</span>
            <span class="s">"Created"</span><span class="o">:</span>   <span class="o">&amp;</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValueMemberN</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Unix</span><span class="p">())},</span>
            <span class="s">"TTL"</span><span class="o">:</span>       <span class="o">&amp;</span><span class="n">types</span><span class="o">.</span><span class="n">AttributeValueMemberN</span><span class="p">{</span><span class="n">Value</span><span class="o">:</span> <span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"%d"</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">Now</span><span class="p">()</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">30</span><span class="o">*</span><span class="n">time</span><span class="o">.</span><span class="n">Minute</span><span class="p">)</span><span class="o">.</span><span class="n">Unix</span><span class="p">())},</span>
        <span class="p">},</span>
        <span class="n">ConditionExpression</span><span class="o">:</span> <span class="n">aws</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="s">"attribute_not_exists(LockID)"</span><span class="p">),</span>
    <span class="p">})</span>
    
    <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span>
        <span class="k">var</span> <span class="n">condErr</span> <span class="o">*</span><span class="n">types</span><span class="o">.</span><span class="n">ConditionalCheckFailedException</span>
        <span class="k">if</span> <span class="n">errors</span><span class="o">.</span><span class="n">As</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">condErr</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="n">ErrLockHeld</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s">""</span><span class="p">,</span> <span class="n">err</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">lockID</span><span class="p">,</span> <span class="no">nil</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="advanced-remote-state-configuration">Advanced Remote State Configuration</h3>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># S3 backend with enhanced security and performance</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"terraform-state-${data.aws_caller_identity.current.account_id}"</span>
    <span class="nx">key</span>    <span class="o">=</span> <span class="s2">"${var.project}/${var.environment}/terraform.tfstate"</span>
    <span class="nx">region</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">aws_region</span>
    
    <span class="c1"># DynamoDB table for state locking</span>
    <span class="nx">dynamodb_table</span> <span class="o">=</span> <span class="s2">"terraform-state-locks"</span>
    
    <span class="c1"># Encryption at rest</span>
    <span class="nx">encrypt</span>        <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">kms_key_id</span>     <span class="o">=</span> <span class="s2">"arn:aws:kms:${var.aws_region}:${data.aws_caller_identity.current.account_id}:key/${var.kms_key_id}"</span>
    
    <span class="c1"># Access logging</span>
    <span class="nx">access_logging</span> <span class="p">{</span>
      <span class="nx">target_bucket</span> <span class="o">=</span> <span class="s2">"terraform-state-access-logs"</span>
      <span class="nx">target_prefix</span> <span class="o">=</span> <span class="s2">"state-access/"</span>
    <span class="p">}</span>
    
    <span class="c1"># Workspace key prefix</span>
    <span class="nx">workspace_key_prefix</span> <span class="o">=</span> <span class="s2">"workspaces"</span>
    
    <span class="c1"># Skip metadata API check (for restricted environments)</span>
    <span class="nx">skip_metadata_api_check</span> <span class="o">=</span> <span class="kc">true</span>
    
    <span class="c1"># Custom endpoint for S3-compatible storage</span>
    <span class="nx">endpoint</span> <span class="o">=</span> <span class="nx">var</span><span class="err">.</span><span class="nx">s3_endpoint</span>
    
    <span class="c1"># Force path style for compatibility</span>
    <span class="nx">force_path_style</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">use_path_style</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># State locking table</span>
<span class="nx">resource</span> <span class="s2">"aws_dynamodb_table"</span> <span class="s2">"terraform_locks"</span> <span class="p">{</span>
  <span class="nx">name</span>         <span class="o">=</span> <span class="s2">"terraform-state-locks"</span>
  <span class="nx">billing_mode</span> <span class="o">=</span> <span class="s2">"PAY_PER_REQUEST"</span>
  <span class="nx">hash_key</span>     <span class="o">=</span> <span class="s2">"LockID"</span>
  
  <span class="c1"># TTL for automatic lock cleanup</span>
  <span class="nx">ttl</span> <span class="p">{</span>
    <span class="nx">attribute_name</span> <span class="o">=</span> <span class="s2">"TTL"</span>
    <span class="nx">enabled</span>        <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="c1"># Point-in-time recovery</span>
  <span class="nx">point_in_time_recovery</span> <span class="p">{</span>
    <span class="nx">enabled</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="p">}</span>
  
  <span class="c1"># Global secondary index for querying locks</span>
  <span class="nx">global_secondary_index</span> <span class="p">{</span>
    <span class="nx">name</span>            <span class="o">=</span> <span class="s2">"PathIndex"</span>
    <span class="nx">hash_key</span>        <span class="o">=</span> <span class="s2">"Path"</span>
    <span class="nx">projection_type</span> <span class="o">=</span> <span class="s2">"ALL"</span>
  <span class="p">}</span>
  
  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Purpose</span> <span class="o">=</span> <span class="s2">"TerraformStateLocking"</span>
    <span class="nx">Critical</span> <span class="o">=</span> <span class="s2">"true"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="state-migration-and-refactoring">State Migration and Refactoring</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">StateMigrator</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Handles complex state migrations and refactoring</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">source_backend</span><span class="p">:</span> <span class="n">StateBackend</span><span class="p">,</span> <span class="n">target_backend</span><span class="p">:</span> <span class="n">StateBackend</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source_backend</span>
        <span class="n">self</span><span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">target_backend</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">migrate_with_transformation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> 
                                        <span class="n">transformer</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">State</span><span class="p">],</span> <span class="n">State</span><span class="p">],</span>
                                        <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MigrationResult</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Migrate state with transformation function</span><span class="sh">"""</span>
        
        <span class="c1"># Acquire locks on both backends
</span>        <span class="n">source_lock</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="nf">lock</span><span class="p">(</span><span class="nc">LockInfo</span><span class="p">(</span><span class="sh">"</span><span class="s">migration-read</span><span class="sh">"</span><span class="p">))</span>
        <span class="n">target_lock</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">lock</span><span class="p">(</span><span class="nc">LockInfo</span><span class="p">(</span><span class="sh">"</span><span class="s">migration-write</span><span class="sh">"</span><span class="p">))</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Read source state
</span>            <span class="n">source_state</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">ConsistencyLevel</span><span class="p">.</span><span class="n">STRONG</span><span class="p">)</span>
            
            <span class="c1"># Apply transformation
</span>            <span class="n">target_state</span> <span class="o">=</span> <span class="nf">transformer</span><span class="p">(</span><span class="n">source_state</span><span class="p">)</span>
            
            <span class="c1"># Validate transformed state
</span>            <span class="n">validation_errors</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">validate_state</span><span class="p">(</span><span class="n">target_state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">validation_errors</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">State validation failed: </span><span class="si">{</span><span class="n">validation_errors</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">dry_run</span><span class="p">:</span>
                <span class="c1"># Write to target
</span>                <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">target_state</span><span class="p">,</span> <span class="nc">Condition</span><span class="p">(</span><span class="n">not_exists</span><span class="o">=</span><span class="bp">True</span><span class="p">))</span>
                
                <span class="c1"># Verify write
</span>                <span class="n">verified_state</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">ConsistencyLevel</span><span class="p">.</span><span class="n">STRONG</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">verified_state</span><span class="p">.</span><span class="nf">hash</span><span class="p">()</span> <span class="o">!=</span> <span class="n">target_state</span><span class="p">.</span><span class="nf">hash</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">State verification failed</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="k">return</span> <span class="nc">MigrationResult</span><span class="p">(</span>
                <span class="n">success</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                <span class="n">resources_migrated</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">target_state</span><span class="p">.</span><span class="n">resources</span><span class="p">),</span>
                <span class="n">transformations_applied</span><span class="o">=</span><span class="n">transformer</span><span class="p">.</span><span class="n">transformations_count</span>
            <span class="p">)</span>
            
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Always release locks
</span>            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">source</span><span class="p">.</span><span class="nf">unlock</span><span class="p">(</span><span class="n">source_lock</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">target</span><span class="p">.</span><span class="nf">unlock</span><span class="p">(</span><span class="n">target_lock</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="terraform-workspaces">Terraform Workspaces</h2>

<h3 id="managing-multiple-environments">Managing Multiple Environments</h3>

<p>Terraform workspaces provide a way to manage multiple deployments of the same infrastructure configuration. Think of workspaces as parallel universes for your infrastructure - each with its own state file but sharing the same configuration code.</p>

<h3 id="understanding-workspaces">Understanding Workspaces</h3>

<p>By default, you‚Äôre working in a workspace called ‚Äúdefault‚Äù. Each workspace maintains its own state file, allowing you to deploy the same configuration multiple times without conflicts.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># List all workspaces (* indicates current)</span>
terraform workspace list
<span class="c"># Output:</span>
<span class="c"># * default</span>
<span class="c">#   dev</span>
<span class="c">#   staging</span>
<span class="c">#   production</span>

<span class="c"># Create a new workspace</span>
terraform workspace new dev

<span class="c"># Switch between workspaces</span>
terraform workspace <span class="k">select </span>production

<span class="c"># Show current workspace</span>
terraform workspace show
</code></pre></div></div>

<h3 id="workspace-aware-configuration">Workspace-Aware Configuration</h3>

<p>Make your configuration adapt to the current workspace:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Use workspace name in resource naming</span>
<span class="nx">resource</span> <span class="s2">"aws_s3_bucket"</span> <span class="s2">"app_data"</span> <span class="p">{</span>
  <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"${var.project}-${terraform.workspace}-data"</span>
  
  <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Environment</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span>
    <span class="nx">Project</span>     <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">project</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Different instance types per environment</span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">instance_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">default</span>    <span class="o">=</span> <span class="s2">"t3.micro"</span>
    <span class="nx">dev</span>        <span class="o">=</span> <span class="s2">"t3.small"</span>
    <span class="nx">staging</span>    <span class="o">=</span> <span class="s2">"t3.medium"</span>
    <span class="nx">production</span> <span class="o">=</span> <span class="s2">"m5.large"</span>
  <span class="p">}</span>
  
  <span class="nx">instance_type</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">instance_types</span><span class="p">[</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">]</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app"</span> <span class="p">{</span>
  <span class="nx">instance_type</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">instance_type</span>
  
  <span class="c1"># Only enable detailed monitoring in production</span>
  <span class="nx">monitoring</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span> <span class="o">==</span> <span class="s2">"production"</span>
<span class="p">}</span>

<span class="c1"># Workspace-specific variable files</span>
<span class="nx">variable</span> <span class="s2">"replicas"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">dev</span>        <span class="o">=</span> <span class="mi">1</span>
    <span class="nx">staging</span>    <span class="o">=</span> <span class="mi">2</span>
    <span class="nx">production</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"aws_autoscaling_group"</span> <span class="s2">"app"</span> <span class="p">{</span>
  <span class="nx">min_size</span> <span class="o">=</span> <span class="nx">lookup</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">replicas</span><span class="p">,</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="nx">max_size</span> <span class="o">=</span> <span class="nx">lookup</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">replicas</span><span class="p">,</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">*</span> <span class="mi">2</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="advanced-workspace-patterns">Advanced Workspace Patterns</h3>

<h4 id="pattern-1-environment-isolation">Pattern 1: Environment Isolation</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Complete environment isolation</span>
<span class="nx">module</span> <span class="s2">"vpc"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"./modules/vpc"</span>
  
  <span class="nx">cidr_block</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">vpc_cidrs</span><span class="p">[</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">]</span>
  
  <span class="c1"># Prevent accidental cross-environment references</span>
  <span class="nx">enable_vpc_peering</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span> <span class="o">==</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="kc">false</span> <span class="o">:</span> <span class="kc">true</span>
  
  <span class="c1"># Different availability zones per environment</span>
  <span class="nx">availability_zones</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">aws_availability_zones</span><span class="p">.</span><span class="nx">available</span><span class="p">.</span><span class="nx">names</span><span class="p">[</span>
    <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span> <span class="o">==</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="s2">"0:3"</span> <span class="o">:</span> <span class="s2">"0:2"</span>
  <span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Separate state buckets per workspace</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"terraform-state"</span>
    <span class="nx">key</span>    <span class="o">=</span> <span class="s2">"infrastructure/${terraform.workspace}/terraform.tfstate"</span>
    <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-east-1"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="pattern-2-feature-flags">Pattern 2: Feature Flags</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Enable features progressively across environments</span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">dev</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">enable_waf</span>          <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">enable_backup</span>       <span class="o">=</span> <span class="kc">false</span>
      <span class="nx">enable_monitoring</span>   <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_auto_scaling</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="nx">staging</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">enable_waf</span>          <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_backup</span>       <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_monitoring</span>   <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_auto_scaling</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
    <span class="nx">production</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">enable_waf</span>          <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_backup</span>       <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_monitoring</span>   <span class="o">=</span> <span class="kc">true</span>
      <span class="nx">enable_auto_scaling</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">current_features</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">features</span><span class="p">[</span><span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># Conditionally create resources</span>
<span class="nx">resource</span> <span class="s2">"aws_wafv2_web_acl"</span> <span class="s2">"main"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">current_features</span><span class="p">.</span><span class="nx">enable_waf</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span>
  
  <span class="nx">name</span>  <span class="o">=</span> <span class="s2">"${var.project}-${terraform.workspace}-waf"</span>
  <span class="nx">scope</span> <span class="o">=</span> <span class="s2">"REGIONAL"</span>
  
  <span class="c1"># WAF rules...</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="workspace-best-practices">Workspace Best Practices</h3>

<h4 id="1-naming-conventions">1. Naming Conventions</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Consistent naming across resources</span>
<span class="nx">locals</span> <span class="p">{</span>
  <span class="c1"># Standard name prefix</span>
  <span class="nx">name_prefix</span> <span class="o">=</span> <span class="s2">"${var.organization}-${var.project}-${terraform.workspace}"</span>
  
  <span class="c1"># Common tags for all resources</span>
  <span class="nx">common_tags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">Organization</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">organization</span>
    <span class="nx">Project</span>      <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">project</span>
    <span class="nx">Environment</span>  <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span>
    <span class="nx">ManagedBy</span>    <span class="o">=</span> <span class="s2">"terraform"</span>
    <span class="nx">Workspace</span>    <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Use in all resources</span>
<span class="nx">resource</span> <span class="s2">"aws_instance"</span> <span class="s2">"app"</span> <span class="p">{</span>
  <span class="nx">tags</span> <span class="o">=</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">local</span><span class="p">.</span><span class="nx">common_tags</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Name</span> <span class="o">=</span> <span class="s2">"${local.name_prefix}-app-server"</span>
    <span class="nx">Role</span> <span class="o">=</span> <span class="s2">"application"</span>
  <span class="p">})</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="2-workspace-validation">2. Workspace Validation</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Ensure workspace names follow conventions</span>
<span class="nx">variable</span> <span class="s2">"allowed_workspaces"</span> <span class="p">{</span>
  <span class="nx">default</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"dev"</span><span class="p">,</span> <span class="s2">"staging"</span><span class="p">,</span> <span class="s2">"production"</span><span class="p">,</span> <span class="s2">"dr"</span><span class="p">]</span>
<span class="p">}</span>

<span class="nx">locals</span> <span class="p">{</span>
  <span class="nx">workspace_valid</span> <span class="o">=</span> <span class="nx">contains</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">allowed_workspaces</span><span class="p">,</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span><span class="p">)</span>
<span class="p">}</span>

<span class="nx">resource</span> <span class="s2">"null_resource"</span> <span class="s2">"workspace_validator"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">local</span><span class="p">.</span><span class="nx">workspace_valid</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span>
  
  <span class="nx">provisioner</span> <span class="s2">"local-exec"</span> <span class="p">{</span>
    <span class="nx">command</span> <span class="o">=</span> <span class="s2">"echo 'ERROR: Workspace ${terraform.workspace} is not allowed' &amp;&amp; exit 1"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="3-cost-management">3. Cost Management</h4>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Automatic resource cleanup for non-production</span>
<span class="nx">resource</span> <span class="s2">"aws_lambda_function"</span> <span class="s2">"auto_shutdown"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span> <span class="o">!=</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span>
  
  <span class="nx">function_name</span> <span class="o">=</span> <span class="s2">"${local.name_prefix}-auto-shutdown"</span>
  
  <span class="nx">environment</span> <span class="p">{</span>
    <span class="nx">variables</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">WORKSPACE</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span>
      <span class="nx">TAG_KEY</span>   <span class="o">=</span> <span class="s2">"Environment"</span>
      <span class="nx">TAG_VALUE</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># CloudWatch event for nightly shutdown</span>
<span class="nx">resource</span> <span class="s2">"aws_cloudwatch_event_rule"</span> <span class="s2">"shutdown_schedule"</span> <span class="p">{</span>
  <span class="nx">count</span> <span class="o">=</span> <span class="nx">terraform</span><span class="p">.</span><span class="nx">workspace</span> <span class="o">!=</span> <span class="s2">"production"</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span>
  
  <span class="nx">name</span>                <span class="o">=</span> <span class="s2">"${local.name_prefix}-shutdown"</span>
  <span class="nx">schedule_expression</span> <span class="o">=</span> <span class="s2">"cron(0 2 * * ? *)"</span>  <span class="c1"># 2 AM UTC daily</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="workspace-limitations-and-alternatives">Workspace Limitations and Alternatives</h3>

<p>While workspaces are useful, they have limitations:</p>

<ol>
  <li><strong>Single Configuration</strong>: All workspaces share the same Terraform configuration</li>
  <li><strong>State Isolation Only</strong>: No configuration isolation between environments</li>
  <li><strong>Limited Flexibility</strong>: Can‚Äôt have different modules per environment</li>
</ol>

<h4 id="alternative-directory-structure">Alternative: Directory Structure</h4>

<p>For more complex scenarios, consider separate directories:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>infrastructure/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ dev/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ       ‚îî‚îÄ‚îÄ terraform.tfvars
‚îî‚îÄ‚îÄ modules/
    ‚îú‚îÄ‚îÄ networking/
    ‚îú‚îÄ‚îÄ compute/
    ‚îî‚îÄ‚îÄ database/
</code></pre></div></div>

<h4 id="alternative-terragrunt">Alternative: Terragrunt</h4>

<p>For DRY (Don‚Äôt Repeat Yourself) configurations:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># terragrunt.hcl in environment directory</span>
<span class="nx">terraform</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"../../../modules//app-stack"</span>
<span class="p">}</span>

<span class="nx">inputs</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">environment</span>     <span class="o">=</span> <span class="s2">"production"</span>
  <span class="nx">instance_count</span>  <span class="o">=</span> <span class="mi">10</span>
  <span class="nx">instance_type</span>   <span class="o">=</span> <span class="s2">"m5.xlarge"</span>
  <span class="nx">enable_autoscaling</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="workspace-migration-strategies">Workspace Migration Strategies</h3>

<p>When moving resources between workspaces:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Export resource from source workspace</span>
terraform workspace <span class="k">select </span>source-workspace
terraform state pull <span class="o">&gt;</span> source-state.json

<span class="c"># Extract specific resources</span>
jq <span class="s1">'.resources[] | select(.type == "aws_instance")'</span> source-state.json <span class="o">&gt;</span> resources.json

<span class="c"># Import to target workspace</span>
terraform workspace <span class="k">select </span>target-workspace
terraform import aws_instance.app i-1234567890abcdef0

<span class="c"># Verify state</span>
terraform plan
</code></pre></div></div>

<h2 id="outputs-and-remote-state-management">Outputs and Remote State Management</h2>

<p>Outputs in Terraform are used to display specific values from your configuration after it is applied.</p>

<h3 id="defining-outputs">Defining Outputs</h3>

<p>Create a new file named <code class="language-plaintext highlighter-rouge">outputs.tf</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">touch </span>outputs.tf
</code></pre></div></div>

<p>Open <code class="language-plaintext highlighter-rouge">outputs.tf</code> and add the following output definition:</p>

<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">output</span> <span class="s2">"bucket_arn"</span> <span class="p">{</span>
  <span class="nx">description</span> <span class="o">=</span> <span class="s2">"The Amazon Resource Name (ARN) of the created S3 bucket"</span>
  <span class="nx">value</span>       <span class="o">=</span> <span class="nx">aws_s3_bucket</span><span class="p">.</span><span class="nx">example_bucket</span><span class="p">.</span><span class="nx">arn</span>
<span class="p">}</span>
</code></pre></div></div>

<p>After applying your configuration with <code class="language-plaintext highlighter-rouge">terraform apply</code>, the output value will be displayed.</p>

<h3 id="remote-state-management">Remote State Management</h3>

<p>By default, Terraform stores the state of your infrastructure in a local file named <code class="language-plaintext highlighter-rouge">terraform.tfstate</code>. To store the state remotely and enable collaboration, you can use remote state backends like Amazon S3.</p>

<p>To configure a remote backend, update your <code class="language-plaintext highlighter-rouge">main.tf</code> file with the following code:</p>

<div class="language-terraform highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">terraform</span> <span class="p">{</span>
  <span class="nx">backend</span> <span class="s2">"s3"</span> <span class="p">{</span>
    <span class="nx">bucket</span> <span class="o">=</span> <span class="s2">"my-terraform-state-bucket"</span>
    <span class="nx">key</span>    <span class="o">=</span> <span class="s2">"terraform-aws-example/terraform.tfstate"</span>
    <span class="nx">region</span> <span class="o">=</span> <span class="s2">"us-west-2"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Replace <code class="language-plaintext highlighter-rouge">"my-terraform-state-bucket"</code> with the name of an existing S3 bucket in your AWS account. The <code class="language-plaintext highlighter-rouge">key</code> specifies the path in the bucket where the state file will be stored.</p>

<p>After updating the <code class="language-plaintext highlighter-rouge">main.tf</code>, run <code class="language-plaintext highlighter-rouge">terraform init</code> again:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>terraform init
</code></pre></div></div>

<p>Terraform will prompt you to confirm the migration of the local state to the remote backend. Type <code class="language-plaintext highlighter-rouge">yes</code> and press Enter to proceed. From now on, Terraform will store the state in the specified S3 bucket.</p>

<h2 id="mastering-terraform-modules">Mastering Terraform Modules</h2>

<h3 id="from-copy-paste-to-composable-infrastructure">From Copy-Paste to Composable Infrastructure</h3>

<p>Every Terraform journey follows a similar pattern:</p>
<ol>
  <li>Start with a single <code class="language-plaintext highlighter-rouge">main.tf</code> file</li>
  <li>Copy configurations for new environments</li>
  <li>Realize copying leads to drift and maintenance burden</li>
  <li>Discover modules as the solution</li>
</ol>

<p>Modules transform infrastructure from scattered scripts to composable, reusable components. Think of them as functions for infrastructure - they take inputs, create resources, and return outputs.</p>

<h3 id="advanced-module-patterns">Advanced Module Patterns</h3>

<p>As you mature in module usage, you‚Äôll discover patterns that mirror software engineering principles:</p>

<div class="language-hcl highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Generic module interface pattern</span>
<span class="nx">module</span> <span class="s2">"generic_app"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"./modules/composable-app"</span>
  
  <span class="c1"># Module composition using higher-order modules</span>
  <span class="nx">providers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">aws</span><span class="p">.</span><span class="nx">primary</span>   <span class="o">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">us_east_1</span>
    <span class="nx">aws</span><span class="p">.</span><span class="nx">secondary</span> <span class="o">=</span> <span class="nx">aws</span><span class="p">.</span><span class="nx">us_west_2</span>
  <span class="p">}</span>
  
  <span class="c1"># Dependency injection pattern</span>
  <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">network</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">network</span>
    <span class="nx">security</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">security</span>
    <span class="nx">monitoring</span> <span class="o">=</span> <span class="nx">module</span><span class="p">.</span><span class="nx">monitoring</span>
  <span class="p">}</span>
  
  <span class="c1"># Feature flags for conditional composition</span>
  <span class="nx">features</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">multi_region</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">auto_scaling</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">blue_green</span>   <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">canary</span>       <span class="o">=</span> <span class="kc">false</span>
  <span class="p">}</span>
  
  <span class="c1"># Dynamic configuration</span>
  <span class="nx">for_each</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">applications</span>
  
  <span class="nx">app_config</span> <span class="o">=</span> <span class="nx">each</span><span class="p">.</span><span class="nx">value</span>
<span class="p">}</span>

<span class="c1"># Module with advanced type constraints</span>
<span class="nx">module</span> <span class="s2">"typed_infrastructure"</span> <span class="p">{</span>
  <span class="nx">source</span> <span class="o">=</span> <span class="s2">"./modules/typed-infra"</span>
  
  <span class="c1"># Type-safe configuration using experiments</span>
  <span class="nx">configuration</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">compute</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">instances</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">for</span> <span class="nx">i</span> <span class="nx">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">instance_count</span><span class="p">)</span> <span class="o">:</span> <span class="p">{</span>
          <span class="nx">name</span> <span class="o">=</span> <span class="s2">"instance-${i}"</span>
          <span class="nx">type</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">instance_types</span><span class="p">[</span><span class="nx">i</span> <span class="o">%</span> <span class="nx">length</span><span class="p">(</span><span class="nx">var</span><span class="p">.</span><span class="nx">instance_types</span><span class="p">)]</span>
          
          <span class="c1"># Conditional nested objects</span>
          <span class="nx">monitoring</span> <span class="o">=</span> <span class="nx">var</span><span class="p">.</span><span class="nx">enable_monitoring</span> <span class="o">?</span> <span class="p">{</span>
            <span class="nx">detailed</span> <span class="o">=</span> <span class="kc">true</span>
            <span class="nx">interval</span> <span class="o">=</span> <span class="mi">60</span>
          <span class="p">}</span> <span class="o">:</span> <span class="kc">null</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="module-testing-framework">Module Testing Framework</h3>

<div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// Terratest-style module testing</span>
<span class="k">func</span> <span class="n">TestComposableAppModule</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="o">.</span><span class="n">Parallel</span><span class="p">()</span>
    
    <span class="c">// Test matrix for different configurations</span>
    <span class="n">testCases</span> <span class="o">:=</span> <span class="p">[]</span><span class="k">struct</span> <span class="p">{</span>
        <span class="n">name</span>     <span class="kt">string</span>
        <span class="n">vars</span>     <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}</span>
        <span class="n">validate</span> <span class="k">func</span><span class="p">(</span><span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="o">*</span><span class="n">terraform</span><span class="o">.</span><span class="n">Options</span><span class="p">,</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{})</span>
    <span class="p">}{</span>
        <span class="p">{</span>
            <span class="n">name</span><span class="o">:</span> <span class="s">"multi-region-deployment"</span><span class="p">,</span>
            <span class="n">vars</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span>
                <span class="s">"features"</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
                    <span class="s">"multi_region"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"auto_scaling"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="n">validate</span><span class="o">:</span> <span class="n">validateMultiRegion</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="n">name</span><span class="o">:</span> <span class="s">"single-region-basic"</span><span class="p">,</span>
            <span class="n">vars</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="k">interface</span><span class="p">{}{</span>
                <span class="s">"features"</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">bool</span><span class="p">{</span>
                    <span class="s">"multi_region"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
                    <span class="s">"auto_scaling"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
                <span class="p">},</span>
            <span class="p">},</span>
            <span class="n">validate</span><span class="o">:</span> <span class="n">validateSingleRegion</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tc</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">testCases</span> <span class="p">{</span>
        <span class="n">tc</span> <span class="o">:=</span> <span class="n">tc</span> <span class="c">// Capture range variable</span>
        
        <span class="n">t</span><span class="o">.</span><span class="n">Run</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="k">func</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span><span class="n">testing</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">t</span><span class="o">.</span><span class="n">Parallel</span><span class="p">()</span>
            
            <span class="n">terraformOptions</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="n">terraform</span><span class="o">.</span><span class="n">Options</span><span class="p">{</span>
                <span class="n">TerraformDir</span><span class="o">:</span> <span class="s">"../../modules/composable-app"</span><span class="p">,</span>
                <span class="n">Vars</span><span class="o">:</span>         <span class="n">tc</span><span class="o">.</span><span class="n">vars</span><span class="p">,</span>
                <span class="n">NoColor</span><span class="o">:</span>      <span class="no">true</span><span class="p">,</span>
                
                <span class="c">// Retry configuration for flaky resources</span>
                <span class="n">RetryableTerraformErrors</span><span class="o">:</span> <span class="k">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
                    <span class="s">".*timeout.*"</span><span class="o">:</span> <span class="s">"Timeout error occurred"</span><span class="p">,</span>
                    <span class="s">".*rate limit.*"</span><span class="o">:</span> <span class="s">"Rate limit hit"</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="n">MaxRetries</span><span class="o">:</span> <span class="m">3</span><span class="p">,</span>
                <span class="n">TimeBetweenRetries</span><span class="o">:</span> <span class="m">5</span> <span class="o">*</span> <span class="n">time</span><span class="o">.</span><span class="n">Second</span><span class="p">,</span>
            <span class="p">}</span>
            
            <span class="c">// Clean up resources</span>
            <span class="k">defer</span> <span class="n">terraform</span><span class="o">.</span><span class="n">Destroy</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">terraformOptions</span><span class="p">)</span>
            
            <span class="c">// Deploy infrastructure</span>
            <span class="n">terraform</span><span class="o">.</span><span class="n">InitAndApply</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">terraformOptions</span><span class="p">)</span>
            
            <span class="c">// Get outputs</span>
            <span class="n">outputs</span> <span class="o">:=</span> <span class="n">terraform</span><span class="o">.</span><span class="n">OutputAll</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">terraformOptions</span><span class="p">)</span>
            
            <span class="c">// Run validations</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">terraformOptions</span><span class="p">,</span> <span class="n">outputs</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="module-registry-protocol">Module Registry Protocol</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ModuleRegistry</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">Implementation of Terraform Module Registry Protocol</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">base_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">aiohttp</span><span class="p">.</span><span class="nc">ClientSession</span><span class="p">()</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">discover</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">Implement service discovery</span><span class="sh">"""</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/.well-known/terraform.json</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_versions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sh">"""</span><span class="s">List available module versions</span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/modules/</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s">/versions</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="sh">"</span><span class="s">version</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">modules</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">versions</span><span class="sh">"</span><span class="p">]]</span>
    
    <span class="k">async</span> <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">provider</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Get module download URL</span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/v1/modules/</span><span class="si">{</span><span class="n">namespace</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">provider</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">version</span><span class="si">}</span><span class="s">/download</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">self</span><span class="p">.</span><span class="n">session</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        
        <span class="c1"># Follow redirect to actual download URL
</span>        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">204</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="sh">"</span><span class="s">X-Terraform-Get</span><span class="sh">"</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="k">await</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">download_url</span><span class="sh">"</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">generate_lock_file</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ModuleRef</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">Generate module lock file for reproducible builds</span><span class="sh">"""</span>
        <span class="n">lock_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">version</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">modules</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">modules</span><span class="p">:</span>
            <span class="n">lock_data</span><span class="p">[</span><span class="sh">"</span><span class="s">modules</span><span class="sh">"</span><span class="p">][</span><span class="n">module</span><span class="p">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">source</span><span class="sh">"</span><span class="p">:</span> <span class="n">module</span><span class="p">.</span><span class="n">source</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">version</span><span class="sh">"</span><span class="p">:</span> <span class="n">module</span><span class="p">.</span><span class="n">version</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">hash</span><span class="sh">"</span><span class="p">:</span> <span class="n">module</span><span class="p">.</span><span class="nf">calculate_hash</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">dependencies</span><span class="sh">"</span><span class="p">:</span> <span class="n">module</span><span class="p">.</span><span class="n">dependencies</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">lock_data</span>
</code></pre></div></div>

<h2 id="real-world-case-studies">Real-World Case Studies</h2>

<h3 id="learning-from-production-deployments">Learning from Production Deployments</h3>


      </section>
    </div>
  </article>
</div>
</body>
</html>