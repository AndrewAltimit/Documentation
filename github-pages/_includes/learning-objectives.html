{% comment %}
  Learning Objectives Component
  
  Usage: {% include learning-objectives.html objectives=page.learning_objectives %}
  
  Parameters:
  - objectives: Array of learning objective strings
  - expandable: Boolean - Whether to initially collapse objectives (default: false)
{% endcomment %}

{% assign expandable = include.expandable | default: false %}

<div class="learning-objectives {% if expandable %}expandable{% endif %}">
  <div class="objectives-header">
    <h3>
      <i class="fas fa-bullseye"></i>
      What You'll Learn
    </h3>
    {% if expandable %}
    <button class="expand-btn" onclick="toggleObjectives(this)">
      <i class="fas fa-chevron-down"></i>
    </button>
    {% endif %}
  </div>
  
  <div class="objectives-content" {% if expandable %}style="display: none;"{% endif %}>
    <ul class="objectives-list">
      {% for objective in include.objectives %}
        <li class="objective-item" data-objective-index="{{ forloop.index }}">
          <div class="objective-checkbox">
            <input type="checkbox" 
                   id="objective-{{ forloop.index }}" 
                   onchange="updateObjectiveProgress({{ forloop.index }})">
            <label for="objective-{{ forloop.index }}"></label>
          </div>
          <span class="objective-text">{{ objective }}</span>
        </li>
      {% endfor %}
    </ul>
    
    <div class="objectives-progress">
      <div class="progress-bar">
        <div class="progress-fill" style="width: 0%"></div>
      </div>
      <span class="progress-text">0 of {{ include.objectives | size }} completed</span>
    </div>
  </div>
</div>

<style>
.learning-objectives {
  background: linear-gradient(135deg, #f5f7ff 0%, #f0f4ff 100%);
  border: 1px solid #d4ddfc;
  border-radius: 12px;
  padding: 1.5rem;
  margin: 2rem 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.objectives-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.objectives-header h3 {
  margin: 0;
  font-size: 1.25rem;
  color: #2c3e50;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.objectives-header h3 i {
  color: #5b7dff;
}

.expand-btn {
  background: none;
  border: 1px solid #d4ddfc;
  border-radius: 4px;
  padding: 0.25rem 0.5rem;
  cursor: pointer;
  color: #5b7dff;
  transition: all 0.2s;
}

.expand-btn:hover {
  background: #5b7dff;
  color: white;
}

.expand-btn i {
  transition: transform 0.3s;
}

.expand-btn.expanded i {
  transform: rotate(180deg);
}

.objectives-list {
  list-style: none;
  padding: 0;
  margin: 0 0 1rem 0;
}

.objective-item {
  display: flex;
  align-items: flex-start;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  background: white;
  border-radius: 8px;
  transition: all 0.3s;
  position: relative;
  overflow: hidden;
}

.objective-item::before {
  content: "";
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 4px;
  background: #5b7dff;
  transform: translateX(-100%);
  transition: transform 0.3s;
}

.objective-item.completed::before {
  transform: translateX(0);
}

.objective-item:hover {
  transform: translateX(4px);
  box-shadow: 0 2px 8px rgba(91, 125, 255, 0.1);
}

.objective-checkbox {
  margin-right: 1rem;
  position: relative;
}

.objective-checkbox input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  cursor: pointer;
}

.objective-checkbox label {
  display: block;
  width: 24px;
  height: 24px;
  border: 2px solid #d4ddfc;
  border-radius: 6px;
  position: relative;
  cursor: pointer;
  transition: all 0.3s;
}

.objective-checkbox input[type="checkbox"]:checked + label {
  background: #5b7dff;
  border-color: #5b7dff;
}

.objective-checkbox input[type="checkbox"]:checked + label::after {
  content: "";
  position: absolute;
  left: 8px;
  top: 4px;
  width: 6px;
  height: 12px;
  border: solid white;
  border-width: 0 2px 2px 0;
  transform: rotate(45deg);
}

.objective-text {
  flex: 1;
  color: #4a5568;
  line-height: 1.5;
  padding-top: 2px;
}

.objective-item.completed .objective-text {
  color: #718096;
  text-decoration: line-through;
}

.objectives-progress {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.progress-bar {
  flex: 1;
  height: 8px;
  background: #e2e8f0;
  border-radius: 4px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, #5b7dff 0%, #4c63d2 100%);
  transition: width 0.3s ease;
  border-radius: 4px;
}

.progress-text {
  font-size: 0.875rem;
  color: #718096;
  font-weight: 500;
  white-space: nowrap;
}

/* Animation for completion */
@keyframes checkmarkPop {
  0% {
    transform: scale(0) rotate(45deg);
  }
  40% {
    transform: scale(1.3) rotate(45deg);
  }
  100% {
    transform: scale(1) rotate(45deg);
  }
}

.objective-checkbox input[type="checkbox"]:checked + label::after {
  animation: checkmarkPop 0.3s ease;
}

/* Responsive design */
@media (max-width: 768px) {
  .learning-objectives {
    padding: 1rem;
  }
  
  .objectives-header h3 {
    font-size: 1.1rem;
  }
  
  .objective-item {
    padding: 0.5rem;
  }
  
  .objective-checkbox {
    margin-right: 0.75rem;
  }
  
  .objective-checkbox label {
    width: 20px;
    height: 20px;
  }
  
  .objective-text {
    font-size: 0.9rem;
  }
}
</style>

<script>
// Load saved progress on page load
document.addEventListener('DOMContentLoaded', function() {
  const pageId = '{{ page.id }}';
  const savedProgress = JSON.parse(localStorage.getItem(`objectives_${pageId}`) || '[]');
  
  savedProgress.forEach(index => {
    const checkbox = document.getElementById(`objective-${index}`);
    if (checkbox) {
      checkbox.checked = true;
      checkbox.closest('.objective-item').classList.add('completed');
    }
  });
  
  updateProgressBar();
});

function toggleObjectives(button) {
  const content = button.closest('.learning-objectives').querySelector('.objectives-content');
  const isHidden = content.style.display === 'none';
  
  content.style.display = isHidden ? 'block' : 'none';
  button.classList.toggle('expanded', isHidden);
}

function updateObjectiveProgress(index) {
  const checkbox = document.getElementById(`objective-${index}`);
  const item = checkbox.closest('.objective-item');
  const pageId = '{{ page.id }}';
  
  // Toggle completed class
  item.classList.toggle('completed', checkbox.checked);
  
  // Save to localStorage
  let savedProgress = JSON.parse(localStorage.getItem(`objectives_${pageId}`) || '[]');
  
  if (checkbox.checked) {
    if (!savedProgress.includes(index)) {
      savedProgress.push(index);
    }
  } else {
    savedProgress = savedProgress.filter(i => i !== index);
  }
  
  localStorage.setItem(`objectives_${pageId}`, JSON.stringify(savedProgress));
  
  // Update progress bar
  updateProgressBar();
  
  // If all objectives completed, trigger celebration
  const totalObjectives = document.querySelectorAll('.objective-checkbox input').length;
  const completedObjectives = document.querySelectorAll('.objective-checkbox input:checked').length;
  
  if (completedObjectives === totalObjectives && totalObjectives > 0) {
    celebrateCompletion();
  }
}

function updateProgressBar() {
  const total = document.querySelectorAll('.objective-checkbox input').length;
  const completed = document.querySelectorAll('.objective-checkbox input:checked').length;
  const percentage = total > 0 ? (completed / total) * 100 : 0;
  
  document.querySelector('.progress-fill').style.width = `${percentage}%`;
  document.querySelector('.progress-text').textContent = `${completed} of ${total} completed`;
}

function celebrateCompletion() {
  // Add a celebration animation or notification
  const objectives = document.querySelector('.learning-objectives');
  objectives.style.animation = 'pulse 0.5s ease';
  
  setTimeout(() => {
    objectives.style.animation = '';
  }, 500);
}

// CSS for pulse animation
const style = document.createElement('style');
style.textContent = `
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
  }
`;
document.head.appendChild(style);
</script>